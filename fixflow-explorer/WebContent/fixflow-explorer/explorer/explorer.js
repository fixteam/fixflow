/**
 * Copyright (c) 2009 - Signavio GmbH
 *
 * 
 * 
 *
 * Ext JS (http://extjs.com/) is used under the terms of the Open Source LGPL 3.0
 * license.
 * The license and the source files can be found in our SVN repository at:
 * http://oryx-editor.googlecode.com/.
 *
 **/if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}Signavio.Core.Version="7.4.0";XMLNS={ATOM:"http://www.w3.org/2005/Atom",XHTML:"http://www.w3.org/1999/xhtml",ERDF:"http://purl.org/NET/erdf/profile",RDFS:"http://www.w3.org/2000/01/rdf-schema#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RAZIEL:"http://b3mn.org/Raziel",SCHEMA:""};if(!Signavio){var Signavio={}}if(!Signavio.Config){Signavio.Config={}}if(!Signavio.Config.Mode){Signavio.Config.Mode={}}if(!Signavio.Const){Signavio.Const={}}Signavio.Config.SUPPORTMAILADDRESS="support@signavio.com";Signavio.Config.SUPPORTPHONENUMBER="+49 30 8562154-21";Signavio.Config.APPLICATION="explorer";Signavio.Config.EXPLORER_PATH="/explorer";Signavio.Config.APPLICATION_NAME="Explorer";Signavio.Config.EDITOR_PATH="/editor";Signavio.Config.STENCILSET_EXTENSION_PATH="/stencilsets/extensions/";Signavio.Config.STENCILSET_PATH="/stencilsets";Signavio.Config.SSEXTENSIONS_PATH="/editor_ssextensions";Signavio.Config.BACKEND_PATH="/p";Signavio.Config.IMAGE_PATH="/images";Signavio.Config.SPREADSHEET_PATH="/quickmodel";Signavio.Config.DIAGRAMS_IMAGE_PATH=Signavio.Config.IMAGE_PATH+"";Signavio.Config.GLOSSARY_PATH="/glossary";Signavio.Config.META_MODELLINGGUIDELINES_PATH="/mgrules";Signavio.Config.META_MODELLINGGUIDELINES_CONFIG_PATH="/mgconfig";Signavio.Config.VIEW_MODELLINGGUIDELINES_CONFIG_PATH="/mgviewconfig";Signavio.Config.LIBS_PATH="/libs";Signavio.Config.LIBS_PATH=(" "+window.location.pathname).split(/\//g).slice(3).map(function(){return"/.."}).join("")+Signavio.Config.LIBS_PATH;Signavio.Config.PATH=Signavio.Config.EXPLORER_PATH+"/src/javascript";Signavio.Config.PLUGIN_PATH=Signavio.Config.EXPLORER_PATH+"/src/javascript/plugins";Signavio.Config.EDITOR_HANDLER_URI=Signavio.Config.BACKEND_PATH+"/editor";Signavio.Config.SPREADSHEET_EDITOR_HANDLER_URI=Signavio.Config.BACKEND_PATH+"/quickmodel";Signavio.Config.SIMULATION_HANDLER_URI=Signavio.Config.BACKEND_PATH+"/simulation";Signavio.Config.STENCILSET_URI=Signavio.Config.BACKEND_PATH+"/editor_stencilset";Signavio.Config.PLUGIN_CONFIG=Signavio.Config.BACKEND_PATH+"/explorer_plugins";Signavio.Config.GLOSSARY_URI=Signavio.Config.BACKEND_PATH+Signavio.Config.GLOSSARY_PATH;Signavio.Config.PUBLISHER_URI=Signavio.Config.BACKEND_PATH+"/publisher";Signavio.Config.PORTAL_URI=Signavio.Config.BACKEND_PATH+"/portal";Signavio.Config.COMPARATOR_URI=Signavio.Config.BACKEND_PATH+"/comparator";Signavio.Config.MASHUP_URI="/mashup";Signavio.Config.HELP_START_URL="/help/en/index.html";Signavio.Config.HELP_START_URL_DE="/help/de/index.html";Signavio.Config.HELP_PDF_URL="/help/en/SignavioProcessEditor.pdf";Signavio.Config.HELP_PDF_URL_DE="/help/de/SignavioProcessEditor_de.pdf";Signavio.Config.GETTING_STARTET_URL="/help/screencasts/screencasts_EN.html";Signavio.Config.GETTING_STARTET_URL_DE="/help/screencasts/screencasts_DE.html";Signavio.Config.NPB_USER_GUIDE="/help/en/NPBUserGuide.pdf";Signavio.Config.NPB_USER_GUIDE_DE="/help/de/NPBUserGuide_DE.pdf";Signavio.Config.REFERENCE_MODELS_URL="http://www.signavio.com/reference-models";Signavio.Config.SHOW_LOGIN_LOGOUT=true;Signavio.Config.SHOW_LICENSE=true;Signavio.Config.TEACHING_PACKAGE="http://bpmai.org/";Signavio.Config.LOGOUT_HANDLER=Signavio.Config.BACKEND_PATH+"/login?logout=true";Signavio.Config.LOGIN_PAGE="/p/login";Signavio.Config.RESET_PASSWORD_PAGE="/p/resetPassword";Signavio.Config.AUTHENTICATED_RESET_PASSWORD_PAGE="/p/authenticatedResetPassword";Signavio.Config.VALIDATE_ORDER_PATH="/p/validate_order";Signavio.Config.MIGRATION_PATH="/p/migration";Signavio.Config.CONFIG_PATH="/config";Signavio.Config.COUNT_PATH="/count";Signavio.Config.PUBLISH_PATH="/publish";Signavio.Config.SEARCH_PATH="/search";Signavio.Config.INVITATION_PATH="/invitation";Signavio.Config.MODEL_PATH="/model";Signavio.Config.COPY_LINKED_PATH="/copylinked/";Signavio.Config.FILE_PATH="/file";Signavio.Config.DIRECTORY_PATH="/directory";Signavio.Config.DIRECTORY_ALL_PATH="/directoryall";Signavio.Config.USER_PATH="/user";Signavio.Config.ROOTGROUPUSER_PATH="/rootgroupuser";Signavio.Config.USERGROUP_PATH="/usergroup";Signavio.Config.METACONFIG_PATH="/metaconfig";Signavio.Config.TENANT_PATH="/tenant";Signavio.Config.ORDER_PATH="/order";Signavio.Config.PRIVATE_URL_PATH="/purl";Signavio.Config.ARCHIVE_EXPORT_PATH="/zip-export";Signavio.Config.ARCHIVE_IMPORT_PATH="/zip-import";Signavio.Config.ACCESS_PATH="/access";Signavio.Config.EXTERNAL_PATH="/external";Signavio.Config.EXTERNAL_MANAGEMENT_PATH="/externalUserManagement";Signavio.Config.EXTERNAL_USERS_PATH="/externalUserEntity";Signavio.Config.INFO_PATH="/info";Signavio.Config.TALKABOUT_PATH="/talkabout";Signavio.Config.VIEWS_PATH="/views";Signavio.Config.VIEW_PATH="/view";Signavio.Config.AML_IMPORT_PATH="/aml-upload";Signavio.Config.BPMN2_0_IMPORT_PATH="/bpmn2_0-import";Signavio.Config.NPB_IMPORT_PATH="/npb-import";Signavio.Config.NPB_EXPORT_PATH="/npb-export";Signavio.Config.NPB_OAUTH_PATH="/npboauth";Signavio.Config.NPB_UPLOAD_PATH="/npbupload";Signavio.Config.NPB_DOWNLOAD_PATH="/npbdownload";Signavio.Config.NPB_UPDATE_PATH="/npbupdate";Signavio.Config.ASTAH_IMPORT_PATH="/astah-import";Signavio.Config.STANDARD_REPORT_PATH="/excel-report";Signavio.Config.XPDL_IMPORT_PATH="/xpdl";Signavio.Config.BPMN_INFO_PATH="/bpmninfo";Signavio.Config.VISIO_IMPORT_PATH="/visio";Signavio.Config.CONFIGURATION_PATH="/configuration";Signavio.Config.CONTROLRIGHTS_PATH="/controlrights";Signavio.Config.PROCESS_DOCU_PATH="/docu";Signavio.Config.PROCESS_DOCU_TEMPLATE_PATH="/docutemplate";Signavio.Config.PRINT_MULTIPLE_PDFS_PATH="/printsvg";Signavio.Config.MAIL_PATH="/mail";Signavio.Config.CERTIFICATE_PATH="/certificate";Signavio.Config.AZUREADPROXY_PATH="/azureadproxy";Signavio.Config.SPREADSHEET_IMPORT_PATH="/quickmodelImport";Signavio.Config.SPREADSHEET_EXPORT_PATH="/quickmodelExport";Signavio.Config.JCAPTCHA_PATH="/jcaptcha.jpg";Signavio.Config.CUSTOM_LAYERS_CONFIG_PATH="/clconfig";Signavio.Config.ADMINISTRATOR_GROUP="Administrators";Signavio.Config.FOLDER_TYPE={};Signavio.Config.FOLDER_TYPE.PRIVATE="private";Signavio.Config.FOLDER_TYPE.PUBLIC="public";Signavio.Config.FOLDER_TYPE.TRASH="trash";Signavio.Config.FOLDER_TYPE.INTERNAL="internal";Signavio.Config.GLOSSARY_ENABLED=true;Signavio.Config.USE_CACHE=true;Signavio.Config.LOGLEVEL=7;Signavio.Config.LOGLEVELSHOWN=3;Signavio.Config.WARNING_SHOWN=5000;Signavio.Config.INITIAL_VIEW="icon";Signavio.Config.SORT_DESC="desc";Signavio.Config.SORT_ASC="asc";Signavio.Config.SPREADSHEET_LICENSE="quickmodel";Signavio.Config.TRIAL_LICENSE="trial";Signavio.Config.QUICKMODEL_LICENSE=Signavio.Config.SPREADSHEET_LICENSE;Signavio.Config.TEAM_LICENSE="team";Signavio.Config.PREMIUM_LICENSE="premium";Signavio.Config.PROFESSIONAL_LICENSE="professional";Signavio.Config.CORPORATE_LICENSE="corporate";Signavio.Config.ULTIMATE_LICENSE="ultimate";Signavio.Config.API_ACCESS_LICENSE="apiaccess";Signavio.Config.ARCHIMATE="archimate";Signavio.Config.MAIN_LICENSES=[Signavio.Config.ULTIMATE_LICENSE,Signavio.Config.CORPORATE_LICENSE,Signavio.Config.PROFESSIONAL_LICENSE,Signavio.Config.QUICKMODEL_LICENSE,Signavio.Config.PREMIUM_LICENSE,Signavio.Config.TEAM_LICENSE,Signavio.Config.API_ACCESS_LICENSE,Signavio.Config.ARCHIMATE];Signavio.Config.ALL_LICENSES=[].concat(Signavio.Config.TRIAL_LICENSE,Signavio.Config.MAIN_LICENSES);Signavio.Config.DEPRECATED_LICENSES=[Signavio.Config.PREMIUM_LICENSE,Signavio.Config.TEAM_LICENSE,Signavio.Config.ARCHIMATE];Signavio.Config.ACCESS_RIGHTS=["warehouse.read","warehouse.delete","warehouse.share","warehouse.write","all"];if(!Signavio.Config.RIGHTS){Signavio.Config.RIGHTS={}}Signavio.Config.RIGHTS.ALL="all";Signavio.Config.RIGHTS.READ="warehouse.read";Signavio.Config.RIGHTS.DELETE="warehouse.delete";Signavio.Config.RIGHTS.SHARE="warehouse.share";Signavio.Config.RIGHTS.WRITE="warehouse.write";Signavio.Config.RIGHTS.GROUP_DELETE="usermanagement.usergroup.delete";Signavio.Config.RIGHTS.GROUP_REMOVE="usermanagement.usergroup.remove";Signavio.Config.RIGHTS.GROUP_ADD="usermanagement.usergroup.add";Signavio.Config.RIGHTS.GROUP_CHANGE="usermanagement.usergroup.change";Signavio.Config.RIGHTS.USER_CHANGE="usermanagement.user.change";Signavio.Config.RIGHTS.USER_DELETE="usermanagement.deleteuser";Signavio.Config.RIGHTS.GLOSSARY_OPEN="glossary.open";Signavio.Config.RIGHTS.GLOSSARY_WRITE="glossary.write";Signavio.Config.RIGHTS.GLOSSARY_SHARE="glossary.share";Signavio.Config.SEARCH_LIMIT=20;Signavio.Config.ShowCommentBubblesForModels=false;Signavio.Config.REMOVE_ON_DELETE=false;Signavio.Config.HIDE_NOTIFICATION=false;Signavio.Config.CollapseRightPanel=true;Signavio.Config.CollapseLeftPanel=false;Signavio.Config.LeftPanelCollapsible=false;Signavio.Config.COMPARATOR_ENABLED=false;Signavio.Config.SIGNAVIO_BRANDING_CONFIGURABEL=false;Signavio.Config.DIAGRAM_EMBEDDING_ENABLED=false;Signavio.Config.USE_CONTENT_MODE=true;Signavio.Config.LEFT_PANEL_WIDTH=250;Signavio.Config.RIGHT_PANEL_WIDTH=290;Signavio.Config.Mode.SAAS="SaaS";Signavio.Config.Mode.ENTERPRISE="Enterprise";Signavio.Config.MIN_USERS_FOR_INVITE_TO_EDIT=11;Signavio.Const.PUBLIC_USER="public";Signavio.Const.DATE_FORMAT="d.m.Y H:i";Signavio.Const.MAIL_VALIDATOR="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$";Signavio.Const.QUOTA_WARNING_THRESHOLD=0.75;Signavio.Const.EVENT={};Signavio.Const.EVENT.ROOTSELECTIONCHANGE="rootselectionchange";Signavio.Const.EVENT.FOLDER_SELECT_PATH="folderselectpath";Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE="folderselectionchange";Signavio.Const.EVENT.SHOW_INFO_IMG="showinfoimg";Signavio.Const.EVENT.SHOW_TALK_ABOUT="showTalkAbout";Signavio.Const.EVENT.USER_LOADED="userloaded";Signavio.Const.EVENT.SEARCH_ACTIVATED="searchactivated";Signavio.Const.EVENT.SEARCH_DEACTIVATED="searchdeactivated";Signavio.Const.EVENT.REVISION_SELECTION_CHANGED="revisionchanged";Signavio.Const.EVENT.DELETE_SELECTED_ITEMS="deleteselecteditems";Signavio.Const.EVENT.ITEMS_REMOVED="itemsremoved";Signavio.Const.EVENT.FULL_VIEW_SHOWN="fullviewshown";Signavio.Const.EVENT.FULL_VIEW_HIDDEN="fullviewhidden";Signavio.Const.EVENT.ADD_MODELLING_GUIDE_LINES="addmodellierungguidelines";Signavio.Const.EVENT.ADDED_ALL_MODELLING_GUIDE_LINES="addedallmodellierungguidelines";Signavio.Const.EVENT.REQUEST_FOR_RULE_IS_READY="requestforruleisready";Signavio.Const.EVENT.ADD_CUSTOM_LAYERS_TAB="addcustomlayerstab";Signavio.Const.EVENT.OPEN_MANAGE_METADATA="openManageMetadata";Signavio.Const.EVENT.IMPORT_REFERENCE_MODEL="importReferenceModel";Signavio.Const.NAMESPACE={};Signavio.Const.NAMESPACE.BPMN1_1="http://b3mn.org/stencilset/bpmn1.1#";Signavio.Const.NAMESPACE.BPMN1_2=Signavio.Const.NAMESPACE.BPMN1_1;if(!Signavio.Const.PURL){Signavio.Const.PURL={}}Signavio.Const.PURL.PNG="png";Signavio.Const.PURL.DISCUSSION="talkabout";Signavio.Const.PURL.JSON="json";Signavio.Const.PURL.STENCILSET="stencilset";Signavio.Const.PURL.GADGET="gadget";Signavio.Const.PURL.ANALYTICS_PAYLOAD="analytics_payload";Signavio.Const.PURL.ANALYTICS_INSTANCES="analytics_instances";Signavio.Const.THUMBNAIL="/thumbnail";if(!Signavio.Const.ACCESS_TYPES){Signavio.Const.ACCESS_TYPES={}}Signavio.Const.ACCESS_TYPES.mod=["warehouse.read","warehouse.write","warehouse.delete","warehouse.share"];Signavio.Const.ACCESS_TYPES.dir=["warehouse.read","warehouse.write","warehouse.delete","warehouse.share"];Signavio.Const.ACCESS_TYPES.glos=["glossary.open","glossary.write"];Signavio.Const.FRAGMENTS_ENABLED=false;if(!Signavio.Const.META_TYPES){Signavio.Const.META_TYPES={}}Signavio.Const.META_TYPES.GLOSSARY=[{type:"MetaDataStringInfo",asList:true},"MetaDataStringInfoMulti",{type:"MetaDataGlossaryLink",asList:true},{type:"MetaDataUrl",asList:true},"MetaDataBoolean"];Signavio.Const.META_TYPES.STENCILSET=[{type:"MetaDataStringInfo",asList:true},"MetaDataStringInfoMulti",{type:"MetaDataGlossaryLink",asList:true},"MetaDataDate","MetaDataNumberInfo","MetaDataEnum",{type:"MetaDataUrl",asList:true},"MetaDataBoolean",{type:"MetaDataModelLink",asList:true},"MetaDataComplex"];Signavio.Config.HEADER_LOGO_LINK_TARGET="http://www.signavio.com";if(!Signavio.Analytics){Signavio.Analytics={}}if(!Signavio.Analytics.Config){Signavio.Analytics.Config={}}Signavio.Analytics.Config.ANALYTICS_PATH="/analytics";Signavio.Const.SHAREPOINT_DOWNLOAD_LINK_ENABLED=false;Signavio.Const.SHAREPOINT_CONNECTOR_ENABLED=false;Signavio.Const.SHAREPOINT_CONNECTOR_TEST_PATH="connection.asmx";Signavio.Const.SHAREPOINT_CONNECTOR_SEARCH_PATH="searchad.asmx";if(!Signavio.Const.COMMANDS){Signavio.Const.COMMANDS={}}Signavio.Const.COMMANDS.FILTER_ROOTGROUPUSERS="defaultgroup:";if(!Signavio.Const.ERRORS){Signavio.Const.ERRORS={}}Signavio.Const.ERRORS.WRONG_NAMESPACE="WRONG_NAMESPACE";Signavio.Const.OLD_FF_VERSION=3;Signavio.Const.OLD_IE_Version=8;Signavio.Const.SHOW_MODELINGGUIDELINE_TAB=false;Signavio.Const.SHOW_CUSTOM_LAYERS_TAB=false;Signavio.Const.MODELINGGUIDELINE_TAB_NAME="tab.modelingGuidelines";Signavio.Const.CUSTOM_LAYERS_TAB_NAME="tab.customLayers";Ext.BLANK_IMAGE_URL=".."+Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/s.gif";Ext.Rating=Ext.extend(Ext.BoxComponent,{maxScore:5,minScore:1,scoreImgEnabled:"../images/silk/star.png",scoreImgDisabled:"../images/silk/star_gray.png",imgStyle:"width:12px;margin:2px;",imgEditStyle:"cursor:pointer;",textStyle:"margin-left:5px;position:relative;top:-4px;",disabledImg:"../images/silk/bullet_black.png",value:0,text:"",stars:[],editable:false,_setStyle:function(b,a){if(Ext.isIE){b.style.setAttribute("cssText",a)}else{b.setAttribute("style",a)}},onRender:function(d,a){if(!this.el){this.el=document.createElement("div");this.el.id=this.getId();this.stars=[];for(var c=this.minScore;c<=this.maxScore;c++){var b=document.createElement("img");if(this.editable){Element.observe(b,"mouseover",this.onMouseOverStar.bind(this),true);Element.observe(b,"mouseout",this.onMouseOutStar.bind(this),true);Element.observe(b,"click",this.onClickStar.bind(this),true);this._setStyle(b,this.imgStyle+""+this.imgEditStyle)}else{this._setStyle(b,this.imgStyle)}this.stars.push(b)}this.stars.each(function(e){this.el.appendChild(e)}.bind(this));this.textEl=document.createElement("span");this._setStyle(this.textEl,this.textStyle);this.textEl.innerHTML=this.text;this.el.appendChild(this.textEl);if(this.forId){this.el.setAttribute("htmlFor",this.forId)}}this.setStars();if(d){Ext.Rating.superclass.onRender.call(this,d,a)}},setStars:function(b){if(!b){b=this.value}var a=this.disabled||b<=0;this.stars.each(function(f,c){var g=c+this.minScore;var e=g<=(b+0.5);var d=e?this.scoreImgEnabled:this.scoreImgDisabled;d=a?this.disabledImg:d;f.setAttribute("src",d);f.setAttribute("title",g)}.bind(this))},onMouseOverStar:function(a){this.setStars(this.stars.indexOf(a.target)+this.minScore)},onMouseOutStar:function(a){this.setStars()},onClickStar:function(b){var a=this.stars.indexOf(b.target)+this.minScore;this.setValue(a);if(this.changed instanceof Function){this.changed(a)}},setValue:function(a){this.value=a;this.setStars()},setText:function(a){this.text=a;if(this.textEl){this.textEl.innerHTML=a}},startEdit:function(){this._setStyle(this.el.dom,"left:22px;position:absolute;top:2px;")},completeEdit:function(){},cancelEdit:function(){}});Ext.reg("rating",Ext.Rating);Ext.LinkButton=Ext.extend(Ext.BoxComponent,{click:null,image:null,imageStyle:null,toggle:false,toggleStyle:null,selected:false,href:undefined,el:null,onRender:function(b,a){if(this.el==null){this.el=document.createElement("a");if(this.tabIndex){this.el.setAttribute("tabindex",this.tabIndex)}this.el.id=this.getId();this.el.className=this.cls||"x-link-button";this.el.href=this.href!==undefined?this.href:"#"+this.text;this.el.onclick=function(){return false};Ext.get(this.el).on("click",this.onClick.bind(this));if(this.image){this.el.innerHTML='<img src="'+this.image+'" title="'+this.text+'"'+(this.imageStyle?' style="'+this.imageStyle+'"/>':"/>")}else{this.el.innerHTML=this.text?Ext.util.Format.htmlEncode(this.text):(this.html||"")}if(this.forId){this.el.setAttribute("htmlFor",this.forId)}}Ext.LinkButton.superclass.onRender.call(this,b,a)},onClick:function(a){Event.stop(a);if(this.disabled){return}if(this.toggle){this.selected=!this.selected;if(this.toggleStyle){this._setStyle(this.el.dom,"");this.el.dom.setAttribute("style","");if(this.selected){this.el.applyStyles(this.toggleStyle)}else{this.el.applyStyles(this.initialConfig.style)}}}if(this.click instanceof Function){this.click.apply(this.click,[this,a])}return false},setText:function(a,b){this.text=a;if(this.rendered){this.el.dom.innerHTML=b!==false?Ext.util.Format.htmlEncode(a):a}return this},_setStyle:function(b,a){if(Ext.isIE){b.style.setAttribute("cssText",a)}else{b.setAttribute("style",a)}}});Ext.reg("linkbutton",Ext.LinkButton);Ext.SimpleButton=Ext.extend(Ext.Button,{template:new Ext.Template("<a href='#' class='x-button-plain'>{0}</a>"),handler:Ext.emptyFn,onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.el.on("click",function(b,a){this.handler.apply(this,arguments);b.stopEvent();return false}.bind(this))}});Ext.form.ComboBoxMulti=function(a){Ext.apply(a);this.typeAhead=false;this.minChars=1;this.validationEvent=true;this.hideTrigger=true;this.defaultAutoCreate={tag:a.renderAsTextArea?"textarea":"input",autocomplete:"off"};Ext.form.ComboBoxMulti.superclass.constructor.call(this,a)};Ext.form.ComboBoxMulti=Ext.extend(Ext.form.ComboBoxMulti,Ext.form.ComboBox,{anyMatch:false,getPosition:function(){if(document.selection){var a=document.selection.createRange();var b=a.duplicate();b.moveToElementText(this.el.dom);b.setEndPoint("EndToEnd",a);return b.text.length}else{return this.el.dom.selectionEnd}},getActiveRange:function(){var b=this.sep;var e=this.getPosition();var a=this.getRawValue();var f=a.split(this.sep);var c=e;while(c>0&&(a.charAt(c)!=b)){--c}if(c>0){c++}return{left:c,right:e}},getActiveEntry:function(){var a=this.getActiveRange();return this.getRawValue().substring(a.left,a.right).replace(/^\s+|\s+$/g,"")},replaceActiveEntry:function(c){var b=this.getActiveRange();var a=this.getRawValue();if(this.preventDuplicates&&a.indexOf(c)>=0){return}var e=(this.sep==" "?"":" ");e=(this.sep=="\n"?"":e);this.setValue(a.substring(0,b.left)+(b.left>0?e:"")+c+this.sep+e+a.substring(b.right));var d=b.left+c.length+2+e.length;this.selectText.defer(200,this,[d,d])},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=a.data[this.valueField||this.displayField];if(this.sep){this.replaceActiveEntry(c)}else{this.setValue(c)}this.collapse();this.fireEvent("select",this,a,b)}},initEvents:function(){Ext.form.ComboBoxMulti.superclass.initEvents.call(this);this.keyNav.doRelay=function(c,b,a){if(this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true}},initQuery:function(){this.doQuery(this.sep?this.getActiveEntry():this.getRawValue())},selectText:function(f,a){var c=this.sep?this.getActiveEntry():this.getRawValue();if(c.length>0){f=f===undefined?this.getRawValue().indexOf(c):f;a=a===undefined?c.length:a;var e=this.el.dom;if(e.setSelectionRange){e.setSelectionRange(f,a)}else{if(e.createTextRange){var b=e.createTextRange();b.moveStart("character",f);b.moveEnd("character",a-c.length);b.select()}}}},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.selectText()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},growMin:60,growMax:1000,onKeyUp:function(a){if(!a.isNavKeyPress()||a.getKey()==a.ENTER){Ext.form.ComboBoxMulti.superclass.onKeyUp.call(this,a);this.autoSize()}},doQuery:function(c,b){if(c===undefined||c===null){c=""}var a={query:c,forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false}c=a.query;b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode=="local"){this.selectedIndex=-1;if(b){this.store.clearFilter()}else{this.store.filter(this.displayField,c,this.anyMatch)}this.onLoad()}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},autoSize:function(){if(!this.grow||this.defaultAutoCreate.tag!=="textarea"||!this.el){return}var d=this.el;var a=d.dom.value;var c=d.getStyle("line-height")=="normal"?14.4:d.getStyle("line-height").replace("px","");var b=Number(c)*(a.split("\n").length+1);b-=6;b+=d.isScrollable()?20:0;b=Math.min(this.growMax,Math.max(b,this.growMin));if(b!=this.lastHeight){this.lastHeight=b;this.el.setHeight(b)}}});Ext.reg("combomulti",Ext.form.ComboBoxMulti);Ext.form.DataStoreComboBox=Ext.extend(Ext.form.ComboBox,{typeAhead:false,mode:"local",minChars:0,triggerAction:"all",selectOnFocus:true,setValue:function(a){var c=a;if(this.store){var b=this.store.find(this.valueField,a);if(b>=0){b=this.store.getAt(b);c=this.store.parseValue(b,this.displayField);a=b}this.lastSelectionText=c;Ext.form.DataStoreComboBox.superclass.setValue.call(this,c)}this.value=a},selectByValue:function(b,e){if(b!==undefined&&b!==null&&typeof b==="string"){var d=this.findRecord(this.valueField||this.displayField,b);if(!d){var c=this.store;var a=this.displayField;d=c.data.items.find(function(f){return c.parseValue(f,a).toLowerCase().startsWith(b.toLowerCase())});if(!d){d=c.data.items.find(function(f){return c.parseValue(f,a).toLowerCase().include(b.toLowerCase())})}}if(d){this.select(this.store.indexOf(d),e);return true}}return false},onSelect:function(){Ext.form.DataStoreComboBox.superclass.onSelect.apply(this,arguments);var a=this.getRawValue().length;this.selectText(a,a)},doQuery:function(d,c){if(d===undefined||d===null){d=""}var b={query:d,forceAll:c,combo:this,cancel:false};if(this.fireEvent("beforequery",b)===false||b.cancel){return false}d=b.query;c=b.forceAll;if(c===true||(d.length>=this.minChars)){if(this.lastQuery!==d){this.lastQuery=d;if(this.mode=="local"){this.selectedIndex=-1;if(c){this.store.clearFilter()}else{this.store.filter(this.displayField||this.valueField,d)}if(this.pageSize){var g=[].concat(this.store.data.items),a=this.pageSize,f=0,e=0;this.store.copy=g;this.store.filterBy(function(j){if(!g.include(j)){return false}var h=e++;return h>=f&&h<f+a});this.store.storeOptions({params:this.getParams(d)});this.store.fireEvent("load",this.store,this.store.getRange(),this.store.lastOptions)}else{this.onLoad()}}else{this.store.baseParams[this.queryParam]=d;this.store.load({params:this.getParams(d)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{var a=this.getRawValue();if(a){var b=this.store.data.items.find(function(c){return this.store.parseValue(c,this.displayField).toLowerCase().startsWith(a.toLowerCase())}.bind(this));if(!b){b=this.store.data.items.find(function(c){return this.store.parseValue(c,this.displayField).toLowerCase().include(a.toLowerCase())}.bind(this))}}if(b){this.select(this.store.indexOf(b),true)}else{this.selectNext()}if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onTypeAhead:function(){if(this.store.getCount()>0){var f=this.getRawValue().toLowerCase();var b=this.store.data.items.find(function(c){return c.get("rep").name.toLowerCase().startsWith(f)})||this.store.getAt(0);var d=this.store.parseValue(b,this.displayField);var a=d.length;var e=this.getRawValue().length;if(e!=a){this.setRawValue(d.unescapeHTML());this.selectText(e,d.length)}}},initList:function(){Ext.form.DataStoreComboBox.superclass.initList.apply(this,arguments);if(this.pageTb){var a=this.pageTb;this.pageTb.items.each(function(g){if(!(g==a.first||g==a.prev||g==a.next||g==a.last)){g.hide()}});var f=a.addText("");var b=2;a.tr.insertBefore(f.el.parentNode,a.tr.childNodes[b]);a.items.remove(f);a.items.insert(b,f);a.displayMsg="{0}/{1}";a.displayEl=Ext.fly(f.el).createChild({cls:"x-paging-info",style:{display:"inline",position:"relative",left:"0",top:"0"}});var e=a.addFill();a.tr.insertBefore(e.el.parentNode,a.tr.childNodes[++b]);a.items.remove(e);a.items.insert(b,e);var d=this.pageSize,c=this;a.updateInfo=function(){if(this.displayEl){var g=this.store.copy?this.store.copy.length:this.store.getTotalCount();var h=g<=d?"":String.format(this.displayMsg,Math.ceil((this.cursor+1)/d),Math.ceil(g/d));this.displayEl.update(h);if(!h){c.assetHeight-=!this.hidden?23:0;this.hide()}else{c.assetHeight+=this.hidden?23:0;this.show()}}};if(this.pageSize&&this.mode=="local"){a.doLoad=function(n){var j=Object.clone(this.store.lastOptions);if(!j.params){j.params={}}var m=[].concat(this.store.copy||this.store.data.items),h=this.paramNames,g=this.pageSize,l=j.params[h.start]=n,k=0;this.store.filterBy(function(q){if(!m.include(q)){return false}var p=k++;return p>=l&&p<l+g});this.store.storeOptions(j);this.store.fireEvent("load",this.store,this.store.getRange(),this.store.lastOptions)}}}}});Ext.DataView.LabelEditor=function(a,b){Ext.DataView.LabelEditor.superclass.constructor.call(this,b||new Ext.form[a.tag==="textarea"?"TextArea":"TextField"]({allowBlank:false,grow:a.tag==="textarea"&&a.grow!==false}),a)};Ext.extend(Ext.DataView.LabelEditor,Ext.Editor,{alignment:"tl-tl",hideEl:false,cls:"x-small-editor",shim:false,completeOnEnter:true,cancelOnEsc:true,labelSelector:"span.x-editable",updateEl:true,init:function(a){this.view=a;a.on("render",this.initEditor,this);this.on("complete",this.onSave,this);this.on("beforehide",function(b){b.boundEl.dom.innerHTML=b.boundEl.dom.innerHTML.gsub("\n","<br/>")})},initEditor:function(){Ext.get(document).on("mousedown",this.onMouseDownBefore.bind(this));this.view.getEl().on("mousedown",this.onMouseDown,this,{delegate:this.labelSelector});this.view.getEl().on("mouseover",this.onMouseOver,this,{delegate:this.labelSelector});this.view.getEl().on("mouseout",this.onMouseOut,this,{delegate:this.labelSelector})},onMouseDownBefore:function(b,a){if(this.field&&this.field.getEl()&&b.target!=this.field.getEl().dom){this.completeEdit()}},onMouseOver:function(b,a){Ext.get(a).addClass("x-over")},onMouseOut:function(b,a){Ext.get(a).removeClass("x-over")},onMouseDown:function(h,g){if(!h.ctrlKey&&!h.shiftKey){if(Ext.isIE8===false&&g.offsetHeight!==g.scrollHeight){var b=g.scrollWidth;var f=h.getXY()[0]-g.cumulativeOffset()[0];if(f>=b&&f<=b+17){return}}h.stopEvent();if(this.dataIndex){var j=this.dataIndex.split(".");this.dataKey=j[0];this.dataAttr=j.length>=2?j[1]:null}this.field.setWidth(Math.max(g.offsetWidth,150));this.field.allowBlank=g.className.indexOf("required")<0;var d;if(this.view.findItemFromChild instanceof Function){var c=this.view.findItemFromChild(g);var a=this.view.store.getAt(this.view.indexOf(c));this.activeRecord=a;if(this.dataAttr){d=a.data[this.dataKey][this.dataAttr]}else{d=a.data[this.dataKey]}}else{d=g.innerHTML.gsub("<br/>","\n").gsub("<br>","\n").gsub("<BR>","\n").gsub("<BR/>","\n")}if(d!==undefined){if(g.className.include("x-default")){d=""}this.startEdit(g,(d||"").unescapeHTML())}}else{h.preventDefault()}},onSave:function(b,c,a){if(c===a){return}if(this.activeRecord&&this.dataKey&&!this.dataAttr){this.activeRecord.set(this.dataKey,c);this.activeRecord.commit()}else{if(this.activeRecord&&this.dataKey&&this.dataAttr){var d=Object.clone(this.activeRecord.get(this.dataIndex));d[this.dataAttr]=c;this.activeRecord.set(this.dataKey,d);this.activeRecord.commit()}}}});Ext.DataView.DragSelector=function(h){h=h||{};var l,e,k,p,b;var f,m,n=new Ext.lib.Region(0,0,0,0);var c=h.dragSafe===true;this.init=function(t){l=t;l.on("render",s)};this.isDragging=function(){return !!k};function q(){f=[];l.all.each(function(t){f[f.length]=t.getRegion()});m=l.el.getRegion()}function g(){return true}function j(v){var u=l.el.isScrollable();var t=18;return((!c||v.target==l.el.dom)&&(!u||((l.el.dom.offsetWidth+l.el.getX())-v.getXY()[0])>t))}function r(t){window.clearTimeout(b);l.on("containerclick",g,l,{single:true});if(!k){k=l.el.createChild({cls:"x-view-selector"})}else{k.setDisplayed("block")}q();if(!this.ctrlKey){l.clearSelections()}}function d(B){var C=p.startXY;var G=p.getXY();var E=Math.min(C[0],G[0]);var D=Math.min(C[1],G[1]);var F=Math.abs(C[0]-G[0]);var z=Math.abs(C[1]-G[1]);n.left=E;n.top=D;n.right=E+F;n.bottom=D+z;n.constrainTo(m);k.setRegion(n);for(var v=0,A=f.length;v<A;v++){var t=f[v],u=n.intersect(t);if(u&&!t.selected){t.selected=true;l.select(v,true)}else{if(!u&&t.selected){t.selected=false;l.deselect(v)}}}}function a(t){if(k){k.setDisplayed(false);window.clearTimeout(b);b=window.setTimeout(function(){k.remove();k=null},10)}}function s(t){p=new Ext.dd.DragTracker({onBeforeStart:j,onMouseMove:function(u){this.ctrlKey=u.ctrlKey;Ext.dd.DragTracker.prototype.onMouseMove.apply(this,arguments)},onStart:r,onDrag:d,onEnd:a});p.initEl(t.el)}};Ext.grid.DragSelector=function(h){h=h||{};var m,a,b,q,f,l;var j,g,d=new Ext.lib.Region(0,0,0,0);var p=h.dragSafe===true;this.init=function(u){a=u;a.on("render",e)};this.isDragging=function(){return !!q};function c(){j=[];$A(m.getRows()||[]).each(function(u){j[j.length]=Ext.get(u).getRegion()});g=m.el.getRegion()}function r(){return true}function t(w){var v=m.scroller.isScrollable();var u=18;return((!p||w.target==m.el.dom||m.el.contains(w.target))&&(!v||((m.el.dom.offsetWidth+m.el.getX())-w.getXY()[0])>u))}function s(u){window.clearTimeout(l);m.on("click",r,m,{single:true});if(!q){q=m.el.createChild({cls:"x-view-selector"})}else{q.setDisplayed("block")}c();if(!this.ctrlKey){a.getSelectionModel().clearSelections()}}function n(D){var E=f.startXY;var I=f.getXY();var G=Math.min(E[0],I[0]);var F=Math.min(E[1],I[1]);var H=Math.abs(E[0]-I[0]);var B=Math.abs(E[1]-I[1]);d.left=G;d.top=F;d.right=G+H;d.bottom=F+B;d.constrainTo(g);q.setRegion(d);for(var A=0,C=j.length;A<C;A++){var u=j[A],v=d.intersect(u),z=a.getSelectionModel();if(v&&!u.selected){u.selected=true;z.selectRow(A,true)}else{if(!v&&u.selected){delete u.selected;z.deselectRow(A)}}}}function k(u){if(q){q.setDisplayed(false);window.clearTimeout(l);l=window.setTimeout(function(){q.remove();q=null},10)}}function e(){m=a.view;f=new Ext.dd.DragTracker({onBeforeStart:t,onMouseMove:function(u){this.ctrlKey=u.ctrlKey;Ext.dd.DragTracker.prototype.onMouseMove.apply(this,arguments)},onStart:s,onDrag:n,onEnd:k});f.initEl(m.el)}};Ext.data.Record.prototype.set=function(b,c,a){if(this.data[b]===c){return}this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[b]=="undefined"){this.modified[b]=this.data[b]}this.data[b]=c;if(!this.editing&&this.store&&a!==true){this.store.afterEdit(this)}};Ext.data.Record.prototype.commit=function(a){if(this.store&&a!==true&&this.store.beforeCommit){this.store.beforeCommit(this)}this.dirty=false;delete this.modified;this.editing=false;if(this.store&&a!==true){this.store.afterCommit(this)}};if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.AddedPanel=function(a){a=a||{};this.store=a.store;if(a.onDelete instanceof Function){this.plugins=[new Signavio.Extensions.HoverButton({selector:"div.x-panel-added-item",callback:this.doDelete.bind(this)})]}this.hideAddField=a.hideAddField===false||!(a.onAppend instanceof Function);Signavio.Extensions.AddedPanel.superclass.constructor.call(this,a);this.itemTpl.compile()};Ext.extend(Signavio.Extensions.AddedPanel,Ext.Panel,{itemTpl:new Ext.XTemplate('<div class="x-panel-added-list">','<tpl for=".">','<div class="x-panel-added-item" rel="{id}"><img src="{icon}"/><span>{name}</span></div>',"</tpl>","</div>"),icon:Signavio.Config.IMAGE_PATH+"/famfamfam/user.png",cls:"x-panel-added",width:200,isFormField:true,originalValue:null,border:false,onRender:function(){Signavio.Extensions.AddedPanel.superclass.onRender.apply(this,arguments);var a=new Ext.XTemplate('<tpl for="."><tpl for="rep"><div class="search-item">','<span class="name">{name}</span>','<span class="mail">{mail}</span>','<span class="principal">{principal}</span>',"</div></tpl></tpl>");this.textField=new Ext.form.ComboBox(Ext.apply({store:this.store,hidden:this.hideAddField,width:this.width,minListWidth:200,listClass:"x-panel-added-cb-list",displayField:"rep.name||rep.mail||rep.principal",value:"",tpl:a,itemSelector:"div.search-item",blankText:"Name",selectOnFocus:true,triggerClass:"x-panel-added-trigger",renderTo:this.body,allowBlank:true,mode:"local",tabIndex:1000,forceSelection:true,minChars:1,disabled:this.disabled,listeners:{specialkey:function(b,c){if(c.getKey()===Ext.EventObject.ENTER){this.onTrigger(this.textField.getValue(),"principal");this.textField.focus(false,100)}}.bind(this)},onTriggerClick:function(b){if(!b||b!=Ext.EventObject||b.type!=="click"||this.onTrigger(this.textField.getValue(),"principal")){Ext.form.ComboBox.prototype.onTriggerClick.apply(this.textField,arguments)}}.bind(this),onTypeAhead:function(){if(this.store.getCount()>0){var c=this.store.getAt(0);var d=c.get("rep").name;var b=d.length;var e=this.getRawValue().length;if(e!=b){this.setRawValue(d);this.selectText(e,d.length)}}},onSelect:function(b,c){if(this.fireEvent("beforeselect",this,b,c)!==false){this.setValue(b.get("rep").principal);this.collapse();this.fireEvent("select",this,b,c)}}},this.cbConfig||{}));this.list=document.createElement("div");this.body.appendChild(this.list);this.list=Ext.Element(this.list)},doDelete:function(c,d){var b=d.getAttribute("rel");if(!b||!this.currentRecords){return}var a=this.currentRecords.find(function(e){return e.get("href")==b});if(!a){return}this.onDelete(a,b)},onTrigger:function(c,a){if(!c){return true}var b=this.store.data.find(function(d){return d.get("rep")[a]==c});if(!b){return true}this.onAppend(b,c);this.textField.setValue("");return false},onAppend:function(){},onDelete:function(){},disable:function(){if(this.list){this.list.addClass("x-disabled")}if(this.textField){this.textField.disable()}this.disabled=true},enable:function(){if(this.list){this.list.removeClass("x-disabled")}if(this.textField){this.textField.enable()}this.disabled=false},setValue:function(b,c,e){if(!this.body){return}if(!(b instanceof Array)){b=[b].compact()}this.currentRecords=e;if(b.length<=0&&typeof this.blankText=="string"){b.push(this.blankText);this.list.addClass("x-no-group")}else{this.list.removeClass("x-no-group")}var d=b.map(function(f,a){return{icon:this.icon,name:(this.parseText?this.parseText(f,e[a]):false)||f.name||f,id:e.length>a?(e[a].get?e[a].get("href"):e[a].href):null}}.bind(this)).sort(function(g,f){return Number(g.name.toLowerCase()>f.name.toLowerCase())});this.itemTpl.overwrite(this.list,d||[])}});if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}new function(){function a(l,b,d,c){l=l||{};var f=l.sortingFn||undefined;var e=typeof l=="string"?l:l.stateValue;var h=l.treeFilter||function(){return true};var j=l.recordRel||("user");var g=new Ext.tree.TreeNode({text:"",leaf:false,childLeaf:l.treeChildLeaf||false,cls:"folder",expanded:true,dataField:l.dataField||"rep.name",filterFn:h,childCls:l.hasChildCls?undefined:l.treeChildCls||"user",hasChildCls:l.hasChildCls,recordRel:l.recordRel||"info",identifier:l.treeRootIdentifier,parseText:l.parseText instanceof Function?l.parseText:undefined});var k=new Signavio.Extensions.TreePanel({sortingFn:f,cls:"administration_plugin_tree "+(l.treeCls||""),region:"west",onRootLoaded:l.onRootLoaded||function(){},title:l.treeTitle||"",width:200,split:l.split===false?false:true,margins:l.split===false?"3 6 3 3":"3 0 3 3",root:g,tbar:d});k.getSelectionModel().on("selectionchange",function(n,p){var m;if(b&&b instanceof Signavio.Extensions.FormStorePanel){if(p&&p.attributes.identifier){m=Signavio.Core.StoreManager.getRelatedStore(p.attributes.identifier);b.setStore(m)}else{if(!p){b.setStore()}}}if(c instanceof Function){c(p,m)}});return k}Signavio.Extensions.AdminPanel=function(b){b=b||{};var c=b.tbar;delete b.tbar;Ext.apply(this,b);this.form=this.generateFormPanel(b.items);this.onStoreChange=(b.onStoreChange||function(){}).bind(this);this.onSelectionChange=(b.onSelectionChange||function(){}).bind(this);this.tree=a(b,this.form,c,this.onSelectionChange);this.form.on("storechanged",function(d){this.onStoreChange(this.tree.getSelectionModel().getSelectedNode(),d)}.bind(this));b.items=[this.tree,this.form];Signavio.Extensions.AdminPanel.superclass.constructor.call(this,b)};Ext.extend(Signavio.Extensions.AdminPanel,Ext.Panel,{layout:"border",margins:"3 3 3 3",generateFormPanel:function(b){return new Signavio.Extensions.FormStorePanel({region:"center",autoScroll:true,cls:"configuration_window_form",margins:"3 3 3 0",items:b,bodyStyle:"overflow-x:hidden;",hideButtons:this.hideButtons||false})}})}();if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.DrawerButtons=function(d){d=d||{};var g=[];this.init=function(k){if(k.layout instanceof Ext.layout.CardLayout||k.layout=="card"){this.view=k;k.on("render",c,this);k.on("add",j,this);k.on("collapse",e,this);k.on("expand",f,this)}};var c=function(){var l=["div",{"class":"drawer_plugin"}];this.root=Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.view.getEl().dom.parentNode,l);var k=["div",{"class":"drawer_plugin_background"}];this.rootBg=Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.view.getEl().dom.parentNode,k);$(this.root).observe("signavio:selectcontexttab",function(n){var m=n.memo;this.view.items.each(function(q,p){if((q.title||q.name||"")==m){if(this.view.layout.activeItem){var r=this.view.items.items.indexOf(this.view.layout.activeItem);if(r===p){return false}}h.call(this,p,undefined,true);return false}}.bind(this))}.bind(this));if(!this.view.items||this.view.items.length<=0){return}this.view.items.each(function(n,m){j(this,n,m)}.bind(this));h(0)};var a=function(l,k){k.removeClass("x-disabled")};var b=function(l,k){k.addClass("x-disabled")};var j=function(q,n,k){var m=Signavio.Core.graft("http://www.w3.org/1999/xhtml",null,["div",{"class":"x-btn x-index-"+k}]);if(Ext.isIE9||Ext.isIE8||Ext.isIE7||Ext.isIPad||Ext.isOpera){var l=this.rootBg.appendChild(m.cloneNode(true));window.setTimeout(function(){l.style.height=((m.dom.offsetWidth||m.dom.clientWidth||2)-2)+"px"},1000);Ext.get(l).on("click",h.bind(this,k))}m.innerHTML='<a class="x-btn-caption">'+(n.title||n.name||"")+"</a>";this.root.appendChild(m);g.push(m);m=Ext.get(m);m.on("click",h.bind(this,k));n.on("enable",a.bind(this,n,m));n.on("disable",b.bind(this,n,m));if(n.disabled){b(n,m)}};var f=function(){this.view.el.appendChild(this.root);this.view.el.appendChild(this.rootBg);if(!this.view.layout.activeItem){h.call(this,0)}};var e=function(){$(this.view.id+"-xcollapsed").appendChild(this.root);$(this.view.id+"-xcollapsed").appendChild(this.rootBg)};var h=function(l,k,m){if(m!==true&&g[l].className.include("x-disabled")){if(k){Event.stop(k)}return}if(this.view.layout.activeItem){var n=this.view.items.items.indexOf(this.view.layout.activeItem);if(n===l){this.view.collapse(true);return}g[n].className=g[n].className.replace(" activated","")}else{if(this.view.collapsed){this.view.expand(true)}}g[l].className+=" activated";this.view.layout.setActiveItem(l);this.view.items.items[l].fireEvent("activate",this.view.items.items[l]);return false}};if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.HoverButton=function(b){b=b||{};var c=b.tpl||new Ext.XTemplate('<a class="x-hoverbutton">'+Signavio.I18N.Repository.HoverButton.deleteString+"</a>");c.compile();var f;var h;var g=b.callback||function(){};this.init=function(j){this.view=j;j.on("render",d,this)};var d=function(){this.view.getEl().on("mouseover",e,this,{delegate:b.selector});this.view.getEl().on("mouseout",a,this,{delegate:b.selector})};var e=function(j,k){window.clearTimeout(h);if(f&&f.parent(null,true)==k){return}else{if(f){f.remove()}}f=c.insertFirst(k,{},true);f.on("click",function(m,l){g.apply(g,[m,l.parentNode])})};var a=function(j,k){h=window.setTimeout(function(){if(f){f.remove()}},50)}};if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.FormStorePanel=function(a){a=a||{};Signavio.Extensions.FormStorePanel.superclass.constructor.call(this,a);this.setStore(a.store)};Ext.extend(Signavio.Extensions.FormStorePanel,Ext.form.FormPanel,{defaults:{width:200},getDirtyEl:function(){return Signavio.Core.graft("http://www.w3.org/1999/xhtml",null,["div",{"class":"x-grid3-dirty-cell x-dirty-cell-overlay"}])},getWaitingEl:function(){return Signavio.Core.graft("http://www.w3.org/1999/xhtml",null,["div",{"class":"x-waiting"}])},setDirty:function(a){if(!a.dirtyEl){a.dirtyEl=this.getDirtyEl().cloneNode(true)}if(a.body||a.el){(a.body||a.el.parent()).appendChild(a.dirtyEl)}},removeDirty:function(a){if(a.dirtyEl&&a.dirtyEl.parentNode){a.dirtyEl.parentNode.removeChild(a.dirtyEl)}},setWaiting:function(a){if(!this.el){return}if(!this.waitingEl){this.waitingEl=this.getWaitingEl().cloneNode(true)}window.clearTimeout(this.waitingTimeout);if(a===true){this.waitingTimeout=window.setTimeout(this.el.appendChild.bind(this.el,this.waitingEl),10)}else{if(a===false&&this.waitingEl.parentNode){this.waitingEl.parentNode.removeChild(this.waitingEl)}}},initFields:function(){var d=function(k,j,h){this[h===String(j.originalValue)?"removeDirty":"setDirty"](k);if(j.dataField&&this.store){var g=this.store.getRecords(k.recordRel)[0]||this.store.getAt(0);var m=Object.clone(g.get("rep"));var l=k.parseData?k.parseData(h):h;if(typeof l==="string"){l=Signavio.Utils.escapeHTML(l)}m[j.dataField.split(".").last()]=l;g.set("rep",m)}};this.items.each(function(g){if(g instanceof Ext.form.TextField){g.on("change",d.bind(this,g))}else{if(g instanceof Ext.form.Checkbox){g.on("check",d.bind(this,g))}else{if(g instanceof Ext.tree.TreePanel){g.on("checkchange",function(m,l){var p=g.getValue();var k=g.originalValue;var h=!k||(k.length===p.length&&k.all(function(q){return p.include(q)}));this[h?"removeDirty":"setDirty"](g);if(g.dataField&&this.store){var j=this.store.getRecords(g.recordRel)[0]||this.store.getAt(0);var n=Object.clone(j.get("rep"));n[g.dataField.split(".").last()]=p;j.set("rep",n)}}.bind(this))}else{if(g instanceof Ext.TabPanel){g.on("tabchange",function(j,k){if(k.value&&this.store&&g.dataField){var h=this.store.getRecords(g.recordRel)[0]||this.store.getAt(0);if(!h){return}var l=Object.clone(h.get("rep"));l[g.dataField.split(".").last()]=k.value;h.set("rep",l)}}.bind(this));g.items.each(function(h){if(h instanceof Ext.Panel){h.items.each(function(j){if(j instanceof Ext.form.TextField||j instanceof Ext.form.Checkbox){j.on("change",d.bind(this,j))}}.bind(this))}}.bind(this))}}}}}.bind(this));Signavio.Extensions.FormStorePanel.superclass.initFields.call(this);this.ok=Ext.get(document.createElement("img"));this.failed=Ext.get(document.createElement("img"));this.ok.dom.src=Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif";this.failed.dom.src=Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif";this.ok.addClass("x-ok");this.failed.addClass("x-failed");var e=1000;var b=false;var c=function(g){this.failed.show(true);window.setTimeout(function(){this.failed.hide({useDisplay:true});b=false}.bind(this),e);g.un("submitfailed",f,this);g.un("update",f,this);b=true};var f=function(h,g,j){if(j!==Ext.data.Record.COMMIT||b===true){return}this.ok.show(true);window.setTimeout(this.ok.hide.bind(this.ok,{useDisplay:true}),e);h.un("update",f,this);h.un("submitfailed",f,this)};this.commitBtn=new Ext.Button({text:Signavio.I18N.Repository.FormStorePanel.commit,style:"float:left;",disabled:true,hidden:this.hideButtons,handler:function(){if(this.store){this.store.commitChanges();this.store.on("update",f,this);this.store.on("submitfailed",c,this)}}.bind(this)});this.rejectBtn=new Ext.Button({text:Signavio.I18N.Repository.FormStorePanel.reject,style:"float:left;",disabled:true,hidden:this.hideButtons,handler:function(){this.store?this.store.rejectChanges():null}.bind(this)});var a=new Ext.Panel({border:false,disable:this.disable.bind(a),enable:this.enable.bind(a),autoWidth:true,style:this.labelWidth!==undefined?"padding-left:"+(this.labelWidth+5)+"px":"",cls:"x-admin-btn",items:([this.commitBtn,this.rejectBtn])});a.on("render",function(){a.body.appendChild(this.ok.dom);a.body.appendChild(this.failed.dom);a.body.insertHtml("beforeEnd",'<div style="clear:both;"></div>')}.bind(this));this.add(a);this.items.each(function(g){if(g.initialConfig.width&&g.initialConfig.width!=g.width){g.setWidth(g.initialConfig.width)}})},showButtons:function(a){this.commitBtn.setVisible(a!==false);this.rejectBtn.setVisible(a!==false)},onRender:function(){Signavio.Extensions.FormStorePanel.superclass.onRender.apply(this,arguments);if(this.commitBtn&&this.store&&!this.disabled){this.commitBtn.setDisabled(false);this.rejectBtn.setDisabled(false)}if(this.store&&this.store.data.items.size()>0){window.setTimeout(this.doStoreChange.bind(this,this.store),10)}},store:null,setStore:function(a){this.setWaiting(true);if(this.store){this.store.un("load",this.doStoreChange,this);this.store.un("update",this.doStoreChange,this);this.store.un("remove",this.doStoreChange,this);this.store.un("add",this.doStoreChange,this)}this.store=a;if(this.store){this.store.on("load",this.doStoreChange,this);this.store.on("update",this.doStoreChange,this);this.store.on("remove",this.doStoreChange,this);this.store.on("add",this.doStoreChange,this)}if(this.commitBtn){this.commitBtn.setDisabled(!a);this.rejectBtn.setDisabled(!a)}if(!a){this.doStoreChange(true)}if(this.store&&this.store.data.items.size()>0){window.setTimeout(this.doStoreChange.bind(this,this.store),10)}},disable:function(){if(this.items){this.items.each(function(a){a.disable()});this.disabled=true}},enable:function(){if(this.items){this.items.each(function(a){if(a.initialConfig.disabled){return}a.enable()});this.disabled=false}},doStoreChange:function(e,d,g){if(!e||(typeof g=="string"&&g!==Ext.data.Record.COMMIT)){return}var f=e instanceof Signavio.Core.DataStore?e:undefined;if(this.disabled&&f){this.enable()}else{if(!this.disabled&&!f){this.disable()}}this.items.each(function(h){if(typeof h.dataField==="string"){var k,b,j;if(f){j=f.getRecords(h.recordRel)||f.data.items;k=(j||[]).map(function(l){return f.parseValue(l,h.dataField)}).compact().reduce()||"";if(j){b=j.findAll(function(l){return !(f.addedRecords||[]).include(l)}).concat(f.removedRecords);b=b.map(function(l){if(l){return f.parseValue(l.modified||l,h.dataField)}else{return null}}).compact().reduce()}}h.originalValue=b||k;if(h.setValue){h.setValue(k||h.defaultValue||h.initialConfig.value,f,j,h)}var c=this.disabled||h.initialConfig.disabled||(h.value===h.defaultValue&&!!h.value)||(h.initialConfig.isDisabled instanceof Function&&h.initialConfig.isDisabled(k,(j||[]).reduce()));h[(h.value==h.defaultValue&&!!h.value)?"addClass":"removeClass"]("x-default");h[c?"disable":"enable"]();var a=!b&&!k;if(typeof k=="string"){a=a||(!b||k===String(b)||(b instanceof Array&&b.include(k)))}else{if(k instanceof Array){a=a||(b&&(b.length===k.length&&b.all(function(l){var m=$H(l).toJSON();return !!k.find(function(n){return $H(n).toJSON()==m})})))}else{a=a||(b&&($H(b).toJSON()===$H(k).toJSON()))}}a=h.hideAddField||a;this[a?"removeDirty":"setDirty"](h)}}.bind(this));if(this.commitBtn){this.commitBtn.enable();this.rejectBtn.enable()}this.setWaiting(false);this.fireEvent("storechanged",f)}});if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}(function(){var a="y-filter-value-editor";var c={STRING:"string",DATE:"date",NUMBER:"number",LINKLIST:"linklist",USER:"user",GLOSSARY:"glossary",BOOLEAN:"boolean"};var b={META:0,ATTRIBUTE:1};Signavio.Extensions.Filter=function(d){d=d||{};this.active=!!d.active;this.field=d.field;this.id=d.id;this.valueConf=d.valueConf||[];this.relationConf=d.relationConf||[];this.value=d.value;this.relation=d.relation;this.filterType=d.filterType!==undefined?d.filterType:b.ATTRIBUTE;if(d.relationConf&&d.relationConf.length>0){this.relation=d.relationConf[0][1]}this.internationalize()};Signavio.Extensions.Filter.CustomEditor=function(e,d){this.field=e;Ext.apply(this,d);Signavio.Extensions.Filter.CustomEditor.superclass.constructor.call(this,e,d)};Ext.extend(Signavio.Extensions.Filter.CustomEditor,Ext.grid.GridEditor,{completeEdit:function(d){if(!this.editing){return}var e=this.getValue();if(this.revertInvalid!==false&&!this.field.isValid()){e=this.trueOldValue;this.cancelEdit(true)}if(String(e)===String(this.trueOldValue)&&this.ignoreNoChange){this.editing=false;this.hide();return}if(this.fireEvent("beforecomplete",this,e,this.trueOldValue)!==false){this.editing=false;if(this.updateEl&&this.boundEl){this.boundEl.update(e)}if(d!==true){this.hide()}this.fireEvent("complete",this,e,this.trueOldValue)}}});Ext.extend(Signavio.Extensions.Filter,Object,{getJSON:function(){return{field:this.id,relation:this.relation,value:this.getValue(),type:this.filterType,dataType:this.dataType}},getValue:function(){return this.value===undefined?"":this.value},setValue:function(d){this.value=d},internationalize:function(){var d={};this.valueConf.concat(this.relationConf).each(function(e){var g=e[0];var f=e[1];d[f.toString()]=g});this.i18n=d},activate:function(e,d){this.active=true;var f=e.el.select(".y-wizard-filter-switch");var g=f.elements[d];if(g){g.checked=true}},disable:function(e,d){this.active=false;var f=e.el.select(".y-wizard-filter-switch");var g=f.elements[d];if(g){g.checked=false}},afterEdit:function(d,f,e){e.store.commitChanges()},getDefaultValue:function(){return""},getDefaultRelationValue:function(){return this.relation},getValueEditor:function(e,g){var d=new Ext.ux.form.ComboFieldList({store:new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:this.valueConf||[]}),valueField:"value",displayField:"title",mode:"local",selectOnFocus:true,editable:true,readOnly:true});var f=new Ext.grid.GridEditor(d,{cls:a});f.on("complete",function(h){this.value=h.getValue();if(!this.active&&this.valid()){this.activate(e,g)}}.bind(this));return f},getRelationEditor:function(e,g){var d=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:this.relationConf||[]}),valueField:"value",displayField:"title",shadow:"drop",mode:"local",editable:false});var f=new Ext.grid.GridEditor(d,{cls:a});f.on("complete",function(h){this.relation=h.getValue();if(!this.active&&this.valid()){this.activate(e,g)}e.store.commitChanges()}.bind(this));return f},valid:function(){return true},renderRelation:function(e,d){return(this.i18n[(e===undefined?"":e).toString()]||e)+(d?" (<a href='#' onclick='return false;'>"+Signavio.I18N.FilterSet.change+"</a>)":"")},renderValue:function(d){var e="<a href='#' onclick='return false;'>"+Signavio.I18N.FilterSet.change+"</a>";d=this.i18n[(d===undefined?"":d).toString()]||d;if(d||d===false){e="("+e+")"}return d+" "+e}});Signavio.Extensions.BooleanFilter=function(d){d=d||{};d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.relation.typeEquals,"equals"]];d.valueConf=d.valueConf||[[Signavio.I18N.FilterSet.bool.typeTrue,true],[Signavio.I18N.FilterSet.bool.typeFalse,false]];Signavio.Extensions.BooleanFilter.superclass.constructor.call(this,d);this.value=this.getDefaultValue();this.dataType=c.BOOLEAN};Ext.extend(Signavio.Extensions.BooleanFilter,Signavio.Extensions.Filter,{getDefaultValue:function(){return true},relationEditable:false,getValueEditor:function(e,g){var d=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:this.valueConf||[]}),valueField:"value",displayField:"title",mode:"local",selectOnFocus:true,editable:true,readOnly:true});var f=new Ext.grid.GridEditor(d,{cls:a});f.on("complete",function(h){this.value=h.getValue();if(!this.active&&this.valid()){this.activate(e,g)}}.bind(this));return f}});Signavio.Extensions.ListFilter=function(d){d=d||{};d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.relation.typeEquals,"equals"],[Signavio.I18N.FilterSet.relation.typeIsEmpty,"is_empty"]];this.dataType=c.STRING;Signavio.Extensions.ListFilter.superclass.constructor.call(this,d)};Ext.extend(Signavio.Extensions.ListFilter,Signavio.Extensions.Filter,{relationEditable:false,getDefaultValue:function(){return[]},renderRelation:function(d){return this.i18n[d]},renderValue:function(d){if(d&&d instanceof Array){if(d.length){d=d.map(function(e){return e[0]});return d.join("<br />")}d=""}return Signavio.Extensions.ListFilter.superclass.renderValue.call(this,d)},getValue:function(){return this.value.map(function(d){return d[1]})},setValue:function(d){d=(d||[]).map(function(e){var f=this.valueConf.find(function(g){if(g[1]===e){return true}});return f}.bind(this));this.value=d},valid:function(){return(this.value||[]).length!==0},afterEdit:function(d,f,e){if(!(this.value||[]).length){this.disable(e,f)}Signavio.Extensions.ListFilter.superclass.afterEdit.call(this,d,f,e)}});Signavio.Extensions.StringFilter=function(d){d=d||{};d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.relation.typeContains,"contains"],[Signavio.I18N.FilterSet.relation.typeNotContains,"not_contains"],[Signavio.I18N.FilterSet.relation.typeEquals,"equals"],[Signavio.I18N.FilterSet.relation.typeNotEqual,"not_equal"],[Signavio.I18N.FilterSet.relation.typeBeginsWith,"begins_with"],[Signavio.I18N.FilterSet.relation.typeEndsWith,"ends_with"],[Signavio.I18N.FilterSet.relation.typeIsEmpty,"is_empty"]];this.dataType=c.STRING;Signavio.Extensions.StringFilter.superclass.constructor.call(this,d)};Ext.extend(Signavio.Extensions.StringFilter,Signavio.Extensions.Filter,{relationEditable:true,getDefaultValue:function(){return[]},getValueEditor:function(d,f){var e=new Ext.ux.form.TextFieldList({itemFieldTpl:new Ext.XTemplate('<tpl if="values.length===0"><span class="x-empty"></span></tpl>','<tpl for=".">','<span class="y-filter-combo-list">{[Signavio.Utils.escapeHTML(values)]} ','<span class="x-smaller">',"(",'<a href="#{[xindex-1]}" class="x-edit" tabindex="-1">{[(Ext.ux.getI18N("btnEdit"))]}</a>, ','<a href="#{[xindex-1]}" class="x-remove" tabindex="-1">{[(Ext.ux.getI18N("btnRemove"))]}</a>',")","</span>","</span>","</tpl>"),onRender:function(){Ext.ux.form.TextFieldList.superclass.onRender.apply(this,arguments);this.itemField=Ext.get(Ext.DomHelper.append(this.wrap,{tag:"div",style:"margin:1px 0px 0px 0px;"+(!this.emptyListText?"display:none;":"")+this.listStyle}));this.updateView();var g=this.wrap.boxWrap();g.child(".x-box-mc")},startEdit:function(g){this.editing=g;var h=this.itemField.query(".y-filter-combo-list")[g];Ext.fly(h).addClass("x-editing");this.setRawValue(this.data[g]);window.setTimeout(this.focus.bind(this),10);this.onStartEdit()},stopEdit:function(){if(this.editing===undefined){return}var g=this.itemField.query(".y-filter-combo-list")[this.editing];Ext.fly(g).removeClass("x-editing");delete this.editing;this.setRawValue("");this.onStopEdit()},setValue:function(j){var g,h;if(typeof j.existing!=="undefined"&&typeof j.typed!=="undefined"){g=j.existing;h=j.typed}else{g=j;h=""}this.value="";this.setRawValue(h);if(g instanceof Array){this.data=g}else{if(typeof g==="string"&&g.trim()){this.data=[g]}else{this.data=[]}}this.updateView()},requiresComplexData:true});e.enableEmptyAdd=false;e.on("specialkey",function(g,h){if(h.getKey()===h.ENTER){h.stopEvent();return false}else{if(h.getKey()===h.ESC){g.stopEdit()}}});return new Signavio.Extensions.Filter.CustomEditor(e,{cls:a})},valid:function(){return(this.value&&this.value.length!==0)||this.relation==="is_empty"},afterEdit:function(d,f,e){this.value=d.get("value");if(this.value.length){if(!this.active){this.activate(e,f)}}else{this.disable(e,f);this.cleanRecord(e.store.getAt(f))}Signavio.Extensions.StringFilter.superclass.afterEdit.call(this,d,f,e)},cleanRecord:function(d){d.data.value=d.data.value.compact()},renderValue:function(d){if(d.length){return d.join("<br />")}return Signavio.Extensions.StringFilter.superclass.renderValue.call(this,"")}});Signavio.Extensions.URLFilter=function(d){d=d||{};this.asList=!!d.isList;Signavio.Extensions.URLFilter.superclass.constructor.call(this,d);this.dataType=d.isList?c.LINKLIST:c.STRING};Ext.extend(Signavio.Extensions.URLFilter,Signavio.Extensions.StringFilter,{getDefaultRelationValue:function(){return"contains"}});Signavio.Extensions.GlossaryFilter=function(d){d=d||{};d.relationConf=[[Signavio.I18N.FilterSet.relation.typeIsEmpty,"is_empty"]];this.linkableType=d.linkableType;this.dataType=c.GLOSSARY;this.asList=!!d.isList;if(this.asList){d.relationConf.push([Signavio.I18N.FilterSet.relation.typeContains,"contains"])}else{d.relationConf.push([Signavio.I18N.FilterSet.glossary.typeEqual,"equals"])}Signavio.Extensions.GlossaryFilter.superclass.constructor.call(this,d)};Ext.extend(Signavio.Extensions.GlossaryFilter,Signavio.Extensions.Filter,{relationEditable:true,getDefaultRelationValue:function(){if(this.asList){return"contains"}return"equals"},getValueEditor:function(d,g){var f=new Ext.ux.form.GlossaryList({linkableType:this.linkableType,showEmptyItems:false});var e=new Signavio.Extensions.Filter.CustomEditor(f,{cls:a});e.on("complete",function(h){this.value=h.getValue();if(!this.active&&this.valid()){this.activate(d,g)}}.bind(this));return e},valid:function(){return this.value instanceof Array&&this.value.length!==0},getValue:function(){return(this.value||[]).map(function(d){return d.first().substr(1).replace("/","://")+"/"+d.last()+";;"})},setValue:function(d){this.value=(d||[]).map(function(e){return["/glossary/"+this.glossaryId(e),this.glossaryTitle(e)]}.bind(this))},glossaryId:function(d){if(typeof d==="string"&&!!d.match(/\glossary\:\/\/.+\/[\w\W]+\;\;/g)){return(d||"").split(";;").invoke("replace",/\glossary\:\/\//g,"").invoke("replace",/\/[\w\W]+/g,"").first()}return""},glossaryTitle:function(d){if(typeof d==="string"&&!!d.match(/\glossary\:\/\/.+\/[\w\W]+\;\;/g)){return(d||"").replace(/;;$/,"").replace(/\glossary\:\/\/.+?\//g,"")}return""},renderValue:function(d){if(d&&d instanceof Array&&d.length){d=d.map(function(e){if(e instanceof Array){return e.last()}return this.glossaryTitle(e)}.bind(this));return d.join("<br />")}return Signavio.Extensions.GlossaryFilter.superclass.renderValue.call(this,"")}});Signavio.Extensions.DateFilter=function(d){d=d||{};d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.date.typeBefore,"before"],[Signavio.I18N.FilterSet.date.typeOn,"on"],[Signavio.I18N.FilterSet.date.typeAfter,"after"],[Signavio.I18N.FilterSet.date.typeBetween,"between"],[Signavio.I18N.FilterSet.relation.typeIsEmpty,"is_empty"]];Signavio.Extensions.DateFilter.superclass.constructor.call(this,d);this.dataType=c.DATE};Ext.extend(Signavio.Extensions.DateFilter,Signavio.Extensions.Filter,{relationEditable:true,getValueEditor:function(d,f){var e=this.createEditor();e.on("complete",function(g){this.value=g.getValue();if(!this.active&&this.valid()){this.activate(d,f)}else{if(!this.valid()){this.disable(d,f)}}}.bind(this));return e},createEditor:function(){var e=null;if(this.relation==="between"){e=new Ext.form.DateField({format:Signavio.I18N.FilterSet.timeFormat,ctCls:"y-date-editor-between"+(Ext.isChrome?" y-date-editor-chrome":""),emptyText:Signavio.I18N.FilterSet.timeTill,allowBlank:false})}var d=new Ext.ux.form.TimeSpanField({from:new Ext.form.DateField({format:Signavio.I18N.FilterSet.timeFormat,ctCls:(e?"y-date-editor-between"+(Ext.isChrome?" y-date-editor-chrome":""):""),emptyText:e?Signavio.I18N.FilterSet.timeFrom:"",allowBlank:false}),till:e,border:false});return new Ext.grid.GridEditor(d,{cls:a})},renderValue:function(e){var d=this.parseDate((e||[]).flatten());d=d.invoke("format",Signavio.I18N.FilterSet.timeFormat);d=d.uniq().join(" - ");return Signavio.Extensions.DateFilter.superclass.renderValue.call(this,d)},getValue:function(){var e=this.value;if(e instanceof Array){e=e.map(function(f){if(f&&f instanceof Date){return f.format("j.m.y")}}).compact().uniq();if(e.length===0){return[]}else{if(e.length===1){var d="-0:0:0";if(this.relation==="after"){d="-23:59:59"}e=e[0]+d}else{if(e.length===2){e[0]=e.first()+"-0:0:0";e[1]=e.last()+"-23:59:59"}}}return[e]}return e},dateFromString:function(h){if(!h){return}var g=h.split("-");g=g[0].split(".");var d=g[0];var j=g[1];var f="20"+g[2];var e=new Date(j+"/"+d+"/"+f);if(isNaN(e.getTime())){return}return e},parseDate:function(d){if(d instanceof Date){return d}if(typeof d==="string"){return this.dateFromString(d)}if(d instanceof Array){return d.map(function(e){return this.parseDate(e)}.bind(this))}},setValue:function(d){if(d instanceof Date){this.value=[d]}else{this.value=this.parseDate(d)}},checkValue:function(e){var d=false;e.each(function(f){if(f instanceof Array){d=this.checkValue(f)}else{d=!!f}}.bind(this));return d},valid:function(){return(this.value instanceof Array&&this.checkValue(this.value))||this.relation==="is_empty"}});Signavio.Extensions.NumberFilter=function(d){d=d||{};d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.number.typeLessThan,"lt"],[Signavio.I18N.FilterSet.number.typeLessThanEqual,"lte"],[Signavio.I18N.FilterSet.number.typeEqual,"equals"],[Signavio.I18N.FilterSet.number.typeNotEqual,"not_equal"],[Signavio.I18N.FilterSet.number.typeGreaterThanEqual,"gte"],[Signavio.I18N.FilterSet.number.typeGreaterThan,"gt"],[Signavio.I18N.FilterSet.relation.typeIsEmpty,"is_empty"]];Signavio.Extensions.NumberFilter.superclass.constructor.call(this,d);this.dataType=c.NUMBER};Ext.extend(Signavio.Extensions.NumberFilter,Signavio.Extensions.Filter,{relationEditable:true,getValueEditor:function(d,f){var g=new Ext.form.NumberField({nanText:Signavio.I18N.FilterSet.errorNaN,decimalSeparator:Signavio.I18N.FilterSet.decimalSeparator});var e=new Ext.grid.GridEditor(g,{cls:a});e.on("complete",function(h){this.value=h.getValue();if(!this.active&&this.valid()){this.activate(d,f)}else{if(!this.valid()){this.disable(d,f)}}}.bind(this));return e},renderValue:function(d){d=(d||"").toString().replace(".",Signavio.I18N.FilterSet.decimalSeparator);return Signavio.Extensions.NumberFilter.superclass.renderValue.call(this,d)}});Signavio.Extensions.UserFilter=function(d){d=d||{};this.user=d.user;d.relationConf=d.relationConf||[[Signavio.I18N.FilterSet.relation.typeEquals,"equals"]];var e=Signavio.Core.StoreManager.getAllUserStore();d.valueConf=d.valueConf||[];e.each(function(f){var h=f.get("href");var g=f.get("rep");d.valueConf.push([g.name,h])});d.valueConf.sort(function(g,f){var j=g[0];var h=f[0];return j<h?-1:j>h?1:0});Signavio.Extensions.UserFilter.superclass.constructor.call(this,d);this.dataType=c.USER};Ext.extend(Signavio.Extensions.UserFilter,Signavio.Extensions.ListFilter,{getValue:function(){return this.value.map(function(d){return d[1].replace("/user/","")})},setValue:function(d){d=(d||[]).map(function(e){if(!e.startsWith("/user/")){e="/user/"+e}var f=this.valueConf.find(function(g){if(g[1]===e){return true}});return f}.bind(this));this.value=d}});Signavio.Extensions.FilterSet=function(h,j){h=h||{};this.facade=j;var e=new Ext.data.ArrayReader({},[{name:"filter"},{name:"relation"},{name:"value"},{name:"group"}]);var g=new Ext.data.GroupingStore({reader:e,fields:[{name:"filter"},{name:"relation"},{name:"value"},{name:"group"}],data:[],sortInfo:{field:"filter",direction:"ASC"},groupField:"group"});g.sortData=function(m,n){if(m==="filter"){n=n||"ASC";var k=this.fields.get(m).sortType;var l=function(s,q){var u=k(s.data[m].field);var t=k(q.data[m].field);var r=k(s.data.group);var p=k(q.data.group);return r>p?1:r<p?-1:u>t?1:(u<t)?-1:0};this.data.sort(n,l);if(this.snapshot&&this.snapshot!==this.data){this.snapshot.sort(n,l)}}};var d=new Ext.grid.ColumnModel([{menuDisabled:true,hideable:false,sortable:false,width:25,dataIndex:"filter",fixed:true,renderer:function(k){return"<input type='checkbox' class='y-wizard-filter-switch' "+(k.active?"checked='checked'":"")+" />"}},{header:Signavio.I18N.FilterSet.header.field,menuDisabled:true,sortable:true,hideable:false,dataIndex:"filter",renderer:function(k){return"<span class='y-wizard-filter-field'>"+k.field+"</span>"}},{header:Signavio.I18N.FilterSet.header.operation,menuDisabled:true,sortable:false,hideable:false,dataIndex:"relation",editor:new Ext.form.TextField(),renderer:function(m,n,k){var l=k.get("filter");return l.renderRelation(m,l.relationEditable)}},{header:Signavio.I18N.FilterSet.header.value,menuDisabled:true,sortable:false,hideable:false,dataIndex:"value",width:120,editor:new Ext.form.TextField(),renderer:function(m,n,k){var l=k.get("filter");return l.renderValue(m)}},{hidden:true,dataIndex:"group"}]);var f=new Ext.grid.GroupingView({emptyText:Signavio.I18N.FilterSet.emptyText,forceFit:true,autoFill:true,groupTextTpl:"{[Signavio.I18N.FilterSet.groups[(values.rs.first().data.group)]]}"});f.on("rowupdated",this.handleRender.bind(this));h.store=g;h.clicksToEdit=1;h.cm=d;h.cls="y-wizard-filter";h.view=f;h.stripeRows=true;h.disableSelection=true;h.anchor="100%, -100";h.border=false;h.hideHeaders=true;Signavio.Extensions.FilterSet.superclass.constructor.call(this,h);this.on("beforeedit",this.handleBeforeEdit);this.on("afteredit",this.handleAfterEdit.bind(this));this.on("render",this.handleRender.bind(this));this.on("mousedown",this.handleCellClick.bind(this));this.configureFilters()};Signavio.Extensions.FilterSet.ALLOWED_STENCILS={"http://b3mn.org/stencilset/bpmn2.0choreography#":["BPMNDiagram"],"http://b3mn.org/stencilset/bpmn2.0conversation#":["BPMNDiagram"],"http://b3mn.org/stencilset/bpmn2.0#":["BPMNDiagram"],"http://www.signavio.com/stencilsets/organigram#":["Diagram"],"http://www.signavio.com/stencilsets/processmap#":["Diagram"],"http://b3mn.org/stencilset/epc#":["Diagram"]};Signavio.Extensions.FilterSet.Record=Ext.data.Record.create([{name:"filter",mapping:"filter"},{name:"relation",mapping:"relation"},{name:"value",mapping:"value"},{name:"group",mapping:"group"}]);Ext.extend(Signavio.Extensions.FilterSet,Ext.grid.EditorGridPanel,{filters:[],lastError:undefined,configureFilters:function(){this.filters.clear();Signavio.Core.StoreManager.getStore("/meta",true,function(e){var d=e.invoke("get","rep");d.each(function(f){var g=f.stencilsetBindings.find(function(l){var j=Signavio.Extensions.FilterSet.ALLOWED_STENCILS[l.namespace];if(j){var k=j.find(function(m){if(m===l.stencil){return true}});return !!k}return false});if(g){var h=this.createFilter(f);if(h){this.addFilter(h)}}}.bind(this))}.bind(this));this.createCustomFilters()},addFilter:function(d){this.filters.push(d);this.store.addSorted(new Signavio.Extensions.FilterSet.Record({filter:d,relation:d.getDefaultRelationValue(),value:d.getDefaultValue(),group:d.filterType}))},createCustomFilters:function(){this.newCustomFilter({type:"MetaDataStringInfo",name:Signavio.I18N.FilterSet.modelName,id:"name",filterType:b.META});this.newCustomFilter({type:"MetaDataStringInfo",name:Signavio.I18N.FilterSet.modelDescription,id:"description",filterType:b.META});this.newCustomFilter({type:"MetaDataDate",name:Signavio.I18N.FilterSet.modelLastModified,id:"modificationdate",filterType:b.META});this.newCustomFilter({type:"MetaDataBoolean",name:Signavio.I18N.FilterSet.modelIsPublished,id:"ispublished",filterType:b.META});this.newCustomFilter({type:"MetaDataUser",name:Signavio.I18N.FilterSet.modelEditor,id:"author",filterType:b.META});this.addStencilSetFilter()},addStencilSetFilter:function(){this.facade.loadStencilSets(function(d){this.newCustomFilter({type:"MetaDataEnum",name:Signavio.I18N.FilterSet.modelStencilset,id:"stencilset",filterType:b.META,items:d.map(function(e){return[e["title_"+Ext.ux.getLang()]||e.title,e.namespace]})})}.bind(this))},newCustomFilter:function(e){var d=this.createFilter(e);this.addFilter(d)},createFilter:function(d){var f=null;var e={field:d.name,id:d.id,filterType:d.filterType};switch(d.type){case"MetaDataBoolean":f=new Signavio.Extensions.BooleanFilter(e);break;case"MetaDataStringInfo":f=new Signavio.Extensions.StringFilter(e);break;case"MetaDataEnum":e.valueConf=d.items.map(function(g){if(g instanceof Array&&g.length===2){return g}else{if("object"==typeof g&&g.id&&g.title){return[g.title,g.id]}}return[g,g]});f=new Signavio.Extensions.ListFilter(e);break;case"MetaDataUrl":e.isList=d.isList;f=new Signavio.Extensions.URLFilter(e);break;case"MetaDataGlossaryLink":e.linkableType=d.linkableType;e.isList=d.isList;f=new Signavio.Extensions.GlossaryFilter(e);break;case"MetaDataDate":if(!d.dateFormat){f=new Signavio.Extensions.DateFilter(e)}break;case"MetaDataNumberInfo":f=new Signavio.Extensions.NumberFilter(e);break;case"MetaDataUser":e.user=Signavio.Core.StoreManager.getCurrentUser();f=new Signavio.Extensions.UserFilter(e);break}return f},removeCellSelection:function(){this.el.select(".x-grid3-cell-selected").each(function(d){d.addClass("y-filter-grid-no-background")})},handleBeforeEdit:function(g){var f=g.record.get("filter");var d=g.grid.getColumnModel();var e=null;switch(g.field){case"relation":if(!f.relationEditable){return false}e=f.getRelationEditor(g.grid,g.row);break;case"value":e=f.getValueEditor(g.grid,g.row);break}if(e){d.setEditor(g.column,e);e.render(g.grid);e.setSize(d.getColumnWidth(g.column,e.height))}},handleAfterEdit:function(e){var d=e.record.get("filter");d.afterEdit(e.record,e.row,this);this.handleRender()},handleRender:function(){var e=this.el.select(".y-wizard-filter-switch");e.each(function(f,h,g){f.removeAllListeners();f.on("click",function(){var j=g;this.handleClick(j);return false}.bind(this))}.bind(this));var d=this.el.select(".y-wizard-filter-field");d.each(function(h,g,f){h.removeAllListeners();h.on("click",function(){var j=f;this.handleClick(j)}.bind(this))}.bind(this));this.removeCellSelection()},handleClick:function(d){var e=this.store.getAt(d).get("filter");if(e.active){e.disable(this,d)}else{e.activate(this,d)}},handleCellClick:function(){this.removeCellSelection()},getJSON:function(){var d=[];this.filters.each(function(e){if(e.active&&e.valid()){d.push(e.getJSON())}});return d},isValid:function(){var d=true;this.filters.each(function(e){if(e.active&&!e.valid()){d=false;this.lastError=Signavio.I18N.FilterSet.errorStart+e.field+Signavio.I18N.FilterSet.errorEnd;throw $break}}.bind(this));return d},getLastError:function(){return this.lastError},activateFilters:function(d){this.store.each(function(e,g){var f=e.get("filter");var h=false;d.each(function(j){if(j.id===f.id){h=true;var k=j.value instanceof Array?j.value.clone():j.value;f.activate(this,g);f.setValue(k);f.relation=j.relation;e.set("relation",j.relation);e.set("value",f.value);e.commit();throw $break}}.bind(this));if(!h){f.disable(this,g);f.setValue(f.getDefaultValue());f.relation=f.getDefaultRelationValue();e.set("relation",f.getDefaultRelationValue());e.set("value",f.getDefaultValue());e.commit()}}.bind(this))}})}());if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.TreeLoader=Signavio.ux.dialog.tree.Loader;Signavio.Extensions.TreePanel=Signavio.ux.dialog.tree.Panel;Signavio.Extensions.ModelDirectoryCheckTreePanel=Signavio.ux.dialog.tree.ModelCheckPanel;Signavio.Extensions.TreeIPPanel=function(a){a=a||{};var b=a.validator||function(){return true};this.data=a.data;this.dataLabel=a.dataLabel;delete a.data;var d={iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/add.png",text:Signavio.I18N.Repository.ControlRights.add,disabled:true,handler:function(){var e=new Ext.form.TextField({style:"margin: 8px 0 5px 10px; width: 210px;",invalidText:Signavio.I18N.Repository.ControlRights.ipIsInvalid,blankText:Signavio.I18N.Repository.ControlRights.ipv4,anchor:"100%",allowBlank:false,regex:/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/});var j=new Ext.Button({text:Signavio.I18N.Repository.ControlRights.add,width:100,cls:"df-ip-add-btn",style:"margin-to:10px",handler:function(){var k=f.items.get(1).getValue();if(!b(k)){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,msg:Signavio.I18N.Repository.ControlRights.ipInvalid,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}else{if(this.addIp(k)){f.close()}}}.bind(this)});var h=new Ext.Button({text:Signavio.I18N.Repository.ControlRights.chancel,width:100,handler:function(){f.close()}.bind(this)});var g={html:"<div style='background-color: #AAAAAA'>"+Signavio.I18N.Repository.ControlRights.ipv4+"</div>"};var f=new Ext.Window({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,modal:true,cls:"df-ip-add-window",border:false,resizable:false,width:"250px",buttonAlign:"center",layout:"anchor",items:[g,e],buttons:[j,h]});f.show()}.bind(this)};var c={iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/delete.png",text:Signavio.I18N.Repository.ControlRights.remove,disabled:true,handler:function(){this.getRootNode().eachChild(function(e){if(e&&e.isSelected()){e.remove();this.fireEvent("ipremoved");return}})}.bind(this)};a.tbar=[d,c];Signavio.Extensions.TreeIPPanel.superclass.constructor.call(this,a)};Ext.extend(Signavio.Extensions.TreeIPPanel,Signavio.Extensions.TreePanel,{animate:true,autoScroll:true,enableDD:false,rootVisible:false,useArrows:true,cls:"df-x-iplisttree",loader:new Ext.tree.TreeLoader(),value:null,height:100,width:100,isFormField:true,checkRecursive:false,originalValue:null,listeners:{enable:function(a){if(a.rendered){a.getTopToolbar().items.each(function(b){b.enable()})}},disable:function(a){if(a.rendered){a.getTopToolbar().items.each(function(b){b.disable()})}}},root:new Ext.tree.TreeNode({text:"",draggable:false,expanded:true}),clear:function(){var a=this.getRootNode();while(a.firstChild){a.removeChild(a.firstChild)}},onDestroy:function(){Signavio.Extensions.TreeIPPanel.superclass.onDestroy.call(this)},isDirty:function(){return false},onRender:function(){Signavio.Extensions.TreeIPPanel.superclass.onRender.apply(this,arguments);if(this.onIpChange){this.on("ipadded",this.onIpChange);this.on("ipremoved",this.onIpChange)}},getAllIps:function(){var a=[];this.getRootNode().eachChild(function(b){a.push(b.text)});return a},addIp:function(c){var b=false;this.getRootNode().eachChild(function(d){if(d.text===c){b=true}});if(b){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,msg:Signavio.I18N.Repository.ControlRights.ipAlready,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}else{var a=new Ext.tree.TreeNode({text:c});this.getRootNode().appendChild(a);this.fireEvent("ipadded");return true}}});Signavio.Extensions.TreeCheckPanel=Signavio.ux.dialog.tree.CheckPanel;Signavio.Extensions.TreeTableView=function(a){a=a||{};if(a.store){this.store=a.store;this.store.on("load",this.onLoad.bind(this));this.store.on("update",this.onLoad.bind(this))}a.root=new Ext.tree.TreeNode({text:"RootFolder",leaf:false,cls:"folder"});Signavio.Extensions.TreeTableView.superclass.constructor.call(this,a);if(a.forceUpdate===true){this.onLoad(this.store,this.store.data.items,this.store.lastOptions)}if(a.listeners&&a.listeners.selectionchange){this.getSelectionModel().on("selectionchange",a.listeners.selectionchange)}};Ext.extend(Signavio.Extensions.TreeTableView,Signavio.Extensions.TreePanel,{cls:"x-tableview-plugin",autoWidth:true,animate:true,border:false,onLoad:function(a,b,c){this.root.collapse();this.dirty=true;this.root.attributes={text:"RootFolder",leaf:false,cls:"folder",expanded:true,dataField:"rep.name",filterFn:function(d){return true},isChildLeaf:function(d){return d.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(d){if(d.get("rel")===Signavio.Const.REL.MODEL){return"model"}return"folder"},recordRel:this.recordRel||[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL]};if(!this.viewPlugin||this.viewPlugin.isViewSelected()){this.loader.doResponse(this.store,this.root,null,b,c);this.loader.initStoreEvents(this.store,this.root);this.dirty=false}}});Signavio.Extensions.ProcessMapCheckTreePanel=function(a){a=a||{};Signavio.Extensions.ProcessMapCheckTreePanel.superclass.constructor.call(this,a);a.loader.setGetRequestUrlCallback(function(b){return b+"/link"});this.addListener("checkchange",function(d,c){var e=function(j,h){var g=j.childNodes;for(var f=0;f<g.length;f++){g[f].ui.toggleCheck(h);g[f].attributes.checked=h;e(g[f],h)}};e(d,c);var b=function(g,h){if(!g){return}if(!h){g.ui.toggleCheck(h);g.attributes.checked=h}else{var f=g.childNodes.all(function(j){return j.ui.isChecked()});if(f){g.ui.toggleCheck(true);g.attributes.checked=true}}b(g.parentNode,h)};b(d.parentNode,c)});this.setRootNode(new Ext.tree.TreeNode({text:"",draggable:false,expanded:true}));this.getRootNode().appendChild(this.visibleRootChild);this.getRootNode().addListener("expand",function(b){b.childNodes.each(function(c){this.getLoader().requestData(c,this.onRootLoaded.bind(this))}.bind(this))}.bind(this))};Ext.extend(Signavio.Extensions.ProcessMapCheckTreePanel,Signavio.Extensions.TreePanel,{style:"padding:0px;padding-top:10px;",anchor:"100% -15",cls:"x-tableview-plugin",forceUpdate:true,recordRel:[Signavio.Const.REL.MODEL],onDestroy:function(){Signavio.Extensions.ProcessMapCheckTreePanel.superclass.onDestroy.call(this);this.getLoader().releaseAllEvents();this.purgeListeners()},containsNodeWithIdentifier:function(a){for(var b in this.nodeHash){if(this.nodeHash[b].attributes.identifier==a){return true}}return false}});if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}Signavio.Extensions.HoverPanel=function(a){a.renderTo=Ext.getBody();Signavio.Extensions.HoverPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Signavio.Extensions.HoverPanel,Ext.Panel,{border:false,title:"&nbsp;",cls:"x-info",bodyStyle:"margin-left:9px;background:white;",collapsible:true,layout:"border",offsetTop:28,initComponent:function(){Signavio.Extensions.HoverPanel.superclass.initComponent.apply(this,arguments);this.addEvents("showfullview","hidefullview")},onRender:function(){Signavio.Extensions.HoverPanel.superclass.onRender.apply(this,arguments);this.weightElement=this.facade.getExtView("view").el;this.facade.getExtView("view").on("resize",this.syncSize.bind(this));this.header.addClass("x-header-info");window.setTimeout(this.syncSize.bind(this,true),100)},syncSize:function(c){if(this.syncing){return}this.syncing=true;c=c===true||undefined;this.el.setWidth(this.weightElement.getWidth()+5);this.el.setLeft(this.weightElement.getLeft()-5);var b=Ext.getBody().getHeight();b-=this.weightElement.getTop()+this.weightElement.getHeight();var a=this.weightElement.getHeight()+b;a-=this.offsetTop;if(this.collapsed){a=0}else{if(!this.fullviewShown){a=(this.initialConfig.height||60)}}var d=Ext.getBody().getHeight()-a;if(c&&this.el.getHeight()>a){this.el.setY(d,{block:true,callback:function(){this.setHeight(a);this.el.setHeight(a);this.doLayout();delete this.syncing;this.facade.raiseEvent(this.fullviewShown?Signavio.Const.EVENT.FULL_VIEW_SHOWN:Signavio.Const.EVENT.FULL_VIEW_HIDDEN)}.bind(this)})}else{this.setHeight(a);this.el.setHeight(a);this.el.setY(d,c);this.doLayout();delete this.syncing;this.facade.raiseEvent(this.fullviewShown?Signavio.Const.EVENT.FULL_VIEW_SHOWN:Signavio.Const.EVENT.FULL_VIEW_HIDDEN)}},showFullView:function(){if(this.fireEvent("showfullview",this)===false||this.collapsed){return}this.fullviewShown=true;this.el.addClass("x-info-fullview");this.syncSize(true)},hideFullView:function(){if(this.fireEvent("hidefullview",this)===false){return}this.fullviewShown=false;this.el.removeClass("x-info-fullview");this.syncSize(true)},collapse:function(){if(this.fullviewShown){this.hideFullView()}else{this.showFullView();return;this.el.setBottom(0);this.el.setTop("auto");this.el.setHeight("auto");Signavio.Extensions.HoverPanel.superclass.collapse.apply(this,arguments)}},afterCollapse:function(){Signavio.Extensions.HoverPanel.superclass.afterCollapse.apply(this,arguments);this.syncSize()},expand:function(){return;this.el.setTop("auto");this.el.setBottom(0);this.el.setHeight("auto");Signavio.Extensions.HoverPanel.superclass.expand.apply(this)},afterExpand:function(){Signavio.Extensions.HoverPanel.superclass.afterExpand.apply(this,arguments);this.syncSize()}});if(!window.Signavio){window.Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}(function(){var a=Ext.data.Record.create([{name:"href",mapping:"href"},{name:"rel",mapping:"rel"},{name:"rep",mapping:"rep"}]);Signavio.Extensions.ViewSelectionWindow=function(b){b.views=b.views||[];b.showFor=b.showFor||[];if(!b.showFor.include(b.suffix)){this.submitWithoutViews(b.selection,b.suffix);return}this.getTitle=function(){return b.title||""};this.withSubprocesses=b.withSubprocesses||false;this.showExportDialog(b.views,b.languages,b.selection,b.suffix)};Ext.extend(Signavio.Extensions.ViewSelectionWindow,Object,{handleSelectionChange:function(e,b,d){if(d.length>0){var c=e.getSelectedIndexes().first();if(c!==undefined){e.deselect(c)}}},showExportDialog:function(l,c,j,k){var g=l.length!==0;var h=k.replace("/","");var f=this.createTopPanel(j.first(),c,h,g);var b=this.createViewSelector(l);f.getDataView().on("selectionchange",this.handleSelectionChange.bind(this,b.getDataView()));b.getDataView().on("selectionchange",this.handleSelectionChange.bind(this,f.getDataView()));if(l.length===0){b.hide()}var e=this;var d=new Ext.ux.Window({resizable:false,minimizable:false,modal:true,width:500,title:this.getTitle(),bodyStyle:"background-color: white",layout:"anchor",cls:"y-wizard",buttons:[{text:Signavio.I18N.Repository.Offer.WindowBtnExport,handler:function(){if(e.submitWithViews(f,b,k)){this.ownerCt.close()}}}],items:[f,b]});d.on("show",function(n){var m=f.getOptions();if(!g&&$H(m).keys().length===0){e.submitWithoutViews(j,k);n.close()}});d.show();f.getDataView().select(0)},getHeight:function(b){if(b.getEl()){if(b.getHeight){return b.getHeight()}if(b.getSize){return b.getSize().height}}return 0},updateHeight:function(c){var b=0;var d=this;c.items.each(function(e){b+=d.getHeight(e)});if(this.getHeight(c)!==b){c.setHeight(b)}},createTopPanel:function(f,g,e,c){var b=this.getOriginalView(f.data,c);var d=this.getOptions(g,e,c);return new Ext.Panel({anchor:"100%",layout:"column",cls:"y-export-top-panel",border:false,items:[d,b],getDataView:b.getDataView,getOptions:function(){return d.getValue()},listeners:{show:this.updateHeight.bind(this)}})},getSettings:function(d){var c=this.getLanguageSelector(d);var b=null;if(c){b=[c]}return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.ProcessDocu.titleOptions,items:b,layout:"form",labelWidth:d.length===0?265:130,getValue:function(){if(c){return{language:c.getValue()}}return{}}})},getOptions:function(h,f,c,g){var b=[];var d=new Template(Signavio.I18N.Repository.Offer.GenericExportDescription);if(h.length>1||this.withSubprocesses){b.push(new Ext.form.Label({text:d.evaluate({type:Signavio.I18N.Repository.Offer.exportType[f]}),style:"margin-top: 20px"}))}var e=this.getSettings(h);if($H(e.getValue()).keys().length!==0){b.push(e)}if(c){b.push(new Ext.form.Label({text:Signavio.I18N.Repository.Offer.WindowDescription,style:"margin-top:20px; margin-bottom: 0px"}))}if(b.length===0){b=null}return new Ext.Panel({columnWidth:1,bodyStyle:"padding-left: 20px; padding-bottom: 20px;",border:false,items:b,getValue:function(){return e.getValue()}})},getLanguageSelector:function(b){if(b.length===0){return}return Signavio.Utils.getLangaugeSelector(b,{value:b.first().rel,fieldLabel:Signavio.I18N.Repository.ProcessDocu.languageFieldLabel,anchor:"100%",suppressGroups:true})},getOriginalView:function(b,c){Ext.apply(b.rep,{view:{name:c?Signavio.I18N.Repository.Revision.resetView:b.rep.name},picture:Signavio.Config.BACKEND_PATH+b.rep.revision+Signavio.Const.THUMBNAIL+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter())});var d=this.getDataView([b]);return new Ext.Panel({width:150,bodyStyle:"padding-left: 25px; padding-top: 15px; padding-bottom: 15px;",border:false,items:d,getDataView:function(){return d}})},createViewSelector:function(b){var c=this.getDataView(b);return new Ext.Panel({height:130,anchor:"100%",border:false,cls:"y-export-view-selector",items:c,bodyStyle:"overflow-x: auto",getDataView:function(){return c}})},getDataView:function(b){var c=105;return new Ext.DataView({multiSelect:false,tpl:this.getViewTpl(),cls:"view_plugin",overClass:"x-view-over",itemSelector:"div.thumb-wrap",width:c*b.length,anchor:"100% 100%",store:this.getViewStore(b),prepareData:this.prepareData,singleSelect:true})},prepareData:function(b){var c=Object.clone(b);c.rep=Object.clone(b.rep);c.rep.shortName=Signavio.Helper.SplitIntoTwoLines((c.rep.view.name||""),(90*2));if(!c.rep.picture){c.rep.picture=Signavio.Config.BACKEND_PATH+c.href+Signavio.Const.THUMBNAIL+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter())}return c},getViewTpl:function(){return new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{href}" storeindex="{#}" unselectable="on">','<tpl for="rep">','<div class="thumb view"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>','<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>",'<div class="x-clear"></div>')},getViewStore:function(b){var c=new Ext.data.SimpleStore({fields:this.getFields(),data:[]});c.add(this.createRecords(b));return c},getFields:function(){return[{name:"href"},{name:"rep"},{name:"rel"}]},createRecords:function(b){return(b||[]).map(function(c){return new a(c)})},getCurrentViewId:function(b,e){var d=b.getSelectedRecords().first();var c=e.getSelectedRecords().first();if(d){return d.get("href")}else{if(c){return c.get("href")}}return null},submitWithoutViews:function(b,c){var d=b.first().get("href");this.doSubmit(d,c)},doSubmit:function(c,d,b){c=Signavio.Config.BACKEND_PATH+c+d;c+=(c.include("?")?"&":"?")+Object.toQueryString(Ext.Ajax.getSecurityParameter());$H(b).keys().each(function(e){c+="&"+e+"="+b[e]});window.open(c)},submitWithViews:function(c,b,e){var d=this.getCurrentViewId(c.getDataView(),b.getDataView());if(d){this.doSubmit(d,e,c.getOptions()||{});return true}Ext.Msg.show({title:this.getTitle(),msg:Signavio.I18N.Repository.Offer.noViewSelected,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});return false}})}());if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}(function(){Signavio.Extensions.WizardTreePage=function(b){b=b||{};if(b.labelText){this.label=new Ext.form.Label({cls:"y-wizard-description-label",text:b.labelText})}this.loaderFn=b.loaderFn;var a=this.createTree(b);if(typeof b.items==="object"&&b.items.length>0){var d={title:b.optionTitle||Signavio.I18N.Repository.MapExport.furtherOptionsTitle,desc:b.optionDesc||Signavio.I18N.Repository.MapExport.furtherOptionsDesc,cls:undefined,items:b.items};this.appendedItems=new Ext.ux.view.OptionsContainer(d)}this.tree=a;this.getTree=function(){return a};if(b.showLayerSelection){this.layerSelection=this.getExportLayerSelection()}var c=null;if(b.filterPanel){c=new Ext.Button({text:Signavio.I18N.FilterSet.buttonAdd,cls:"y-wizard-filter-button",handler:this.createFilterDialog.bind(this,b.filterPanel),buttonSelector:"a:first",template:new Ext.Template("<span><a href='#' class='y-wizard-filter-link'>{0}</a> <span class='y-wizard-filter-active-count'></span></span>")})}if(this.layerSelection||this.appendedItems){this.optionsContainer=new Ext.Panel({cls:"y-wizard-options",layout:"anchor",anchor:"-20",items:[this.layerSelection,this.appendedItems].compact()})}b.items=[this.label,a,c,this.optionsContainer].compact();this.activeFilters=[];Signavio.Extensions.WizardTreePage.superclass.constructor.call(this,b)};Ext.extend(Signavio.Extensions.WizardTreePage,Ext.ux.view.WizardPage,{treeActivated:false,createFilterDialog:function(c){if(!this.filterWindow){this.filterWindow=new Ext.ux.Window({items:[new Signavio.Extensions.FilterPanel(c)],width:600,height:560,minHeight:300,minWidth:500,modal:true,closeAction:"hide",layout:"anchor",title:Signavio.I18N.FilterSet.windowTitle,buttons:[{text:Ext.MessageBox.buttonText.ok,handler:this.handleFilterSelection.bind(this)}]})}var b=this.filterWindow.items.get(0);var a=b.filterSet;this.filterWindow.show();a.activateFilters(this.activeFilters)},handleFilterSelection:function(){var d=this.filterWindow.items.get(0);var a=d.filterSet;var c=function(){var h=a.getJSON();var g=d.folderPicker.getJSON();this.activeFilters.clear();h.each(function(j){this.activeFilters.push({id:j.field,relation:j.relation,value:j.value instanceof Array?j.value.clone():j.value})}.bind(this));if(!g){this.alert(Signavio.I18N.FilterSet.chooseFolderEmptyText)}else{if(h.length>0){var f=Signavio.Config.BACKEND_PATH+"/docufilter";this.filterWindow.el.mask(Signavio.I18N.FilterSet.waitingMessage);Signavio.Core.Stores.RequestManager.doPost(f,[function(k){var l=(k.models||[]).map(function(m){return"/model/"+m});var j=this.getTree();j.collapseAll();j.uncheckAllExcept(l);this.filteredModels=k.models||[];d.cb(j,l,g,function(m){this.filterWindow.el.unmask();this.updateActiveFilters(h);if(m){this.filterWindow.hide()}}.bind(this))}.bind(this),function(j){this.filterWindow.el.unmask();this.alert(Signavio.I18N.FilterSet.requestError)}.bind(this)],{filters:h,folder:g})}else{this.updateActiveFilters([]);this.filterWindow.hide()}}}.bind(this);if(!a.isValid()){var e=a.getLastError()+"<br />"+Signavio.I18N.FilterSet.invalidFilterWarning;var b=Ext.Msg.confirm(Signavio.I18N.FilterSet.windowTitle,e,function(f){if(f==="yes"){c()}})}else{c()}},updateActiveFilters:function(a){var b=this.el.select(".y-wizard-filter-active-count").elements[0];if(a.length){b.innerHTML="("+a.length+" "+Signavio.I18N.FilterSet.filtersActive+")"}else{b.innerHTML=""}},alert:function(b){var a=Ext.Msg.alert(Signavio.I18N.FilterSet.windowTitle,b);a.setIcon(Ext.MessageBox.WARNING)},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a,b){return b&&a.get("href")==b.get("href")},isInternalFolder:function(a){return a.get("rep").type=="internal"},createTree:function(d){var c=[];var f=d.selection;var e=d.trashRecord;var g=d.hideModels;(f||[]).each(function(j){if(j.get instanceof Function&&this.isTrashFolder(j,e)){return}c.push(j)}.bind(this));var b=[Signavio.Const.REL.DIRECTORY];if(!g){b.push(Signavio.Const.REL.MODEL)}var h=new Signavio.Extensions.ModelDirectoryCheckTreePanel({cls:"x-tableview-plugin x-div-textbackground y-wizard-tree",anchor:"-20",style:null,listeners:d.treeListeners,root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:b,filterFn:function(j){if(this.isModel(j)){return true}if(this.isDirectory(j)){return !this.isTrashFolder(j,e)&&!this.isInternalFolder(j)}return false}.bind(this),isChildLeaf:function(j){return j.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(j){return j.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(j,true):"folder"}})},c);if(this.loaderFn){var a=h.getLoader();a.on("load",this.loaderFn);a.on("update",this.loaderFn)}return h},getExportLayerSelection:function(){var a=new Ext.ux.form.ComboBox({valueField:"value",displayField:"title",mode:"local",anchor:"100%",boxLabel:Signavio.I18N.Repository.MapExport.linkedSubprocessesDesc,editable:false,store:new Ext.data.SimpleStore({data:[[Signavio.I18N.Repository.MapExport.linkedSubprocessesNone,0],[Signavio.I18N.Repository.MapExport.linkedSubprocessesAll,1],[Signavio.I18N.Repository.MapExport.linkedSubprocessesSome,2]],fields:[{name:"title"},{name:"value"}]})});var b={title:Signavio.I18N.Repository.MapExport.linkedSubprocessesTitle,desc:Signavio.I18N.Repository.MapExport.linkedSubprocessesDesc,cls:(Ext.isIE7?"y-wizard-options-container-ie7":undefined),items:a,anchor:"100%",layout:"anchor"};return new Ext.ux.view.OptionsContainer(b)}})})();(function(){Signavio.Extensions.WizardOptionsPage=function(a){a=a||{};if(a.labelText){this.label=new Ext.form.Label({cls:"y-wizard-description-label",text:a.labelText})}var b=null;if(a.store){b=this.createFormatSelector(a.store);this.formatSelector=new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.MapExport.exportFormat,cls:"y-wizard-map-view-container",items:[b]})}this.getFormatSelector=function(){return b};if(typeof a.items==="object"&&a.items.length>0){var e={title:Signavio.I18N.Repository.MapExport.furtherOptionsTitle,desc:Signavio.I18N.Repository.MapExport.furtherOptionsDesc,cls:(Ext.isIE7?"y-wizard-options-container-ie7":undefined),items:a.items};this.appendedItems=new Ext.ux.view.OptionsContainer(e)}var c=null,d=null;if(a.languages&&a.languages.length>1){d=Signavio.Utils.getLangaugeSelector(a.languages,{value:a.languages.first().rel,anchor:"100%",suppressGroups:true});c=new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.ProcessDocu.languageFieldLabel,items:d,layout:"anchor"})}this.getLanguageSelector=function(){return d};if(a.user){this.exportOptions=this.getExportOptions(a.user,a.configMode)}if(typeof a.selection==="object"&&a.selection.length===1&&a.selection[0].get("rel")=="mod"&&typeof a.views==="object"&&a.views.length>0){this.modelId=a.selection[0].get("href");this.viewsContainer=this.getViewsContainer(a.views)}this.optionsContainer=new Ext.Panel({cls:"y-wizard-options",getExportOptions:function(){return this.exportOptions}.bind(this),getViewOptions:function(){return this.viewsContainer}.bind(this),getExtraOptions:function(){return this.appendedItems}.bind(this),items:[this.exportOptions,this.appendedItems,this.viewsContainer].compact()});this.getOptions=function(){return this.optionsContainer};a.items=[this.label,this.formatSelector,c,this.optionsContainer].compact();Signavio.Extensions.WizardTreePage.superclass.constructor.call(this,a)};Ext.extend(Signavio.Extensions.WizardOptionsPage,Ext.ux.view.WizardPage,{getViewsContainer:function(a){if(!a||a.length===0){return}var f=Ext.id();var e=this;var d=function(j,h,g){if(g){e.currentView=j}};var c=new Ext.form.Radio({xtype:"radio",hideLabel:true,boxLabel:Signavio.I18N.Repository.MapExport.selectViewOriginal,name:f,value:this.modelId,checked:true,listeners:{check:d.bind(this,this.modelId)}});var b=[c].concat(a.map(function(g){return{xtype:"radio",hideLabel:true,boxLabel:(g.rep.view&&g.rep.view.name)||g.rep.name,name:f,value:g.href,listeners:{check:d.bind(this,g.href)}}}));return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.MapExport.selectViewTitle,cls:(Ext.isIE7?"y-wizard-options-container-ie7":undefined),identifier:"Signavio.OptionsContainer.ViewSelector",desc:Signavio.I18N.Repository.MapExport.selectViewDesc,items:b,getCurrentView:function(){return e.currentView}})},createFormatSelector:function(a){return new Ext.DataView({tpl:'<tpl for="."><div class="thumb-wrap"><span class="thumb-title">{name}</span><span class="thumb-format">{format}</span><div class="thumb"><img src="{img}" title="{name}"></div></div></tpl><div class="x-clear"></div>',itemSelector:"div.thumb-wrap",overClass:"x-view-over",store:a,cls:"x-plugin-map-view y-wizard-map-view",singleSelect:true,anchor:"100% 100%",doSingleSelection:function(c,b,d){this.select(b,false)},afterRender:function(){Ext.DataView.prototype.afterRender.apply(this,arguments);this.select(0)},listeners:{containerclick:function(b,c){return false}}})},getExportOptions:function(e,d,f){var a=new Ext.form.Checkbox({hideLabel:true,name:"showSignavioBranding",checked:d!=="Enterprise",disabled:!Signavio.Config.SIGNAVIO_BRANDING_CONFIGURABEL,boxLabel:Signavio.I18N.Repository.ProcessDocu.branding+" "+(!Signavio.Config.SIGNAVIO_BRANDING_CONFIGURABEL?' <img ext:qtip="'+Signavio.I18N.Repository.ProcessDocu.premiumOnly+'" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" style="margin-left: 2px; margin-top: -3px; position: relative; top: 4px;"/>':"")});var c=new Ext.form.Checkbox({xtype:"checkbox",hideLabel:true,checked:false,boxLabel:Signavio.I18N.Repository.ProcessDocu.blackWhite});var b=null;if(d==="Academic"){b=new Ext.form.Checkbox({xtype:"checkbox",hideLabel:true,checked:false,boxLabel:Signavio.I18N.Repository.ProcessDocu.sketchy})}return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.ProcessDocu.exportOptionsTitle,cls:(Ext.isIE7?"y-wizard-options-container-ie7":undefined),desc:Signavio.I18N.Repository.ProcessDocu.exportOptionsDesc,layout:"form",showSignavioBranding:function(){return a.getValue()},isBlackAndWhite:function(){return c.getValue()},isSketchy:function(){if(b){return b.getValue()}return false},items:[a,c,b].compact()})}})})();(function(){Signavio.Extensions.FolderPicker=function(b){b=b||{};var a=new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:this.gatherFolderInfo(b.folderStore,b.rootFolder)});b.store=a;delete b.rootFolder;b.valueField="value";b.displayField="title";b.mode="local";b.selectOnFocus=true;b.editable=true;b.readonly=true;b.emptyText=Signavio.I18N.FilterSet.chooseFolderEmptyText;b.cls="y-wizard-filter";b.anchor="100%";b.tpl='<tpl for=".">';b.tpl+='<div class="x-combo-list-item">';b.tpl+='{[ values.value === "custom" ? "<a href=\'\' onclick=\'return false;\'>" : ""]}';b.tpl+="{[ values.title.escapeHTML() ]}";b.tpl+='{[ values.value === "custom" ? "</a>" : ""]}';b.tpl+="</div>";b.tpl+="</tpl>";if(b.value){this.oldValue=b.value}Signavio.Extensions.FolderPicker.superclass.constructor.call(this,b);this.on("select",this.handleSelect.bind(this,{trashRecord:b.trashRecord,folderStore:b.folderStore}))};Ext.extend(Signavio.Extensions.FolderPicker,Ext.ux.form.ComboBox,{oldValue:undefined,currentFolder:undefined,rootFolder:undefined,breadcrumb:[],createData:function(b,a){var c=[];if(b.type){if(this.rootFolder.id!==a){c=[[Signavio.I18N.Repository.Folder[b.type]||b.name,a]]}if(!this.currentFolder.isRoot){c=c.concat([[this.currentFolder.name,this.currentFolder.id]])}}else{if(a!==this.currentFolder.id&&!this.currentFolder.isRoot){c=[[b.name,a],[this.currentFolder.name,this.currentFolder.id],]}else{c=[[b.name,a]]}}return[[this.rootFolder.name,this.rootFolder.id]].concat(c,[[Signavio.I18N.FilterSet.chooseFolder,"custom"]])},gatherFolderInfo:function(f,a){var c=f.getRecords("info");var d=c.invoke("get","rep")[0];var b=c.invoke("get","href")[0];if(b.endsWith("/info")){b=b.replace("/info","")}if(d.type){this.currentFolder={name:Signavio.I18N.Repository.Folder[d.type],id:b,isRoot:true}}else{this.currentFolder={name:d.name,id:b,isRoot:false}}var e=a.get("rep");var g=Signavio.I18N.Repository.Folder[e.type];this.rootFolder={name:g,id:a.get("href")};return this.createData(d,b)},handleSelect:function(d,c,e,f){var a=this.oldValue;this.oldValue=c.getValue();if(e.get("value")==="custom"){var b=this.getFolderTree(d.trashRecord,d.folderStore);var j=new Ext.form.Label({cls:"y-wizard-description-label",text:Signavio.I18N.FilterSet.folderPickerDescription});var h=true;var g=new Ext.ux.Window({title:Signavio.I18N.FilterSet.folderPickerHead,width:500,modal:true,cancelButton:{text:Ext.MessageBox.buttonText.cancel,handler:function(){this.setValue(a||"");g.close()}.bind(this)},buttons:[{text:Ext.MessageBox.buttonText.ok,handler:function(){h=false;var k=b.getSelectedRecord();if(k){this.updateSelectedFolder(k);g.close()}}.bind(this)}],items:[j,b]});g.on("close",function(){if(h){this.setValue(a||"");this.oldValue=a}}.bind(this));g.show()}},updateSelectedFolder:function(a){this.oldValue=a.get("href");var b=this.createData(a.get("rep"),a.get("href"));this.store.loadData(b);this.setValue(a.get("href"))},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a,b){return b&&a.get("href")==b.get("href")},isInternalFolder:function(a){return a.get("rep").type=="internal"},getFolderTree:function(a,b){return new Signavio.Extensions.ModelDirectoryCheckTreePanel({cls:"x-tableview-plugin x-div-textbackground y-wizard-tree",anchor:null,style:null,height:200,bodyStyle:null,root:new Ext.tree.TreeNode({text:"",draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY],filterFn:function(c){if(this.isModel(c)){return true}else{if(this.isDirectory(c)){return !this.isTrashFolder(c,a)&&!this.isInternalFolder(c)}else{return false}}}.bind(this),isChildLeaf:function(c){return c.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(c){return c.get("rel")===Signavio.Const.REL.MODEL?"model mode-"+Signavio.Utils.getIcon(c,true):"folder"}})},[b])},getJSON:function(){return this.getValue()}});Signavio.Extensions.FilterPanel=function(a){a=a||{};if(a.labelText){this.label=new Ext.form.Label({cls:"y-wizard-description-label",text:a.labelText})}this.cb=a.cb;this.filterSet=a.filter;this.folderPicker=new Signavio.Extensions.FolderPicker({folderStore:a.folderStore,rootFolder:a.rootFolder,trashRecord:a.trashRecord,value:a.rootFolder.get("href").replace("/info","")});a.layout="anchor";a.anchor="100% 100%";a.items=[this.label,this.folderPicker,this.filterSet].concat(a.items||[]).compact();Signavio.Extensions.FilterPanel.superclass.constructor.call(this,a)};Ext.extend(Signavio.Extensions.FilterPanel,Ext.Panel,{getJSON:function(){return $H(this.folderPicker.getJSON()).merge(this.filterSet.getJSON()).toObject()}})})();if(!Signavio){var Signavio={}}if(!Signavio.Log){Signavio.Log={}}if(!Signavio.Log.Level){Signavio.Log.Level={}}new function(){var a=[];Signavio.Log.register=function(b){if(b instanceof Function&&!a.include(b)){a.push(b)}};Signavio.Log.doLog=function(d,b){d=d===undefined?Signavio.Log.Level.WARNING:d;if(d>=Signavio.Config.LOGLEVELSHOWN){a.each(function(e){e.call(e,d,b)})}if(d<Signavio.Config.LOGLEVEL){return}b=b instanceof Object?b.message:b;try{if(window.console&&typeof window.console.log==="function"){console.log(Signavio.I18N.Repository.Log.LOG+": "+d+" - "+b)}}catch(c){}if(d>=Signavio.Log.Level.ERROR){switch(d){case Signavio.Log.Level.ERROR:throw Signavio.I18N.Repository.Log.ERROR+": "+d+" - "+b;break;case Signavio.Log.Level.CRITICAL:throw Signavio.I18N.Repository.Log.CRITICAL+": "+d+" - "+b;break;case Signavio.Log.Level.FATAL:throw Signavio.I18N.Repository.Log.FATAL+": "+d+" - "+b;break;default:throw Signavio.I18N.Repository.Log.LOG+": "+d+" - "+b}}};Signavio.Log.doFatal=function(b){Signavio.Log.doLog(Signavio.Log.Level.FATAL,b)};Signavio.Log.doCritical=function(b){Signavio.Log.doLog(Signavio.Log.Level.CRITICAL,b)};Signavio.Log.doError=function(b){Signavio.Log.doLog(Signavio.Log.Level.ERROR,b)};Signavio.Log.doWarning=function(b){Signavio.Log.doLog(Signavio.Log.Level.WARNING,b)};Signavio.Log.doNotice=function(b){Signavio.Log.doLog(Signavio.Log.Level.NOTICE,b)};Signavio.Log.doInfo=function(b){Signavio.Log.doLog(Signavio.Log.Level.INFO,b)};Signavio.Log.doDebug=function(b){Signavio.Log.doLog(Signavio.Log.Level.DEBUG,b)};Signavio.Log.Level.FATAL=6;Signavio.Log.Level.CRITICAL=5;Signavio.Log.Level.ERROR=4;Signavio.Log.Level.WARNING=3;Signavio.Log.Level.NOTICE=2;Signavio.Log.Level.INFO=1;Signavio.Log.Level.DEBUG=0}();var log=Signavio.Log.doLog;var error=Signavio.Log.doError;var warn=Signavio.Log.doWarning;var notice=Signavio.Log.doNotice;var info=Signavio.Log.doNotice;var Clazz=function(){};Clazz.prototype.construct=function(){};Clazz.extend=function(e){var a=function(){if(arguments[0]!==Clazz){this.construct.apply(this,arguments)}};var d=new this(Clazz);var b=this.prototype;for(var f in e){var c=e[f];if(c instanceof Function){c.$=b}d[f]=c}a.prototype=d;a.extend=this.extend;return a};if(!Signavio){var Signavio={}}if(!Signavio.Helper){Signavio.Helper={}}(function(){Signavio.Helper.isIE6=function(){return Ext.isIE6};Signavio.Helper.isIE7=function(){return Ext.isIE7};Signavio.Helper.isIE8=function(){return Ext.isIE8};Signavio.Helper.isIPad=function(){return !!String(window.navigator.userAgent).match(/(ipad|iphone)/i)};Signavio.Helper.getBrowserVersion=function(){return Ext.getBrowserVersion().toFixed(1)};Signavio.Helper.SimulateEvent=function(j,h){h=h||"click";if(document.createEvent){var g=document.createEvent("MouseEvents");g.initMouseEvent(h,true,true,window,0,0,0,0,0,false,false,false,false,0,null);return j.dispatchEvent(g)}else{if(document.createEventObject){var g=document.createEventObject();g.detail=0;g.screenX=0;g.screenY=0;g.clientX=0;g.clientY=0;g.ctrlKey=false;g.altKey=false;g.shiftKey=false;g.metaKey=false;g.button=0;g.relatedTarget=null;return j.fireEvent("on"+h,g)}}};Signavio.Helper.OpenWindow=function(j,h){var g=Ext.get(document.createElement("a"));g.on("click",function(){var k=window.open(j);if(h instanceof Function){h(k)}g.remove()});Ext.getBody().appendChild(g);Signavio.Helper.SimulateEvent(g.dom)};Signavio.Helper.CutOpenID=function(m,l){var k=["blogspot.com","verisignlabs.com"];var g=new Ext.Template('<span title="{openid}">{cuttedopenid}</span>');l=l||30;var j=m.length>=l;if(j){var h=k.some(function(p){return m.toLowerCase().include(p)});var n=h?m.slice(0,l)+"...":"..."+m.slice(m.length-l)}return j?g.apply({openid:m,cuttedopenid:n}):m};var e=["i","I","j","l"];var d=["a","b","d","e","f","J","k","n","o","r","s","t","u","v","y","z"];var c=["%","W@","mwMOQ#+=<>~^","DGCHNRU&A","BKSVXZbdghnopquxETY1234567890_$*`vyPaeF","{}kL?cszJ",'"-rt/()[]:;|\\!fI.,',"j ","'il"];var b=[11,10,8,7,6,5,4,3,2];var f=11;var a=function(h){var g=c.find(function(j){return j.include(h)});return Math.ceil((g?b[c.indexOf(g)]:9)*(f/11))};Signavio.Helper.TruncateByWidth=function(l,j,k){l=l||"";if(typeof j!="number"){return l}var h=0;var g=0;while(h<j&&g<l.length){h+=a(l.charAt(g++))}while((h+14)>j&&g>0){h-=a(l.charAt(g--))}return g==l.length?l:l.slice(0,g-1)+(k!==undefined?k:"&hellip;")};if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}})}Signavio.Helper.TruncateByWidthAndEscape=function(l,j,k){l=l||"";if(typeof j!="number"){return l}var h=0;var g=0;while(h<j&&g<l.length){h+=a(l.charAt(g++))}while((h+14)>j&&g>0){h-=a(l.charAt(g--))}return g==l.length?l.escapeHTML():l.slice(0,g-1).escapeHTML()+(k!==undefined?k:"&hellip;")};Signavio.Helper.SplitIntoTwoLines=function(l,j){if(!l){return""}var h=l.unescapeHTML();var k=Signavio.Helper.TruncateByWidth(h,(j/2)+16,"");if(k===h){return l}var g=h.slice(k.length);g=Signavio.Helper.TruncateByWidthAndEscape(g,j/2,"<small>&hellip;</small>");return k.escapeHTML()+"<br/>"+g};Signavio.Helper.ParseDate=function(g){var h=g;if(typeof g=="string"){g=g.replace(/^([^-]+)(-)([^- ]+)(-)(.*)?/i,"$1/$3/$5");g=g.replace(/\.[0-9]+/g,"");g=new Date(g);if(!(g instanceof Date)||isNaN(g.valueOf())){g=Date.parseDate(h,"D M j G:i:s T Y")}}return g};Signavio.Helper.BeautifyDate=function(h,l){if(h===undefined){return""}h=Signavio.Helper.ParseDate(h);if(!h){error("Date could not been parsed: "+arguments[0]);return""}var g=new Date();var k=new Date(h.getElapsed(g));var m={};m.year=k.getUTCFullYear()-1970;m.month=k.getUTCMonth();m.days=k.getUTCDate()-1;m.hours=k.getUTCHours();m.minutes=k.getUTCMinutes();m.seconds=k.getUTCSeconds();var j="";if(m.year){j+=m.year+" "+(m.year>1?Signavio.I18N.Repository.Date.years:Signavio.I18N.Repository.Date.year)}else{if(m.month){j+=m.month+" "+(m.month>1?Signavio.I18N.Repository.Date.months:Signavio.I18N.Repository.Date.month)}else{if(m.days){j+=m.days+" "+(m.days>1?Signavio.I18N.Repository.Date.days:Signavio.I18N.Repository.Date.day)}else{if(m.hours){j+=m.hours+" "+(m.hours>1?Signavio.I18N.Repository.Date.hours:Signavio.I18N.Repository.Date.hour)}else{if(m.minutes){j+=m.minutes+" "+(m.minutes>1?Signavio.I18N.Repository.Date.minutes:Signavio.I18N.Repository.Date.minute)}else{j+=Signavio.I18N.Repository.Date.rest}}}}}return l===true?j:"<span class='x-beautified-date' title='"+h.format(Signavio.Const.DATE_FORMAT)+"'>"+j+"</span>"};Signavio.Helper.LoadRelatedInfo=function(h,g){};Signavio.Helper.GetAllCountries=function(){return[{id:"AF",name:"Afghanistan"},{id:"AL",name:"Albania"},{id:"DZ",name:"Algeria"},{id:"AS",name:"American Samoa"},{id:"AD",name:"Andorra"},{id:"AI",name:"Anguilla"},{id:"AQ",name:"Antarctica"},{id:"AG",name:"Antigua And Barbuda"},{id:"AR",name:"Argentina"},{id:"AM",name:"Armenia"},{id:"AW",name:"Aruba"},{id:"AU",name:"Australia"},{id:"AT",name:"Austria"},{id:"AZ",name:"Ayerbaijan"},{id:"BS",name:"Bahamas, The"},{id:"BH",name:"Bahrain"},{id:"BD",name:"Bangladesh"},{id:"BB",name:"Barbados"},{id:"BY",name:"Belarus"},{id:"BZ",name:"Belize"},{id:"BE",name:"Belgium"},{id:"BJ",name:"Benin"},{id:"BM",name:"Bermuda"},{id:"BT",name:"Bhutan"},{id:"BO",name:"Bolivia"},{id:"BV",name:"Bouvet Is"},{id:"BA",name:"Bosnia and Herzegovina"},{id:"BW",name:"Botswana"},{id:"BR",name:"Brazil"},{id:"IO",name:"British Indian Ocean Territory"},{id:"BN",name:"Brunei"},{id:"BG",name:"Bulgaria"},{id:"BF",name:"Burkina Faso"},{id:"BI",name:"Burundi"},{id:"KH",name:"Cambodia"},{id:"CM",name:"Cameroon"},{id:"CA",name:"Canada"},{id:"CV",name:"Cape Verde"},{id:"KY",name:"Cayman Is"},{id:"CF",name:"Central African Republic"},{id:"TD",name:"Chad"},{id:"CL",name:"Chile"},{id:"CN",name:"China"},{id:"HK",name:"Hong Kong"},{id:"MO",name:"Macau S.A.R."},{id:"CX",name:"Christmas Is"},{id:"CC",name:"Cocos (Keeling) Is"},{id:"CO",name:"Colombia"},{id:"KM",name:"Comoros"},{id:"CK",name:"Cook Islands"},{id:"CR",name:"Costa Rica"},{id:"CI",name:"Cote D'Ivoire (Ivory Coast)"},{id:"HR",name:"Croatia (Hrvatska)"},{id:"CY",name:"Cyprus"},{id:"CZ",name:"Czech Republic"},{id:"CD",name:"Democratic Republic of the Congo"},{id:"DK",name:"Denmark"},{id:"DE",name:"Deutschland"},{id:"DM",name:"Dominica"},{id:"DO",name:"Dominican Republic"},{id:"DJ",name:"Djibouti"},{id:"TP",name:"East Timor"},{id:"EC",name:"Ecuador"},{id:"EG",name:"Egypt"},{id:"SV",name:"El Salvador"},{id:"GQ",name:"Equatorial Guinea"},{id:"ER",name:"Eritrea"},{id:"EE",name:"Estonia"},{id:"ET",name:"Ethiopia"},{id:"FK",name:"Falkland Is (Is Malvinas)"},{id:"FO",name:"Faroe Islands"},{id:"FJ",name:"Fiji Islands"},{id:"FI",name:"Finland"},{id:"FR",name:"France"},{id:"GF",name:"French Guiana"},{id:"PF",name:"French Polynesia"},{id:"TF",name:"French Southern Territories"},{id:"MK",name:"F.Y.R.O. Macedonia"},{id:"GA",name:"Gabon"},{id:"GM",name:"Gambia, The"},{id:"GE",name:"Georgia"},{id:"GH",name:"Ghana"},{id:"GI",name:"Gibraltar"},{id:"GR",name:"Greece"},{id:"GL",name:"Greenland"},{id:"GD",name:"Grenada"},{id:"GP",name:"Guadeloupe"},{id:"GU",name:"Guam"},{id:"GT",name:"Guatemala"},{id:"GN",name:"Guinea"},{id:"GW",name:"Guinea-Bissau"},{id:"GY",name:"Guyana"},{id:"HT",name:"Haiti"},{id:"HM",name:"Heard and McDonald Is"},{id:"HN",name:"Honduras"},{id:"HU",name:"Hungary"},{id:"IS",name:"Iceland"},{id:"IN",name:"India"},{id:"ID",name:"Indonesia"},{id:"IE",name:"Ireland"},{id:"IL",name:"Israel"},{id:"IT",name:"Italy"},{id:"JM",name:"Jamaica"},{id:"JP",name:"Japan"},{id:"JO",name:"Jordan"},{id:"KZ",name:"Kayakhstan"},{id:"KE",name:"Kenya"},{id:"KI",name:"Kiribati"},{id:"KR",name:"Korea, South"},{id:"KW",name:"Kuwait"},{id:"KG",name:"Kyrgyzstan"},{id:"LA",name:"Laos"},{id:"LV",name:"Latvia"},{id:"LB",name:"Lebanon"},{id:"LS",name:"Lesotho"},{id:"LR",name:"Liberia"},{id:"LI",name:"Liechtenstein"},{id:"LT",name:"Lithuania"},{id:"LU",name:"Luxembourg"},{id:"MG",name:"Madagascar"},{id:"MW",name:"Malawi"},{id:"MY",name:"Malaysia"},{id:"MV",name:"Maldives"},{id:"ML",name:"Mali"},{id:"MT",name:"Malta"},{id:"MH",name:"Marshall Is"},{id:"MR",name:"Mauritania"},{id:"MU",name:"Mauritius"},{id:"MQ",name:"Martinique"},{id:"YT",name:"Mayotte"},{id:"MX",name:"Mexico"},{id:"FM",name:"Micronesia"},{id:"MD",name:"Moldova"},{id:"MC",name:"Monaco"},{id:"MN",name:"Mongolia"},{id:"MS",name:"Montserrat"},{id:"MA",name:"Morocco"},{id:"MZ",name:"Mozambique"},{id:"MM",name:"Myanmar"},{id:"NA",name:"Namibia"},{id:"NR",name:"Nauru"},{id:"NP",name:"Nepal"},{id:"NL",name:"Netherlands, The"},{id:"AN",name:"Netherlands Antilles"},{id:"NC",name:"New Caledonia"},{id:"NZ",name:"New Zealand"},{id:"NI",name:"Nicaragua"},{id:"NE",name:"Niger"},{id:"NG",name:"Nigeria"},{id:"NU",name:"Niue"},{id:"NO",name:"Norway"},{id:"NF",name:"Norfolk Island"},{id:"MP",name:"Northern Mariana Is"},{id:"OM",name:"Oman"},{id:"PK",name:"Pakistan"},{id:"PW",name:"Palau"},{id:"PA",name:"Panama"},{id:"PG",name:"Papua new Guinea"},{id:"PY",name:"Paraguay"},{id:"PE",name:"Peru"},{id:"PH",name:"Philippines"},{id:"PN",name:"Pitcairn Island"},{id:"PL",name:"Poland"},{id:"PT",name:"Portugal"},{id:"PR",name:"Puerto Rico"},{id:"QA",name:"Qatar"},{id:"CG",name:"Republic of the Congo"},{id:"RE",name:"Reunion"},{id:"RO",name:"Romania"},{id:"RU",name:"Russia"},{id:"SH",name:"Saint Helena"},{id:"KN",name:"Saint Kitts And Nevis"},{id:"LC",name:"Saint Lucia"},{id:"PM",name:"Saint Pierre and Miquelon"},{id:"VC",name:"Saint Vincent And The Grenadines"},{id:"WS",name:"Samoa"},{id:"WM",name:"San Marino"},{id:"ST",name:"Sao Tome and Principe"},{id:"SA",name:"Saudi Arabia"},{id:"SN",name:"Senegal"},{id:"SC",name:"Seychelles"},{id:"SL",name:"Sierra Leone"},{id:"SG",name:"Singapore"},{id:"SK",name:"Slovakia"},{id:"SI",name:"Slovenia"},{id:"SB",name:"Solomon Islands"},{id:"SO",name:"Somalia"},{id:"ZA",name:"South Africa"},{id:"GS",name:"South Georgia & The S. Sandwich Is"},{id:"ES",name:"Spain"},{id:"LK",name:"Sri Lanka"},{id:"SR",name:"Suriname"},{id:"SJ",name:"Svalbard And Jan Mayen Is"},{id:"SZ",name:"Swaziland"},{id:"SE",name:"Sweden"},{id:"CH",name:"Switzerland"},{id:"SY",name:"Syria"},{id:"TW",name:"Taiwan"},{id:"TJ",name:"Tajikistan"},{id:"TZ",name:"Tanzania"},{id:"TH",name:"Thailand"},{id:"TL",name:"Timor-Leste"},{id:"TG",name:"Togo"},{id:"TK",name:"Tokelau"},{id:"TO",name:"Tonga"},{id:"TT",name:"Trinidad And Tobago"},{id:"TN",name:"Tunisia"},{id:"TR",name:"Turkey"},{id:"TC",name:"Turks And Caicos Is"},{id:"TM",name:"Turkmenistan"},{id:"TV",name:"Tuvalu"},{id:"UG",name:"Uganda"},{id:"UA",name:"Ukraine"},{id:"AE",name:"United Arab Emirates"},{id:"GB",name:"United Kingdom"},{id:"US",name:"United States"},{id:"UM",name:"United States Minor Outlying Is"},{id:"UY",name:"Uruguay"},{id:"UZ",name:"Uzbekistan"},{id:"VU",name:"Vanuatu"},{id:"VA",name:"Vatican City State (Holy See)"},{id:"VE",name:"Venezuela"},{id:"VN",name:"Vietnam"},{id:"VG",name:"Virgin Islands (British)"},{id:"VI",name:"Virgin Islands (US)"},{id:"WF",name:"Wallis And Futuna Islands"},{id:"EH",name:"Western Sahara"},{id:"YE",name:"Yemen"},{id:"ZM",name:"Zambia"},{id:"ZW",name:"Zimbabwe"}].sort(function(h,g){return h.name>g.name?1:-1})};Signavio.Helper.HashUtils={callbacks:[],interval:100,useIFrame:Ext.isIE&&(Signavio.Helper.isIE6()||Signavio.Helper.isIE7()),startedIFrame:0,getIFrameDoc:function(){if(!this.iframe){var g;this.iframe=g=document.createElement("iframe");g.style.display="none";Ext.getBody().dom.appendChild(g)}return this.iframe.contentWindow.document},getHash:function(){var g=window.location.href.indexOf("#");return(g==-1?"":"#"+window.location.href.substr(g+1))},set:function(l,h){if(this.useIFrame){try{var k=this.getIFrameDoc();k.open();k.write("<html><body>"+l+"</body></html>");k.close()}catch(j){window.setTimeout(this.set.bind(this,l,h),10)}}else{if(h===true){var g=window.location.toString().replace(/#.*/,"");window.location.replace(g+"#"+l)}else{window.location.hash=(!l.startsWith("#")?"#":"")+l}}},get:function(){if(this.useIFrame){try{return this.getIFrameDoc().body.innerText}catch(g){return this.getHash()}}else{return window.location.hash}},onChange:function(g){this.callbacks.push(g);if(this.useIFrame){this.startWithIFrame(this.interval)}else{this.start(this.interval)}},startWithIFrame:function(g){try{this.getIFrameDoc()}catch(j){this.startedIFrame++;if(this.startedIFrame>10){return}window.setTimeout(this.startWithIFrame.bind(this,g),100);return}if(this.pe){return false}var h=this.getHash();this.set(h);this.pe=new PeriodicalExecuter(function(){try{var k=this.getIFrameDoc().body.innerText;if(k!==h){window.location.hash=h=k;this.callbacks.each(function(n){n(k)}.bind(this))}else{var m=this.getHash();if(h!==m){this.set(m);h=m}}}catch(l){}}.bind(this),(g||this.interval)/1000)},start:function(g){if(this.pe){return false}var h=this.get();this.pe=new PeriodicalExecuter(function(){if(h!=this.get()){h=window.location.hash;this.callbacks.each(function(j){j(this.getParams())}.bind(this))}}.bind(this),(g||this.interval)/1000)},stop:function(){if(this.pe){this.pe.stop();delete this.pe}},getParams:function(){return(window.location.hash+"").slice(1)},toString:function(){return this.getParams()}};Signavio.Helper.addAuthenticationQueryParamsToURL=function(h){var g=location.search.toQueryParams();if(g.authkey){var j="?";if(h.indexOf("?")>-1){j="&"}h+=j+"authkey="+g.authkey;j="&";h+=j+"purl_skey="+Signavio.Helper.getCookie("purl_skey_"+g.authkey)}return h};Signavio.Helper.getCookie=function(h){var n=document.cookie.split(";");var j="";var l="";var m="";var k=false;for(var g=0;g<n.length;g++){j=n[g].split("=");l=j[0].replace(/^\s+|\s+$/g,"");if(l==h){k=true;if(j.length>1){m=unescape(j[1].replace(/^\s+|\s+$/g,""))}return m;break}j=null;l=""}if(!k){return null}};Signavio.Helper.isGlossaryEntry=function(g){return g&&!!g.match(/\glossary\:\/\/.+\/[\w\W]+\;\;/g)};Signavio.Helper.getGlossaryText=function(g){return(g||"").split(";;").invoke("replace",/\glossary\:\/\/[^\/]+\//g,"").first()};Signavio.Helper.getGlossaryId=function(g){return(g||"").split(";;").invoke("replace",/\glossary\:\/\//g,"").invoke("replace",/\/[\w\W]+/g,"").first()};Signavio.Helper.isQuickModelUser=function(g){return(g||[]).any(function(h){return h===Signavio.Config.QUICKMODEL_LICENSE})};Signavio.Helper.isApiAccessUser=function(g){return(g||[]).any(function(h){return h===Signavio.Config.API_ACCESS_LICENSE})};Signavio.Helper.hasAnyValidLicense=function(g){return Signavio.Config.ALL_LICENSES.any(function(h){return(g||[]).include(h)})};Signavio.Helper.openIFramePanel=function(j,m,h){if(!h){h=""}if(Ext.isIPad){window.open(j);return}var k="<iframe src='"+j+"' class='x-help-iframe'></iframe>";k+='<br/><a class="x-help-a" target="_blank" href="'+j+'">'+Signavio.I18N.Repository.Offer.openUGNewWindow+"</a>";var g=new Ext.Panel({height:"100%",width:"100%",html:k});var l=new Ext.Window({cls:"x-help "+h,modal:true,title:m,items:[g],resizable:false,header:true,shadow:false,draggable:false});l.show();l.center()}}());if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){Signavio.Core.Plugin={neededStores:[],enabled:false,construct:function(a){arguments.callee.$.construct.apply(this,arguments);this.facade=a;this._selection=[];this.facade.registerOnEvent("selectionchange",function(b,c){this._selection=(c||[]).uniq()}.bind(this));this.facade.registerOnEvent("finialize",this.finialize.bind(this));this.isInitializing=true;this.facade.registerOnEvent("finialize",function(){this.isInitializing=false}.bind(this))},getSelection:function(){return this._selection||[]},finialize:function(){},confirm:function(a,b){Ext.Msg.confirm("Signavio",a,function(c,d){if(c=="yes"){b()}}.bind(this))},selectionNotInTrash:function(){return !this.selectionInTrash()},selectionInTrash:function(){return this.facade.getCurrentRootFolder()!==undefined&&this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()},selectionInInternal:function(){return this.facade.getCurrentRootFolder()!==undefined&&this.facade.getCurrentRootFolder().get("rep").type==="internal"},selectionInSearch:function(){try{return Signavio.Core.StoreManager.getChildEntitiesStore().getIdentifier()===Signavio.Config.SEARCH_PATH}catch(a){return false}},selectionIsJbpm4:function(){return this.selectionIs("http://b3mn.org/stencilset/jbpm4#")},selectionIsFelten:function(){return this.selectionIs("http://b3mn.org/stencilset/felten#")},selectionIsTim:function(){return this.selectionIs("http://b3mn.org/stencilset/timjpdl3#")||"http://b3mn.org/stencilset/bpmn2.0#"},selectionIsEpc:function(){return this.selectionIs("http://b3mn.org/stencilset/epc#")},selectionIsYAWL:function(){return this.selectionIs("http://b3mn.org/stencilset/yawl2.2#")},selectionIsBpmn11:function(){return this.selectionIs("http://b3mn.org/stencilset/bpmn1.1#")},selectionIsBpmn20:function(){return this.selectionIs("http://b3mn.org/stencilset/bpmn2.0#")},selectionIs:function(a){return this.getSelection().all(function(b){return b.get("rep").namespace==a})},selectionIsEpcOrBpmn20:function(){return this.selectionIsIn(["http://b3mn.org/stencilset/epc#","http://b3mn.org/stencilset/bpmn2.0#"])},selectionIsIn:function(a){return this.getSelection().all(function(b){return a.any(function(c){return b.get("rep").namespace==c})})},oneSelected:function(){return this.getSelection().length===1&&this.getSelection()[0].get("rel")=="mod"},manySelected:function(){return this.getSelection().length>=1&&this.getSelection().all(function(a){return["mod","file"].include(a.get("rel"))})},onlyModelsOrFoldersAreSelected:function(){return this.getSelection().length>=1&&this.getSelection().all(function(a){return["mod","dir"].include(a.get("rel"))})},onlyModelsAreSelected:function(){return this.getSelection().length>=1&&this.getSelection().all(function(a){return["mod"].include(a.get("rel"))})},noneSelected:function(){return this.getSelection().length<=0},oneDirectorySelected:function(){return this.getSelection().length===1&&this.getSelection()[0].get("rel")==="dir"},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a){return a.get("rep").type===Signavio.Config.FOLDER_TYPE.TRASH}};Signavio.Core.Plugin=Clazz.extend(Signavio.Core.Plugin)}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){Signavio.Core.ComponentPlugin={panel:null,parent:null,renderToView:null,title:null,construct:function(a){arguments.callee.$.construct.apply(this,arguments);this.parent=this.facade.getExtView(this.renderToView);this._doRender()},_doRender:function(){this.beforeRender();this.render();if(this.parent&&this.panel&&(this.panel instanceof Ext.Container||this.panel instanceof Ext.BoxComponent)){if(this.renderToView==="hover"){this.parent.items.push(this)}else{this.parent.add(this.panel);if(!(this.parent instanceof Ext.Toolbar)){this.parent.doLayout()}this.afterRender()}if(!this.enabled){this.panel.hide()}}},beforeRender:function(){},render:function(a){},afterRender:function(){},deleteChildItems:function(a){if(!a){a=this.panel}if(a&&a.items){a.items.each(function(b){a.remove(b)}.bind(this))}},iScrollConfig:{touchCount:1},refreshIScroll:function(c,b,d){if(c&&(Ext.isIPad||Ext.isTouch)&&"undefined"!=typeof iScroll){var a=this;(function(){var f;c=c.dom?c:Ext.get(c);if(b===true||c.dom.children.length==1){f=c.child("*")}else{f=c.createChild();$A(c.dom.childNodes).each(function(h){if(h!==f.dom){f.appendChild(h)}})}if(b===true||f.getHeight()>Math.max(0,c.getHeight()-c.getPadding("tb"))||f.getWidth()>Math.max(0,c.getWidth()-c.getPadding("lr"))){if(!a.iscroll){a.iscroll={}}var g=a.iscroll[c.id];if(g){if(b!==true&&g.element&&g.element.parentNode&&g.wrapper&&g.wrapper.parentNode){g.refresh();return}g.destroy()}var e=Ext.apply({},d||{},a.iScrollConfig);a.iscroll[c.id]=new iScroll(f.dom,e)}else{if(a.iscroll&&a.iscroll[c.id]){a.iscroll[c.id].destroy();delete a.iscroll[c.id]}}}())}}};Signavio.Core.ComponentPlugin=Signavio.Core.Plugin.extend(Signavio.Core.ComponentPlugin)}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){var b={};new function(){var c=[];var e=[];var d=[];var g=null;var f=false;b.register=function(j,h){if(!f){h.registerOnEvent("selectionchange",b.set.bind(b));f=true}if(!d.include(j)){d.push(j)}};b.callOnce=function(h){h=h};b.set=function(k,h,j){if(k&&k==="selectionchange"){e=c;c=h;d.each(function(l){if(l instanceof Function){l.apply(l,[c,e])}})}};b.get=function(){return c}}();var a={};new function(){var c=[];var d;a.registerOnChange=function(e,f){c.push({types:e,callback:f})};a.deleteStoreListeners=function(e){var f=e.map(function(g){return g&&g.get("href")}).compact();f.each(function(h){var g=Signavio.Core.StoreManager.getRelatedStore(null,h);g.purgeListeners()})};a.call=function(e){c.each(function(h){var g=h.types;var f=$H({});e.each(function(k){var j=[];k.value.each(function(l){if(g.include(l.get("rel"))){j.push(l)}});f.set(k.key,j.reduce())});h.callback.apply(h.callback,[f,e])})};a.set=function(e,f){a.deleteStoreListeners(f);window.clearTimeout(d);if(!e||e.size()<=0){d=window.setTimeout(a.call.bind(this,$H({}),[]),1);return}d=window.setTimeout(function(){var h=$H({});var g=e.compact().map(function(j){return j.get("href")});g.each(function(l){var k=function(m){h.set(l,m);a.call(h)}.bind(this);var j=Signavio.Core.StoreManager.getRelatedStore(l,l);j.on("load",k);j.on("update",k)}.bind(this))}.bind(this),10)}}();Signavio.Core.ContextPlugin={relTypes:[],construct:function(){arguments.callee.$.construct.apply(this,arguments);if(this.relTypes&&this.relTypes.length>0){a.registerOnChange(this.relTypes,this.initUpdate.bind(this));b.register(a.set,this.facade)}window.setTimeout(this.initUpdate.bind(this,$H({}),$H({})),1)},initUpdate:function(d,c){this.currentRecordsSet=d;this.currentStores=c?c.values():[];this.update.apply(this,arguments);if(this.panel&&this.panel.setTitle instanceof Function&&this.panel.initialConfig.header!==false){var e=d.keys().length;var g=e===1?c.values()[0].getRecords("info")[0]:null;var f=g?g.get("rep").title||g.get("rep").name:e+" "+Signavio.I18N.Repository.ContextPlugin.selectedElements;this.panel.doLayout()}},update:function(c,d){}};Signavio.Core.ContextPlugin=Signavio.Core.ComponentPlugin.extend(Signavio.Core.ContextPlugin)}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Core){Signavio.Core={}}(function(){var a=["/pdf","/png","/bpmn2_0_xml","/svg","/npb-export"];Signavio.Core.ExportPlugin=Signavio.Core.ContextPlugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments)},doExport:function(e,d){var b=this.currentRecordsSet.values()[0].get("rep");var c=(this.facade.getConfig("department","languages")||"[]").evalJSON(true)||[];if(!c||c.length<=1){c=[]}new Signavio.Extensions.ViewSelectionWindow({views:b,selection:this.getSelection(),suffix:e,title:d,languages:c,showFor:a})}})}());if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Core){Signavio.Core={}}new function(){Signavio.Core.ImportPlugin=Signavio.Core.ContextPlugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments)},showDummyDialogue:function(b){var a=false;try{a=this.facade.getCurrentUser().getRecords("info")[0].get("rep").licenses.include(Signavio.Config.TEAM_LICENSE)}catch(c){}var f="",d="";switch(b){case"aml":f=Signavio.I18N.Repository.Offer.importAMLDialogText.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS);d=Signavio.I18N.Repository.Offer.importAMLDialogHeader;break;case"xpdl":f=!a?Signavio.I18N.Repository.Offer.importXPDLNotInTrial.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.importXPDLWrongLicense;d=Signavio.I18N.Repository.Offer.importXPDLTitle;break;case"bpmn2":f=!a?Signavio.I18N.Repository.Offer.BPMN2_0Import.NotInTrial.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.BPMN2_0Import.WrongLicense;d=Signavio.I18N.Repository.Offer.BPMN2_0Import.title;break;case"sgx":f=!a?Signavio.I18N.Repository.Offer.archiveRestoreNotInTrial.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.archiveRestoreWrongLicense;d=Signavio.I18N.Repository.Offer.archiveRestore;break;case"jpdl4":f=!a?Signavio.I18N.Repository.Offer.jpdl4ImportNotInTrial.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.jpdl4ImportWrongLicense;d=Signavio.I18N.Repository.Offer.jpdl4ImportTitle;break;case"visio":f=Signavio.I18N.Repository.Offer.importVisioWrongLicense;d=Signavio.I18N.Repository.Offer.importVisioTitle;break}Ext.Msg.show({title:d,msg:f,prompt:false,icon:Ext.MessageBox.INFO,buttons:{ok:Ext.MessageBox.buttonText.ok}})}})}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}(function(){Signavio.Core.StandardReportsPlugin={enabled:true,construct:function(){this.treeAnchor="100% -39";arguments.callee.$.construct.apply(this,arguments)},showArchiveDialog:function(d,b,e,f,c){var a=[];c=[].concat(c||[]);this.getSelection().each(function(g){if(this.isModel(g)){a.push(g)}else{if(this.isDirectory(g)){a.push(g)}}}.bind(this));return this.showFirstDialog(a,d,b,e,f,c.findAll(function(g){return g instanceof Ext.util.Observable}))},showFirstDialog:function(c,f,b,g,h,e){var a=new Signavio.Extensions.ModelDirectoryCheckTreePanel({anchor:this.treeAnchor,root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL],filterFn:function(j){if(this.isModel(j)&&(this.hasValidModelType(j))){return true}else{if(this.isDirectory(j)){return !this.isTrashFolder(j)&&!this.isInternalFolder(j)}else{return false}}}.bind(this),isChildLeaf:function(j){return j.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(j){return j.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(j,true):"folder"}})},c);var d=new Ext.ux.Window({width:500,height:400,resizable:true,minimizable:false,modal:true,layout:"anchor",title:f,items:[new Ext.form.Label({text:b}),a].concat(e),buttons:[{text:(h===true?Signavio.I18N.Repository.Analysis.nextButton:Signavio.I18N.Repository.Analysis.standardReportGenerateButton),handler:function(){var l=a.getChecked();if(l.length<=0){return}var k=[];var j=[];l.each(function(m){var n=m.attributes.identifier;if(n.indexOf("/model/")==0){k.push(n.replace(/\/model\//,""))}else{if(n.indexOf("/directory/")==0){j.push(n.replace(/\/directory\//,""))}}}.bind(this));this.sendRequest(k,j,g,e);d.close()}.bind(this)}]});d.show();return d},sendRequest:function(b,l,g,c){var a=Ext.isIE7||Ext.isIE8;var n=Ext.isIE6;if(this.frame){this.frame.remove();delete this.frame}var d=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.STANDARD_REPORT_PATH;var h;if(a){this.frame=Ext.getBody().createChild({tag:"iframe",cls:"x-hidden",id:"iframe",name:"iframe"});h=this.frame.dom}else{if(n){window.open(d+"?"+Object.toQueryString({models:b||[],directories:l||[],reportType:g}));return}else{var k=window.open();h=k.document.body}}var j=(b||[]).map(function(p){return["input",{type:"hidden",value:p,name:"models"}]});var m=(l||[]).map(function(p){return["input",{type:"hidden",value:p,name:"directories"}]});var f=$H(Ext.Ajax.getSecurityParameter()).map(function(p){return["input",{type:"hidden",value:p.value,name:p.key}]});var e=Signavio.Core.graft(null,h,["form",{action:d,method:"POST"}].concat(j,m,f).concat([["input",{type:"hidden",value:g,name:"reportType"}]]));e.submit()},foundEpcOrBpmn20ModelSelected:function(){var b=this.getSelection();for(var a=0;a<b.length;a++){var c=b[a];if(this.isModel(c)&&(this.isEpc(c)||this.isBpmn20(c))){return true}}return false},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")},hasValidModelType:function(a){return this.isEpc(a)||this.isBpmn20(a)},isEpc:function(a){return a.get("rep").namespace=="http://b3mn.org/stencilset/epc#"},isBpmn20:function(a){return a.get("rep").namespace=="http://b3mn.org/stencilset/bpmn2.0#"},isProcessMap:function(a){return a.get("rep").namespace=="http://www.signavio.com/stencilsets/processmap#"},isOrganigram:function(a){return a.get("rep").namespace=="http://www.signavio.com/stencilsets/organigram#"},isInternalFolder:function(a){return a.get("rep").type=="internal"},isReportDisabled:function(){return this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected()}};Signavio.Core.StandardReportsPlugin=Signavio.Core.Plugin.extend(Signavio.Core.StandardReportsPlugin)}());if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){var a=$H({});a.activateGroup=function(f,b,c){var d;try{d=typeof c=="number"?this.keys()[c]:c}catch(g){return}if(this.get(d) instanceof Array){if(f&&f.items){f.items.each(function(e){e.hide()})}this.get(d).each(function(e){if(f.items.contains(e.panel)){e.panel.show()}else{f.add(e.panel);f.doLayout();e.afterRender()}})}};a.registerOnViewSwitch=function(c,b){if(!this.registeredOnEvent){b.registerOnEvent("viewswitch",c);this.registeredOnEvent=true}};Signavio.Core.ViewPlugin={renderToView:"view",viewGroup:null,viewIcons:{icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/view_icon.png",table:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/view_text.png"},_doRender:function(){this.beforeRender();this.render();if(this.enabled&&this.parent&&this.panel&&(this.panel instanceof Ext.Container||this.panel instanceof Ext.BoxComponent)){var b=this.viewGroup;if(!(b instanceof Array)){b=[b]}b.each(function(c){if(!a.get(c)){a.set(c,[])}a.get(c).push(this)}.bind(this));a.registerOnViewSwitch(a.activateGroup.bind(a,this.parent),this.facade);this.facade.registerOnEvent("viewswitch",function(){if(this.panel&&this.panel.rendered&&this.isViewSelected()){this.onViewSelect()}}.bind(this))}},isViewSelected:function(){return this.parent.items.contains(this.panel)&&this.panel.isVisible()},onViewSelect:function(){}};Signavio.Core.ViewPlugin=Signavio.Core.ContextPlugin.extend(Signavio.Core.ViewPlugin)}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){var a=[];Signavio.Core.AdministrationPlugins={construct:function(){arguments.callee.$.construct.apply(this,arguments);a.push(this)},generateTab:function(){return null},getAllTabs:function(){var b=[];a.sortBy(function(c){return c.index||0}).each(function(d){var c=d.generateTab();if(c&&"undefined"!=typeof d.index){if(c instanceof Array){c.each(function(e){e.index=d.index})}else{c.index=d.index}}b=b.concat(c||[])});return b.flatten()},doClose:function(){},doOpen:function(){},showTab:function(b){b=b||0;var c;a.each(function(d){c=d.doOpen(b)||c});return c},close:function(){a.each(function(b){b.doClose()})}};Signavio.Core.AdministrationPlugins=Signavio.Core.Plugin.extend(Signavio.Core.AdministrationPlugins)}();if(!Signavio){var Signavio={}}if(!Signavio.Templates){Signavio.Templates={}}Signavio.Templates.header=new Ext.XTemplate('<div id="signavio_repository_header">','<a href="{[Signavio.Config.HEADER_LOGO_LINK_TARGET]}" target="_blank">','<img src="../..'+Signavio.Config.LIBS_PATH+'/ext-2.0.2/resources/images/default/s.gif" id="signavio_repository_logo"/>',"</a>",'<tpl if="isTestSystem"><span style="font-size:20px;font-weight:bold;color:white;padding-left:50px"> WARNING: THIS IS A TEST SYSTEM! YOU MAY NOT STORE ANY PRODUCTION DATA! </span></tpl>',"<tpl if=\"user !== '' \">",'<tpl if="values.isGuest">','<tpl if="!values.isSsoPossible">','<form id="openid_login" class="x-login">',"<div>",'<div style="display:inline;" class="login_name">{user}</div>','<input type="submit" class="button" value="{Signavio.I18N.Repository.Header.login}" style="{[!Signavio.Config.SHOW_LOGIN_LOGOUT ? "display:none" : ""]}"/>',"</div>","</form>","</tpl>",'<tpl if="values.isSsoPossible">','<form action="/p/login?sso=true" method="post" id="openid_login">',"<div>",'<div style="display:inline;" class="login_name">{user}</div>','<input type="submit" class="button" value="{Signavio.I18N.Repository.Header.loginAsModeler}" style="{[!Signavio.Config.SHOW_LOGIN_LOGOUT ? "display:none" : ""]}"/>',"</div>","</form>","</tpl>","</tpl>",'<tpl if="!values.isGuest">','<form action="'+Signavio.Config.LOGOUT_HANDLER+'" method="post" id="openid_login">',"<div>",'<div style="display:inline;" class="login_name">{user}</div>','<input type="submit" class="button" value="{Signavio.I18N.Repository.Header.logout}" style="{[!Signavio.Config.SHOW_LOGIN_LOGOUT ? "display:none" : ""]}" />',"</div>","</form>","</tpl>","</tpl>",'<div style="clear: both;"></div>','</div><div class="signavio_repository_header_shadow"><div></div></div>');if(!Signavio){var Signavio={}}if(!Signavio.Templates){Signavio.Templates={}}Signavio.Templates.Badge='<div class="x-badge"><tpl if="values.granted_revision && values.granted_revision == values.revision"><img src="'+Signavio.Config.IMAGE_PATH+'/nuvola/16x16/apps/browser.png" ext:qtip="{[Signavio.I18N.Repository.Revision.viewIconTooltipHead]}"></tpl><tpl if="values.granted_revision && values.granted_revision != values.revision"><img src="'+Signavio.Config.IMAGE_PATH+'/nuvola/16x16/apps/browser_black.png" ext:qtip="{[Signavio.I18N.Repository.Revision.viewIconTooltipNoHead]}"></tpl><tpl if="values.badge"><img src="{badge}" ext:qtip="{[values.badgeDescription||""]}"></tpl></div>';Signavio.Templates.CommentBadge='<div class="ak-comment-badge"><tpl if="values.renderCommentBadge"><span class="ak-comment-badge-count">{[values.numberOfNewComments]}</span><img class="ak-comment-badge-icon" ext:qtip="{[values.newCommentsQTip]}" src="/images/famfamfam/comments.png"></tpl></div>';Signavio.Templates.View=new Ext.XTemplate('<tpl if="!this.isSearchResult(values)" >','<tpl for=".">','<div class="thumb-wrap" id="{href}" storeindex="{#}" unselectable="on">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>",'<div class="x-clear"></div>',"</tpl>",'<tpl if="this.isSearchResult(values)" >','<tpl if="this.hasSearchResultsFoundInName(values)" >','<div class="x-grid-group dataview">','<div class="x-grid-group-hd dataview-group-header" style="border-bottom:2px solid #DA86AE;margin-right: 6px;">','<div style="color:#AD0F5B;">{[Signavio.I18N.Repository.View.foundInNames]}</div>',"</div>",'<div class="x-grid-group-body">','<tpl for=".">','<tpl if="this.isSearchResultFoundInName(values)" >','<div class="thumb-wrap" id="{href}" storeindex="{#}">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>","</tpl>","</div>","</div>",'<div class="x-clear"></div>',"</tpl>",'<tpl if="this.hasSearchResultsFoundInDescription(values)" >','<div class="x-grid-group dataview">','<div class="x-grid-group-hd dataview-group-header" style="border-bottom:2px solid #DA86AE;margin-right: 6px;">','<div style="color:#AD0F5B;">{[Signavio.I18N.Repository.View.foundInDescriptions]}</div>',"</div>",'<div class="x-grid-group-body">','<tpl for=".">','<tpl if="this.isSearchResultFoundInDescription(values)" >','<div class="thumb-wrap" id="{href}" storeindex="{#}">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>","</tpl>","</div>","</div>",'<div class="x-clear"></div>',"</tpl>",'<tpl if="this.hasSearchResultsFoundInRevComment(values)" >','<div class="x-grid-group dataview">','<div class="x-grid-group-hd dataview-group-header" style="border-bottom:2px solid #DA86AE;margin-right: 6px;">','<div style="color:#AD0F5B;">{[Signavio.I18N.Repository.View.foundInRevComments]}</div>',"</div>",'<div class="x-grid-group-body">','<tpl for=".">','<tpl if="this.isSearchResultFoundInRevComment(values)" >','<div class="thumb-wrap" id="{href}" storeindex="{#}">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>","</tpl>","</div>","</div>",'<div class="x-clear"></div>',"</tpl>",'<tpl if="this.hasSearchResultsFoundInLabels(values) || this.hasSearchResultsFoundInMetaData(values)" >','<div class="x-grid-group dataview">','<div class="x-grid-group-hd dataview-group-header" style="border-bottom:2px solid #DA86AE;margin-right: 6px;">','<div style="color:#AD0F5B;">{[Signavio.I18N.Repository.View.foundInLabels]}</div>',"</div>",'<div class="x-grid-group-body">','<tpl for=".">','<tpl if="this.isSearchResultFoundInLabels(values) || this.isSearchResultFoundInMetaData(values)" >','<div class="thumb-wrap" id="{href}" storeindex="{#}">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>","</tpl>","</div>","</div>",'<div class="x-clear"></div>',"</tpl>",'<tpl if="this.hasSearchResultsFoundInComment(values)" >','<div class="x-grid-group dataview">','<div class="x-grid-group-hd dataview-group-header" style="border-bottom:2px solid #DA86AE;margin-right: 6px;">','<div style="color:#AD0F5B;">{[Signavio.I18N.Repository.View.foundInComments]}</div>',"</div>",'<div class="x-grid-group-body">','<tpl for=".">','<tpl if="this.isSearchResultFoundInComment(values)" >','<div class="thumb-wrap" id="{href}" storeindex="{#}">','<tpl for="rep">','<div class="thumb {[[Signavio.Const.REL.MODEL, Signavio.Const.REL.FILE].include(parent.rel) ? "model"  : ""]}"><img src="{picture}" title="{name}" class="x-thumb-icon"></div>',Signavio.Templates.Badge,Signavio.Templates.CommentBadge,'<span class="x-editable" title="{[values.name != values.shortName ? values.name : "" ]}">{[values.shortName||"&nbsp;"]}</span>',"</tpl>","</div>","</tpl>","</tpl>","</div>","</div>",'<div class="x-clear"></div>',"</tpl>","</tpl>",{isSearchResult:function(a){return a[0]&&a[0].rep&&a[0].rep.fields},hasSearchResultsFoundInName:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInName(b[a])){return true}}return false},isSearchResultFoundInName:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("name")!=-1)},hasSearchResultsFoundInDescription:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInDescription(b[a])){return true}}return false},isSearchResultFoundInDescription:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("description")!=-1)&&!this.isSearchResultFoundInName(a)},hasSearchResultsFoundInRevComment:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInRevComment(b[a])){return true}}return false},isSearchResultFoundInRevComment:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("text1")!=-1)&&!this.isSearchResultFoundInDescription(a)&&!this.isSearchResultFoundInName(a)},hasSearchResultsFoundInLabels:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInLabels(b[a])){return true}}return false},isSearchResultFoundInLabels:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("labels")!=-1)&&!this.isSearchResultFoundInRevComment(a)&&!this.isSearchResultFoundInDescription(a)&&!this.isSearchResultFoundInName(a)},hasSearchResultsFoundInMetaData:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInMetaData(b[a])){return true}}return false},isSearchResultFoundInMetaData:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("text2")!=-1)&&!this.isSearchResultFoundInRevComment(a)&&!this.isSearchResultFoundInDescription(a)&&!this.isSearchResultFoundInName(a)},hasSearchResultsFoundInComment:function(b){for(var a=0;a<b.length;a++){if(this.isSearchResultFoundInComment(b[a])){return true}}return false},isSearchResultFoundInComment:function(a){return a.rep&&a.rep.fields&&(a.rep.fields.indexOf("comments")!=-1)&&!this.isSearchResultFoundInLabels(a)&&!this.isSearchResultFoundInMetaData(a)&&!this.isSearchResultFoundInRevComment(a)&&!this.isSearchResultFoundInDescription(a)&&!this.isSearchResultFoundInName(a)}});if(!Signavio){var Signavio={}}if(!Signavio.Templates){Signavio.Templates={}}Signavio.Templates.InfoModel=new Ext.XTemplate('<div class="details">','<tpl for=".">','<span id="info_name" class="x-info-name {[values.notEditable ? "" : "x-editable"]} {[!values.name?"x-default":""]}">{[values.name||Signavio.I18N.Repository.Info.Attributes.noname]}</span>','<div class="x-info-updated">{info}</div>','<div class="x-info-notify">{[values.showNotify ? values.notify ? Signavio.I18N.Repository.Info.willBeNotified : Signavio.I18N.Repository.Info.wontBeNotified : ""]}<a class="x-info-notify-link" href="#">{[values.showNotify ? values.notify ? Signavio.I18N.Repository.Info.dontNotifyMe : Signavio.I18N.Repository.Info.notifyMe : ""]}</a></div>','<div id="info_description" class="x-info-description {[values.notEditable ? "" : "x-editable"]} {[!values.description?"x-default":""]}">{[values.description.gsub("\n", "<br/>")||Signavio.I18N.Repository.Info.Attributes.nodescription]}</div>',"</tpl>","</div>");Signavio.Templates.InfoFolder=new Ext.XTemplate('<div class="details">','<tpl for=".">','<span id="info_name" class="x-info-name {[values.notEditableTitle||values.notEditable ? "" : "x-editable"]} {[!values.name?"x-default":""]}">{[values.name||Signavio.I18N.Repository.Info.Attributes.noname]}</span>','<div id="info_description" class="x-info-description {[values.notEditable ? "" : "x-editable"]} {[!values.description?"x-default":""]}">{[values.description||Signavio.I18N.Repository.Info.Attributes.nodescription]}</div>',"</tpl>","</div>");Signavio.Templates.InfoMultiple=new Ext.XTemplate('<div class="details">','<tpl for=".">','<div class="x-info-count">{count} {[Signavio.I18N.Repository.Info.elementSelected]}</div>','<div class="x-info-updated">{updated}</div>',"</tpl>","</div>");Signavio.Templates.InfoRootFolder=new Ext.XTemplate('<div class="details">','<tpl for=".">','<span id="info_name" class="x-info-name">{name}</span>',"</tpl>","</div>");Signavio.Templates.No=new Ext.XTemplate('<div class="details">','<span class="x-no-selection">'+Signavio.I18N.Repository.Info.noSelection+"</span>","</div>");Signavio.Templates.InfoModel.compile();Signavio.Templates.InfoFolder.compile();Signavio.Templates.InfoMultiple.compile();Signavio.Templates.InfoRootFolder.compile();Signavio.Templates.No.compile();if(!Signavio){var Signavio={}}if(!Signavio.Templates){Signavio.Templates={}}Signavio.Templates.Revision=new Ext.XTemplate('<tpl for=".">','<tpl if="parent.length &gt; 1">','<div class="x-revision-model {[xindex === 1 ? "x-revision-mode-first" : ""]}"> <span>{[values.info.get("rep").name]}</span></div>',"</tpl>",'<tpl for="rev">','<div class="x-revision-item">','<div class="x-revision-item-header">','<tpl if="values.isGranted && values.hasShareAccess">','<img src="'+Signavio.Config.IMAGE_PATH+'/nuvola/16x16/apps/browser.png" ext:qtip="{[Signavio.I18N.Repository.Revision.iconTooltip]}"/>',"</tpl>",'<span class="revision">Revision','<tpl if="values.hasAccess">',"</span> ",'<a href="{editorLink}" target="_blank" class="revision">',"{rev}","</a> ","</tpl>",'<tpl if="!values.hasAccess">'," {rev}","</span> ","</tpl>",'<span class="date">{info}</span>',"</div>",'<div class="x-full-view-revision" style="display:none;">','<div class="{[!values.comment?"":"comment"]}">','{[(values.comment||"").gsub("\n", "<br/>")]}',"</div>",'<div class="x-revert">','<tpl if="xindex != 1 && values.hasAccess">',' <a href="#" class="x-link-revert">{[Signavio.I18N.Repository.Revision.revert.gsub(" ", "&nbsp;")]}</a>',"</tpl>",'<tpl if="values.hasShareAccess && !values.isGranted && (!values.isAutoPublish || xindex == 1)">',' <a href="#" class="x-link-approve">{[Signavio.I18N.Repository.Revision.approve.gsub(" ", "&nbsp;")]}</a>',"</tpl>",'<tpl if="values.hasShareAccess && values.isGranted && (!values.isAutoPublish || xindex == 1)">',' <a href="#" class="x-link-approve x-link-unapprove">{[Signavio.I18N.Repository.Revision.unapprove.gsub(" ", "&nbsp;")]}</a>',"</tpl>",'<tpl if="Signavio.Config.COMPARATOR_ENABLED && xindex != xcount && values.previousHref && !values.isFile">',' <a href="/p/comparator#{previousHref}{href}" target="_blank" class="x-link-compare">{[Signavio.I18N.Repository.Revision.compare.gsub(" ", "&nbsp;")]}</a>',"</tpl>","</div>","</div>","</div>","</tpl>","</tpl>");if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}if(!Signavio.Core.Stores){Signavio.Core.Stores={}}new function(){Signavio.Core.Stores.RequestManager={};var a={};Signavio.Core.Stores.RequestManager.LOADED="loaded";Signavio.Core.Stores.RequestManager.LOADED_FAILED="loaded_failed";Signavio.Core.Stores.RequestManager.BEFORELOAD="beforeload";Signavio.Core.Stores.RequestManager.FINISHED="finished";Signavio.Core.Stores.RequestManager.on=function(c,b){if(!a[c]){a[c]=[]}if(b instanceof Function){a[c].push(b)}};Signavio.Core.Stores.RequestManager.un=function(c,b){if(a[c]&&a[c].include(b)){a[c]=a[c].without(b)}};Signavio.Core.Stores.RequestManager.raise=function(c){if(!a[c]){return}var b=arguments;return a[c].all(function(d){return d.apply(d,b)!==false})};Signavio.Core.Stores.RequestManager.onNextLoading=function(h,e){var c=0,g,f=true;var d=function(){++c};var b=function(k,j){--c;f=f&&j;window.clearTimeout(g);g=window.setTimeout(function(){if(c===0){Signavio.Core.Stores.RequestManager.un(Signavio.Core.Stores.RequestManager.BEFORELOAD,d);Signavio.Core.Stores.RequestManager.un(Signavio.Core.Stores.RequestManager.FINISHED,b);h(f)}},e||100)};Signavio.Core.Stores.RequestManager.on(Signavio.Core.Stores.RequestManager.BEFORELOAD,d);Signavio.Core.Stores.RequestManager.on(Signavio.Core.Stores.RequestManager.FINISHED,b)};Signavio.Core.Stores.RequestManager.doPost=function(c,b,d){return Signavio.Core.Stores.RequestManager.doRequest(c,b,d,"post")};Signavio.Core.Stores.RequestManager.doGet=function(c,b,d){return Signavio.Core.Stores.RequestManager.doRequest(c,b,d,"get")};Signavio.Core.Stores.RequestManager.doPut=function(c,b,d){return Signavio.Core.Stores.RequestManager.doRequest(c,b,d,"put")};Signavio.Core.Stores.RequestManager.doDelete=function(c,b,d){return Signavio.Core.Stores.RequestManager.doRequest(c,b,d,"delete")};Signavio.Core.Stores.RequestManager.doRequest=function(c,k,f,b,d){var g=Signavio.Core.Stores.RequestManager.raise(Signavio.Core.Stores.RequestManager.BEFORELOAD);if(g===false){return}var h=k instanceof Array&&k.length>0?k[0]:k;var e=k instanceof Array&&k.length>1?k[1]:null;b=b&&["post","delete","put","get"].include(b.toLowerCase())?b:"get";var j=(f||{}).timeout||(2*60*1000);if(f&&f.timeout){delete f.timeout}f=f||{};$H(f).keys().each(function(l){f[l]=typeof f[l]=="object"?(f[l] instanceof Array?f[l].map(function(m){return typeof m=="object"?Object.toJSON(m):m}):Object.toJSON(f[l])):f[l]});Ext.Ajax.request({url:c,timeout:j,params:f,method:b.toUpperCase(),disableCaching:true,headers:{Accept:"application/json"},success:function(l){info("Success request to "+c);if(h instanceof Function){var m=l;try{m=!d?l.responseText.evalJSON()||l:l}catch(l){}h(m)}Signavio.Core.Stores.RequestManager.raise(Signavio.Core.Stores.RequestManager.LOADED,l);Signavio.Core.Stores.RequestManager.raise(Signavio.Core.Stores.RequestManager.FINISHED,l,true)},failure:function(l){warn(l.responseText&&l.responseText.isJSON()?l.responseText.evalJSON():"On "+c+" status "+l.status+" - "+l.statusText);if(e instanceof Function){e(!d&&l.responseText&&l.responseText.isJSON()?l.responseText.evalJSON():l,!d?l.status:null)}Signavio.Core.Stores.RequestManager.raise(Signavio.Core.Stores.RequestManager.LOADED_FAILED,l);Signavio.Core.Stores.RequestManager.raise(Signavio.Core.Stores.RequestManager.FINISHED,l,false)}})};Signavio.Core.Stores.RequestManager.doFileUpload=function(c,b,g,m,k){if(!c||!b||!b.length){return false}var l="\r\n",d="---------------------------"+((new Date()).getTime()),j=[];var f=Ext.Ajax.extraParams&&Ext.Ajax.extraParams.authkey&&Object.toQueryString(Ext.Ajax.extraParams);if(f){c=c+(c.include("?")?"&":"?")+f}j.push('Content-Disposition: form-data; name="file"; filename="'+b[0].fileName+'"'+l+"Content-Type: application/octet-stream"+l+l+b[0].getAsBinary()+l);$H(g||{}).each(function(n){j.push('Content-Disposition: form-data; name="'+n.key+'"'+l+l+n.value+l)});var h="--"+d+l;h+=j.join("--"+d+l);h+="--"+d+"--"+l;h="Content-Type: multipart/form-data; boundary="+d+l+"Content-Length: "+h.length+l+l+h;var e=(Class.create(Ajax.Request,{initialize:function($super,p,n){$super(p,n)},request:function(){this.url=c;this.method=this.options.method;var q=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){q._method=this.method;this.method="post"}this.parameters=q;if(q=Object.toQueryString(q)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+q}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){q+="&_="}}}try{var n=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(n)}Ajax.Responders.dispatch("onCreate",this,n);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||q):null;this.transport.sendAsBinary(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(p){this.dispatchException(p)}}}));new e(c,{method:"POST",contentType:"multipart/form-data; boundary="+d,postBody:h,onSuccess:m,onFailure:k})}}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}new function(){var a=$H({});Signavio.Core.StoreManager={};Signavio.Core.StoreManager.getRootDirectoryStore=function(b){return Signavio.Core.StoreManager.getStore("root")||Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.DIRECTORY_PATH,"root",["dir","glos"],{callback:b})};Signavio.Core.StoreManager.loadChildEntitiesStore=function(b){Signavio.Core.StoreManager.getRelatedStore(b,"child",["mod","dir","file"],{sort:Signavio.Utils.BusinessObjectSortingFunction})};Signavio.Core.StoreManager.setChildEntitiesStore=function(b){var d=a.get("child");if(d){var c=d.lastOptions||{};c.filter=["mod","dir","file"];c.sort=Signavio.Utils.BusinessObjectSortingFunction;d.reloadWith(b,c)}};Signavio.Core.StoreManager.reloadChildEntitiesStore=function(){var c=a.get("child");if(c){var b=c.lastOptions||{};b.filter=["mod","dir","file"];b.sort=Signavio.Utils.BusinessObjectSortingFunction;b.force=true;delete b.callee;b.callback=function(){delete c.lastOptions.callback;delete c.lastOptions.force};c.load(b)}};Signavio.Core.StoreManager.getChildEntitiesStore=function(){var b=Signavio.Core.StoreManager.getRelatedStore(null,"child");return b};Signavio.Core.StoreManager.loadCurrentUser=function(b){Signavio.Core.StoreManager.getRelatedStore(b,"cuser")};Signavio.Core.StoreManager.getCurrentUser=function(){return Signavio.Core.StoreManager.getRelatedStore(null,"cuser")};Signavio.Core.StoreManager.getAllUserStore=function(c){var b={sort:Signavio.Utils.BusinessObjectSortingFunction};if("function"==typeof c){b.callback=c}return Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.USER_PATH,undefined,undefined,b)};Signavio.Core.StoreManager.getAllUserGroupStore=function(){var c=Signavio.Core.StoreManager.getStore("userandgroups");if(c){return c}c=Signavio.Core.StoreManager.getRelatedStore(undefined,"userandgroups");var b=Signavio.Core.StoreManager.getAllUserStore(function(){c.reloadWith(b,{add:true})});var d=Signavio.Core.StoreManager.getAllGroupStore(function(){c.reloadWith(d,{add:true})});return c};Signavio.Core.StoreManager.getAllGroupStore=function(b){return Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.USERGROUP_PATH,"usergroups",undefined,b instanceof Function?{callback:b}:undefined)};Signavio.Core.StoreManager.getStore=function(b,c,d){if(c===true){return Signavio.Core.StoreManager.getRelatedStore(b,undefined,undefined,{callback:d})}else{return a.get(b)}};Signavio.Core.StoreManager.deleteStore=function(b){info("Delete store "+b.getIdentifier()+" from cache");a.unset(b.getIdentifier());delete b};Signavio.Core.StoreManager.clearAllStores=function(){a.values().invoke("clearCache")};Signavio.Core.StoreManager.getAllStores=function(){return a.values()};Signavio.Core.StoreManager.reload=function(b,d){var c=[];(b===undefined?a.values().findAll(function(e){return !(c.include(e.getIdentifier())||!c.push(e.getIdentifier()))}):[b]).each(function(e){var f=Object.clone(e.lastOptions);delete f.add;delete f.callee;f.force=true;f.callback=function(){delete e.lastOptions.callback;delete e.lastOptions.force;if(d instanceof Function){d()}};if(f.url){e.load(f)}})};Signavio.Core.StoreManager.getRelatedStore=function(g,d,f,e){var c=(d?a.get(d):a.get(d)||a.get(g));var b=!!c;if(!c){if((g||"").startsWith(Signavio.Config.USERGROUP_PATH)){c=new Signavio.Core.UserGroupStore({url:""})}else{if((g||"").startsWith(Signavio.Config.TENANT_PATH)){c=new Signavio.Core.UserGroupStore({url:""})}else{if((g||"").startsWith(Signavio.Config.MODEL_PATH)){c=new Signavio.Core.ModelStore({url:""})}else{if((g||"").startsWith(Signavio.Config.FILE_PATH)){c=new Signavio.Core.FileStore({url:""})}else{if((g||"").startsWith(Signavio.Config.CONFIGURATION_PATH)){c=new Signavio.Core.ConfigurationsStore({url:""})}else{if((g||"").startsWith(Signavio.Analytics.Config.ANALYTICS_PATH)){c=new Signavio.Core.AnalyticsStore({url:""})}else{if((g||"").startsWith(Signavio.Config.CONTROLRIGHTS_PATH)){c=new Signavio.Core.ConfigurationsStore({url:""})}else{c=new Signavio.Core.DataStore({url:""})}}}}}}}if(g&&!a.get(g)){a.set(g,c)}if(d&&!a.get(d)){a.set(d,c)}}if(Signavio.Config.USE_CONTENT_MODE){if(Signavio.Config.APPLICATION==="explorer"&&((g||"").startsWith(Signavio.Config.DIRECTORY_PATH)||(g||"").startsWith(Signavio.Config.SEARCH_PATH))){if(!e){e={}}if(!e.params){e.params={}}e.params.contentmode="explorer"}if(Signavio.Config.APPLICATION==="portal"&&((g||"").startsWith(Signavio.Config.DIRECTORY_PATH)||(g||"").startsWith(Signavio.Config.SEARCH_PATH))){if(!e){e={}}if(!e.params){e.params={}}e.params.contentmode="portal"}}f=f||[];e=e?Object.clone(e):c.lastOptions||{};e.key=d;if(g){e.id=g;e.filter=f;e.url=Signavio.Config.BACKEND_PATH+g;c.load(e)}return c}}();if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}(function(){Signavio.Core.RecordCreator={};Signavio.Core.RecordCreator.create=function(e,g,j){var h=Ext.data.Record.create(["rel","href","rep"]);var f=new h({rel:e,href:g,rep:j});return f};var c=Signavio.Core.Stores.RequestManager;var d={};d.PATTERN=new RegExp("("+Signavio.Config.BACKEND_PATH+"/p/)?([^/]+)(/([^/]+))?(/([^/]+))?(/+(.*))?$");d.split=function(f){if(!f||!(f.startsWith("/"))){throw"URLSpliter.split needs a relative url starting with a /."}var e=f.match(d.PATTERN);o={};o.context=e[2];o.identifier=e[4];o.extension=e[6];o.param=e[8];return o};var a={};a.setRecord=function(h,g,f){var e=Signavio.Core.StoreManager.getStore(h);if(!e){return}e.each(function(j){if(j.get("href")===g){j.set("rep",f instanceof Array?f.clone():Object.clone(f),e.indexOf(j)<0);j.commit(true)}});a.cacheStore(e)};a.cacheStore=function(e){if(!e||!e.lastOptions||!e.lastOptions.url){return}a.setCache(e.lastOptions.url,(e.snapshot||e.data).items)};a.setCache=function(g,f){var e=b.get(g);if(e){e.records=f;e.totalRecords=e.records.length;e.success=true}};a.updateAllStores=function(f,e){Signavio.Core.StoreManager.getAllStores().each(function(g){g.each(function(h){if(h.get("href")===f){h.set("rep",e,g.indexOf(h)<0);h.commit(true);g.fireEvent("update",g,h,Ext.data.Record.COMMIT);a.cacheStore(g)}})})};a.doUpdate=function(k,m){info("Do update on record "+k.get("href"));var f=k.get("href");var e=Signavio.Config.BACKEND_PATH+f;var l=k.get("rep");var g=k.modified.rep;var j=d.split(f);var n=function(p){l=p;k.set("rep",Object.clone(l));k.commit(true);if(m.lastOptions.key){}if(j.extension=="info"){a.updateAllStores("/"+j.context+"/"+j.identifier,l);if(!m.lastOptions.key&&m.lastOptions.id.startsWith("/user")){a.setRecord("cuser","/"+j.context+"/"+j.identifier+"/"+j.extension,l)}}a.cacheStore(m);this.afterAsyncCommit(k);this.fireEvent("submitted",this,k)}.bind(m);var h=function(){if(g){k.set("rep",g);k.commit(true)}this.fireEvent("submitfailed",this,k);this.afterAsyncCommit(k)}.bind(m);if($H(l).values().any(function(p){return p instanceof Array||"string"==typeof p})){for(i in l){if(i&&l[i]&&"string"==typeof l[i]&&l.formats instanceof Array){l[i]=Signavio.Utils.unescapeHTML(l[i]);continue}else{if(!i||!(l[i] instanceof Array)){continue}}l[i]=l[i].map(function(p){return typeof p==="string"?p:Object.toJSON(p)})}}c.doRequest(e,[n,h],l,"put")};a.doDeletes=function(g,l,h){info("Deletes internal representation on record "+g.get("href"));var f=g.modified.rep;var k=g.get("rep");var m=function(){this.afterAsyncCommit(g);this.fireEvent("submitted",this,g)}.bind(h);var e=function(){k.splice(f.indexOf(l),0,l);g.set("rep",k);g.commit(true);this.fireEvent("submitfailed",this,g);this.afterAsyncCommit(g)}.bind(h);var j=Signavio.Config.BACKEND_PATH+l.href;c.doRequest(j,[m,e],null,"delete")};a.doAppend=function(g,k,h){info("Append internal representation on record "+g.get("href"));var j=g.get("href");var e=d.split(j);var l=function(m){g.get("rep").each(function(n){if(n.href==k.href){n.rep=m.rep||m;n.rel=m.rel||g.get("rel");n.href=m.href||k.href||g.get("href")}});this.fireEvent("submitted",this,g);this.afterAsyncCommit(g);a.setRecord("/"+e.context+"/"+e.identifier,j,g.get("rep"))}.bind(h);var f=function(){try{delete g.get("rep")[g.get("rep").indexOf(k)];var n=g.get("rep").compact();g.set("rep",n);g.commit(true)}catch(m){}this.fireEvent("submitfailed",this,g);this.afterAsyncCommit(g)}.bind(h);c.doRequest(Signavio.Config.BACKEND_PATH+j,[l.bind(l),f.bind(f)],k.rep||k,"post")};a.doAdd=function(g,h){info("Add a new record "+g.get("href")+" to the store "+h.lastOptions.id);var l=h.lastOptions.id;var e=d.split(l);var j=Signavio.Config.BACKEND_PATH+"/"+e.context+(e.extension?"/"+e.identifier+"/"+e.extension:"");var k=function(m){g.set("rel",m.rel,true);g.set("href",m.href,true);g.set("rep",m.rep,true);g.commit(true);a.cacheStore(h);var n=Signavio.Core.StoreManager.getStore(h.getIdentifier());if(n&&h!==n&&n.indexOf(g)<0){}if(h.lastOptions&&h.lastOptions.key==="child"){var n=Signavio.Core.StoreManager.getStore(h.getIdentifier());if(n&&n!==this&&n.lastOptions.id===this.lastOptions.id){n.add([g])}}this.fireEvent("submitted",this,g);this.fireEvent("add",this,[g],h.indexOf(g))}.bind(h);var f=function(m){this.fireEvent("submitfailed",this,g);h.remove(g);a.cacheStore(h)}.bind(h);c.doRequest(j,[k,f],Ext.apply((Object.clone(g.get("rep"))||{}),{parent:l},h.baseParams),"post")};a.doChildUpdate=function(k,l,p){info("Do an update on the child "+(l.href||l)+" within the record "+k.get("href"));var f=k.get("href");var g=d.split(f);var m=k.get("rep");var h=k.modified.rep;var q=function(r){k.get("rep").each(function(s){if(s.href==l.href){s.rep=r.rep||r;s.rel=r.rel||l.rel||k.get("rel")}});this.fireEvent("submitted",this,k);this.afterAsyncCommit(k);a.setRecord("/"+g.context+"/"+g.identifier,f,k.get("rep"))}.bind(p);var j=function(r){m[m.indexOf(l)].rep=h.indexOf(l).rep;k.set("rep",m);k.commit(true);this.fireEvent("submitfailed",this,k);this.afterAsyncCommit(k)}.bind(p);var e=Signavio.Config.BACKEND_PATH+l.href;var n=l.rep||l;c.doRequest(e,[q.bind(q),j.bind(j)],n,"put")};a.doMove=function(g,m,h){info("Move the record "+g.get("href")+" from "+h.lastOptions.id+" to "+m);var l=g.get("href");var j=Signavio.Config.BACKEND_PATH+l;var e=d.split(l);var k=function(s){var p=g.copy();h.remove(g);var u=Signavio.Core.StoreManager.getStore(h.getIdentifier());if(u&&h!==u){var t=u.data.items.find(function(v){return v.get("href")===g.get("href")});if(t){u.remove(t)}}var n=b.get(Signavio.Config.BACKEND_PATH+m);if(n){if(n.records instanceof Array){n.records.push(p)}else{n.records=[p]}n.totalRecords=n.records.length}var q=Signavio.Core.StoreManager.getStore(m);if(q){q.add([p])}var r=Signavio.Core.StoreManager.getStore(l);if(r){r.clearCache();r.loadData(s)}}.bind(h);var f=function(n){this.fireEvent("submitfailed",this,g);this.afterAsyncCommit(g)}.bind(h);c.doRequest(j,[k,f],{parent:m},"put")};a.doCopy=function(g,m,f,j){var e=function(n){this.fireEvent("submitfailed",this,g,n)}.bind(f);if(j){var h=Signavio.Config.BACKEND_PATH+Signavio.Config.COPY_LINKED_PATH;var k=[];g.each(function(n){info("Copy the record "+n.get("href")+" to the store "+m);k.push(n.get("href"))});var l=function(p){var q=[];p.each(function(s){q.push(Signavio.Core.RecordCreator.create(s.rel,s.href,s.rep))});var r=Signavio.Core.StoreManager.getStore("child");if(r&&r.lastOptions.id===m){q.each(function(s){r.add([s])})}var n=b.get(Signavio.Config.BACKEND_PATH+m);if(n){if(n.records instanceof Array){q.each(function(s){n.records.push(s)})}else{n.records=q}n.totalRecords=n.records.length}}.bind(f);c.doRequest(h,[l,e],{parent:m,ids:k,suffix:Signavio.I18N.Repository.Offer.copyPrefix,copy:true,includeLinked:j},"post")}else{g.each(function(n){info("Copy the record "+n.get("href")+" to the store "+m);var q=((n.get("href")||"").match(/(\/\w+\/)/)||[]).first();var p=Signavio.Config.BACKEND_PATH+q;var r=function(t){n.set("rel",t.rel);n.set("rep",t.rep);n.set("href",t.href);var u=Signavio.Core.StoreManager.getStore("child");if(u&&u.lastOptions.id===m){n=Signavio.Core.RecordCreator.create(t.rel,t.href,t.rep);u.add([n])}var s=b.get(Signavio.Config.BACKEND_PATH+m);if(s){if(s.records instanceof Array){s.records.push(n)}else{s.records=[n]}s.totalRecords=s.records.length}}.bind(f);c.doRequest(p,[r,e],{parent:m,id:n.get("href"),name:n.get("rep").name,copy:true,includeLinked:j},"post")}.bind(this))}};a.doSetGroupParents=function(m,h,j){info("Set the parents from record "+m.get("href")+" to "+h.join(","));var l=m.get("href");var g=Signavio.Config.BACKEND_PATH+l;var e=d.split(l);var k=function(n){var s=Signavio.Core.StoreManager.getStore(l);if(s){s.loadData(n);s.addedRecords=[];s.removedRecords=[];a.cacheStore(s);s.fireEvent("update",s,m,Ext.data.Record.COMMIT)}if(h.include(j.getIdentifier())){var q=n.find(function(t){return t.rel=="info"});j.add(Signavio.Core.RecordCreator.create(m.get("rel")==="user"?"user":"cgroup",l,Object.clone(q.rep)));j.addedRecords=[]}else{var p=j.findByIdentifier(m.get("href"));if(p){j.remove(p);j.removedRecords=[]}}a.cacheStore(j);this.fireEvent("submitted",this,m);this.afterAsyncCommit(m)}.bind(j);var f=function(n){this.fireEvent("submitfailed",this,m);this.afterAsyncCommit(m)}.bind(j);c.doRequest(g,[k,f],{parents:h},"put")};a.doRemove=function(g,h){info("Removes a record "+g.get("href")+" from the store "+h.lastOptions.id);var m=g.get("href");var k=Signavio.Config.BACKEND_PATH+m;var e=d.split(m);var j=h.indexOf(g);var l=function(n){var p=Signavio.Core.StoreManager.getStore(m);if(p){Signavio.Core.StoreManager.deleteStore(p)}this.fireEvent("submitted",this,g);a.cacheStore(h)}.bind(h);var f=function(n){h.insert(Math.max(j,0),[g]);this.fireEvent("submitfailed",this,g);this.fireEvent("update",this,g,Ext.data.Record.COMMIT)}.bind(h);c.doRequest(k,[l,f],null,"delete")};var b=$H({});b.getRecord=function(e,g){var f;b.values().find(function(h){f=h.records.find(function(j){return j.get("rel")===e&&j.get("href")===g});return f});return f};b.stores=$H({});b.register=function(f,g,e){this.set(f,g);if(!b.stores.get(f)){b.stores.set(f,[])}if(!b.stores.get(f).include(e)){b.stores.get(f).push(e)}};b.raise=function(e){(b.stores.get(e)||[]).each(function(f){f.fireEvent("load",f,f.data.items,f.lastOptions)})};Signavio.Core.DataStore=function(e){Signavio.Core.DataStore.superclass.constructor.call(this,Ext.apply(e,{proxy:new Ext.data.HttpProxy({useAjax:true,url:e.url,method:"GET",disableCaching:true,headers:{accept:"application/json"},timeout:(2*60*1000)}),reader:new Ext.data.JsonReader(e,["rel","href","rep"])}));this.proxy.on("loadexception",function(g,f,j){if(j.status===404){return}var h=j.responseText||j.statusText+" on "+f.url;warn(h.isJSON()?h.evalJSON():h)});this.on("add",this.onAdd.bind(this),this);this.on("remove",this.onRemove.bind(this),this);this.baseParams={timeout:120000}};Ext.extend(Signavio.Core.DataStore,Ext.data.Store,{getPrivileges:function(){var e=this.getRecords(Signavio.Const.REL.PRIVILEGE);if(!e||e.length<=0){return null}return e[0].get("rep").map(function(f){return typeof f==="string"?f.toLowerCase():undefined}).compact()},unfoldPrivileges:function(e){if(!e){return[]}if(!(e instanceof Array)){e=[e]}e.each(function(f){switch(f){case Signavio.Config.RIGHTS.READ:e.push(Signavio.Config.RIGHTS.WRITE);case Signavio.Config.RIGHTS.WRITE:e.push(Signavio.Config.RIGHTS.DELETE);case Signavio.Config.RIGHTS.DELETE:e.push(Signavio.Config.RIGHTS.SHARE);case Signavio.Config.RIGHTS.ALL:case Signavio.Config.RIGHTS.SHARE:break}});return e.uniq()},hasPrivileges:function(e){if(!e){return false}if(!(e instanceof Array)){e=[e]}else{e=e.clone()}e=this.unfoldPrivileges(e);var f=this.getPrivileges();if(f===null){return true}else{if(f.length<=0){return false}else{return e.any(function(g){return f.include(g.toLowerCase())})}}},filter:function(g,e){if(typeof g=="string"&&g.indexOf("rep.")>=0){e=e.toLowerCase();var f=g.split("||").map(function(h){return h.split(".").last()}).compact();this.snapshot=this.snapshot||this.data;this.data=this.snapshot.filterBy(function(j){var k=j.get("rep");var h=$H(k).keys();if(f&&f.length>0){h=h.findAll(function(l){return f.include(l)})}return h.any(function(l){return k[l].toLowerCase().indexOf(e)>=0})});this.fireEvent("datachanged",this)}else{Signavio.Core.DataStore.superclass.filter.apply(this,arguments)}},onAdd:function(j,f,h){var g=function(m,n){var l=Object.toJSON(n.get("rep"));return m.any(function(p){return p.get("href")==n.get("href")&&Object.toJSON(p.get("rep"))==l})};this.addedRecords=((this.addedRecords||[]).concat(f)).uniq();this.addedRecords=this.addedRecords.findAll(function(l){return !g(this.removedRecords||[],l)}.bind(this));this.removedRecords=(this.removedRecords||[]).findAll(function(l){return !g(f,l)});a.cacheStore(this);var k=Signavio.Core.StoreManager.getStore("child");if(k&&k!==this&&k.getIdentifier()===this.getIdentifier()){}var e=Signavio.Core.StoreManager.getStore("cuser");if(e&&e!==this&&e.getIdentifier()===this.getIdentifier()){e.add(f)}},onRemove:function(h,j,g){var f=function(m,n){var l=Object.toJSON(n.get("rep"));return m.any(function(p){return p.get("href")==n.get("href")&&Object.toJSON(p.get("rep"))==l})};this.removedRecords=((this.removedRecords||[]).concat(!f(this.addedRecords||[],j)?[j]:null)).compact().uniq();this.addedRecords=(this.addedRecords||[]).without(j);a.cacheStore(this);var k=Signavio.Core.StoreManager.getStore("child");if(k&&k!==this&&k.getIdentifier()===this.getIdentifier()){}var e=Signavio.Core.StoreManager.getStore("cuser");if(e&&e!==this&&e.getIdentifier()===this.getIdentifier()){e.remove(j)}},include:function(e){return this.indexOf(e)>=0},findByIdentifier:function(e){return this.getAt(this.find("href",e))},findByRepValue:function(e,f){return this.getAt(this.findBy(function(g){return g.get("rep")[e]==f}))},getIdentifier:function(){return(this.lastOptions||{}).id||this.id||""},getRecords:function(e){var f=[];e=e instanceof Array?e:(e?[e]:null);(this.snapshot||this.data).each(function(g){if(!e||e.include(g.get("rel"))){f.push(g)}});return f},parseValue:function(e,f){return Signavio.Utils.extractValue(e,f)},move:function(e,f){if(!(e instanceof Ext.data.Record)||!this.findByIdentifier(e.get("href"))){warn("DataStore.move needs a contained record");return}if(typeof f!=="string"){warn("DataStore.move needs a new parent identifier");return}a.doMove(e,f,this)},copy:function(e,g,f){if(!(e instanceof Array)){e=[e]}e.each(function(h){if(!(h instanceof Ext.data.Record)||!this.data.items.pluck("data").pluck("href").include(h.get("href"))){warn("DataStore.copy needs a contained record");return}}.bind(this));if(typeof g!=="string"){warn("DataStore.copy needs a new parent identifier");return}a.doCopy(e,g,this,f)},remove:function(e,f){if(f===true){this.fireEvent("beforesubmit",this,e);a.doRemove(e,this);Signavio.Core.DataStore.superclass.remove.call(this,e);this.removedRecords=(this.removedRecords||[]).without(e)}else{Signavio.Core.DataStore.superclass.remove.call(this,e)}},add:function(f,j){if(j===true){([f]||[]).each(function(k){this.fireEvent("beforesubmit",this,k);a.doAdd(k,this)}.bind(this))}f=[].concat(f);if(f.length<1){return}for(var h=0,e=f.length;h<e;h++){f[h].join(this)}var g=this.data.length;this.data.addAll(f);if(this.snapshot){this.snapshot.addAll(f)}if(j!==true){this.fireEvent("add",this,f,g)}if(j===false){([f]||[]).each(function(k){this.addedRecords=this.addedRecords.without(k)}.bind(this))}},commitChanges:function(f,g){if(g instanceof Function){Signavio.Core.Stores.RequestManager.onNextLoading(g)}if(this.removedRecords&&this.removedRecords.length>0){var e=this.removedRecords.length-1;for(;e>=0;e--){this.remove(this.removedRecords[e],true)}this.addedRecords=[];this.removedRecords=[];this.fireEvent("load",this,this.data.items,this.lastOptions)}if(f===true){a.cacheStore(this);this.fireEvent("load",this,this.data.items,this.lastOptions);return}Signavio.Core.DataStore.superclass.commitChanges.call(this)},rejectChanges:function(){if(this.removedRecords&&this.removedRecords.length>0){var e=this.removedRecords.length-1;for(;e>=0;e--){this.add(this.removedRecords[e])}this.addedRecords=[];this.removedRecords=[]}Signavio.Core.DataStore.superclass.rejectChanges.call(this);this.fireEvent("load",this,this.data.items,this.lastOptions)},missedCallbacks:[],load:function(f){if(this.isLoading){info("Store "+this.getIdentifier()+" is currently loading. Callback will be called after loading.");if(f.callback instanceof Function){this.missedCallbacks.push(f.callback)}this.storeOptions(f);return false}else{this.missedCallbacks=[]}this.isLoading=true;delete this.cleared;var e=f.url||this.proxy.conn.url;this.id=f.id||e;this.proxy.conn.url=e;f.url=e;if(!e){error("Data store needs a url")}if(Signavio.Config.USE_CACHE&&!f.force&&b.get(e)){if(this.fireEvent("beforeload",this,f)!==false){info("Loading store via cache on url "+e);window.setTimeout(function(){this.storeOptions(f);this.loadRecords.apply(this,[b.get(e),f,true])}.bind(this),10)}}else{Signavio.Core.DataStore.superclass.load.call(this,f)}return true},loadRecords:function(m,f,l){delete this.isLoading;if(m&&m.success===true){var k=Object.clone(m);k.records=k.records.map(function(n){return n.copy()});b.register(f.url||this.url,k,this)}if(!m||l===false){this.fireEvent("load",this,[],f);if(f.callback){f.callback.call(f.scope||this,[],f,false)}this.missedCallbacks.each(function(n){n.call(f.scope||this,[],f,false)}.bind(this));this.missedCallbacks=[];return}var j=m.records,h=m.totalRecords||j.length;if(!f||f.add!==true){if(this.pruneModifiedRecords){this.modified=[]}for(var g=0,e=j.length;g<e;g++){j[g].join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(j);this.totalLength=h}else{this.totalLength=Math.max(h,this.data.length+j.length);this.add(j)}if(f.sort&&f.sort instanceof Function){this.data.sort("ASC",f.sort)}this.applySort();if(f.filter instanceof Array&&f.filter.length>0){this.filterBy(function(n){return f.filter.include(n.get("rel"))})}else{this.fireEvent("datachanged",this)}this.fireEvent("load",this,j,f);if(f.callback){f.callback.call(f.scope||this,j,f,true)}this.missedCallbacks.each(function(n){n.call(f.scope||this,j,f,true)}.bind(this));this.missedCallbacks=[]},clone:function(){var f,g,e;f=new Signavio.Core.DataStore({url:""});g=f.lastOptions||{};e=((f.snapshot||f.data).items||[]).invoke("copy");window.setTimeout(function(){f.storeOptions(g);f.loadRecords({records:e,totalRecords:e.length,success:true},g,true)}.bind(this),10);return f},reloadWith:function(e,f){f=f||{};f.url=(e.lastOptions||{}).url;f.id=(e.lastOptions||{}).id;if(this.fireEvent("beforeload",this,f)!==false){window.setTimeout(function(){var g=(e.snapshot||e.data).items;this.storeOptions(f);this.loadRecords({records:g,totalRecords:g.length,success:true},f,true);this.addedRecords=[]}.bind(this),10)}},beforeCommit:function(g){if(!g||!g.dirty){return}this.fireEvent("beforesubmit",this,g);info("Start to commit "+g.get("href"));var h=g.get("href");var l=g.get("rep");var f=g.modified.rep||[];var k=[],m=[],e=[],j;if(l instanceof Array){m=f.findAll(function(n){return !l.any(function(p){return n.href==p.href&&n.rep===p.rep})});k=l.findAll(function(n){return !f.any(function(p){return n.href==p.href&&n.rep===p.rep})});e=l.findAll(function(n){return f.any(function(p){return n.href==p.href&&n.rep&&p.rep&&n.rep!==p.rep})&&!k.include(n)&&!m.include(n)})}else{if(l instanceof Object){j=l}}if(m.length>0||k.length>0||e.length>0){m.each(function(n){a.doDeletes(g,n,this)}.bind(this));k.each(function(n){a.doAppend(g,n,this)}.bind(this));e.each(function(n){a.doChildUpdate(g,n,this)}.bind(this))}else{if(j instanceof Object){a.doUpdate(g,this)}else{info("No element to update");return}}},afterCommit:function(e){},afterAsyncCommit:function(e){(this.modified||[]).remove(e);if(this.indexOf(e)>=0){this.fireEvent("update",this,e,Ext.data.Record.COMMIT)}else{this.fireEvent("load",this,this.data.items,this.lastOptions)}},sortData:function(g,h){if(g instanceof Function){h=h||"ASC";var e=function(j,f){var l=g.call(g,j),k=g.call(g,f);return l>k?1:(l<k?-1:0)};this.data.sort(h,e);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(h,e)}}else{Signavio.Core.DataStore.superclass.sortData.call(this,g,h)}},sortBy:function(e){this.sortData(e,"ASC");this.fireEvent("datachanged",this)},clearCache:function(){if(this.lastOptions&&this.lastOptions.url){b.unset(this.lastOptions.url);this.cleared=true}}});Signavio.Core.ModelStore=Ext.extend(Signavio.Core.DataStore,{getHeadRevision:function(){return this.getRecords("revision").sort(function(f,e){return Number(f.get("rep").rev)-Number(e.get("rep").rev)}).last()}});Signavio.Core.FileStore=Ext.extend(Signavio.Core.DataStore,{getHeadRevision:function(){return this.getRecords("filerevision").sort(function(f,e){return Number(f.get("rep").rev)-Number(e.get("rep").rev)}).last()}});Signavio.Core.UserGroupStore=Ext.extend(Signavio.Core.DataStore,{addAsParent:function(e){if(!(e instanceof Ext.data.Record)){warn("DataStore.addAsParent needs a contained record");return}var g=this.getIdentifier();var f=Signavio.Core.StoreManager.getStore(e.get("href"),true,function(){var h=f.getRecords("group").map(function(j){return j.get("href")});if(!h.include(g)){h.push(g);a.doSetGroupParents(e,h,this)}}.bind(this))},removeAsParent:function(e){if(!(e instanceof Ext.data.Record)){warn("DataStore.removeAsParent needs a contained record");return}var g=e.get("href");var h=this.getIdentifier();var f=Signavio.Core.StoreManager.getStore(g,true,function(){var j=f.getRecords("group").map(function(k){return k.get("href")});if(j.include(h)){j=j.without(h);a.doSetGroupParents(e,j,this)}}.bind(this))},commitChanges:function(){var f;if(this.removedRecords&&this.removedRecords.length>0){var e=this.removedRecords.length-1;for(;e>=0;e--){this.removeAsParent(this.removedRecords[e])}f=true}if(this.addedRecords&&this.addedRecords.length>0){var e=this.addedRecords.length-1;for(;e>=0;e--){this.addAsParent(this.addedRecords[e])}f=true}this.removedRecords=[];this.addedRecords=[];Signavio.Core.UserGroupStore.superclass.commitChanges.call(this);if(f){this.fireEvent("load",this,this.data.items,this.lastOptions)}},rejectChanges:function(){var g=this.addedRecords;var f=this.removedRecords;if(f&&f.length>0){var e=f.length-1;for(;e>=0;e--){this.add(f[e])}}if(g&&g.length>0){var e=g.length-1;for(;e>=0;e--){this.remove(g[e])}}this.removedRecords=[];this.addedRecords=[];Signavio.Core.UserGroupStore.superclass.rejectChanges.call(this);this.fireEvent("load",this,this.data.items,this.lastOptions)}});Signavio.Core.ConfigurationsStore=Ext.extend(Signavio.Core.DataStore,{getConfiguration:function(g,f,e){return this.getRange().find(function(h){return h.get("rel")==="config"&&g.include(h.get("rep").object)&&f.toUpperCase()===h.get("rep").category.toUpperCase()&&e.toLowerCase()===h.get("rep").name.toLowerCase()})},commitChanges:function(){var g,l=[];if(this.removedRecords&&this.removedRecords.length>0){var q=this.removedRecords.length-1;for(;q>=0;q--){var k=this.removedRecords[q];k=k.get("rep");delete k.value;l.push(k)}}if(this.addedRecords&&this.addedRecords.length>0){var q=this.addedRecords.length-1;for(;q>=0;q--){var k=this.addedRecords[q];k=k.get("rep");l.push(k)}}var j=this.modified.slice(0);for(var n=0,q=j.length;n<q;n++){j[n].commit(true);l.push(j[n].get("rep"))}var t=[].concat(this.removedRecords||[]),s=[].concat(this.addedRecords||[]),p=[].concat(this.modified||[]);this.removedRecords=[];this.addedRecords=[];this.modified=[];Signavio.Core.ConfigurationsStore.superclass.commitChanges.call(this);var f=d.split(this.getIdentifier());var e=Signavio.Config.BACKEND_PATH+"/"+f.context;var r=function(u){var m=[].concat(t,s,p);u.each(function(x,w){var v=m[w];v.set("rel",x.rel,true);v.set("href",x.href,true);v.set("rep",x.rep,true);v.commit(true)});a.cacheStore(this);this.fireEvent("submitted",this,[].concat(t,s,p))}.bind(this);var h=function(){this.fireEvent("submitfailed",this,[].concat(t,s,p));t.each(function(m){this.add(m)}.bind(this));s.each(function(m){this.remove(m)}.bind(this));this.removedRecords=[];this.addedRecords=[];a.cacheStore(this)}.bind(this);c.doRequest(e,[r,h],{configurations:l},"post")},rejectChanges:function(){var g=this.addedRecords;var f=this.removedRecords;if(f&&f.length>0){var e=f.length-1;for(;e>=0;e--){this.add(f[e])}}if(g&&g.length>0){var e=g.length-1;for(;e>=0;e--){this.remove(g[e])}}this.removedRecords=[];this.addedRecords=[];Signavio.Core.ConfigurationsStore.superclass.rejectChanges.call(this);this.fireEvent("load",this,this.data.items,this.lastOptions)}});Signavio.Core.AnalyticsStore=function(e){Signavio.Core.DataStore.superclass.constructor.call(this,Ext.apply(e,{proxy:new Ext.data.HttpProxy({useAjax:true,url:e.url,method:"GET",disableCaching:true,headers:{accept:"application/json"}}),reader:new Ext.data.JsonReader(e,["rel","href","rep"])}));this.proxy.on("loadexception",function(g,f,j){if(j.status===404){return}var h=j.responseText||j.statusText+" on "+f.url;warn(h.isJSON()?h.evalJSON():h)});this.on("add",this.onAdd.bind(this),this);this.on("remove",this.onRemove.bind(this),this);this.baseParams={timeout:120000}};Ext.extend(Signavio.Core.AnalyticsStore,Signavio.Core.DataStore,{load:function(e){if(!e||typeof(e)!="object"){e={}}e.force=true;if(this.filterFN instanceof Function){e.filter=this.filterFN}if(e.params&&!e.params.filterId){e.params.filterId=Signavio.Portal.Analytics.WidgetManager.FilterManager.getLastFilter().id}Signavio.Core.AnalyticsStore.superclass.load.call(this,e)},setFilter:function(f,e){if(!f instanceof Function){return}if(this.isFiltered()){return}this.filterFN=f;this.clearFilter(true);this.filterBy(f,e||this)},resetFilter:function(){if(!this.filterFN instanceof Function){return}this.clearFilter(true);this.filterBy(this.filterFN)}})}());if(!Signavio){var Signavio={}}if(!Signavio.Core){Signavio.Core={}}var fn=function(){};new function(){var RM=Signavio.Core.Stores.RequestManager;Signavio.Core.Repository={initialized:false,construct:function(){this.initSecureParameter();arguments.callee.$.construct.apply(this,arguments);this._controls={};this._plugins=[];this._user=null;this._offered=[];this._finializeCount=2;this._additionalFinializeCount=0;this._additionalFinalClb=[];this._eventManager=new EventManager();this.showMask();this._initConfig();this._initComponents();this._initLanguage()},initSecureParameter:function(){(function(){Ext.Ajax.getSecurityToken=function(){var token=Signavio.Helper.getCookie("token");return(token&&32==token.length&&token)||""};Ext.Ajax.getSecurityParameter=function(){return{"signavio-id":Ext.Ajax.getSecurityToken()}};Ext.Ajax.defaultHeaders=Ext.apply({},Ext.Ajax.defaultHeaders||{});Ext.Ajax.request=Ext.Ajax.request.wrap(function(doRequest){var args=$A(arguments).slice(1),token=Ext.Ajax.getSecurityToken();if(token){this.defaultHeaders["x-signavio-id"]=token}else{delete this.defaultHeaders["x-signavio-id"]}return doRequest.apply(this,args)});var setRequestHeaders=Ajax.Request.prototype.setRequestHeaders;Ajax.Request.prototype.setRequestHeaders=function(){setRequestHeaders.apply(this,arguments);this.transport.setRequestHeader("x-signavio-id",Ext.Ajax.getSecurityToken())}}())},getFacade:function(){return{getExtView:function(name){return this._controls[name+"Panel"]}.bind(this),offer:function(option){this._offered.push(option)}.bind(this),switchView:function(key){this._eventManager.raiseEvent.call(this._eventManager,"viewswitch",key)}.bind(this),getTrashRecord:function(){var rootStore=Signavio.Core.StoreManager.getStore("root");return rootStore.findByRepValue("type",Signavio.Config.FOLDER_TYPE.TRASH)}.bind(this),getCurrentRootFolder:function(){var rootStore=Signavio.Core.StoreManager.getStore("root");var folder=this.getCurrentRootFolderStore();return rootStore.findByIdentifier(folder.getIdentifier())}.bind(this),getCurrentFolderStore:function(){return Signavio.Core.StoreManager.getStore("child")}.bind(this),getUserRecord:function(user){if(!this.users){this.users=Signavio.Core.StoreManager.getAllUserStore()}return this.users.findByIdentifier(user)}.bind(this),getCurrentUser:function(){return this._user}.bind(this),getOwnerUser:function(){if(!this.users){this.users=Signavio.Core.StoreManager.getAllUserStore()}return this.users.findByIdentifier(this.config.owner)}.bind(this),isOwnerUser:function(){return this.config.user===this.config.owner}.bind(this),loadStencilSets:function(clb){this.loadStencilSets(clb)}.bind(this),isCurrentUserInGroup:function(id){return this._user&&(this._user.getIdentifier()===id||this._user.getRecords(Signavio.Const.REL.GROUP).any(function(t){return t.get("href")===id||t.get("rep").type===id}))}.bind(this),isCurrentUserAdmin:function(){return this._user&&this._user.getRecords("group").any(function(r){return r.get("rep").isAdminGroup})}.bind(this),isExpired:function(){if(!this.isExpired){this.isExpired=!(this._user.getRecords("info")[0].get("rep").licenses||[]).any(function(r){var d=r.toLowerCase().gsub('"',"");return Signavio.Config.ALL_LICENSES.include(d)})}return this.isExpired}.bind(this),getConfig:this.getConfig.bind(this),getLanguages:this.getLanguages.bind(this),setConfig:this.setConfig.bind(this),getUnusedLicenses:function(type){return(this.config.licenses||[]).findAll(function(l){return !type||l.type.toLowerCase()===type.toLowerCase()})}.bind(this),setUnusedLicenses:function(licenses){this.config.licenses=licenses||[]}.bind(this),isSupportedBrowserEditor:function(){return !!(window.navigator.userAgent.match(this.config.supportedBrowserEditor))&&!Ext.isIECompatibility}.bind(this),isSupportedBrowserQuickModel:function(){return !!(window.navigator.userAgent.match(this.config.supportedBrowserQuickModel))}.bind(this),isFirstStart:function(){return !!this._isFirstStart}.bind(this),askForRefresh:this.askForRefresh.bind(this),showAdministrationPanel:function(index){var win;this._plugins.each(function(p){if(p instanceof Signavio.Core.AdministrationPlugins){win=p.showTab(index||0);throw $break}});return win}.bind(this),raiseEvent:function(foo,bar){if(bar&&bar instanceof Object&&bar.callImmediatly===true){this._eventManager.raiseEventImmediate.apply(this._eventManager,arguments)}else{this._eventManager.raiseEvent.apply(this._eventManager,arguments)}}.bind(this),registerOnEvent:this._eventManager.registerOnEvent.bind(this._eventManager),unregisterOnEvent:this._eventManager.unregisterOnEvent.bind(this._eventManager),registerInitializeFinal:function(callback){this._additionalFinializeCount+=1;this._additionalFinalClb.push(callback)}.bind(this),releaseInitializeFinal:function(){this.finialize()}.bind(this)}},getObjectID:function(obj){if(["department","tenant","user"].include(obj)){switch(obj){case"department":var user=this._user.getRecords("info")[0];if(user&&user.get("rep").department){obj=user.get("rep").department;break}case"tenant":obj=this.config.tenant.split("/").last();break;case"user":obj=this._user.getIdentifier().split("/").last();break}}return obj},getLanguages:function(){return(this.getConfig("department","languages")||"[]").evalJSON(true)},getConfig:function(){if(arguments.length==3||arguments.length==2){var obj=(arguments[0]||"").toLowerCase(),nam=(arguments[1]||"").toLowerCase(),cat=(arguments[2]||"").toLowerCase()||undefined,con=this.config.configuration;if(!obj||!nam){return undefined}obj=this.getObjectID(obj);var rec=con.getRange().find(function(co){var rep=co.get("rep");return rep.object==obj&&rep.name.toLowerCase()==nam&&(!cat||rep.category.toLowerCase()==cat)});if(rec){return rec.get("rep").value}return undefined}else{return Object.clone(this.config||{})}},setConfig:function(obj,name,value,category,type,callback){if(!obj||!name){return false}if("string"!==typeof category||!category){category=undefined}var con=this.config.configuration,fnSuccess,fnFailed;obj=this.getObjectID(obj);if(!type){switch(typeof value){case"boolean":type="boolean";break;case"string":type="string";break;case"number":type=(value===(value|0)?"integer":"decimal");break;default:type="blob"}}var rec=con.getRange().find(function(co){var rep=co.get("rep");return rep.object==obj&&rep.name.toLowerCase()==name.toLowerCase()&&(!category||rep.category.toLowerCase()==category.toLowerCase())});if("function"==typeof callback){fnSuccess=function(){con.un("submitted",fnSuccess);con.un("submitfailed",fnFailed);callback.apply(callback,[].concat(true,arguments))};fnFailed=function(){con.un("submitted",fnSuccess);con.un("submitfailed",fnFailed);callback.apply(callback,[].concat(false,arguments))};con.on("submitted",fnSuccess);con.on("submitfailed",fnFailed)}if(rec){if("undefined"==typeof value){con.remove(rec);con.commitChanges()}else{if(rec.get("rep").value!==value){var rep=Object.clone(rec.get("rep"));rep.value=value;rec.set("rep",rep);con.commitChanges()}}}else{if("undefined"!=typeof value){var rec=Signavio.Core.RecordCreator.create("config","",{name:name,object:obj,category:category,value:value,type:type});con.add(rec);con.commitChanges()}else{if("function"==typeof fnSuccess){fnSuccess(false)}}}return true},getCurrentRootFolderStore:function(){var rootStore=Signavio.Core.StoreManager.getStore("root");var currentStore=Signavio.Core.StoreManager.getStore("child");if(!rootStore||!currentStore){return undefined}var all=Signavio.Core.StoreManager.getAllStores();var getParentStore=function(s){return all.find(function(aa){return !!aa.data.items.find(function(ar){return ar.get("href")===s.getIdentifier()})})};var root,croot=currentStore,i=0;do{root=croot;croot=getParentStore(croot)}while(croot&&croot!=rootStore&&i++<all.length);return root},loadStencilSets:function(clb){if(!this.stencilsets){Signavio.Core.Stores.RequestManager.doRequest(Signavio.Config.STENCILSET_URI,function(result){result=result instanceof Array?result:[];this.stencilsets=result;if(clb instanceof Function){clb(result.clone())}}.bind(this),{},"get",false)}else{if(clb instanceof Function){clb(this.stencilsets.clone())}}},showMask:function(){var s="background:white;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%;z-index:100000;";var ss="left:50%;margin-left:-200px;margin-top:-90px;position:absolute;top:50%;display:none;";var t="<div class='mask-logo' style='"+ss+"'><div><img src='"+Signavio.Config.IMAGE_PATH+"/signavio/signavio_logo.jpg'></div></div>";this.mask=Ext.get(document.createElement("div"));Ext.getBody().appendChild(this.mask);this.mask.addClass("x-mask");this.mask.addClass("x-background-white");this.mask.dom.setAttribute("style",s);this.mask.update(t);var loading="<img style='' src='"+Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif'/>";var t=this.mask.first().first().insertHtml("afterEnd","<span class='mask-text'><span class='mask-title'>"+Signavio.Config.APPLICATION_NAME+"</span> <span class='mask-version'>Version "+Signavio.Core.Version+"</span>"+loading+"</span>",true);this.mask.first().show({duration:0.3})},hideMask:function(){window.setTimeout(function(){if(this.mask){this.mask.first().hide({duration:0.4,remove:true,block:true});this.mask.hide({duration:0.3,remove:true,block:true});delete this.mask}}.bind(this),1000)},askForRefresh:function(){var fn=function(btn){if(btn=="ok"||btn=="yes"){Signavio.Core.StoreManager.reloadChildEntitiesStore()}}.bind(this);var d=Ext.Msg.confirm("Signavio",Signavio.I18N.askForRefresh,fn);d.setIcon("x-window-info");d.getDialog().syncSize()},_finialize:function(){if(--this._finializeCount>0){return}this._additionalFinalClb.each(function(clb){if(clb instanceof Function){clb.call(clb)}});if(this._additionalFinalClb<=0){this.finialize()}},finialize:function(){if(this._finializeCount>0){return}if(--this._additionalFinializeCount>0){return}if(Signavio.Config.HideLeftPanel){this._controls.leftPanel.hide()}this._controls.viewport.doLayout();this._eventManager.raiseEvent("finialize");if(Signavio&&Signavio.Config&&this.getFacade()){Signavio.Config.SUPPORTMAILADDRESS=this.getFacade().getConfig().supportMailAddress}if(!this._plugins||this._plugins.length===0){this.noFeaturesAvailable()}this.hideMask()},noFeaturesAvailable:function(){Ext.Msg.show({title:Signavio.I18N.Repository.noFeaturesTitle,msg:Signavio.I18N.Repository.noFeaturesMsg.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS),icon:Ext.MessageBox.WARNING,closable:false});document.cookie="JSESSIONID=0; expires="+new Date().toGMTString()+"; path=/;"},redirectToLogin:function(){window.location=Signavio.Config.LOGIN_PAGE},_initConfig:function(){this._initStores()},_initStores:function(){var store=Signavio.Core.StoreManager.getCurrentUser();store.on("load",this._initUser,this);var url=Signavio.Config.BACKEND_PATH+Signavio.Config.CONFIG_PATH;RM.doRequest(url,[function(result){this.config=result;if(result&&result.user){var store=Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.CONFIGURATION_PATH,undefined,["config"],{params:{category:Signavio.Config.APPLICATION},callback:function(){store.clearCache();this.config.configuration=store;Signavio.Core.StoreManager.loadCurrentUser(result.user)}.bind(this)});Signavio.Core.StoreManager.deleteStore(store);this._initNumberFormat();if(Signavio.Config.APPLICATION=="explorer"){this._checkForOlderBrowserVersion()}}else{this.redirectToLogin()}}.bind(this),function(result){Ext.Msg.show({title:"Signavio",msg:Signavio.I18N.Repository.loadingFailed,buttons:{ok:"Reload"},fn:function(){window.location=""},icon:Ext.MessageBox.WARNING,width:300}).getDialog().syncSize().el.setStyle("z-index",1000000)}.bind(this)],null,"get")},_initNumberFormat:function(){var conf=this.getFacade().getConfig()||{};var nf=conf.numberFormat;var cur=conf.currency;var formatter=new Signavio.Utils.NumberFormatter(nf,cur);Signavio.Utils.registerNumberFormatterFunctions(formatter)},_getUserName:function(store){var qp=window.location.search.toQueryParams()||{},ck={};document.cookie.split("; ").each(function(param){ck[param.split("=")[0]]=param.split("=")[1]});if(qp.authkey&&ck["purl_label_"+qp.authkey]){var name=ck["purl_label_"+qp.authkey];return name.slice(1,name.length-1)}return store.getRecords("info")[0].get("rep").name||""},_initUser:function(store){store.un("load",this._initUser,this);this._user=store;this._userName=this._getUserName(store);var isGuest=store.getRecords("info")[0].get("rep").isGuestUser||false;if(store.getRecords("info")[0].get("rep").principal=="anonymous"){Signavio.Config.SHOW_LOGIN_LOGOUT=false}var isSsoPossible=!!this.getConfig()["isSsoForModelerPossible"];Signavio.Templates.header.overwrite(this._controls.headerPanel.body,{user:this._userName,isTestSystem:this.config.isTestSystem,isGuest:isGuest,isSsoPossible:isSsoPossible});if(isGuest){var form=this._controls.headerPanel.body.child("form.x-login");if(form){form.dom.onsubmit=function(e){if(e||window.event){Event.stop(e||window.event)}var w=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login",layout:"anchor",modal:true,resizable:false,width:325,title:Signavio.I18N.Repository.Header.loginTitle,items:[new Ext.form.FormPanel({border:false,anchor:"100% 100%",formId:"login",submit:function(){this.getForm().getEl().dom.setAttribute("action",Signavio.Config.LOGIN_PAGE);this.getForm().getEl().dom.submit()},items:[new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldName,width:290,tabIndex:1000,name:"name",value:($("name")||{}).value||"",autoCreate:{tag:"input",type:"text",size:"20"},onRender:function(ct,position){this.originParent=($("name")||{}).parentNode;this.el=Ext.get($("name"));Ext.form.TextField.prototype.onRender.apply(this,arguments)},beforeDestroy:function(){if(this.originParent){this.originParent.appendChild(this.el.dom);this.rendered=false}}}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:290,inputType:"password",tabIndex:1001,name:"password",value:($("password")||{}).value||"",autoCreate:{tag:"input",type:"password",size:"20"},onRender:function(ct,position){this.originParent=($("password")||{}).parentNode;this.el=Ext.get($("password"));Ext.form.TextField.prototype.onRender.apply(this,arguments)},beforeDestroy:function(){if(this.originParent){this.originParent.appendChild(this.el.dom);this.rendered=false}},listeners:{specialkey:function(e,k){if(k.getKey()===k.ENTER){this.ownerCt.ownerCt.buttons[1].handler()}}}}),new Ext.form.Checkbox({boxLabel:Signavio.I18N.Repository.Header.windowFieldRemember,labelSeparator:"",tabIndex:1002,onRender:function(ct,position){this.originParent=($("remember")||{}).parentNode;this.el=Ext.get($("remember"));Ext.form.Checkbox.prototype.onRender.apply(this,arguments)},beforeDestroy:function(){if(this.originParent){this.originParent.appendChild(this.el.dom);this.rendered=false}}})]})],buttons:[new Ext.LinkButton({text:Signavio.I18N.Repository.Header.windowBtnResetPassword,click:function(){var refresh_img=function(){var img=document.getElementById("jcaptcha-img");img.src=img.src+"1"};var ww=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login",layout:"form",modal:true,title:Signavio.I18N.Repository.Header.windowBtnResetPassword,listeners:{show:function(){var link=document.getElementById("jcaptcha-refresh");Ext.EventManager.on(link,"click",refresh_img)},hide:function(){var link=document.getElementById("jcaptcha-refresh");Ext.EventManager.un(link,"click",refresh_img)}},items:[new Ext.form.Label({text:Signavio.I18N.Repository.Header.windowResetPasswordDesc,style:"width:180px;display:block;padding-bottom:10px;"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldName,width:180}),new Ext.form.Label({text:Signavio.I18N.Repository.Header.windowFieldCaptcha+":",style:"width:180px;display:block;margin-top:10px;",cls:"x-form-item x-form-item-label"}),new Ext.Panel({html:'<img src="'+Signavio.Config.JCAPTCHA_PATH+'?v=1" id="jcaptcha-img" alt="security code"/><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/arrow_refresh.png" id="jcaptcha-refresh" alt="reload"/>',height:54,width:180,border:false,cls:"x-captcha-panel"}),new Ext.form.TextField({hideLabel:true,width:180,minLength:5,maxLength:5})],buttons:[{text:Signavio.I18N.Repository.Header.windowBtnSend,handler:function(){var mail=(this.ownerCt.items.get(1).getValue()||"").trim();var cField=this.ownerCt.items.get(4);var captcha=(cField.getValue()||"").trim();if(!mail){return}RM.doPost(Signavio.Config.RESET_PASSWORD_PAGE,[function(){refresh_img();ww.close();Ext.Msg.alert(Signavio.I18N.Repository.Header.windowBtnResetPassword,Signavio.I18N.Repository.Header.windowResetPasswordHintOk).setIcon(Ext.Msg.INFO)},function(e){if(typeof e==="object"&&e.message){Ext.Msg.alert(Signavio.I18N.Repository.Header.windowBtnResetPassword,e.message).setIcon(Ext.Msg.ERROR)}else{Ext.Msg.alert(Signavio.I18N.Repository.Header.windowBtnResetPassword,Signavio.I18N.Repository.Header.windowResetPasswordHintFail.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.Msg.WARNING)}cField.setValue("");refresh_img()}],{mail:mail,jcaptcha:captcha})}},{text:Signavio.I18N.Repository.Header.windowBtnCancel,handler:function(){this.ownerCt.close()},tabIndex:1004}]});ww.show()}}),{text:Signavio.I18N.Repository.Header.windowBtnLogin,tabIndex:1003,handler:function(){var form=this.ownerCt.items.get(0);var password=form.items.get(1);var name=form.items.get(0);if(!(password.getValue()||"").trim()||!(name.getValue()||"").trim()){return}var params={name:name.getValue(),password:password.getValue(),remember:form.items.get(2).getValue()?"on":undefined,tokenonly:true};RM.doPost(Signavio.Config.LOGIN_PAGE+"?"+(Object.toQueryString(params)),[function(result){form.submit()},function(e){var message="";if(e.message){message=e.message===""?Signavio.I18N.Repository.Header.loginError500:e.message}else{message=Signavio.I18N.Repository.Header["loginError"+([401,404,500,423].include(e.status)?e.status:500)].gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)}Ext.Msg.alert(Signavio.I18N.Repository.Header.loginTitle,message).setIcon(Ext.Msg.WARNING)}],{})}},{text:Signavio.I18N.Repository.Header.windowBtnCancel,handler:function(){this.ownerCt.close()},tabIndex:1004}],listeners:{show:function(){if(($("name")||{}).value){window.setTimeout(this.buttons[1].focus.bind(this.buttons[1]),10)}else{window.setTimeout(this.items.get(0).items.get(0).focus.bind(this.items.get(0).items.get(0)),10)}}}}).show();return false}}}var info=store.getRecords("info")[0];if(info.get("rep").isFirstStart&&info.get("rep").principal!="anonymous"){var rep=Object.clone(info.get("rep"));rep.isFirstStart=false;info.set("rep",rep);info.commit();this._isFirstStart=true}this.getFacade().raiseEvent(Signavio.Const.EVENT.USER_LOADED);this._initPlugins();this._finialize()},_initComponents:function(){if(!Signavio.Helper.isIPad()){Ext.QuickTips.init()}Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:1000,dismissDelay:false});this._controls.viewPanel=new Ext.Panel({region:"center",cls:"view_view",layout:"anchor",border:false,margins:{bottom:0}});this._controls.leftPanel=new Ext.Panel({region:"west",cls:"left_view",collapsible:true,collapsed:Signavio.Config.CollapseLeftPanel,collapseMode:(Signavio.Config.LeftPanelCollapsible?"mini":undefined),floatable:true,split:true,width:Signavio.Config.LEFT_PANEL_WIDTH,border:false,hidden:!!Signavio.Config.HideLeftPanel,autoScroll:true});this._controls.rightPanel=new Ext.Panel({region:"east",cls:"right_view",title:Signavio.I18N.Repository.rightPanelTitle,bodyStyle:"overflow:hidden;",header:false,layout:"card",collapsible:true,collapsed:true,collapseMode:"mini",split:true,width:Signavio.Config.RIGHT_PANEL_WIDTH,border:false,plugins:[new Signavio.Extensions.DrawerButtons()]});this._controls.bottomPanel=new Ext.Panel({region:"south",cls:"bottom_view",layout:"anchor",header:false,collapsible:true,title:"",height:200,border:false,split:true});this._controls.toolbarPanel=new Ext.Toolbar({region:"south",cls:"north_view",border:false,height:28});this._controls.headerPanel=new Ext.Panel({region:"center",cls:"header_view",html:Signavio.Templates.header.apply({user:"",isTestSystem:false}),border:false});this._controls.topPanel=new Ext.Panel({region:"north",layout:"border",cls:"north_view",height:63,border:false,items:[this._controls.headerPanel,this._controls.toolbarPanel]});this._controls.viewport=new Ext.Viewport({layout:"border",margins:"0 0 0 0",defaults:{},border:false,items:[this._controls.topPanel,this._controls.viewPanel,this._controls.rightPanel,this._controls.leftPanel,this._controls.bottomPanel]});this._controls.hoverPanel={height:70,facade:this.getFacade(),items:[]}},_initLanguage:function(){var lang=Signavio.I18N.Language;document.documentElement.className+=" "+lang.split("_").concat(lang).uniq().join(" ");var browser=Ext.isIE7?"x-ie x-ie7":(Ext.isIE?"x-ie":(Ext.isGecko?"x-gecko":(Signavio.Helper.isIPad()?"x-ipad":"x-other")));var version=Signavio.Helper.getBrowserVersion();document.documentElement.className+=" "+browser+" "+browser+"-"+version.replace(/\./g,"-")},_initHoverPanel:function(){var plugins=this._controls.hoverPanel.items;if(plugins.length>0){var o=this._controls.hoverPanel;o.items=o.items.map(function(e){return e.panel});this._controls.hoverPanel=new Signavio.Extensions.HoverPanel(o);this._controls.hoverPanel.doLayout();plugins.each(function(p){p.parent=this._controls.hoverPanel;p.afterRender()}.bind(this))}[this._controls.rightPanel,this._controls.bottomPanel].each(function(panel){if(typeof(panel.items)=="undefined"||panel.items.length<=0){panel.hide()}})},_initPlugins:function(){var source=Signavio.Config.PLUGIN_CONFIG;RM.doRequest(source,[function(result){var resultXml=result.responseXML;var plugins=$A(resultXml.getElementsByTagName("plugin")).map(function(p){return{name:p.getAttribute("name"),source:p.getAttribute("source")}}).compact();this._registerPlugins(plugins);this._finialize()}.bind(this),function(e){if(e.status===401){this.redirectToLogin()}}.bind(this)],null,"get",true)},_registerPlugins:function(plugins){var facade=this.getFacade();plugins.each(function(plugin){if(plugin.name==="Signavio.Plugins.Import"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.AMLImportDummy"}))}else{if(plugin.name==="Signavio.Plugins.VisioImport"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.VisioImportDummy"}))}else{if(plugin.name==="Signavio.Plugins.Jpdl4Import"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.Jpdl4ImportDummy"}))}else{if(plugin.name==="Signavio.Plugins.XPDLImport"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.XPDLImportDummy"}))}else{if(plugin.name==="Signavio.Plugins.BPMN2_0Import"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.BPMN2ImportDummy"}))}else{if(plugin.name==="Signavio.Plugins.ArchiveImport"){plugins=plugins.without(plugins.find(function(dummy){return dummy.name==="Signavio.Plugins.ArchiveImportDummy"}))}}}}}}});plugins.each(function(pl){info("Initialize plugin "+pl.name+".");try{if(!pl.name||pl.name.strip().length<=0){return}var className=eval(pl.name);if(className.prototype.enabled){var plugin=new className(facade);this._plugins.push(plugin);info("Plugin "+pl.name+" successfully loaded.")}else{info("Plugin "+pl.name+" is not enabled.")}}catch(e){warn("Plugin "+pl.name+" could not been instanziated.\n"+e)}}.bind(this));info("Finialize the loading of plugins.");this._initHoverPanel();this.getFacade().switchView(Signavio.Config.INITIAL_VIEW);this._plugins.each(function(plugin){if(plugin.handleOffers instanceof Function){plugin.handleOffers(this._offered)}}.bind(this));this._controls.viewport.doLayout()},_checkForOlderBrowserVersion:function(){if(!this.getFacade().isSupportedBrowserEditor()){if(Ext.isIECompatibility){Ext.Msg.alert(Signavio.I18N.Repository.NoBrowserSupport.Title,Signavio.I18N.Repository.NoBrowserSupport.ie9Compatibility).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.NoBrowserSupport.Title,Signavio.I18N.Repository.NoBrowserSupport.Description.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.Msg.INFO).getDialog().syncSize()}}},_appendJSFiles:function(plugins,callback){var prefixURL=Signavio.Config.PLUGIN_PATH+"/";plugins.each(function(plugin){try{var className=eval(plugin.name);if(className){callback(plugin);return}}catch(e){}var head=document.getElementsByTagName("head")[0];var s=document.createElement("script");s.setAttribute("type","text/javascript");s.src=prefixURL+plugin.source;if(navigator.product=="Gecko"){s.onload=callback.bind(callback,plugin)}else{s.onreadystatechange=callback.bind(callback,plugin)}head.appendChild(s)})}};Signavio.Core.Repository=Clazz.extend(Signavio.Core.Repository);var EventManager=Clazz.extend({construct:function(){this.callbacks={}},raiseEvent:function(type){if(type&&this.callbacks[type] instanceof Array){var arg=arguments;this.callbacks[type].each(function(callback){window.setTimeout(function(){callback.apply(callback,arg)},10)})}},raiseEventImmediate:function(type){if(type&&this.callbacks[type] instanceof Array){var arg=arguments;this.callbacks[type].each(function(callback){callback.apply(callback,arg)})}},registerOnEvent:function(type,callback){if(callback instanceof Function){if(!this.callbacks[type]){this.callbacks[type]=[]}this.callbacks[type].push(callback)}},unregisterOnEvent:function(type,callback){if(callback instanceof Function&&this.callbacks[type] instanceof Array&&this.callbacks[type].include(callback)){this.callbacks[type]=this.callbacks[type].without(callback)}}});Signavio.Core.EventManager=EventManager}();Signavio.Core.graft=function(g,f,d,j){j=(j||(f&&f.ownerDocument)||document);var h;if(d===undefined){throw"Can't graft an undefined value"}else{if(d.constructor==String){h=j.createTextNode(d)}else{for(var c=0;c<d.length;c++){if(c===0&&d[c].constructor==String){var a;a=d[c].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i);if(a){h=j.createElementNS instanceof Function?j.createElementNS(g,a[1]):j.createElement(a[1]);h.setAttribute("class",a[2]);continue}a=d[c].match(/^([a-z][a-z0-9]*)$/i);if(a){h=j.createElement(a[1]);continue}h=j.createElement("span");h.setAttribute(null,"class","namelessFromLOL")}if(d[c]===undefined){throw"Can't graft an undefined value in a list!"}else{if(d[c].constructor==String||d[c].constructor==Array){this.graft(g,h,d[c],j)}else{if(d[c].constructor==Number){this.graft(g,h,d[c].toString(),j)}else{if(d[c].constructor==Object){for(var b in d[c]){h.setAttribute(b,d[c][b]);if(b==="class"){h.className=d[c][b]}}}else{}}}}}}}if(f){f.appendChild(h)}else{}return h};if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}var abStore;(function(){Signavio.Plugins.Search={renderToView:"toolbar",enabled:true,render:function(){this.panel=new Ext.Panel({cls:"search_plugin",border:false,layout:"table",layoutConfig:{columns:3},items:[new Ext.Panel({cls:"search_field_left",style:"cursor:pointer;",width:22,heigt:22,border:false,listeners:{render:function(c){c.el.on("click",this.doSearch,this)}.bind(this)}}),new Ext.form.TextField({value:"",id:"search_plugin_field",emptyText:Signavio.I18N.Repository.Offer.search,width:100,listeners:{render:function(d){Ext.QuickTips.register({target:d.getEl(),text:Signavio.I18N.Repository.Offer.searchHintExplorer})},specialkey:function(c,d){if(d.getKey()==d.RETURN){this.doSearch();c.blur();d.preventDefault()}}.bind(this),focus:function(){this.panel.items.get(0).el.addClass("x-focus");this.panel.items.get(1).el.parent().addClass("x-focus");this.panel.items.get(2).el.addClass("x-focus");this.panel.body.addClass("x-focus")}.bind(this),blur:function(){this.panel.items.get(0).el.removeClass("x-focus");this.panel.items.get(1).el.parent().removeClass("x-focus");this.panel.items.get(2).el.removeClass("x-focus");this.panel.body.removeClass("x-focus")}.bind(this)}}),new Ext.Panel({cls:"search_field_right",width:10,heigt:22,border:false})]});var a=Signavio.Core.StoreManager.getRelatedStore(null,"child");a.on("load",function(c){if(c.lastOptions.url.endsWith("search")){this.panel.addClass("activated");this.panel.items.get(1).setValue(c.lastOptions.params.q||"")}else{this.panel.removeClass("activated")}}.bind(this));var b=function(d,c){this.panel.items.get(1).setWidth(Math.max(c-74,45))}.bind(this);this.facade.getExtView("left").on("resize",b);b(null,this.facade.getExtView("left").width)},afterRender:function(){this.parent.addSeparator()},doSearch:function(){var a=Ext.getCmp("search_plugin_field").getValue();if(a.length==0){return}Signavio.Core.StoreManager.getRelatedStore("/search","child",["mod","dir","file"],{force:true,params:{q:a,offset:0,contentmode:"explorer",limit:Signavio.Config.SEARCH_LIMIT}});this.facade.raiseEvent("searchactivated",a);this.panel.addClass("activated")}};Signavio.Plugins.Search=Signavio.Core.ComponentPlugin.extend(Signavio.Plugins.Search)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.JumpToParentFolder={enabled:true,relTypes:["parents"],construct:function(){arguments.callee.$.construct.apply(this,arguments);var c=function(){var d=this.facade.getCurrentRootFolder();return d&&this.facade.getTrashRecord()===d}.bind(this);var b=function(){return c()||this.getSelection().length!==1||this.getSelection()[0].get("rel")!=="mod"||this.getSelection()[0].get("rel")!=="dir"}.bind(this);var a=function(){return !c()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.Offer.jumpToParentFolderTitle,description:Signavio.I18N.Repository.Offer.jumpToParentFolderDescription,icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/filesystems/folder_grey_up.png",functionality:this.jump.bind(this),isDisabled:function(){return !(this.oneSelected()||this.oneDirectorySelected())||this.currentRecordsSet.values().size()==0||!this.currentRecordsSet.values()[0]||this.currentRecordsSet.values()[0].get("rep").length==0}.bind(this),isVisible:this.selectionInSearch.bind(this)});this.facade.offer({isVisible:this.selectionInSearch.bind(this),seperated:true})},jump:function(){var a=this.currentRecordsSet.values()[0].get("rep");if(a.length>0){Signavio.Core.StoreManager.loadChildEntitiesStore(a[0].href)}}};Signavio.Plugins.JumpToParentFolder=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.JumpToParentFolder)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.New={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||this.selectionInSearch()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({cls:"x-menu-large",group:"new",name:Signavio.I18N.Repository.Offer.newTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_add.png",isVisible:function(){return !this.selectionInTrash()&&!this.selectionInSearch()}.bind(this),isDisabled:a,items:[{name:Signavio.I18N.Repository.Offer.newFolderTitle,description:Signavio.I18N.Repository.Offer.newFolderDescription,seperated:true,activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/signavio/new_folder.png",functionality:this.createFolder.bind(this),isVisible:function(){return !this.selectionInInternal()}.bind(this)}],onAdd:function(c){this.menuButton=c;if(this.cacheButtons){this.cacheButtons.each(function(d){c.menu.addMenuItem(d)})}}.bind(this)});if(this.facade.isSupportedBrowserEditor()&&this.hasModelingLicense()){this.facade.offer({relGroup:"edit",index:0,name:Signavio.I18N.Repository.Offer.edit,description:Signavio.I18N.Repository.Offer.editDescription,icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/pencil.png",isDisabled:function(){return this.selectionInTrash()||!this.oneSelected()}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.WRITE],functionality:function(){var c=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:this.getSelection()[0].get("href").split("/")[2]});window.open(c)}.bind(this)})}if(this.hasModelingLicense()){var b=Signavio.I18N.Language.split("_").first();this.facade.loadStencilSets(function(c){if(!this.menuButton){this.menuButton=this.facade.getExtView("toolbar").items.items.find(function(d){return d.offer&&d.offer.group=="new"})}c.each(function(e,d){if(e.visible===false){return}var f={text:e["title_"+b]||e.title,tooltip:e["description_"+b]||e.description,activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+""+e.icon_url,handler:this.createModel.bind(this,Signavio.Config.BACKEND_PATH+"/editorcreate?stencilset="+e.namespace.replace(/#/g,"%23")),offer:{isVisible:function(){return e.namespace==="http://www.signavio.com/stencilsets/processdoctemplate#"?this.selectionInInternal():!this.selectionInInternal()}.bind(this)}};if(!this.menuButton){if(!this.cacheButtons){this.cacheButtons=[]}this.cacheButtons.push(f)}else{if(e.namespace==="http://www.signavio.com/stencilsets/processdoctemplate#"){var g=new Ext.menu.Item(f);this.menuButton.menu.insert(2,g)}else{this.menuButton.menu.addMenuItem(f)}}}.bind(this))}.bind(this))}},afterRender:function(){},hasModelingLicense:function(){try{var a=this.facade.getCurrentUser().getRecords("info")[0].get("rep").licenses||[],b=Signavio.Config.ALL_LICENSES.without(Signavio.Config.QUICKMODEL_LICENSE);return a.any(function(d){return b.include(d)})}catch(c){}return false},createFolder:function(){var a=function(){this.menuButton.menu.un("hide",a);window.setTimeout("Ext.Msg.getDialog().focusEl.focus()",10)}.bind(this);this.menuButton.menu.on("hide",a);Ext.Msg.prompt(Signavio.I18N.Repository.Offer.newWindowFolderTitle,Signavio.I18N.Repository.Offer.newWindowFolderDesc,function(c,e){if(c==="ok"){e=e.trim();if(e.length===0){e=Signavio.I18N.Repository.Offer.newFolderDefaultTitle}var b=Signavio.Core.StoreManager.getStore("child");var d=Signavio.Core.RecordCreator.create(Signavio.Const.REL.DIRECTORY,null,{name:e,description:""});b.add(d,true)}},this,false,Signavio.I18N.Repository.Offer.newFolderDefaultTitle).getDialog()},createModel:function(c){Event.stop(arguments[2]);if(this.facade.isSupportedBrowserEditor()){var a=Signavio.Core.StoreManager.getStore("child");var b=c+"&directory="+a.lastOptions.id;b+="&"+Object.toQueryString(Ext.Ajax.getSecurityParameter());window.open(b);this.facade.askForRefresh()}else{if(Ext.isIECompatibility){Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.ie9Compatibility).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.newFFOnly).setIcon(Ext.Msg.INFO).getDialog().syncSize()}}}};Signavio.Plugins.New=Signavio.Core.Plugin.extend(Signavio.Plugins.New)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var a="      ";Signavio.Plugins.ConfigureProfile={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",name:Signavio.I18N.Repository.Offer.myProfileTitle,description:Signavio.I18N.Repository.Offer.myProfileDesc,arrange:"right",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/vcard_edit.png",functionality:this.show.bind(this),index:1})},show:function(){this.languageWasChanged=false;this.window=new Ext.ux.Window({modal:true,title:Signavio.I18N.Repository.Offer.myProfileTitle,items:[this.getGeneralPanel()],width:440,autoScroll:false,y:50,autoHeight:true,closable:!this.facade.isExpired(),listeners:{close:function(){this.onClose.call(this);this.window.destroy();delete this.window;delete this.languageWasChanged}.bind(this)},cancelButton:{text:Signavio.I18N.Repository.Administration.cancel,handler:function(){this.onCancel.call(this);this.window.close()}.bind(this)},buttons:[{text:Signavio.I18N.Repository.Administration.store,handler:function(){if(this.onSave.call(this,window)!==false){}}.bind(this)}]});this.window.show()},onCancel:function(){var b=Signavio.Core.StoreManager.getStore("cuser");if(b){b.rejectChanges()}},onSave:function(){var b=this.window.items.get(0).items.get(0).items.get(6).getValue();var d=this.window.items.get(0).items.get(0).items.get(7).getValue();if(a!==b&&b.length<6){this.window.items.get(0).items.get(0).items.get(8).body.update(Signavio.I18N.Repository.Administration.resetPasswordDescTooShort);this.window.items.get(0).items.get(0).items.get(6).setValue("");this.window.items.get(0).items.get(0).items.get(7).setValue("");this.window.items.get(0).items.get(0).items.get(6).focus(true,200);return false}if(a!==b&&b!==d){this.window.items.get(0).items.get(0).items.get(8).body.update(Signavio.I18N.Repository.Administration.resetPasswordDescNotSimilar);this.window.items.get(0).items.get(0).items.get(6).setValue("");this.window.items.get(0).items.get(0).items.get(7).setValue("");this.window.items.get(0).items.get(0).items.get(6).focus(true,200);return false}var e=Signavio.Core.StoreManager.getStore("cuser");if(e&&this.window.items.get(0).items.get(0).store.getModifiedRecords().length){e.commitChanges(false,function(c){if(c.status===409){var g=JSON.parse(c.responseText).message.split("\n");var f="";g[g.length-1]=g.last().substring(0,g.last().length-1);if(g.length>2){f="<ul>";for(var h=1;h<g.length;h++){f+="<li>"+g[h]+"</li>"}f+="</ul>"}else{if(g.length==2){f="<div>"+g[1]+"</div>"}}this.window.items.get(0).items.get(0).items.get(8).body.update(f);this.window.items.get(0).items.get(0).items.get(6).setValue("");this.window.items.get(0).items.get(0).items.get(7).setValue("");this.window.items.get(0).items.get(0).items.get(6).focus(true,200)}else{if(this.languageWasChanged===true){location.reload()}this.window.close()}}.bind(this))}else{this.window.close()}return true},onClose:function(b){var d=Signavio.Core.StoreManager.getStore("cuser");if(d){d.purgeListeners()}},getConfig:function(){return this.facade.getConfig()},getGeneralPanel:function(){var b=this.facade.getCurrentUser();var c=["select",{style:"display:none"}];this.getConfig().languages.map(function(e){return[e,Signavio.I18N[e]||e]}).each(function(e){c.push(["option",{value:e[0]},e[1]])});var d=new Signavio.Extensions.FormStorePanel({border:false,cls:"configuration_window_form",store:b,hideButtons:true,labelWidth:140,items:this._getGeneralPanelFormItems(c)});return new Ext.Panel({cls:"x-administration-general",border:false,autoScroll:true,items:[d],height:420})},_getGeneralPanelFormItems:function(c){var b,e,d;e=Signavio.Core.graft("http://www.w3.org/1999/xhtml",null,c);d=new Ext.form.ComboBox({forceSelection:true,fieldLabel:Signavio.I18N.Repository.Administration.fieldLanguage,allowBlank:false,recordRel:"info",dataField:"rep.language",transform:e,triggerAction:"all",lazyRender:true});d.on("change",function(h,g,f){if(g!==f){this.languageWasChanged=true}}.bind(this));b=[new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldTitle,allowBlank:true,recordRel:"info",dataField:"rep.title"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldFirstName,allowBlank:false,recordRel:"info",dataField:"rep.firstName"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldLastName,allowBlank:false,recordRel:"info",dataField:"rep.lastName"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldPrincipal,allowBlank:false,recordRel:"info",dataField:"rep.principal",disabled:true}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldCompany,allowBlank:false,recordRel:"info",dataField:"rep.company"}),d,new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldPassword,inputType:"password",selectOnFocus:true,recordRel:"info",dataField:"rep.password",value:a}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldConfirmPassword,inputType:"password",selectOnFocus:true,recordRel:"info",dataField:"rep.password2",value:a}),new Ext.Panel({html:"",cls:"df-x-form-pw-box",border:false}),this.getLicensePanel(),new Signavio.Extensions.AddedPanel({icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group.png",fieldLabel:Signavio.I18N.Repository.Administration.groups,blankText:Signavio.I18N.Repository.Administration.groupsNo,autoScroll:false,width:200,dataField:"rep",defaultValue:[],recordRel:"group"})];return b.compact()},getLicensePanel:function(){if(!Signavio.Config.SHOW_LICENSE||this.facade.getConfig().mode===Signavio.Config.Mode.ENTERPRISE){return}return new Ext.Panel({fieldLabel:Signavio.I18N.Repository.Administration.fieldLicense,cls:"x-form-item",recordRel:"info",width:400,border:false,dataField:"rep.licenses",disable:function(){if(this.body){this.body.addClass("x-disable")}},enable:function(){if(this.body){this.body.removeClass("x-disable")}},onRender:function(){Ext.Panel.prototype.onRender.apply(this,arguments);this.tpl.overwrite(this.body,{text:"",fieldLabel:this.fieldLabel,width:this.labelWidth||this.ownerCt.labelWidth})},setValue:function(c,d,f,b){if(!b||!b.el){return}var e=((c||[]).sort(function(h){return Signavio.Config.MAIN_LICENSES.indexOf(h)+1||100}).find(function(h){return Signavio.Config.MAIN_LICENSES.include(h)})||"");var g={text:(e&&Signavio.I18N.Repository.Purchase[e])||e,fieldLabel:b.fieldLabel,width:b.labelWidth||b.ownerCt.labelWidth};if(!e&&c){if(this.facade.isCurrentUserAdmin()){g.text="<a href='#'>"+Signavio.I18N.Repository.Administration.upgrade+"</a>"}else{g.text="<i>"+Signavio.I18N.Repository.Administration.upgradeNone+"</i>  <img src='"+Signavio.Config.IMAGE_PATH+"/famfamfam/information.png' style='margin:0 0 0 5px;position:absolute;' ext:qtip='"+Signavio.I18N.Repository.Administration.upgradeDesc+"'/>"}}b.tpl.overwrite(b.body,g);if(!e&&c&&this.facade.isCurrentUserAdmin()){Ext.get(b.body.query("a")[0]).on("click",function(h){this.facade.raiseEvent("open_purchase");Event.stop(h);return false}.bind(this))}}.bind(this),tpl:new Ext.XTemplate('<label class="x-form-item-label" style="width: {width}px;">{fieldLabel}:</label><div style="padding-left:{width+10}px;padding-top:3px;" class="x-form-element">{text}</div><div class="x-form-clear-left"/>'),html:""})}};Signavio.Plugins.ConfigureProfile=Signavio.Core.Plugin.extend(Signavio.Plugins.ConfigureProfile)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.SC_ManageAccessRights={enabled:true,index:30,construct:function(){arguments.callee.$.construct.apply(this,arguments)},generateTab:function(){var d=this.getSelection().length==1?this.getSelection()[0]:this.facade.getCurrentFolderStore();return(this.facade.isCurrentUserAdmin()?new c({facade:this.facade,height:400,selectedNode:d}):undefined)}};Signavio.Plugins.SC_ManageAccessRights=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SC_ManageAccessRights);var c=function(f){f=f||{};var e=f.height||400;this.facade=f.facade;this.folder=new Signavio.Extensions.ModelDirectoryCheckTreePanel({height:e,style:"padding:3px",columnWidth:0.4,root:new Ext.tree.TreeNode({text:"",draggable:false,leaf:false,cls:"folder",dataField:"rep.name",parseText:function(l,k){return k.get("rel")===Signavio.Const.REL.GLOSSARY?Signavio.I18N.Repository.Offer.glossaryTitle:l},identifier:Signavio.Config.DIRECTORY_ALL_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL,Signavio.Const.REL.GLOSSARY],filterFn:function(k){if(this.isModel(k)){return true}else{if(this.isDirectory(k)){return !this.isTrashFolder(k)&&!this.isPrivateFolder(k)&&!this.isInternalFolder(k)}else{if(k.get("rel")===Signavio.Const.REL.GLOSSARY){return true}else{return false}}}}.bind(this),isChildLeaf:function(k){return k.get("rel")===Signavio.Const.REL.MODEL||k.get("rel")===Signavio.Const.REL.GLOSSARY},hasChildCls:function(k){return k.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(k,true):(k.get("rel")===Signavio.Const.REL.DIRECTORY?"folder":"x-glossary")}})},[f.selectedNode].compact());var h=this.folder;this.label=new Ext.Panel({bodyStyle:"margin-bottom:5px;margin-top:10px;height:13px;overflow:visible;",anchor:"100%",border:false,html:Signavio.I18N.Repository.SecurityCenter.accessRightPanelEmpty,update:function(k){if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="rep">'+Signavio.I18N.Repository.SecurityCenter.accessRightPanel+"</tpl>")}if(k.getIdentifier().startsWith("/glossary")){this.tpl.overwrite(this.body,{rep:{name:Signavio.I18N.Repository.Offer.glossaryTitle}})}else{var l=k.getRecords("info")[0];if(l){this.tpl.overwrite(this.body,l.data)}else{if(typeof(h.getSelectedRecord())!=="undefined"){this.tpl.overwrite(this.body,h.getSelectedRecord().data)}}}}});this.rights=new Ext.grid.GridPanel({cls:"x-waiting-panel",store:this.getRightStore(),cm:this.getColumns(),anchor:"100% -73",draggable:false,enableColumnMove:false,enableHdMenu:false,listeners:{render:function(){this.rights.view.on("refresh",function(k){k.mainBody.query("a.x-select-node").each(function(l){Ext.get(l).on("click",function(p){Event.stop(p);var m=l.getAttribute("href").split("#").last().split("/").last();var n=this.folder.getSelectionModel().getSelectedNode();while(n&&!n.attributes.identifier.include(m)){n=n.parentNode}if(n&&n.attributes.identifier.include(m)){this.folder.getSelectionModel().select(n)}}.bind(this))}.bind(this));k.mainBody.query("a.x-delete-node").each(function(l){Ext.get(l).on("click",function(n){Event.stop(n);var q=l.getAttribute("href").split("#").last();var p=this.getRightStore().getAccessStore().data.items.find(function(s){return s.get("href")===q});if(p){var m=this.removeAccessRight.bind(this,this.getRightStore().getAccessStore(),p);if(this.facade.isCurrentUserInGroup(p.get("rep").subject)&&p.get("rep").privilege===Signavio.Config.RIGHTS.SHARE){Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.accessRightRemoveTitle,Signavio.I18N.Repository.SecurityCenter.accessRightRemoveDescWarning,function(r){if(r==="yes"){m()}}.bind(this)).setIcon(Ext.MessageBox.WARNING)}else{Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.accessRightRemoveTitle,Signavio.I18N.Repository.SecurityCenter.accessRightRemoveDesc,function(r){if(r==="yes"){m()}}.bind(this))}}}.bind(this))}.bind(this))}.bind(this))}.bind(this)}});this.addRights=this.getAddRightsPanel();this.purl=this.generatePURLPanel();this.purl.anchor="100% -28";this.purl.bodyStyle="margin-top:5px;border:1px solid #777777;";var g=new Ext.Panel({html:Signavio.I18N.Repository.SecurityCenter.additionalAccessRight,bodyStyle:"margin-top:9px;margin-bottom:1px;height:13px;overflow:visible;",border:false});var d=new Ext.Panel({border:false,layout:"anchor",anchor:"100% 60%",items:[this.label,this.rights,this.addRights]});var j=new Ext.Panel({border:false,layout:"anchor",style:"margin-top:1px;",anchor:"100% 40%",items:[g,this.purl]});f.items=[this.folder,new Ext.Panel({height:e,columnWidth:0.6,bodyStyle:"padding:3px;",layout:"anchor",border:false,items:[d,j]})];c.superclass.constructor.call(this,f);this.initEvent()};Ext.extend(c,Ext.Panel,{layout:"column",title:Signavio.I18N.Repository.SecurityCenter.tabManage,border:false,isModel:function(d){return d.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(d){return d.get("rel")==Signavio.Const.REL.DIRECTORY},isCurrentFolder:function(d){return this.store&&d&&this.store.getIdentifier().include(d.split("/").last())},isTrashFolder:function(d){return d.get("rep").type===Signavio.Config.FOLDER_TYPE.TRASH},isPrivateFolder:function(d){return(d.get("rep")||{}).type===Signavio.Config.FOLDER_TYPE.PRIVATE},isInternalFolder:function(d){return(d.get("rep")||{}).type===Signavio.Config.FOLDER_TYPE.INTERNAL},getRightStore:function(){if(!this.rightStore){this.rightStore=new Ext.data.Store({reader:new a({facade:this.facade}),proxy:new b(),sortInfo:{field:"nameOfSubject",direction:"ASC"},getAccessStore:function(){return this.lastShiftedStore||null},onDestroy:function(){Ext.Panel.prototype.onDestroy.apply(this,arguments);if(this.lastShiftedStore&&this.loadClb){this.lastShiftedStore.un("load",this.loadClb);this.lastShiftedStore.un("remove",this.loadClb);this.lastShiftedStore.un("add",this.loadClb)}},load:function(d){if(this.lastShiftedStore&&this.loadClb){this.lastShiftedStore.un("load",this.loadClb);this.lastShiftedStore.un("remove",this.loadClb);this.lastShiftedStore.un("add",this.loadClb)}Ext.data.Store.prototype.load.apply(this,arguments);this.lastShiftedStore=d;this.loadClb=this.load.bind(this,d);if(this.lastShiftedStore){this.lastShiftedStore.on("load",this.loadClb);this.lastShiftedStore.on("remove",this.loadClb);this.lastShiftedStore.on("add",this.loadClb)}}})}return this.rightStore},getColumns:function(){var d=new Ext.grid.ColumnModel([{width:184,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnUser,dataIndex:"nameOfSubject",renderer:function(f,e,g){return'<div class="x-column-user">'+(g.get("typeOfSubject")===Signavio.Const.REL.USER?'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/user.png"/>':'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/>')+(f||"&nbsp;")+"</div>"}.bind(this)},{width:70,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnRight,dataIndex:"privilegename",renderer:function(g,e,f){return'<span ext:qtip="'+(Signavio.I18N.Repository.Access.Rights[f.get("privilege")]||"")+'">'+(Signavio.I18N.Repository.Access.Rights[f.get("privilege")+"_short"]||g)+"</span>"}},{width:60,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnInherit,dataIndex:"nameOfObject",renderer:function(g,e,f){return this.isCurrentFolder(f.get("object"))?"":'<a href="#'+f.get("object")+'" class="x-select-node">'+g+"</a>"}.bind(this)},{width:69,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnDelete,renderer:function(g,e,f){return this.isCurrentFolder(f.get("object"))?'<a href="#'+f.get("href")+'" class="x-delete-node">'+Signavio.I18N.Repository.SecurityCenter.accessRightColumnEntryDelete+"</a>":""}.bind(this)}]);d.defaultSortable=true;d.defaultWidth=115;d.getTotalWidth=function(){var e=Math.max(Ext.grid.ColumnModel.prototype.getTotalWidth.call(this),0);this.totalWidth=e;return e};return d},generatePURLPanel:function(){var d=this;return new Ext.Panel({cls:"x-div-textbackground x-purl-panel",bodyStyle:"border:1px solid #777777;",autoScroll:true,anchor:"100%",setEditable:function(e){this.el[e?"addClass":"removeClass"]("x-editable")},onDestroy:function(){Ext.Panel.prototype.onDestroy.apply(this,arguments);if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}},beginUpdate:function(){this.el.addClass("x-loading")},update:function(e){var f=false;(this.items||[]).each(function(g){this.remove(g)}.bind(this));if(e){e.getRecords(Signavio.Const.REL.PURL).each(function(g){if(g.get("rep").type==Signavio.Const.PURL.PNG||g.get("rep").type==Signavio.Const.PURL.DISCUSSION){this.add(d.generatePURLEntry(g));f=true}}.bind(this))}if(!f){this.add(new Ext.Panel({border:false,cls:"x-window-security-center-manage-entry x-empty",html:Signavio.I18N.Repository.SecurityCenter.manageEmpty}))}this.doLayout();this.el.removeClass("x-loading");this.initStoreEvents(e)},initStoreEvents:function(e){if(e&&this.lastStore&&e===this.lastStore){return}if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}this.lastStore=e;this.lastClb=this.update.bind(this,e);if(this.lastStore){this.lastStore.on("load",this.lastClb);this.lastStore.on("remove",this.lastClb);this.lastStore.on("add",this.lastClb)}}})},generatePURLEntry:function(e,h){var f='<img src="'+Signavio.Config.IMAGE_PATH+"/famfamfam/"+(e.get("rep").type==Signavio.Const.PURL.PNG?"picture.png":(Signavio.Const.PURL.JSON?"table.png":"comments.png"))+'" />';var g='<span><a href="'+this.getPURLUri(e)+'" target="_blank">'+(e.get("rep").label||Signavio.I18N.Repository.SecurityCenter.Hint[e.get("rep").type])+"</a></span>";if(e.get("rep").type==Signavio.Const.PURL.DISCUSSION){g="<span>"+(e.get("rep").label||Signavio.I18N.Repository.SecurityCenter.Hint[e.get("rep").type])+"</span>"}var d='<a href="#" class="x-remove-entry">'+Signavio.I18N.Repository.SecurityCenter.manageRemove+"</a>";return new Ext.Panel({html:f+" "+g+" "+d,cls:"x-window-security-center-manage-entry",record:e,border:false,afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-remove-entry").each(function(j){j=Ext.get(j);var k=function(){Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.removeInvitationTitle,Signavio.I18N.Repository.SecurityCenter.removeInvitationDesc,function(l,m){if(l==="yes"){j.un("click",k);j.addClass("x-disabled");if(e.store){e.store.remove(e,true)}}})};j.on("mouseover",j.addClass.bind(j,"x-hover"));j.on("mouseout",j.removeClass.bind(j,"x-hover"));j.on("click",k)})}})},getAddRightsPanel:function(){var e=new Ext.data.SimpleStore({fields:["priviledge","name","title"],data:Signavio.Const.ACCESS_TYPES.mod.map(function(f){return[f,Signavio.I18N.Repository.Access.Rights[f]||f,(Signavio.I18N.Repository.Access.Rights[f]||f||"").stripTags()]})});var d=new Ext.Panel({border:false,layout:"column",items:[new Ext.Panel({columnWidth:0.5,layout:"anchor",style:"margin-right:5px",border:false,items:[new Ext.form.DataStoreComboBox({anchor:"100%",disabled:true,tpl:'<tpl for="."><div class="x-combo-list-item x-security-center-cb-user"><tpl if="values.rel == \'user\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/user.png"/></tpl><tpl if="values.rel == \'group\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/></tpl><tpl for="rep">{name}</tpl></div></tpl>',store:Signavio.Core.StoreManager.getAllUserGroupStore(),hideTrigger:false,listWidth:200,forceSelection:true,displayField:"rep.name",valueField:"href",emptyText:Signavio.I18N.Repository.SecurityCenter.accessRightAddUser})]}),new Ext.Panel({columnWidth:0.5,layout:"anchor",border:false,style:"margin-right:5px",items:[new Ext.form.ComboBox({tpl:'<tpl for="."><div class="x-combo-list-item">{name}</div></tpl>',anchor:"100%",listWidth:280,disabled:true,store:e,displayField:"title",valueField:"priviledge",forceSelection:true,typeAhead:true,mode:"local",triggerAction:"all",emptyText:Signavio.I18N.Repository.SecurityCenter.accessRightAddRight,selectOnFocus:true})]}),new Ext.Panel({width:80,border:false,items:[new Ext.Button({text:Signavio.I18N.Repository.SecurityCenter.accessRightAddBtn,disabled:true,handler:function(){var f=d.items.get(0).items.get(0).getValue();var g=d.items.get(1).items.get(0).getValue();if(f===""){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureTitle,Signavio.I18N.Repository.SecurityCenter.accessRightAddInvalidInputUser).setIcon(Ext.Msg.INFO);return}if(g===""){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureTitle,Signavio.I18N.Repository.SecurityCenter.accessRightAddInvalidInputRight).setIcon(Ext.Msg.INFO);return}this.addAccessRight(d.access,f,g);d.items.get(0).items.get(0).setValue();d.items.get(1).items.get(0).setValue()}.bind(this)})]})]});return new Ext.Panel({border:false,hidden:true,update:function(f){d.access=f;d.items.get(0).items.get(0).setDisabled(!f);d.items.get(1).items.get(0).setDisabled(!f);d.items.get(2).items.get(0).setDisabled(!f);var g=f.getIdentifier().slice(1,4);g=g=="glo"?"glos":g;if(Signavio.Const.ACCESS_TYPES[g]){e.loadData(Signavio.Const.ACCESS_TYPES[g].map(function(h){return[h,Signavio.I18N.Repository.Access.Rights[h]||h,(Signavio.I18N.Repository.Access.Rights[h]||h||"").stripTags()]}))}},items:[new Ext.Panel({html:Signavio.I18N.Repository.SecurityCenter.accessRightAddLabel,bodyStyle:"margin:5px 0px;height:13px;overflow:visible;",border:false}),d]})},mask:function(){this.body.mask(Signavio.I18N.Repository.SecurityCenter.accessRightWaiting,"x-waiting-spinner")},unmask:function(){this.body.unmask()},addAccessRight:function(e,d,f){var k;var h=this;var g=function(l){if(l!==false){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureTitle,Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureDesc).setIcon(Ext.Msg.INFO)}e.un("add",k,h);e.un("submitfailed",g,h);h.unmask()};k=function(n,p){g(false);var l=h.facade.isCurrentUserInGroup(j.get("rep").subject);var m=p[0].get("rep");var r=function(s){if(!s){return}s.add(p[0].copy());s.addedRecords=[];s.commitChanges(true)};var q=function(t){if(!t){return}if(l){var s=t.getRecords(Signavio.Const.REL.PRIVILEGE)[0];if(s){s.get("rep").push(m.privilege).uniq();t.commitChanges(true)}}t.getRecords([Signavio.Const.REL.MODEL,Signavio.Const.REL.DIRECTORY]).each(function(u){r(Signavio.Core.StoreManager.getStore(u.get("href")+Signavio.Config.ACCESS_PATH));q(Signavio.Core.StoreManager.getStore(u.get("href")))})};q(h.store)};if(d){this.mask();var j=Signavio.Core.RecordCreator.create("access","",{privilege:f,subject:d.get("href")});e.on("add",k,h);e.on("submitfailed",g,h);e.add(j,true)}},removeAccessRight:function(e,d){var f;var h=this;var g=function(){e.un("submitted",f,h);e.un("submitfailed",g,h);h.unmask()};f=function(k,l){g();var j=h.facade.isCurrentUserInGroup(l.get("rep").subject);var n=function(s){if(!s){return}var p=l.get("href").split("/").slice(2).join("/");var q=s.getRange().find(function(r){return r.get("href").endsWith(p)});if(q){s.remove(q);s.removedRecords=[];s.commitChanges(true)}};var m=function(p){if(!p){return}p.getRecords([Signavio.Const.REL.MODEL,Signavio.Const.REL.DIRECTORY]).each(function(q){n(Signavio.Core.StoreManager.getStore(q.get("href")+Signavio.Config.ACCESS_PATH));m(Signavio.Core.StoreManager.getStore(q.get("href")))})};m(h.store);h.changeEditMode(true)};this.mask();e.on("submitted",f,h);e.on("submitfailed",g,h);e.remove(d,true)},getServer:function(){return window.location.protocol+"//"+window.location.host},getPURLUri:function(d){return this.getServer()+""+d.get("rep").uri+(d.get("rep").type==Signavio.Const.PURL.DISCUSSION?"?":"&")+"authkey="+d.get("rep").authkey},initEvent:function(){this.folder.getSelectionModel().on("selectionchange",this.onSelectionChange,this);var d=Signavio.Core.StoreManager.getAllUserStore();var f=this.rights;var e=function(){f&&f.el&&f.el.unmask();d.un("load",e)};if(d.isLoading){d.on("load",e)}},changeEditMode:function(f){this.addRights.setVisible(f);if(f&&this.addRights.el){this.addRights.doLayout()}this.rights.getColumnModel().setHidden(3,!f);var e=this.rights.getColumnModel().getColumnWidth(1)+this.rights.getColumnModel().getColumnWidth(2)+(f?this.rights.getColumnModel().getColumnWidth(3):0);var d=this.rights.el.getWidth();d=d?d-21:this.rights.getColumnModel().getTotalWidth();this.rights.getColumnModel().setColumnWidth(0,d-e);this.purl.setEditable(f)},onSelectionChange:function(j,f){delete this.store;this.rights.el.mask();var e=f.attributes.identifier;var h=false;if(e.startsWith("/glossary")){h=true}var d=Signavio.Core.StoreManager.getStore(e,true,function(){this.label.update(d);if(h){var l=Signavio.Core.StoreManager.getStore(f.attributes.identifier);this.changeEditMode(l.hasPrivileges([Signavio.Config.RIGHTS.GLOSSARY_SHARE,Signavio.Config.RIGHTS.ALL]))}else{this.changeEditMode(true)}this.store=d;var k=Signavio.Core.StoreManager.getStore(f.attributes.identifier+Signavio.Config.ACCESS_PATH,true,function(){this.getRightStore().load(k);var m=Signavio.Core.StoreManager.getAllUserStore();if(m.isLoading){var p=this.rights.el;p.mask();var n=function(){p.unmask();m.un("load",n)};m.on("load",n)}else{this.rights.el.unmask()}this.addRights.update(k)}.bind(this))}.bind(this));this.purl.beginUpdate();if(h){this.purl.update()}else{var g=Signavio.Core.StoreManager.getStore(Signavio.Config.PRIVATE_URL_PATH+"/"+f.attributes.identifier.split("/").last(),true,function(){this.purl.update(g)}.bind(this))}}});var b=Ext.extend(Ext.data.DataProxy,{load:function(j,d,k,g,f){k=k||function(){};if(this.fireEvent("beforeload",this,f)!==false){try{d.read(f,function(e){this.fireEvent("load",this,e,f,true);k.call(g||this,e,f,true)}.bind(this))}catch(h){this.fireEvent("loadexception",this,f);k.call(g||this,null,f,false);return}}else{k.call(g||this,null,f,false)}}});var a=function(d){d=d||{};this.facade=d.facade;a.superclass.constructor.call(this,d,["subject","typeOfSubject","nameOfSubject","object","typeOfObject","nameOfObject","privilege","privilegename","href"])};Ext.extend(a,Ext.data.JsonReader,{rel:"access",read:function(g,j){var e=this.recordType;var f=[];var d=g.getRecords(this.rel);var h=d.length;d.each(function(k){this.readOneRecord(k,function(l){if(!l){h--}else{f.push(l)}if(h===f.length){j({success:true,records:f,totalRecords:f.length})}})}.bind(this));if(d.length===0){j({success:true,records:f,totalRecords:f.length})}return{success:true,records:f,totalRecords:f.length}},readOneRecord:function(e,l){var d=this.recordType;var k={};k.href=e.get("href");k.subject=e.get("rep").subject;k.typeOfSubject=e.get("rep").typeOfSubject;if(k.typeOfSubject=="user"&&!this.facade.getUserRecord(k.subject)){l(false);return}k.nameOfSubject=k.typeOfSubject=="user"?this.facade.getUserRecord(k.subject).get("rep").name:null;k.privilege=e.get("rep").privilege;k.privilegename=Signavio.I18N.Repository.Access.Rights[k.privilege]||k.privilege;k.object=e.get("rep").object;k.typeOfObject=e.get("rep").typeOfObject;k.nameOfObject=null;var g=function(){if(k.nameOfObject!==null&&k.nameOfSubject!==null){l(new d(k))}};var h=Signavio.Core.StoreManager.getStore(k.object);var f=function(){var m=h.getRecords("info")[0];if(!m){h.on("load",f);return}else{h.un("load",f)}k.nameOfObject=Signavio.I18N.Repository.Folder[m.get("rep").type]||m.get("rep").name;g()};if(!h){h=Signavio.Core.StoreManager.getStore(k.object,true,function(){f()}.bind(this))}else{f()}if(k.nameOfSubject===null){var j=Signavio.Core.StoreManager.getAllGroupStore(function(){var m=j.find("href",k.subject);k.nameOfSubject=m<0?"":j.getAt(m).get("rep").name;g()})}}})})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.SC_ManageExternalRights={enabled:true,index:40,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.hasKerberos=this.facade.getConfig().hasLdapKerberosSupport;this.hasSaaSLdap=this.facade.getConfig("department","sharepointmode","explorer")==="LDAP";this.hasSaaSAzureAD=this.facade.getConfig("department","sharepointmode","explorer")==="AzureAD";this.isActivated=this.hasSaaSLdap||this.hasKerberos||this.hasSaaSAzureAD;if(!this.isActivated){return}},generateTab:function(){var selection=this.getSelection().length==1?this.getSelection()[0]:this.facade.getCurrentFolderStore();return(this.facade.isCurrentUserAdmin()&&this.isActivated?new ManageExternalRights({facade:this.facade,height:400,selectedNode:selection,hasKerberos:this.hasKerberos,hasSaaSLdap:this.hasSaaSLdap,hasSaaSAzureAD:this.hasSaaSAzureAD}):undefined)}};Signavio.Plugins.SC_ManageExternalRights=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SC_ManageExternalRights);var ManageExternalRights=function(attr){attr=attr||{};var height=(attr.height||400)-23;this.facade=attr.facade;this.hasKerberos=attr.hasKerberos;this.hasSaaSLdap=attr.hasSaaSLdap;this.hasSaaSAzureAD=attr.hasSaaSAzureAD;this.folder=new Signavio.Extensions.ModelDirectoryCheckTreePanel({height:height,style:"padding:3px",columnWidth:0.4,root:new Ext.tree.TreeNode({text:"",draggable:false,leaf:false,cls:"folder",dataField:"rep.name",parseText:function(value,r){return r.get("rel")===Signavio.Const.REL.GLOSSARY?Signavio.I18N.Repository.Offer.glossaryTitle:value},identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL,Signavio.Const.REL.GLOSSARY],filterFn:function(r){if(this.isModel(r)){return false}else{if(this.isDirectory(r)){return !this.isTrashFolder(r)&&!this.isPrivateFolder(r)&&!this.isInternalFolder(r)}else{if(r.get("rel")===Signavio.Const.REL.GLOSSARY){return false}else{return false}}}}.bind(this),isChildLeaf:function(r){return r.get("rel")===Signavio.Const.REL.MODEL||r.get("rel")===Signavio.Const.REL.GLOSSARY},hasChildCls:function(r){return r.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(r,true):(r.get("rel")===Signavio.Const.REL.DIRECTORY?"folder":"x-glossary")}})},[attr.selectedNode].compact());this.label=new Ext.Panel({bodyStyle:"margin-bottom:5px;margin-top:10px;height:13px;overflow:visible;",anchor:"100%",border:false,html:Signavio.I18N.Repository.SecurityCenter.tabExternalLabel,update:function(store){if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="rep">'+Signavio.I18N.Repository.SecurityCenter.tabExternalLabelFolder+"</tpl>")}if(store.getIdentifier().startsWith("/glossary")){this.tpl.overwrite(this.body,{rep:{name:Signavio.I18N.Repository.Offer.glossaryTitle}})}else{var info=store.getRecords("info")[0];if(!info){return}this.tpl.overwrite(this.body,info.data)}}});this.rights=new Ext.grid.GridPanel({cls:"x-waiting-panel",store:this.getRightStore(),cm:this.getColumns(),anchor:"100% -73",draggable:false,enableColumnMove:false,enableHdMenu:false,listeners:{render:function(){this.rights.view.on("refresh",function(view){view.mainBody.query("a.x-select-node").each(function(a){Ext.get(a).on("click",function(e){Event.stop(e);var dir=a.getAttribute("href").split("#").last();var node=this.folder.getSelectionModel().getSelectedNode();while(node&&node.attributes.identifier!=dir){node=node.parentNode}if(node&&node.attributes.identifier==dir){this.folder.getSelectionModel().select(node)}}.bind(this))}.bind(this));view.mainBody.query("a.x-delete-node").each(function(a){Ext.get(a).on("click",function(e){Event.stop(e);var id=a.getAttribute("href").split("#").last();var rec=this.getRightStore().getAccessStore().data.items.find(function(r){return r.get("href")===id});if(rec){var clb=this.removeAccessRight.bind(this,this.getRightStore().getAccessStore(),rec);Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.accessRightRemoveTitle,Signavio.I18N.Repository.SecurityCenter.accessRightRemoveDesc,function(btn){if(btn==="yes"){clb()}}.bind(this))}}.bind(this))}.bind(this));if(view.grid.getStore().getCount()===0){view.mainBody.update("<span style='padding:5px; display:block;font-style:italic;color:gray;' class='x-grid-empty'>"+(Signavio.I18N.Repository.SecurityCenter.tabExternalNone)+"</span>")}}.bind(this))}.bind(this)}});this.addRights=this.getAddRightsPanel();attr.items=[new Ext.Panel({anchor:"100%",html:Signavio.I18N.Repository.SecurityCenter.tabExternalDescription,border:false,bodyStyle:"padding:5px;height:13px;"}),new Ext.Panel({anchor:"100% -23",layout:"column",border:false,items:[this.folder,new Ext.Panel({height:height,columnWidth:0.6,bodyStyle:"padding:3px;",layout:"anchor",border:false,items:[this.label,this.rights,this.addRights]})]})];ManageExternalRights.superclass.constructor.call(this,attr);this.initEvent()};Ext.extend(ManageExternalRights,Ext.Panel,{layout:"anchor",title:Signavio.I18N.Repository.SecurityCenter.tabExternal,border:false,isModel:function(record){return record.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(record){return record.get("rel")==Signavio.Const.REL.DIRECTORY},isCurrentFolder:function(id){return this.store&&id&&this.store.getIdentifier()===id},isTrashFolder:function(record){return this.facade.getTrashRecord()&&record.get("href")==this.facade.getTrashRecord().get("href")},isPrivateFolder:function(record){return(record.get("rep")||{}).type===Signavio.Config.FOLDER_TYPE.PRIVATE},isInternalFolder:function(record){return(record.get("rep")||{}).type===Signavio.Config.FOLDER_TYPE.INTERNAL},getRightStore:function(){if(!this.rightStore){this.rightStore=new Ext.data.Store({reader:new RightRecordReader({facade:this.facade}),proxy:new RightStoreProxy(),sortInfo:{field:"nameOfSubject",direction:"ASC"},getAccessStore:function(){return this.lastShiftedStore||null},onDestroy:function(){Ext.Panel.prototype.onDestroy.apply(this,arguments);if(this.lastShiftedStore&&this.loadClb){this.lastShiftedStore.un("load",this.loadClb);this.lastShiftedStore.un("remove",this.loadClb);this.lastShiftedStore.un("add",this.loadClb)}},load:function(store){if(this.lastShiftedStore&&this.loadClb){this.lastShiftedStore.un("load",this.loadClb);this.lastShiftedStore.un("remove",this.loadClb);this.lastShiftedStore.un("add",this.loadClb)}Ext.data.Store.prototype.load.apply(this,arguments);this.lastShiftedStore=store;this.loadClb=this.load.bind(this,store);if(this.lastShiftedStore){this.lastShiftedStore.on("load",this.loadClb);this.lastShiftedStore.on("remove",this.loadClb);this.lastShiftedStore.on("add",this.loadClb)}}})}return this.rightStore},getColumns:function(){var columns=new Ext.grid.ColumnModel([{width:201,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnUser,dataIndex:"nameOfSubject",renderer:function(a,b,rec){return'<div class="x-column-user">'+(rec.get("typeOfSubject")==="externalUser"?'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/user.png"/>':'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/>')+(a||"&nbsp;")+"</div>"}.bind(this)},{width:113,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnInherit,dataIndex:"nameOfObject",renderer:function(value,m,record){return this.isCurrentFolder(record.get("object"))?"":'<a href="#'+record.get("object")+'" class="x-select-node">'+value+"</a>"}.bind(this)},{width:69,header:Signavio.I18N.Repository.SecurityCenter.accessRightColumnDelete,renderer:function(value,m,record){return this.isCurrentFolder(record.get("object"))?'<a href="#'+record.get("href")+'" class="x-delete-node">'+Signavio.I18N.Repository.SecurityCenter.accessRightColumnEntryDelete+"</a>":""}.bind(this)}]);columns.defaultSortable=true;columns.defaultWidth=115;columns.getTotalWidth=function(){return Math.max(Ext.grid.ColumnModel.prototype.getTotalWidth.call(this),0)};return columns},getAddRightsPanel:function(){Ext.PagingToolbar.prototype.paramNames.start="offset";var externalUsers,me2=this;if(this.hasKerberos){externalUsers=new Ext.data.Store({parseValue:Signavio.Core.DataStore.prototype.parseValue,baseParams:{},proxy:new Ext.data.HttpProxy({useAjax:true,method:"GET",headers:{accept:"application/json"},url:((Signavio&&Signavio.Config&&Signavio.Config.BACKEND_PATH)||"/p")+Signavio.Config.EXTERNAL_MANAGEMENT_PATH}),reader:new Ext.ux.data.RecordReader({rels:"external"})});externalUsers.reader.read=function(response){var json=response.responseText;var o=eval("("+json+")");if(!o){throw {message:"JsonReader.read: Json object not found"}}var Record=this.recordType;var records=[],total=-1;o.each(function(rec){if(this.rels.include(rec.rel)){records.push(new Record(rec))}if(rec.rel=="info"&&rec.rep.size){total=rec.rep.size}}.bind(this));return{success:true,records:records,totalRecords:total}}}else{if(this.hasSaaSLdap){externalUsers=new Ext.data.SimpleStore({parseValue:Signavio.Core.DataStore.prototype.parseValue,data:[],fields:["rel","href","rep"],load:function(options){options=options||{};if(this.fireEvent("beforeload",this,options)!==false){this.storeOptions(options);var p=Ext.apply(options.params||{},this.baseParams);var fnName="loadResources"+(Math.round(Math.random()*1000)),url=me2.facade.getConfig("department","sharepointurl","explorer"),query={query:p.q,limit:p.limit||10,offset:p.offset||0,method:fnName};var timeout=window.setTimeout(function(){externalUsers.loadRecords(undefined,options,false);this.fireEvent("loadexception",this,externalUsers)}.bind(this),30*1000);window[fnName]=function(response){delete window[fnName];window.clearTimeout(timeout);if(script&&script.parentNode){script.parentNode.removeChild(script)}var records=$A(response).map(function(rep){if("undefined"!==typeof rep.size){return undefined}rep.id=rep.sid;rep.sourceId="sharepoint";return[rep.type,"",rep]}).compact();var size=$A(response).find(function(r){return"undefined"!==typeof r.size});size=size?size.size:records.length;records=externalUsers.reader.readRecords(records);records.totalRecords=size;externalUsers.loadRecords(records,{add:false,params:p},true)};url+=!url.endsWith("/")?"/":"";url+=!url.include(Signavio.Const.SHAREPOINT_CONNECTOR_SEARCH_PATH)?Signavio.Const.SHAREPOINT_CONNECTOR_SEARCH_PATH+"":"";url=!url.startsWith("http")?"http://"+url:url;var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",url+"?"+Object.toQueryString(query));document.getElementsByTagName("head")[0].appendChild(script);return true}else{return false}}})}else{if(this.hasSaaSAzureAD){externalUsers=this.getExternalStoreForAzureAd()}else{throw new Error("ManageExternalRightsTab needs kerberos or ldad configuration!")}}}var ids=[];var panel=new Ext.Panel({border:false,layout:"column",items:[new Ext.Panel({columnWidth:1,layout:"anchor",style:"margin-right:5px",border:false,items:[new Ext.form.DataStoreComboBox({anchor:"100%",disabled:true,triggerAction:"query",tpl:new Ext.XTemplate('<tpl for="."><div class="{[this.isAlreadyUsed(values)?"x-combo-used":""]} x-combo-list-item x-security-center-cb-user"><tpl if="values.rep.type == \'user\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/user.png"/></tpl><tpl if="values.rep.type == \'group\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/></tpl><tpl for="rep">{name}</tpl></div></tpl>',{isAlreadyUsed:function(rec){return ids.include(rec.rep.sourceId+"#"+rec.rep.id)}}),store:externalUsers,hideTrigger:false,mode:"remote",forceSelection:false,displayField:"rep.name",valueField:"href",pageSize:10,queryParam:"q",emptyText:Signavio.I18N.Repository.SecurityCenter.accessRightAddUser,setValue:function(v){var text="string"==typeof v?v:v.get("rep").name;if(this.store){this.lastSelectionText=text;Ext.form.DataStoreComboBox.superclass.setValue.call(this,text)}this.value=v},getParams:function(q){var p={q:q};if(this.pageSize){p.offset=0;p.limit=this.pageSize+(this.hiddenItems||[]).length}return p},isSelectable:function(record){return !ids.include(record.get("rep").sourceId+"#"+record.get("rep").id)},onSelect:function(record,index){if(!this.isSelectable(record)){return}if(this.fireEvent("beforeselect",this,record,index)!==false){this.setValue(record);this.collapse();this.fireEvent("select",this,record,index)}},initList:function(){Ext.form.DataStoreComboBox.prototype.initList.apply(this,arguments);if(this.pageTb){var count=this.pageSize,me=this;this.pageTb.updateInfo=function(){if(this.displayEl){var total=this.store.getTotalCount(),msg;if("number"==typeof total&&total>=0){msg=total<=count?"":Signavio.I18N.Repository.SecurityCenter.tabExternalPage+" "+String.format(this.displayMsg,Math.ceil((this.cursor+1)/count),Math.ceil(total/count))}else{msg=Signavio.I18N.Repository.SecurityCenter.tabExternalPage+" "+String(Math.ceil((this.cursor+1)/count))}this.displayEl.update(msg);if(!msg){me.assetHeight-=!this.hidden?23:0;this.hide()}else{me.assetHeight+=this.hidden?23:0;this.show()}if(total==-1){this.first.setDisabled(this.cursor==0);this.prev.setDisabled(this.cursor==0);this.next.setDisabled(false);this.last.setDisabled(true)}}}}if(me2.hasSaaSLdap||me2.hasSaaSAzureAD){this.store.un("loadexception",this.collapse,this);this.store.on("loadexception",function(){this.innerList.update("<div style='font-size:11px;font-style:italic;color:gray;padding:4px 5px;'>"+Signavio.I18N.Repository.Configuration.sharepointConnectorFailed+"</div>");this.restrictHeight()},this)}},selectNext:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex<ct-1){var index=this.selectedIndex;while(index<ct-1&&!this.isSelectable(this.store.getAt(++index))){}if(this.isSelectable(this.store.getAt(index))){this.select(index)}}}}},selectPrev:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex!=0){var index=this.selectedIndex;while(index>0&&!this.isSelectable(this.store.getAt(--index))){}if(this.isSelectable(this.store.getAt(index))){this.select(index)}}}}}})]}),new Ext.Panel({width:80,border:false,items:[new Ext.Button({text:Signavio.I18N.Repository.SecurityCenter.accessRightAddBtn,disabled:true,handler:function(){var user=panel.items.get(0).items.get(0).getValue();this.addAccessRight(panel.access,user);panel.items.get(0).items.get(0).setValue("")}.bind(this)})]})]});return new Ext.Panel({border:false,hidden:true,update:function(store,ex){panel.access=store;panel.items.get(0).items.get(0).setDisabled(!store);panel.items.get(1).items.get(0).setDisabled(!store);ids=ex.getRange().map(function(r){return r.get("sourceId")+"#"+r.get("externalId")});panel.items.get(0).items.get(0).lastQuery=-1},items:[new Ext.Panel({html:Signavio.I18N.Repository.SecurityCenter.accessRightAddLabel,bodyStyle:"margin:5px 0px;height:13px;",border:false}),panel]})},getExternalStoreForAzureAd:function(){var externalUsers=new Ext.data.Store({parseValue:Signavio.Core.DataStore.prototype.parseValue,baseParams:{},proxy:new Ext.data.HttpProxy({useAjax:true,method:"GET",headers:{accept:"application/json"},url:Signavio.Config.BACKEND_PATH+Signavio.Config.AZUREADPROXY_PATH}),reader:new Ext.ux.data.RecordReader({rels:"azuread"})});externalUsers.reader.read=function(response){var json=response.responseText;var o=eval("("+json+")");if(!o){throw {message:"JsonReader.read: Json object not found"}}var Record=this.recordType;var records=[],total=-1;o.each(function(rec){if(this.rels.include(rec.rel)){records.push(new Record(rec))}if(rec.rel=="info"&&rec.rep.size){total=rec.rep.size}}.bind(this));return{success:true,records:records,totalRecords:total}};return externalUsers},mask:function(){this.body.mask(Signavio.I18N.Repository.SecurityCenter.accessRightWaiting,"x-waiting-spinner")},unmask:function(){this.body.unmask()},addAccessRight:function(store,user){var onAdd,onFailure,me=this;onFailure=function(a){if(a!==false){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureTitle,Signavio.I18N.Repository.SecurityCenter.accessRightAddFailureDesc).setIcon(Ext.Msg.INFO)}store.un("add",onAdd,me);store.un("submitfailed",onFailure,me);me.unmask()};onAdd=function(s,recs){onFailure(false);var newRec=recs[0].get("rep");var externalUsers=Signavio.Core.StoreManager.getStore(Signavio.Config.EXTERNAL_USERS_PATH);if(externalUsers){var eu=externalUsers.getRange().find(function(r){return r.get("rep").sourceId==user.get("rep").sourceId&&r.get("rep").externalId==user.get("rep").id});if(!eu){var rec2=Signavio.Core.RecordCreator.create("external",newRec.subject,{mail:user.get("rep").email,name:user.get("rep").name,externalId:user.get("rep").id,sourceId:user.get("rep").sourceId});externalUsers.add(rec2);externalUsers.addedRecords=[];externalUsers.commitChanges(true)}else{var rep=Object.clone(eu.get("rep"));rep.name=user.get("rep").name;rep.mail=user.get("rep").email;eu.set("rep",rep);eu.store.commitChanges(true)}}var updateAccess=function(astore){if(!astore){return}astore.add(recs[0].copy());astore.addedRecords=[];astore.commitChanges(true)};var update=function(ustore){if(!ustore){return}ustore.getRecords([Signavio.Const.REL.DIRECTORY]).each(function(child){updateAccess(Signavio.Core.StoreManager.getStore(child.get("href")+Signavio.Config.EXTERNAL_PATH));update(Signavio.Core.StoreManager.getStore(child.get("href")))})};update(me.store);me.onSelectionChange(me.folder.getSelectionModel(),me.folder.getSelectionModel().getSelectedNode());me.changeEditMode(true)};var rec=Signavio.Core.RecordCreator.create("external","",{source:user.get("rep").sourceId,subjectId:user.get("rep").id,name:user.get("rep").name,type:user.get("rep").type});store.on("add",onAdd,me);store.on("submitfailed",onFailure,me);store.add(rec,true);this.mask()},removeAccessRight:function(store,record){var onRemove;var me=this;var onFailure=function(){store.un("submitted",onRemove,me);store.un("submitfailed",onFailure,me);me.unmask()};onRemove=function(s,rec){onFailure();var updateAccess=function(astore){if(!astore){return}var r=astore.find("href",rec.get("href"));if(r>=0){r=astore.getAt(r);astore.remove(r);astore.removedRecords=[];astore.commitChanges(true)}};var update=function(ustore){if(!ustore){return}ustore.getRecords([Signavio.Const.REL.DIRECTORY]).each(function(child){updateAccess(Signavio.Core.StoreManager.getStore(child.get("href")+Signavio.Config.EXTERNAL_PATH));update(Signavio.Core.StoreManager.getStore(child.get("href")))})};update(me.store);me.onSelectionChange(me.folder.getSelectionModel(),me.folder.getSelectionModel().getSelectedNode());me.changeEditMode(true)};store.on("submitted",onRemove,me);store.on("submitfailed",onFailure,me);store.remove(record,true);this.mask()},initEvent:function(){this.folder.getSelectionModel().on("selectionchange",this.onSelectionChange,this)},changeEditMode:function(canEdit){this.addRights.setVisible(canEdit);if(canEdit&&this.addRights.el){this.addRights.doLayout()}this.rights.getColumnModel().setHidden(2,!canEdit);var a=this.rights.getColumnModel().getColumnWidth(1)+(canEdit?this.rights.getColumnModel().getColumnWidth(2):0);var b=this.rights.el.getWidth();b=b?b-21:this.rights.getColumnModel().getTotalWidth();this.rights.getColumnModel().setColumnWidth(0,b-a)},onSelectionChange:function(sm,node){delete this.store;this.rights.el.mask();var identifier=node.attributes.identifier;var isGlossary=false;if(identifier.startsWith("/glossary")){isGlossary=true}var store=Signavio.Core.StoreManager.getStore(identifier,true,function(){this.label.update(store);if(isGlossary){var pStore=Signavio.Core.StoreManager.getStore(node.attributes.identifier);this.changeEditMode(pStore.hasPrivileges([Signavio.Config.RIGHTS.GLOSSARY_SHARE,Signavio.Config.RIGHTS.ALL]))}else{this.changeEditMode(true)}this.store=store;var access=Signavio.Core.StoreManager.getStore(node.attributes.identifier+Signavio.Config.EXTERNAL_PATH,true,function(){var st=this.getRightStore(),loaded=function(){st.un("load",loaded);this.rights.el.unmask();this.addRights.update(access,st)}.bind(this);st.on("load",loaded);st.load(access)}.bind(this))}.bind(this))}});var RightStoreProxy=Ext.extend(Ext.data.DataProxy,{load:function(params,reader,callback,scope,store){callback=callback||function(){};if(this.fireEvent("beforeload",this,store)!==false){try{reader.read(store,function(result){this.fireEvent("load",this,result,store,true);callback.call(scope||this,result,store,true)}.bind(this))}catch(e){this.fireEvent("loadexception",this,store);callback.call(scope||this,null,store,false);return}}else{callback.call(scope||this,null,store,false)}}});var RightRecordReader=function(meta){meta=meta||{};this.facade=meta.facade;RightRecordReader.superclass.constructor.call(this,meta,["subject","typeOfSubject","nameOfSubject","object","typeOfObject","nameOfObject","privilege","privilegename","href","sourceId","externalId"])};Ext.extend(RightRecordReader,Ext.data.JsonReader,{rel:"external",read:function(store,callback){var Record=this.recordType;var records=[];var access=store.getRecords(this.rel);var size=access.length;access.each(function(rec){this.readOneRecord(rec,function(r){if(!r){size--}else{records.push(r)}if(size===records.length){callback({success:true,records:records,totalRecords:records.length})}})}.bind(this));if(size==0){callback({success:true,records:records,totalRecords:records.length})}return{success:true,records:records,totalRecords:records.length}},readOneRecord:function(record,callback){var Record=this.recordType;var o={};o.href=record.get("href");o.subject=record.get("rep").subject;o.typeOfSubject=record.get("rep").typeOfSubject;o.privilege=record.get("rep").privilege;o.privilegename=Signavio.I18N.Repository.Access.Rights[o.privilege]||o.privilege;o.object=record.get("rep").object;o.typeOfObject=record.get("rep").typeOfObject;o.nameOfObject=null;var finish=function(){if(o.nameOfObject!==null&&o.nameOfSubject!==null){callback(new Record(o))}};var objectStore=Signavio.Core.StoreManager.getStore(o.object);var setObject=function(){var info=objectStore.getRecords("info")[0];if(!info){objectStore.on("load",setObject);return}else{objectStore.un("load",setObject)}o.nameOfObject=Signavio.I18N.Repository.Folder[info.get("rep").type]||info.get("rep").name;finish()};var externalUsers=Signavio.Core.StoreManager.getStore(Signavio.Config.EXTERNAL_USERS_PATH,true,function(){var g=externalUsers.find("href",o.subject);if(g>=0){var eus=externalUsers.getAt(g).get("rep");o.nameOfSubject=eus.name;o.sourceId=eus.sourceId;o.externalId=eus.externalId}if(!objectStore){objectStore=Signavio.Core.StoreManager.getStore(o.object,true,function(){setObject()}.bind(this))}else{setObject()}})}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.SC_ManageGroups={enabled:true,index:20,construct:function(){arguments.callee.$.construct.apply(this,arguments)},generateTab:function(){return(this.facade.isCurrentUserAdmin()?new a({facade:this.facade,height:400}):undefined)}};Signavio.Plugins.SC_ManageGroups=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SC_ManageGroups);var a=function(b){b=b||{};this.facade=b.facade;b.items=[this.getPanel()];a.superclass.constructor.call(this,b)};Ext.extend(a,Ext.Panel,{title:Signavio.I18N.Repository.SecurityCenter.tabGroup,layout:"anchor",getPanel:function(){var b=new Signavio.Extensions.AdminPanel({treeTitle:Signavio.I18N.Repository.SecurityCenter.titleGroupTree,hideButtons:true,split:false,treeRootIdentifier:"/usergroup",anchor:"100% 100%",autoWidth:true,treeChildLeaf:true,treeCls:"x-tree-admin-user",treeChildCls:"group",recordRel:"group",dataField:"rep.name",onStoreChange:function(e,d){var c=e&&d&&d.hasPrivileges([Signavio.Config.RIGHTS.GROUP_DELETE,Signavio.Config.RIGHTS.ALL]);b.tree.getTopToolbar().items.items[1][c?"enable":"disable"]()},items:[this.getNamePanel(),this.getParentPanel(),this.getChildPanel()],tbar:[{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group_add.png",hidden:!this.facade.isCurrentUserAdmin()&&!this.facade.getConfig().canCreateGroups,handler:function(){Ext.Msg.prompt(Signavio.I18N.Repository.SecurityCenter.groupAddTitle,Signavio.I18N.Repository.SecurityCenter.groupAddDesc,function(d,e){if(d!=="ok"){return}var c=Signavio.Core.StoreManager.getStore(b.tree.getRootNode().attributes.identifier);this.addGroupRecord(c,{rel:"group",href:"",rep:{name:e||Signavio.I18N.Repository.SecurityCenter.groupAddDefaultName}})}.bind(this))}.bind(this)},{iconCls:"class_bugfixing",disabled:true,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group_delete.png",enableToggle:false,handler:function(){var c=b.tree.getSelectionModel().getSelectedNode();if(!c){return}Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.groupDeleteTitle,Signavio.I18N.Repository.SecurityCenter.groupDeleteDesc,function(e,f){if(e=="yes"){var d=Signavio.Core.StoreManager.getStore(c.parentNode.attributes.identifier);this.removeGroupRecord(d,c);if(b.form){b.form.setStore()}}}.bind(this))}.bind(this)},{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/arrow_refresh_small.png",handler:function(){b.tree.loader.cachedStores.each(function(c){Signavio.Core.StoreManager.reload(c)});if(b.form){b.form.setStore()}if(b.tree){b.tree.getSelectionModel().clearSelections()}}.bind(this)}],parseText:function(d,c){if(typeof d==="string"){return Signavio.Utils.escapeHTML(d)}return d}});this.panel=b;return b},getNamePanel:function(){var b=false;return new Ext.Panel({border:false,width:455,layout:"form",border:false,recordRel:"info",dataField:"rep.name",labelWidth:150,disable:function(){this.items.get(0).disable();this.items.get(1).disable()},enable:function(){this.items.get(0).enable();this.items.get(1).enable()},setValue:function(d,f,c){this.items.get(0).setValue(d);this.ownerCt.removeDirty(this.items.get(0));var e=f&&f.hasPrivileges([Signavio.Config.RIGHTS.GROUP_CHANGE,Signavio.Config.RIGHTS.ALL])?true:false;if(c&&c.length>0&&["AdminGroup","UsersRootNode"].include(c[0].get("rep").type)){e=false}this.changeEditMode(e)},changeEditMode:function(c){this.items.get(0).setWidth(215+(!c?85:0));this.items.get(1).setVisible(c);if(this.items.get(0).el){this.items.get(0).el.dom.readOnly=!c}},items:[new Ext.form.TextField({width:215+(!b?85:0),fieldLabel:Signavio.I18N.Repository.SecurityCenter.groupFormName,emptyText:Signavio.I18N.Repository.SecurityCenter.groupFormNameEmpty,readOnly:!b,listeners:{change:function(h,g){var e=h.ownerCt;var d=e.ownerCt;d[g===String(e.originalValue)?"removeDirty":"setDirty"](h);if(e.dataField&&d.store){var c=d.store.getRecords(e.recordRel)[0]||d.store.getAt(0);var f=Object.clone(c.get("rep"));f[e.dataField.split(".").last()]=g;c.set("rep",f)}}}}),new Ext.Button({style:"left:375px;position:absolute;top:0;width:auto;",width:80,hidden:!b,text:Signavio.I18N.Repository.SecurityCenter.groupFormChangeNameBtn,handler:function(d){var e=d.ownerCt;var c=e.ownerCt;if(c.store){c.store.commitChanges()}}.bind(this)})]})},getChildPanel:function(){var d=false;var f=this;var b;var e=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.groupFormChildGroup+":",style:"font-size:12px;position:absolute;text-align:right;width:150px;top:1px;left:0px;z-index:30000;"});var c=new Ext.Panel({cls:"x-div-textbackground x-purl-panel",bodyStyle:"border:1px solid #777777;",style:"padding-left:155px;background-color:transparent;",autoScroll:true,height:200,anchor:"100%",recordRel:["user","cgroup"],dataField:"rep.name",onRender:function(){Ext.Panel.prototype.onRender.apply(this,arguments);this.update()},onDestroy:function(){Ext.Panel.prototype.onDestroy.apply(this,arguments);if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}},beginUpdate:function(){if(this.el){this.el.addClass("x-loading")}},update:function(h){if(!this.el){return}var l=false;(this.items||[]).each(function(m){this.remove(m)}.bind(this));var k=function(m){f.removeUserFromGroup(b,m)}.bind(this);var j=function(n){var m=c.ownerCt.ownerCt.ownerCt.tree.root.childNodes.find(function(p){return p.attributes.identifier===n});if(m){f.panel.tree.getSelectionModel().select(m)}}.bind(this);if(h){h.getRecords(this.recordRel).each(function(m){this.add(f.getChildEntryPanel(m,k,j));l=true}.bind(this))}if(!l){this.add(new Ext.Panel({border:false,cls:"x-window-security-center-manage-entry x-empty",html:Signavio.I18N.Repository.SecurityCenter.groupFormChildGroupEmpty}))}this.doLayout();this.el.removeClass("x-loading");this.initStoreEvents(h)},initStoreEvents:function(h){if(h&&this.lastStore&&h===this.lastStore){return}if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}this.lastStore=h;this.lastClb=this.update.bind(this,h);if(this.lastStore){this.lastStore.on("load",this.lastClb);this.lastStore.on("remove",this.lastClb);this.lastStore.on("add",this.lastClb)}}});var g=new Ext.Panel({border:false,layout:"column",style:"margin-top:4px;",hidden:!d,items:[new Ext.Panel({columnWidth:1,layout:"anchor",style:"margin-right:5px",border:false,layout:"form",labelWidth:150,items:[new Ext.form.DataStoreComboBox({fieldLabel:Signavio.I18N.Repository.SecurityCenter.groupFormAddChildGroup,anchor:"100%",tpl:'<tpl for="."><div class="x-combo-list-item x-security-center-cb-user"><tpl if="values.rel == \'user\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/user.png"/></tpl><tpl if="values.rel == \'group\'"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/></tpl><tpl for="rep">{name}</tpl></div></tpl>',store:Signavio.Core.StoreManager.getAllUserGroupStore(),forceSelection:true,displayField:"rep.name",valueField:"href",emptyText:Signavio.I18N.Repository.SecurityCenter.groupFormAddChildGroupEmpty})]}),new Ext.Panel({width:80,border:false,items:[new Ext.Button({text:Signavio.I18N.Repository.SecurityCenter.groupFormAddBtn,handler:function(){var h=g.items.get(0).items.get(0).getValue();if(!h){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.groupFormAddWarningTitle,Signavio.I18N.Repository.SecurityCenter.groupFormAddWarningDesc).setIcon(Ext.Msg.INFO);return}f.addUserToGroup(b,h);g.items.get(0).items.get(0).setValue()}.bind(this)})]})]});return new Ext.Panel({border:false,width:455,recordRel:c.recordRel,dataField:c.dataField,disable:function(){c.disable();g.items.get(0).items.get(0).disable();g.items.get(1).items.get(0).disable()},enable:function(){c.enable();g.items.get(0).items.get(0).enable();g.items.get(1).items.get(0).enable()},setValue:function(j,l,h){c.beginUpdate();c.update(l);b=l;g.items.get(0).items.get(0).setValue("");var k=l&&l.hasPrivileges([Signavio.Config.RIGHTS.GROUP_ADD,Signavio.Config.RIGHTS.ALL])?true:false;var m=l&&l.hasPrivileges([Signavio.Config.RIGHTS.GROUP_REMOVE,Signavio.Config.RIGHTS.ALL])?true:false;if(l instanceof Signavio.Core.DataStore&&["UsersRootNode"].include(l.getRecords("info")[0].get("rep").type)){k=m=false}this.changeEditMode(k,m)},changeEditMode:function(h,j){g.setVisible(h);if(h&&g.el){g.doLayout()}if(c.el){c.el[j?"addClass":"removeClass"]("x-editable")}},items:[e,c,g]})},getChildEntryPanel:function(c,g,f){var d='<img src="'+Signavio.Config.IMAGE_PATH+"/famfamfam/"+(c.get("rel")===Signavio.Const.REL.USER?"user.png":"group.png")+'" />';var e="<span>"+(c.get("rel")===Signavio.Const.REL.USER?c.get("rep").name:'<a href="#" class="x-select-group">'+(c.get("rep").name)+"</a>")+"</span>";var b='<a href="#" class="x-remove-entry">'+Signavio.I18N.Repository.SecurityCenter.groupFormRemoveGroup+"</a>";return new Ext.Panel({html:d+" "+e+" "+b,cls:"x-window-security-center-manage-entry",record:c,border:false,afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-remove-entry").each(function(h){h=Ext.get(h);var j=function(k){Event.stop(k);h.un("click",j);h.addClass("x-disabled");g(c)};h.on("mouseover",h.addClass.bind(h,"x-hover"));h.on("mouseout",h.removeClass.bind(h,"x-hover"));h.on("click",j)});this.el.query("a.x-select-group").each(function(h){h=Ext.get(h);var j=function(k){Event.stop(k);f(c.get("href"))};h.on("click",j)})}})},getParentPanel:function(){var d=this;var c=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.groupFormParentGroup+":",style:"font-size:12px;position:absolute;text-align:right;width:150px;top:3px;left:0px;z-index:30000;"});var b=new Ext.Panel({cls:"x-div-textbackground x-groups-parent ",bodyStyle:"border:1px solid #777777; margin-bottom:4px; min-height:17px; line-height:17px; max-height:100px;",style:"padding-left:155px;background-color:transparent;",autoScroll:true,maxHeight:150,anchor:"100%",recordRel:["group"],dataField:"rep.name",onRender:function(){Ext.Panel.prototype.onRender.apply(this,arguments);this.update()},onDestroy:function(){Ext.Panel.prototype.onDestroy.apply(this,arguments);if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}},beginUpdate:function(){if(this.el){this.el.addClass("x-loading")}},update:function(e){if(!this.el){return}var g=false;(this.items||[]).each(function(h){this.remove(h)}.bind(this));var f=function(j){var h=b.ownerCt.ownerCt.ownerCt.tree.root.childNodes.find(function(k){return k.attributes.identifier===j.get("href")});if(h){d.panel.tree.getSelectionModel().select(h)}};if(e){e.getRecords(this.recordRel).each(function(h,j){if(j!==0){this.add(new Ext.form.Label({text:", "}))}this.add(new Ext.LinkButton({style:"padding-left:20px;position:relative;",html:'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png" style="position:absolute;left:0px;top:0px;"/> '+h.get("rep").name,click:f.bind(this,h)}));g=true}.bind(this))}if(!g){this.add(new Ext.form.Label({cls:"x-window-security-center-manage-entry x-empty",text:Signavio.I18N.Repository.SecurityCenter.groupFormParentGroupEmpty}))}this.doLayout();this.el.removeClass("x-loading")},initStoreEvents:function(e){if(e&&this.lastStore&&e===this.lastStore){return}if(this.lastStore&&this.lastClb){this.lastStore.un("load",this.lastClb);this.lastStore.un("remove",this.lastClb);this.lastStore.un("add",this.lastClb)}this.lastStore=e;this.lastClb=this.update.bind(this,e);if(this.lastStore){this.lastStore.on("load",this.lastClb);this.lastStore.on("remove",this.lastClb);this.lastStore.on("add",this.lastClb)}}});return new Ext.Panel({border:false,width:455,recordRel:b.recordRel,dataField:b.dataField,disable:function(){b.disable()},enable:function(){b.enable()},setValue:function(f,g,e){b.beginUpdate();b.update(g)},items:[c,b]})},addUserToGroup:function(c,b){if(!(c instanceof Signavio.Core.UserGroupStore)){return}c.addAsParent(b)},removeUserFromGroup:function(c,b){if(!(c instanceof Signavio.Core.UserGroupStore)){return}c.removeAsParent(b)},addGroupRecord:function(c,g){if(!c||!g||g.rel===undefined||g.rep===undefined||g.href===undefined){return}var e=Ext.data.Record.create(["rel","href","rep"]);var b=new e({rel:g.rel,href:g.href,rep:g.rep});this.panel.form.setWaiting(true);var h,f=this;var d=function(){f.panel.form.setWaiting(false);c.un("add",h);c.un("submitfailed",d)};h=function(k,j){d();[Signavio.Core.StoreManager.getAllUserGroupStore(),Signavio.Core.StoreManager.getAllGroupStore()].each(function(l){if(!l){return}l.add(j);l.addedRecords=[];l.removedRecords=[];l.commitChanges(true)})};c.on("add",h);c.on("submitfailed",d);c.add(b,true)},removeGroupRecord:function(b,e){var g=b.findByIdentifier(e.attributes.identifier);if(g){this.panel.form.setWaiting(true);var f,d=this;var c=function(){d.panel.form.setWaiting(false);b.un("submitted",f);b.un("submitfailed",c)};f=function(k,l){c();var j=[Signavio.Core.StoreManager.getAllUserGroupStore(),Signavio.Core.StoreManager.getAllGroupStore()];var h=Signavio.Core.StoreManager.getStore(l.get("href"),true,function(){h.getRecords(["group","user","cgroup"]).each(function(m){j.push(Signavio.Core.StoreManager.getStore(m.get("href")))});j.each(function(m){if(!m){return}var n=m.findByIdentifier(l.get("href"));if(n){m.remove(n);m.addedRecords=[];m.removedRecords=[];m.commitChanges(true)}})})};b.on("submitted",f);b.on("submitfailed",c);b.remove(g,true)}}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.SC_ManageUsers={enabled:true,index:10,construct:function(){arguments.callee.$.construct.apply(this,arguments)},generateTab:function(){return(this.facade.isCurrentUserAdmin()?new a({facade:this.facade,height:400},this):undefined)}};Signavio.Plugins.SC_ManageUsers=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SC_ManageUsers);var a=function(b,c){b=b||{};this.facade=b.facade;this.plugin=c;b.items=[this.getPanel()];a.superclass.constructor.call(this,b)};Ext.extend(a,Ext.Panel,{title:Signavio.I18N.Repository.SecurityCenter.tabUser,layout:"anchor",getPanel:function(){var d=this;this.filterBox=this.getFilterTextbox();var b=new Signavio.Extensions.AdminPanel({treeTitle:Signavio.I18N.Repository.SecurityCenter.titleUsersTree,hideButtons:true,split:false,treeRootIdentifier:Signavio.Config.USER_PATH,anchor:"100% 100%",autoWidth:true,treeChildLeaf:true,treeCls:"x-tree-admin-user x-waiting-panel",hasChildCls:function(e){var f=e.get("rep").licenses;if(Signavio.Helper.isQuickModelUser(f)){return"userquickmodel"}else{if(Signavio.Helper.isApiAccessUser(f)){return"userapiaccess"}else{return"user"}}},recordRel:"user",dataField:"rep.name",parseText:function(g,e){var j=e.get("rep"),k="",h="",f="";g=Signavio.Utils.escapeHTML(g);if(j.isAlwaysGrantedAccess){k=Signavio.I18N.Repository.Administration.isAlwaysGrantedAccessTooltip;g+='<span title="'+k+'" style="font-size:11px;color:gray;">*</span>'}g+=j.company?" ("+j.company+")":"";if(!Signavio.Helper.hasAnyValidLicense(j.licenses)){h="font-style:italic;color:gray"}else{if(j.hasLoggedInInCurrentMonth===false&&j.isAlwaysGrantedAccess!==true){h="color:gray;"}else{if(j.isDeleted){g="<s>"+g+"</s>";h="font-style:italic;color:gray"}}}return'<span title="'+k+'" style="'+h+'" >'+g+"</span>"},onStoreChange:function(g,f){b.tree.getTopToolbar().items.items[0][g&&f&&f.hasPrivileges([Signavio.Config.RIGHTS.USER_DELETE,Signavio.Config.RIGHTS.ALL])?"enable":"disable"]();var e=!!(f&&f.hasPrivileges([Signavio.Config.RIGHTS.USER_CHANGE,Signavio.Config.RIGHTS.ALL]));[0,1,2,3,5,6].each(function(h){this.form.items.get(h).setDisabled(!e)}.bind(this));this.form.items.get(4).setVisible(e);this.form.showButtons(false)},items:[new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldTitle,allowBlank:true,disabled:true,recordRel:"info",dataField:"rep.title",width:300}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldFirstName,allowBlank:true,disabled:true,recordRel:"info",dataField:"rep.firstName",width:300}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldLastName,allowBlank:true,disabled:true,recordRel:"info",dataField:"rep.lastName",width:300}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldPrincipal,disabled:true,dataField:"rep.principal",recordRel:"info",width:300,readOnly:true}),new Ext.LinkButton({text:Signavio.I18N.Repository.Administration.btnPasswortReset,style:"display:block;margin-bottom:8px;margin-left:110px;margin-top:-2px;width:300px;",recordRel:"info",hidden:true,dataField:"rep.principal",setValue:function(e){this.value=e;this[e?"enable":"disable"]()},click:function(e){if(!e.value){return}Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.AUTHENTICATED_RESET_PASSWORD_PAGE,[function(){Ext.Msg.alert(Signavio.I18N.Repository.Header.windowBtnResetPassword,Signavio.I18N.Repository.Header.windowResetPasswordHintOk).setIcon(Ext.Msg.INFO).getDialog().syncSize()},function(f){Ext.Msg.alert(Signavio.I18N.Repository.Header.windowBtnResetPassword,Signavio.I18N.Repository.Header.windowResetPasswordHintFail.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.Msg.WARNING).getDialog().syncSize()}],{mail:e.value})}}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldCompany,disabled:true,width:300,dataField:"rep.company",recordRel:"info"}),this.getGroupsPanel(),new Ext.form.Checkbox({fieldLabel:Signavio.I18N.Repository.Administration.isAlwaysGrantedAccess,boxLabel:Signavio.I18N.Repository.Administration.isAlwaysGrantedAccessDescription,width:300,dataField:"rep.isAlwaysGrantedAccess",recordRel:"info",ctCls:"x-checkbox-special-box-label",listeners:{render:function(e){if(this.facade.getConfig().mode.toLowerCase()!=="enterprise"||!this.facade.getConfig().hasMonthlyConcurrentLicenses){e.el.parent(".x-form-item").setDisplayed(false)}}.bind(this)},isDisabled:function(h,g){if(g){var e=g.store;var f=e.getRecords("info")[0].get("rep");return e.getRecords("group").invoke("get","rep").pluck("isAdminGroup").any()||f.licenses.indexOf(Signavio.Config.API_ACCESS_LICENSE)>=0||f.licenses.indexOf(Signavio.Config.SPREADSHEET_LICENSE)>=0}}}),(Signavio.Config.SHOW_LICENSE?this.getLicensePanel():undefined)].compact(),tbar:[{iconCls:"class_bugfixing",disabled:true,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/user_delete.png",enableToggle:false,handler:function(){var e=b.tree.getSelectionModel().getSelectedNode();if(!e){return}Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.removeUserTitle,Signavio.I18N.Repository.SecurityCenter.removeUserDesc,function(g,h){if(g=="yes"){var f=Signavio.Core.StoreManager.getStore(e.parentNode.attributes.identifier);this.removeUserRecord(f,e);if(b.form){b.form.setStore()}}}.bind(this))}.bind(this)},{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/arrow_refresh_small.png",handler:this.refreshStore.bind(this)},new Ext.Toolbar.Spacer({}),new Ext.Toolbar.Spacer({}),new Ext.Toolbar.Spacer({}),this.filterBox,new Ext.Toolbar.Spacer({}),new Ext.Toolbar.Spacer({}),new Ext.Toolbar.Spacer({}),{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/email.png",handler:function(){var e=b.tree.root.attributes.store.getRange().map(function(g){var f=g.get("rep").mail;if(!f||!f.match(Signavio.Const.MAIL_VALIDATOR)){return undefined}return f}).compact();(new Ext.ux.Window({title:Signavio.I18N.Repository.Administration.mailToAllTitle,description:Signavio.I18N.Repository.Administration.mailToAllUsers,modal:true,width:300,resizable:false,items:[new Ext.form.TextArea({value:e.join(";\n"),anchor:"100%",height:"100px",selectOnFocus:true,style:"margin-top:10px;"})]})).show()}.bind(this)}]});var c=(function(){var e=b.tree.root.childNodes.length;b.tree.setTitle(b.treeTitle+(e>0?" ("+e+")":""))});b.tree.loader.on("load",function(){d.filterUserList(d.filterBox);c()});b.tree.on("remove",c);b.tree.on("add",c);b.tree.getSelectionModel().on("selectionchange",function(f,e,g){if(e){this.panel.tree._selectedNode=e.attributes.identifier}}.bind(this));b.on("destroy",function(){b.tree.getSelectionModel().purgeListeners();b.tree.loader.purgeListeners();b.tree.purgeListeners();b.purgeListeners();this.filterBox.purgeListeners()}.bind(this));[0,1,2,3,5,7].each(function(e){this.form.items.get(e).on("render",function(g){var f=function(){var j=this.form.store;var h=!!(j&&j.hasPrivileges([Signavio.Config.RIGHTS.USER_CHANGE,Signavio.Config.RIGHTS.ALL]));var k=[0,1,2,3,5,7].findAll(function(l){var m=this.form.items.get(l);return m.originalValue!==m.el.dom.value}.bind(this));this.form.showButtons(h&&k.length>0)}.bind(this);if(this.form.items.get(g) instanceof Ext.form.Checkbox){}else{this.form.items.get(g).on("check",f);this.form.items.get(g).el.on("keyup",f)}}.bind(this,e))}.bind(b));this.panel=b;b.form.on("render",function(){var e=this.getUserRegitrationLink();if(e){b.form.add(e)}},this);return b},refreshStore:function(){this.panel.tree.loader.cachedStores.each(function(b){Signavio.Core.StoreManager.reload(b)});if(this.panel.form){this.panel.form.setStore();this.panel.form.showButtons(false)}if(this.panel.tree){this.panel.tree.getSelectionModel().clearSelections()}},getFilterTextbox:function(b){var c=new Ext.form.TextField({emptyText:Signavio.I18N.Repository.SecurityCenter.search,width:116,cls:"x-no-clear-input"});c.on("render",function(d){var e=document.createElement("img");if(Ext.isIE6){e.setAttribute("src",Signavio.Config.IMAGE_PATH+"/signavio/s.gif");$(e).setStyle("filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Signavio.Config.IMAGE_PATH+"/fugue/icons/cross-small.png',sizingMethod='image');background:none !important; margin-top: -1px;")}else{e.setAttribute("src",Signavio.Config.IMAGE_PATH+"/fugue/icons/cross-small.png");e.style.marginTop="-1px"}var f=document.createElement("a");f.appendChild(e);f.className="filterLink";d.el.dom.parentNode.appendChild(f);Ext.get(f).on("click",function(g){c.setValue("")})}.bind(this));c.on("valid",this.filterUserList.bind(this));c.on("specialkey",function(e,d){if(d.getKey()===Ext.EventObject.ENTER){this.refreshStore()}}.bind(this));return c},filterUserList:function(b){var c=!b?[""]:b.getValue().toLowerCase().match(/[a-z0-9:]*/ig).filter(function(d){return !!d});if(c.length>0&&c[0].startsWith(Signavio.Const.COMMANDS.FILTER_ROOTGROUPUSERS)){if(this.panel.tree.root.attributes.store.getIdentifier()!==Signavio.Config.ROOTGROUPUSER_PATH){this.panel.tree.root.attributes.store.reload({id:Signavio.Config.ROOTGROUPUSER_PATH,url:Signavio.Config.BACKEND_PATH+Signavio.Config.ROOTGROUPUSER_PATH});return}if(c[0].length>Signavio.Const.COMMANDS.FILTER_ROOTGROUPUSERS.length){c[0]=c[0].replace(Signavio.Const.COMMANDS.FILTER_ROOTGROUPUSERS,"")}else{c=c.slice(1,c.length)}}else{if(this.panel.tree.root.attributes.store.getIdentifier()!==Signavio.Config.USER_PATH){this.panel.tree.root.attributes.store.reload({id:Signavio.Config.USER_PATH,url:Signavio.Config.BACKEND_PATH+Signavio.Config.USER_PATH});return}}this.panel.tree.root.attributes.store.filterBy(function(d){var e=d.get("rep");return e&&c.all(function(f){return(e.company||"").toLowerCase().include(f)||(e.name||"").toLowerCase().include(f)})}.bind(this));this.panel.tree.root.childNodes.each(function(d){if(d.text.length>0&&c.all(function(e){return d.text.toLowerCase().include(e)})){d.ui.show()}else{d.ui.hide()}});if(this.panel.tree.root.childNodes.findAll(function(d){return !d.hidden}).length===0){if(!this.userSearchEmptyText){this.userSearchEmptyText=document.createElement("span");this.userSearchEmptyText.setAttribute("class","y-user-select-empty-text");this.userSearchEmptyText.textContent=Signavio.I18N.Repository.SecurityCenter.userSearchEmptyText}this.panel.tree.body.dom.appendChild(this.userSearchEmptyText)}else{if(this.userSearchEmptyText&&this.userSearchEmptyText.parentNode){this.panel.tree.body.dom.removeChild(this.userSearchEmptyText)}}this.reselectUserAfterLoad()},reselectUserAfterLoad:function(){var c=this.panel.tree._selectedNode||null;if(c&&this.panel.tree&&this.panel.tree.root){var b=this.panel.tree.root.findChild("identifier",c);if(b&&!b.hidden&&this.panel.tree.getSelectionModel().selNode){this.panel.tree.getSelectionModel().select(b)}}},getGroupsPanel:function(){var e=this;var d=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.userFieldGroup+":",style:"font-size:12px;position:absolute;text-align:right;width:100px;top:3px;left:0px;z-index:30000;"});var c=this.facade.getCurrentUser().hasPrivileges([Signavio.Config.RIGHTS.ALL]);var b=new Ext.Panel({cls:"x-div-textbackground x-groups-parent",bodyStyle:"border:1px solid #777777; margin-bottom:4px; min-height:17px; line-height:17px; max-height:100px;word-wrap: break-word;"+(Ext.isIE6?"width:288px;":""),style:(Ext.isIE6?"width:288px;padding-left:110px;":"padding-left:105px;")+"background-color:transparent;",autoScroll:true,maxHeight:150,anchor:"100%",recordRel:["group"],dataField:"rep.name",onRender:function(){Ext.Panel.prototype.onRender.apply(this,arguments);this.update()},beginUpdate:function(){if(this.el){this.el.addClass("x-loading")}},update:function(h){if(!this.el){return}var j=false;(this.items||[]).each(function(k){this.remove(k)}.bind(this));if(h){h.getRecords(this.recordRel).each(function(k,l){if(l!==0){this.add(new Ext.form.Label({text:", "}))}this.add(new Ext.LinkButton({style:"padding-left:20px;position:relative;",html:'<img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png" style="position:absolute;left:0px;top:0px;"/> '+k.get("rep").name,click:function(){try{var n=e.plugin.showTab(20).items.get(0).getActiveTab();if(n){window.setTimeout(function(){var p=n.panel.tree.root.childNodes.find(function(q){return q.attributes.identifier===k.get("href")});if(p){n.panel.tree.getSelectionModel().select(p)}},10)}}catch(m){}}}));j=true}.bind(this))}if(!j){this.add(new Ext.form.Label({cls:"x-window-security-center-manage-entry x-empty",text:Signavio.I18N.Repository.SecurityCenter.groupFormParentGroupEmpty}))}this.doLayout();this.el.removeClass("x-loading")}});var f=function(){var l=e.panel.form.store;var k=l.getRecords("group").map(function(n){return n.get("href")})||[];var h=Signavio.Core.StoreManager.getAllGroupStore().getRecords("group").findAll(function(n){return !k.include(n.data.href)});var m=new Signavio.Core.DataStore({});m.loadRecords({records:h},{sort:Signavio.Utils.BusinessObjectSortingFunction},true);var j=new Ext.Window({resizable:false,closeable:true,minimizable:false,modal:true,width:200,layout:"anchor",title:Signavio.I18N.Repository.SecurityCenter.addGroupToUserTitle,items:[new Ext.Panel({border:false,bodyStyle:"padding-bottom: 10px;",html:Signavio.I18N.Repository.SecurityCenter.addGroupToUserDesc.replace("{user}",l.getRecords("info")[0].get("rep").name)}),new Ext.form.DataStoreComboBox({anchor:"100%",tpl:'<tpl for="."><div class="x-combo-list-item x-security-center-cb-user"><img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/group.png"/><tpl for="rep">{name}</tpl></div></tpl>',store:m,forceSelection:true,displayField:"rep.name",valueField:"href",emptyText:(m.getRecords().length>0?Signavio.I18N.Repository.SecurityCenter.addGroupComboEmptyText:Signavio.I18N.Repository.SecurityCenter.addGroupComboNoGroupsEmptyText)})],bodyStyle:"background-color:white; padding: 10px; color: black; overflow: visible;",buttons:[{text:Signavio.I18N.Repository.SecurityCenter.groupFormAddBtn,handler:function(){var q=j.items.get(1).getValue();if(!q||q===""){return}var n=Signavio.Core.StoreManager.getAllUserStore().findByIdentifier(l.getIdentifier());var p=Signavio.Core.StoreManager.getRelatedStore(q.data.href,undefined,undefined,{callback:function(){p.addAsParent(n)}});e.filterUserList(e.filterBox);this.ownerCt.close()}},{text:Signavio.I18N.Repository.SecurityCenter.Button.cancel,handler:function(){this.ownerCt.close()}}]});j.show()};var g=null;b.on("render",function(){var h=document.createElement("img");if(Ext.isIE6){h.setAttribute("src",Signavio.Config.IMAGE_PATH+"/signavio/s.gif");$(h).setStyle("filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Signavio.Config.IMAGE_PATH+"/fugue/icons/plus-small.png',sizingMethod='image');background:none !important; margin-top: -1px;")}else{h.setAttribute("src",Signavio.Config.IMAGE_PATH+"/fugue/icons/plus-small.png");h.style.marginTop="-1px"}var j=document.createElement("a");j.appendChild(h);j.className="addGroupLink";$(j).setStyle("visibility: hidden");b.el.dom.appendChild(j);Ext.get(j).on("click",f.bind(this));g=j}.bind(this));return new Ext.Panel({border:false,width:Ext.isIE8?401:405,recordRel:b.recordRel,dataField:b.dataField,disable:function(){b.disable()},enable:function(){b.enable()},setValue:function(j,k,h){b.beginUpdate();b.update(k);if(g){$(g).setStyle("visibility: "+((!!e.panel&&e.panel.form.store&&c)?"visible":"hidden"))}},items:[d,b]})},getUserRegitrationLink:function(){if(this.facade.getConfig().mode.toLowerCase()!=="enterprise"){return undefined}return new Ext.Panel({border:false,cls:"x-manage-user-register-new-user",html:'<a href="/p/register" target="_blank">'+Signavio.I18N.Repository.SecurityCenter.registerNewUser+"</a>",width:300,disable:function(){if(this.body){this.body.addClass("x-disable")}},enable:function(){if(this.body){this.body.removeClass("x-disable")}}})},getLicensePanel:function(){if(!Signavio.Config.SHOW_LICENSE||this.facade.getConfig().mode===Signavio.Config.Mode.ENTERPRISE){return}return new Ext.Panel({fieldLabel:Signavio.I18N.Repository.Administration.fieldLicense,cls:"x-form-item",recordRel:"info",width:400,border:false,dataField:"rep.licenses",disable:function(){if(this.body){this.body.addClass("x-disable")}},enable:function(){if(this.body){this.body.removeClass("x-disable")}},onRender:function(){Ext.Panel.prototype.onRender.apply(this,arguments);this.tpl.overwrite(this.body,{text:"-",fieldLabel:this.fieldLabel,width:this.labelWidth||this.ownerCt.labelWidth})},setValue:function(c,d,f,b){if(!b||!b.el){return}var e=((c||[]).sort(function(h){return(Signavio.Config.MAIN_LICENSES.indexOf(h)+1)||100}).find(function(h){return Signavio.Config.MAIN_LICENSES.include(h)})||"");var g={text:(e&&Signavio.I18N.Repository.Purchase[e])||e||"-",fieldLabel:b.fieldLabel,width:b.labelWidth||b.ownerCt.labelWidth};if(!e&&c){if(this.facade.isCurrentUserAdmin()){g.text="<a href='#'>"+Signavio.I18N.Repository.Administration.upgrade+"</a>";if(!c.include(Signavio.Config.TRIAL_LICENSE)){g.text+=" <i>("+Signavio.I18N.Repository.Administration.expired+")</i>"}}else{g.text="<i>"+Signavio.I18N.Repository.Administration.upgradeNone+"</i>"}}b.tpl.overwrite(b.body,g);if(!e&&c&&this.facade.isCurrentUserAdmin()){Ext.get(b.body.query("a")[0]).on("click",function(m){if(Signavio.Config.MAIN_LICENSES.all(function(r){return this.facade.getUnusedLicenses(r).length<=0}.bind(this))){this.facade.raiseEvent("open_purchase")}else{var k=f[0].get("rep").name.trim();var j=Signavio.Config.MAIN_LICENSES.findAll(function(r){return this.facade.getUnusedLicenses(r).length>0}.bind(this));if(j.length==1){var l=j[0];var q=new Ext.XTemplate(Signavio.I18N.Repository.Administration.upgradeText).apply({user:k,license:l,licenseName:Signavio.I18N.Repository.Purchase[l]||l,count:this.facade.getUnusedLicenses(l).length});Ext.Msg.confirm("Signavio",q,function(r){if(r=="yes"){this.upgradeUser(f[0],l)}}.bind(this))}else{var h=j.map(function(t,r){var s=this.facade.getUnusedLicenses(t).length;return"<div><input type='radio' id='x-upgrade-"+(t)+"' name='upgrade_license'"+(r===0?" checked='true'":"")+"> <label for='x-upgrade-"+(t)+"'><b>"+(Signavio.I18N.Repository.Purchase[t]||t)+"</b> ("+s+")</label></div>"}.bind(this)).join("");var p="<div style='display:block;width:300px;float:right;'>"+Signavio.I18N.Repository.Administration.upgradeTextMulti+"<br/><br/>"+(h)+"</div>";var n=Ext.Msg.alert("Signavio",p,function(r){if(r=="ok"){var s=n.getDialog().body.child("input:checked");if(s){s=s.id.split("-").last();this.upgradeUser(f[0],s)}}}.bind(this)).setIcon(Ext.Msg.INFO);n.getDialog().setWidth(380);n.getDialog().syncSize()}}Event.stop(m);return false}.bind(this))}}.bind(this),tpl:new Ext.XTemplate('<label class="x-form-item-label" style="width: {width}px;">{fieldLabel}:</label><div style="padding-left:{[values.width+10]}px;padding-top:3px;" class="x-form-element">{text}</div><div class="x-form-clear-left"/>'),html:""})},upgradeUser:function(b,c){var d=Object.clone(b.get("rep"));d.licenses=(d.licenses||[]).concat(c);b.set("rep",d);b.store.commitChanges();this.facade.setUnusedLicenses(this.facade.getConfig().licenses.without(this.facade.getConfig().licenses.find(function(e){return e.type==c})))},removeUserRecord:function(b,e){var g=b.findByIdentifier(e.attributes.identifier);if(g){this.panel.form.setWaiting(true);var f,d=this;var c=function(){d.panel.form.setWaiting(false);b.un("submitted",f,d);b.un("submitfailed",c,d)};f=function(k,m){c();var j=[Signavio.Core.StoreManager.getAllUserGroupStore(),Signavio.Core.StoreManager.getAllGroupStore()];var h=Signavio.Core.StoreManager.getStore(m.get("href"));if(h){h.getRecords(["group"]).each(function(n){j.push(Signavio.Core.StoreManager.getStore(n.get("href")))})}j.each(function(n){if(!n){return}var p=n.findByIdentifier(m.get("href"));if(p){n.remove(p);n.addedRecords=[];n.removedRecords=[];n.commitChanges(true)}});var l=(g.get("rep").licenses||[]).find(function(n){return Signavio.Config.MAIN_LICENSES.include(n)});if(l){this.facade.setUnusedLicenses((this.facade.getConfig().licenses||[]).concat({type:l,id:""}))}};b.on("submitted",f,d);b.on("submitfailed",c,d);b.remove(g,true)}}})})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.SecurityCenter={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({group:"configure",arrange:"right",name:Signavio.I18N.Repository.SecurityCenter.btn,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/cog.png",seperated:true,items:[{name:Signavio.I18N.Repository.SecurityCenter.btnManage,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group.png",functionality:this.showSecurityCenter.bind(this,0),index:2,isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this)},{seperated:true,index:5}]});this.facade.registerOnEvent("open_configure",function(b,c){this.doOpen(c)}.bind(this))},userCanEdit:function(){},showSecurityCenter:function(b){var c=this.getSelection().length==1?this.getSelection()[0]:this.facade.getCurrentFolderStore();var d=new Ext.TabPanel({activeTab:typeof b=="number"?b:0,cls:"x-security-center-tab-panel",layoutOnTabChange:true,enableTabScroll:true,listeners:{tabchange:function(){this.win.syncSize()}.bind(this),render:function(){this.delegateUpdates()}},items:this.getAllTabs()});var a=this;this.win=new Ext.Window({title:Signavio.I18N.Repository.SecurityCenter.title,width:700,modal:true,resizable:false,items:[d],listeners:{close:function(){this.destroy();delete a.win}}});this.win.show()},doClose:function(){if(this.win){this.win.close()}},doOpen:function(a){if(!this.win){this.showSecurityCenter()}else{this.win.show()}if(this.win.items.get(0) instanceof Ext.TabPanel){a=a||0;var b=this.win.items.get(0).items.items.find(function(c){return c.index===a});this.win.items.get(0).setActiveTab(b||this.win.items.get(0).items.get(a))}return this.win}};Signavio.Plugins.SecurityCenter=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SecurityCenter)}();if(!Signavio.Plugins){Signavio.Plugins={}}Signavio.Plugins.Feedback=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=[{name:Signavio.I18N.Repository.Offer.userGettingStartet,description:Signavio.I18N.Repository.Offer.userGettingStartetDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/monitor.png",functionality:this.showGettingStartet.bind(this),index:1},{name:Signavio.I18N.Repository.Offer.userGuide,description:Signavio.I18N.Repository.Offer.userGuideDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/book_open.png",functionality:this.showHelp.bind(this),index:2},{name:Signavio.I18N.Repository.Offer.userGuidePDF,description:Signavio.I18N.Repository.Offer.userGuideDescPDF,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png",functionality:this.showHelpPDF.bind(this),index:3}];var b=this.facade.getConfig("department","urlhelplist");if("string"==typeof b&&b&&b.isJSON()){b=b.evalJSON();b.each(function(d,c){if(d&&d.url){a.push({name:d.label||d.url,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_world.png",functionality:function(){window.open(d.url)},index:10+c})}});a.last().seperated=true}a.push({name:(this.facade.getConfig().mode==="Enterprise")?Signavio.I18N.Repository.Offer.feedbackNameEnterprise:Signavio.I18N.Repository.Offer.feedbackName,description:Signavio.I18N.Repository.Offer.feedbackDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/feedback.png",functionality:this.showWindow.bind(this),index:100});this.facade.offer({name:Signavio.I18N.Repository.Offer.help,arrange:"right",description:Signavio.I18N.Repository.Offer.helpDesc,group:"help",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/help.png",items:a});this.facade.registerOnEvent("finialize",function(){if(this.facade.isFirstStart()){window.setTimeout(this.showGettingStartet.bind(this),4000)}}.bind(this))},showWindow:function(){var b=this.facade.getConfig().mode;var a=this.facade.getConfig().supportMailAddress;new Ext.ux.view.FeedbackWindow(b,Signavio.Config.BACKEND_PATH+"/support",Signavio.Config.EXPLORER_PATH,undefined,a)},showHelp:function(){var a=(Signavio.I18N.Language.toLowerCase().startsWith("de"))?Signavio.Config.HELP_START_URL_DE:Signavio.Config.HELP_START_URL;var b=Signavio.I18N.Repository.Offer.userGuide;Signavio.Helper.openIFramePanel(a,b)},showHelpPDF:function(){var a=(Signavio.I18N.Language.toLowerCase().startsWith("de"))?Signavio.Config.HELP_PDF_URL_DE:Signavio.Config.HELP_PDF_URL;var b=Signavio.I18N.Repository.Offer.userGuidePDF;Signavio.Helper.openIFramePanel(a,b)},showGettingStartet:function(){var a=(Signavio.I18N.Language.toLowerCase().startsWith("de"))?Signavio.Config.GETTING_STARTET_URL_DE:Signavio.Config.GETTING_STARTET_URL;var b=Signavio.I18N.Repository.Offer.userGettingStartet;Signavio.Helper.openIFramePanel(a,b,"x-help-screencasts")},showIFramePanel:function(c,f,b){if(!b){b=""}if(Ext.isIPad){window.open(c);return}var d="<iframe src='"+c+"' class='x-help-iframe'></iframe>";d+='<br/><a class="x-help-a" target="_blank" href="'+c+'">'+Signavio.I18N.Repository.Offer.openUGNewWindow+"</a>";var a=new Ext.Panel({height:"100%",width:"100%",html:d});var e=new Ext.Window({cls:"x-help "+b,modal:true,title:f,items:[a],resizable:false,header:true,shadow:false,draggable:false});e.show();e.center()}});if(!Signavio.Plugins){Signavio.Plugins={}}Signavio.Plugins.ReferenceModels=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({name:Signavio.I18N.Repository.Offer.referenceModels,arrange:"right",description:Signavio.I18N.Repository.Offer.referenceModelsDesc,relGroup:"help",index:4,icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/apps/custom/importReferenceModels.png",functionality:this.showReferenceModels.bind(this)})},showReferenceModels:function(){var a=Signavio.Config.REFERENCE_MODELS_URL;var b=Signavio.I18N.Repository.Offer.referenceModels;Signavio.Helper.openIFramePanel(a,b)},showIFramePanel:function(c,f,b){if(!b){b=""}if(Ext.isIPad){window.open(c);return}var d="<iframe src='"+c+"' class='x-help-iframe'></iframe>";d+='<br/><a class="x-help-a" target="_blank" href="'+c+'">'+Signavio.I18N.Repository.Offer.openUGNewWindow+"</a>";var a=new Ext.Panel({height:"100%",width:"100%",html:d});var e=new Ext.Window({cls:"x-help "+b,modal:true,title:f,items:[a],resizable:false,header:true,shadow:false,draggable:false});e.show();e.center()}});if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Update={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({name:Signavio.I18N.Repository.Offer.updateTitle,arrange:"right",description:Signavio.I18N.Repository.Offer.updateDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/update_green.png",functionality:this.update.bind(this)})},update:function(){Signavio.Core.StoreManager.reload()}};Signavio.Plugins.Update=Signavio.Core.Plugin.extend(Signavio.Plugins.Update)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Delete={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"edit",index:6,name:Signavio.I18N.Repository.Offer.deleteTitle,description:Signavio.I18N.Repository.Offer.deleteDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_remove.png",functionality:this.deleteElements.bind(this),isDisabled:function(){return this.noneSelected()}.bind(this),isVisible:this.selectionNotInTrash.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.DELETE]});this.facade.offer({relGroup:"edit",index:10,seperated:true});this.facade.offer({name:Signavio.I18N.Repository.Offer.removeTitle,description:Signavio.I18N.Repository.Offer.removeDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_remove.png",functionality:this.removeElements.bind(this),isDisabled:function(){return this.noneSelected()}.bind(this),isVisible:this.selectionInTrash.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.DELETE]});this.facade.offer({name:Signavio.I18N.Repository.Offer.restoreTitle,description:Signavio.I18N.Repository.Offer.restoreDescription,icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/restore.png",functionality:this.recoverElements.bind(this),isDisabled:function(){return this.noneSelected()}.bind(this),isVisible:this.selectionInTrash.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.DELETE]});this.facade.registerOnEvent(Signavio.Const.EVENT.DELETE_SELECTED_ITEMS,this.handleDeleteSelectedItems.bind(this))},handleDeleteSelectedItems:function(c,b){if(this.noneSelected()){return}var a=true;this.getSelection().each(function(d){if(!d.store.hasPrivileges([Signavio.Config.RIGHTS.DELETE])){a=false}}.bind(this));if(!a){return}if(this.selectionInTrash()){this.removeElements();return}this.deleteElements()},deleteElements:function(){if(Signavio.Config.REMOVE_ON_DELETE){this.removeElements();return}var a=function(){this.getSelection().each(function(b){var c=b.store.getIdentifier();b.get("rep").parent=c;b.store.move(b,this.facade.getTrashRecord().get("href"))}.bind(this))}.bind(this);this.confirm(Signavio.I18N.Repository.Offer.deleteQuestion,a)},removeElements:function(){var a=function(){var b=this.getSelection();b.each(function(c){c.store.remove(c,true)}.bind(this));this.facade.raiseEvent(Signavio.Const.EVENT.ITEMS_REMOVED,b)}.bind(this);this.confirm(Signavio.I18N.Repository.Offer.removeQuestion,a)},recoverElements:function(){this.getSelection().each(function(a){var b=a.get("rep").parent;if(b){delete a.get("rep").parent;a.store.on("update",function(e,d,f){e.un("submitfailed");e.un("update")});a.store.on("submitfailed",function(e,d,g){var f=Ext.MessageBox.alert(Signavio.I18N.Repository.Offer.restoreFailedTitle,Signavio.I18N.Repository.Offer.restoreFailed);f.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout();e.un("submitfailed");e.un("update")});a.store.move(a,b)}}.bind(this))}};Signavio.Plugins.Delete=Signavio.Core.Plugin.extend(Signavio.Plugins.Delete)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.Move={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({group:"edit",name:Signavio.I18N.Repository.Offer.editGroupTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/picture_edit.png",isVisible:this.selectionNotInTrash.bind(this),items:[{relGroup:"edit",index:3,seperated:true},{relGroup:"edit",index:4,name:Signavio.I18N.Repository.Offer.moveTitle,description:Signavio.I18N.Repository.Offer.moveDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_go.png",functionality:this.doMove.bind(this,true),isVisible:function(){return !this.selectionInInternal()}.bind(this),isDisabled:function(){return this.selectionInTrash()||this.selectionInSearch()||this.noneSelected()}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.DELETE]},{relGroup:"edit",index:5,name:Signavio.I18N.Repository.Offer.copyTitle,description:Signavio.I18N.Repository.Offer.copyDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_copy.png",functionality:this.doMove.bind(this,false),isDisabled:function(){return this.selectionInTrash()||!this.manySelected()}.bind(this),isVisible:function(){return !this.selectionInInternal()}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.READ]},{relGroup:"edit",index:5,name:Signavio.I18N.Repository.Offer.copyTitleDublicate,description:Signavio.I18N.Repository.Offer.copyDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_copy.png",functionality:this.doMove.bind(this,false),isDisabled:function(){return this.selectionInTrash()||!this.manySelected()}.bind(this),isVisible:function(){return this.selectionInInternal()}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.READ]}]})},doMove:function(a){var b=function(f,g,c,e){if(!f){return}var d=Signavio.Core.StoreManager.getStore(f.get("href"),true,function(){var h=d.hasPrivileges(Signavio.Config.RIGHTS.WRITE);if(!h){Ext.Msg.alert(Signavio.I18N.Repository.Offer[(g?"copy":"move")+"AlertTitle"],Signavio.I18N.Repository.Offer[(g?"copy":"move")+"AlertDesc"]).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{var k=this.facade.getCurrentFolderStore();k.on("submitfailed",function(m,l,n){var p=" ";if(n&&n.modelName){p=Signavio.I18N.Repository.Offer.copyLinkedError.replace("{model}",n.modelName)}var q=Ext.MessageBox.alert(Signavio.I18N.Repository.Offer.copyTitle,Signavio.I18N.Repository.Offer.copyError+p);q.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout()});if(g&&e){var j=[];this.getSelection().each(function(l){var m=Signavio.Core.RecordCreator.create(l.get("rel"),l.get("href"),Object.clone(l.get("rep")));j.push(m)}.bind(this));k.copy(j,f.get("href"),e)}else{this.getSelection().each(function(l){if(g){var m=Signavio.Core.RecordCreator.create(l.get("rel"),l.get("href"),Object.clone(l.get("rep")));m.get("rep").name=m.get("rep").name+Signavio.I18N.Repository.Offer.copyPrefix;k.copy(m,f.get("href"),e)}else{if(l.store.getIdentifier()!==f.get("href")){k.move(l,f.get("href"))}}}.bind(this))}if(c){c.close()}}}.bind(this))}.bind(this);if(this.selectionInInternal()&&!a){b(this.facade.getCurrentRootFolder(),true)}else{this.showWindow(b,a)}},showWindow:function(l,b){var m;if(this.getSelection().length===1){m=new Template(Signavio.I18N.Repository.Offer[(b?"move":"copy")+"WindowHeader"]).evaluate({title:this.getSelection()[0].get("rep").name})}else{m=new Template(Signavio.I18N.Repository.Offer[(b?"move":"copy")+"WindowHeaderMultiple"]).evaluate({count:this.getSelection().length})}var c=this.getSelection().all(function(p){return p.get("rel")===Signavio.Const.REL.MODEL});var k=Signavio.Core.StoreManager.getRootDirectoryStore();k.lastOptions.sort=function(){return 0};var j=this.getSelection().length==1?this.getSelection()[0]:this.facade.getCurrentFolderStore();var n=new Signavio.Extensions.ModelDirectoryCheckTreePanel({height:270,anchor:"100%",style:"margin-top:10px;padding:0;",disabledIds:this.getSelection().map(function(p){return p.get("href")}),root:new Ext.tree.TreeNode({text:"",draggable:false,leaf:false,cls:"folder",childCls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:Signavio.Const.REL.DIRECTORY,filterFn:function(p){if(p.get("rel")=="mod"){return true}else{if(p.get("rel")=="dir"){return !this.isTrashFolder(p)&&!this.isInternalFolder(p)}else{return false}}}.bind(this)})},[j].compact());n.loader=new Signavio.Extensions.TreeLoader({panel:n,sortingFn:n.sortingFn,generateNodeData:function(s,u,t){var q=Signavio.Extensions.TreeLoader.prototype.generateNodeData.apply(this,arguments);var p=s.hasPrivileges(Signavio.Config.RIGHTS.WRITE);t.ui[p?"removeClass":"addClass"]("x-disabled");t.ui[p?"removeClass":"addClass"]("x-locked");window.setTimeout(function(){q.each(function(w,r){var v=Signavio.Core.StoreManager.getStore(w.identifier,true,function(){var x=v.hasPrivileges(Signavio.Config.RIGHTS.WRITE);if(!x){var y=t.childNodes.find(function(z){return z.attributes.identifier===w.identifier});if(y){y.ui.addClass("x-disabled");y.ui.addClass("x-locked")}}})})},1);return q}});var e=[n];if(!b){var d=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Repository.Offer.includeLinked,checked:false});var h=Signavio.I18N.Repository.Offer.includeLinkedToolTip;var a=' <img style="padding-top:2px" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+h+'" class="x-info-img"/>';var f=new Ext.Panel({layout:"column",anchor:"100%",getValue:function(){return this.items.get(0).items.get(0).getValue()},border:false,items:[{bodyStyle:"padding-top: 8px;padding-right:3px",border:false,items:[d]},{html:a,bodyStyle:"padding-top: 8px;padding-right:3px",border:false}]});e.push(f)}var g=new Ext.ux.Window({modal:true,cls:"x-plugin-move-window",title:Signavio.I18N.Repository.Offer[(b?"move":"copy")+"Title"],description:m,resizable:false,width:400,items:e,buttons:[{text:Signavio.I18N.Repository.Offer[(b?"move":"copy")+"BtnOk"],handler:function(){var p=b?false:g.items.get(2).getValue();var q=g.items.get(1).getSelectedRecord();var r=!b;l(q,r,g,p)}.bind(this)}]});g.show()},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")},isInternalFolder:function(a){return a.get("rep").type=="internal"}};Signavio.Plugins.Move=Signavio.Core.Plugin.extend(Signavio.Plugins.Move)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Export={enabled:true,renderToView:"toolbar",relTypes:["exp"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({group:"import",name:Signavio.I18N.Repository.Offer.importTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_put.png",isVisible:this.selectionNotInTrash.bind(this),items:[],onAdd:function(a){this.menuButton=a;if(this.cacheButtons){this.cacheButtons.each(function(b){a.menu.addMenuItem(b)})}}.bind(this)})}};Signavio.Plugins.Export=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.Export)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Import={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importAMLTitle,description:Signavio.I18N.Repository.Offer.importAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",functionality:this.importAML.bind(this),index:25,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)});var b=Signavio.I18N.Language.split("_").first()},afterRender:function(){},importAML:function(){var b=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{name:"amlfile",inputType:"file",style:"margin-top:10px;display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(c){return{name:c.key,inputType:"hidden",value:c.value}})].flatten()});b.getForm().errorReader={read:function(c){return{success:c.responseText.toLowerCase().replace(/<.*?pre.*?>/g,"").startsWith("["),records:[]}}};var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.amlImportRestore,description:Signavio.I18N.Repository.Offer.amlImportRestoreLabel,width:400,modal:true,resizable:false,items:[b],buttons:[{text:Signavio.I18N.Repository.Offer.amlImportRestoreBtn,handler:function(){if(b.items.items[0].el.dom.value){b.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.AML_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.amlImportWait,method:"POST",success:function(d,c){a.close();Signavio.Core.StoreManager.reloadChildEntitiesStore();var e=c.response.responseText.replace(/<.*?pre.*?>/g,"");if(e.isJSON()){Ext.Msg.alert(Signavio.I18N.Repository.Offer.importAMLTitle,(new Ext.Template(Signavio.I18N.Repository.Offer.amlImportSuccess)).apply(e.evalJSON()[0]||{})).setIcon(Ext.MessageBox.INFO)}}.bind(this),failure:function(d,c){a.close();if(c.response.responseText.indexOf("amlImport.AMLFileTooBig")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.amlImportFileTooBigTitle,Signavio.I18N.Repository.Offer.amlImportFileTooBigDesc).setIcon(Ext.MessageBox.WARNING)}else{if(c.response.responseText.indexOf("amlImport.AMLValidationFailed")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.amlImportValidationFailedTitle,Signavio.I18N.Repository.Offer.amlImportValidationFailedDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.amlImportErrorTitle,Signavio.I18N.Repository.Offer.amlImportErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}}})}else{}}.bind(this)}]});a.show()}};Signavio.Plugins.Import=Signavio.Core.Plugin.extend(Signavio.Plugins.Import)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Publisher={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var g=function(){var h=this.facade.getCurrentRootFolder();return h&&this.facade.getTrashRecord()===h}.bind(this);var d=function(){return this.facade.getCurrentRootFolder()&&this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PRIVATE}.bind(this);var e=function(){return g()||this.getSelection().length!==1||this.getSelection()[0].get("rel")!=="mod"}.bind(this);var b=function(){return !g()}.bind(this);var f=function(){return this.facade.getCurrentUser()&&!this.facade.getCurrentUser().getRecords("info")[0].get("rep").isGuestUser}.bind(this);var c=function(){return g()||(this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected())}.bind(this);var a=function(){return !g()&&f()}.bind(this);this.facade.offer({relGroup:"scenter",name:Signavio.I18N.Repository.Offer.openPublisherTitle,description:Signavio.I18N.Repository.Offer.openPublisherDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report.png",functionality:this.open.bind(this),isDisabled:c,isVisible:a,seperated:false,index:-10})},open:function(){var d=undefined;if(this.getSelection().size()>=1){var a=this.getSelection().find(function(e){if(e.get("rel")==="mod"){return e}});if(a){d="#"+a.get("href");try{if((Signavio.Core.StoreManager.getChildEntitiesStore().lastOptions.params||{}).q){d+="/search?"+Signavio.Core.StoreManager.getChildEntitiesStore().lastOptions.params.q}}catch(c){}}}if(!d){var b=this.facade.getCurrentFolderStore();var f=b.getRecords("mod");if(f.size()>0){d="#"+f[0].get("href")}}window.open(Signavio.Config.PORTAL_URI+(d||""))}};Signavio.Plugins.Publisher=Signavio.Core.Plugin.extend(Signavio.Plugins.Publisher)}();if("undefined"==typeof Signavio){var Signavio={}}if("undefined"==typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Publishing=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var d=function(){var e=this.facade.getCurrentRootFolder();return e&&this.facade.getTrashRecord()===e}.bind(this);var c=function(){return this.facade.getCurrentUser()&&!this.facade.getCurrentUser().getRecords("info")[0].get("rep").isGuestUser}.bind(this);var a=function(){return this.facade.getCurrentRootFolder()&&this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PRIVATE}.bind(this);var b=function(){return this.facade.getConfig().mode!=="Enterprise"||this.facade.getConfig().hasGuestUser}.bind(this);this.facade.offer({relGroup:"scenter",name:Signavio.I18N.Repository.Offer.doPublishTitle,description:Signavio.I18N.Repository.Offer.doPublishDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report_go.png",functionality:this.publish.bind(this),isDisabled:function(){return d()||a()||!b()}.bind(this),isVisible:c,neededPrivileges:[Signavio.Config.RIGHTS.SHARE],seperated:true,index:-9})},publish:function(){var b=this.facade.getConfig();if((b.mode==="Enterprise"&&b.hasGuestUser)||(b.mode==="SaaS"&&b.certificatesOrdered)){var a=[];this.getSelection().each(function(c){if(this.isModel(c)||this.isFile(c)){a.push(c)}else{if(this.isDirectory(c)){a.push(c)}}}.bind(this));if(a.length==0){a.push(Signavio.Core.StoreManager.getChildEntitiesStore())}this._showPublishDialogue(a)}else{this.noCertificate()}},noCertificate:function(){Ext.Msg.show({title:Signavio.I18N.Repository.Publishing.noCertTitle,msg:Signavio.I18N.Repository.Publishing.noCertText,prompt:false,icon:Ext.MessageBox.INFO,buttons:{ok:Ext.MessageBox.buttonText.close}})},_showPublishDialogue:function(b){var a=new Signavio.Extensions.ModelDirectoryCheckTreePanel({anchor:"100% -30",height:350,root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL,Signavio.Const.REL.FILE],filterFn:function(c){if(this.isModel(c)||this.isFile(c)){return true}else{if(this.isDirectory(c)){return !this.isTrashFolder(c)&&this.isPublicFolder(c)}else{return false}}}.bind(this),isChildLeaf:function(c){return[Signavio.Const.REL.MODEL,Signavio.Const.REL.FILE].include(c.get("rel"))},hasChildCls:function(f){var e=this.isPublished(f),g=this.oldPublished(f),c=f.get("rel");var d="";d+=e?"model-isPublished ":g?"model-oldPublished ":"";d+=[Signavio.Const.REL.MODEL,Signavio.Const.REL.FILE].include(c)?(Signavio.Const.REL.MODEL==c?((!e&&!g)&&"model "||"")+"model-":"file-")+Signavio.Utils.getIcon(f,true):"folder";return d}.bind(this)})},b);this.dialog=new Ext.ux.Window({width:500,resizable:false,minimizable:false,modal:true,autoScroll:false,cls:"x-plugin-archive",title:Signavio.I18N.Repository.Publishing.publishingWindowTitle,items:[new Ext.form.Label({text:Signavio.I18N.Repository.Publishing.publishingWindowDesc}),a],buttons:[{text:Signavio.I18N.Repository.Publishing.publishButtonTitle,handler:function(){var d=[];var c=[];a.getChecked().each(function(e){var f=e.attributes.identifier;if(f.indexOf("/model/")==0||f.indexOf("/file/")==0){d.push(f)}else{if(f.indexOf("/directory/")==0){c.push(f)}}}.bind(this));this.sendRequest(d,c)}.bind(this)}]}),this.dialog.buttons[0].on("render",function(){var c=this.getSelection();if(c.length===0||c.length===1&&this.isTrashFolder(c[0])){this.dialog.buttons[0].disable()}}.bind(this));a.on("checkchange",function(){if(a.getChecked().length===0){this.dialog.buttons[0].disable()}else{this.dialog.buttons[0].enable()}}.bind(this));this.dialog.show();this.dialog.on("close",function(){delete this.dialog}.bind(this))},sendRequest:function(b,a){var c=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.COUNT_PATH;Signavio.Core.Stores.RequestManager.doPost(c,function(d){if(d.models[0].length>0){var e=Ext.Msg.show({title:Signavio.I18N.Repository.Publishing.confirmDialogTitle,msg:Signavio.I18N.Repository.Publishing.confirmDialogTextPre+d.models[0].length+(d.models[0].length===1?Signavio.I18N.Repository.Publishing.confirmDialogTextSingular:Signavio.I18N.Repository.Publishing.confirmDialogTextPlural),prompt:false,icon:Ext.MessageBox.QUESTION,buttons:{ok:Ext.MessageBox.buttonText.yes,cancel:Ext.MessageBox.buttonText.no},fn:function(f){if(f==="ok"&&this.dialog){this.sendPublishRequest(d.models[0]);this.dialog.close()}}.bind(this)})}else{if(a.length>0){Ext.Msg.show({title:Signavio.I18N.Repository.Publishing.noModel,msg:Signavio.I18N.Repository.Publishing.emptyDirectory,prompt:false,icon:Ext.MessageBox.INFO,buttons:{ok:Ext.MessageBox.buttonText.ok}})}}}.bind(this),{models:b,directories:a})},sendPublishRequest:function(b){var a=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.PUBLISH_PATH;Signavio.Core.Stores.RequestManager.doPost(a,function(c){var e=c.rep;Signavio.Core.StoreManager.getAllStores().each(function(g){if(g.getIdentifier().startsWith(Signavio.Config.DIRECTORY_PATH)){var f=g.getRecords(Signavio.Const.REL.MODEL).concat(g.getRecords(Signavio.Const.REL.FILE));f.each(function(j){if(e[j.get("href")]){j.get("rep").granted_revision=j.get("rep").revision}})}else{if(g.getIdentifier().startsWith(Signavio.Config.MODEL_PATH)){var h=g.getRecords(Signavio.Const.REL.INFO)[0];if(h&&e[g.getIdentifier()]){h.get("rep").granted_revision=h.get("rep").revision}}}});var d=Signavio.Core.StoreManager.getChildEntitiesStore();d.fireEvent("datachanged",d)}.bind(this),{models:b})},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isFile:function(a){return a.get("rel")==Signavio.Const.REL.FILE},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isPublished:function(a){var b=a.get("rep");return b.granted_revision!==""&&b.granted_revision===b.revision},oldPublished:function(a){var b=a.get("rep");return b.granted_revision!==""&&b.granted_revision!==b.revision},isPublicFolder:function(a){return !a.get("rep").type||a.get("rep").type==="public"},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.TalkAbout={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var c=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"}.bind(this);var d=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return c.call(this)||(this.facade.getCurrentRootFolder()!==undefined&&this.facade.getCurrentRootFolder()===this.facade.getTrashRecord())}.bind(this);var b=function(){return d()&&this.facade.getCurrentUser()&&this.facade.getCurrentUser().getRecords("info")[0].get("rep").isGuestUser}.bind(this);var e=function(){return d()&&this.facade.getCurrentUser()&&!this.facade.getCurrentUser().getRecords("info")[0].get("rep").isGuestUser}.bind(this);this.facade.offer({relGroup:"edit",name:Signavio.I18N.Repository.TalkAbout.titleEdit,arrange:"left",description:Signavio.I18N.Repository.TalkAbout.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments.png",functionality:this.open.bind(this),isDisabled:a,isVisible:function(){return e()&&!this.selectionInInternal()}.bind(this),index:2,neededPrivileges:[Signavio.Config.RIGHTS.READ]});this.facade.offer({name:Signavio.I18N.Repository.TalkAbout.title,arrange:"left",description:Signavio.I18N.Repository.TalkAbout.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments.png",functionality:this.open.bind(this),isDisabled:a,isVisible:b,index:0})},open:function(b,c,a){window.open(Signavio.Config.PUBLISHER_URI+"/"+this.getSelection()[0].get("href").split("/").last()+"?comment")}};Signavio.Plugins.TalkAbout=Signavio.Core.Plugin.extend(Signavio.Plugins.TalkAbout)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.DirectFolderURL={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);Signavio.Const.FRAGMENTS_ENABLED=true;this.facade.registerInitializeFinal(function(){this.loadParents()}.bind(this))},missedHashes:[],isCurrentCallee:function(){return Signavio.Core.StoreManager.getChildEntitiesStore().lastOptions.callee===Signavio.Plugins.DirectFolderURL},finialize:function(){Signavio.Core.StoreManager.getChildEntitiesStore().on("load",function(b){if(this.currentlyCalling||this.isCurrentCallee()){return}if(b.lastOptions.id&&b.lastOptions.id.startsWith("/directory")){this.updateHash(b.lastOptions.id)}else{if(b.lastOptions.id&&b.lastOptions.id.startsWith("/search")){var d=b.lastOptions.params.offset;var a=b.lastOptions.params.limit;var c=b.lastOptions.params.q;this.updateHash("/search?p="+(Math.floor(d/a)+1)+"&q="+c)}}}.bind(this));Signavio.Helper.HashUtils.onChange(function(b){if(!b||([Signavio.Config.DIRECTORY_PATH,Signavio.Config.MODEL_PATH,"/search?"].all(function(c){return !b.include(c)}))){return}if(this.currentlyCalling){this.missedHashes.push(b);return}else{if(this.hash===b){return}else{this.currentlyCalling=true}}var a=function(f){var h="",d={},c;if(f.include(Signavio.Config.DIRECTORY_PATH)||f.include(Signavio.Config.MODEL_PATH)){h=f=f.replace(/.*\/directory\/?/g,"/directory/").replace(/.*\/model\/?/g,"/model/");d={sort:Signavio.Utils.BusinessObjectSortingFunction}}else{if(f.include("/search?")){h="/search";var g=Number(f.replace(/.*\/search\?p=/g,"").replace(/&q=.*/,""))||1;var e=f.replace(/.*\/search\?.*?q=/g,"");d={force:true,params:{q:e,limit:Signavio.Config.SEARCH_LIMIT,offset:((g-1)*Signavio.Config.SEARCH_LIMIT)}};this.facade.raiseEvent("searchactivated",e,false)}else{return}}d.callee=Signavio.Plugins.DirectFolderURL;d.callback=function(){if(this.missedHashes.length>0){var j=this.missedHashes.last();this.missedHashes=[];a(j)}else{delete this.currentlyCalling;delete c.lastOptions.callee}}.bind(this);this.hash=f;c=Signavio.Core.StoreManager.getRelatedStore(h,"child",["mod","dir","file"],d)}.bind(this);a(b)}.bind(this))},finishLoading:function(){window.setTimeout(function(){this.facade.releaseInitializeFinal()}.bind(this),100)},loadParents:function(){var e=this;this.hash=decodeURI(window.location.hash);var f;if(this.hash.include(Signavio.Config.DIRECTORY_PATH)||this.hash.include(Signavio.Config.MODEL_PATH)||this.hash.include(Signavio.Config.TALKABOUT_PATH)){this.hash=this.hash.replace(/.*\/directory\/?/g,"/directory/").replace(/.*\/model\/?/g,"/model/").replace(/.*\/talkabout\/?/g,"/model/");if(this.hash.include("/referencemodel")){f=(this.hash.match(";/referencemodel/(\\w*)")||["",""])[1];if(f){window.setTimeout(this.facade.raiseEvent.bind(this,Signavio.Const.EVENT.IMPORT_REFERENCE_MODEL,{referenceModelId:f}),1000)}this.updateHash(this.hash.replace(/;\/referencemodel\/(\w*)/,""))}}else{if(this.hash.include("/search?")){var g=Number(this.hash.replace(/.*\/search\?p=/g,"").replace(/&q=.*/,""))||1;var c=this.hash.replace(/.*\/search\?.*?q=/g,"");this.hash="/search?p="+g+"&q="+c;Signavio.Core.StoreManager.getRelatedStore("/search","child",["mod","dir"],{force:true,params:{q:c,offset:((g-1)*Signavio.Config.SEARCH_LIMIT),limit:Signavio.Config.SEARCH_LIMIT},callback:function(){e.finishLoading()}});return}else{var a=Signavio.Core.StoreManager.getStore("root");var d=function(){a.un("load",d);if(a.getTotalCount()===0||a.getRecords()[0].get("rel")!==Signavio.Const.REL.DIRECTORY||(a.getRecords()[0].get("rep").type===Signavio.Config.FOLDER_TYPE.TRASH&&!a.getRecords()[0].get("rep").visible)){e.finishLoading();return}var h=a.getRecords()[0].get("href");var k=Signavio.Core.StoreManager.getChildEntitiesStore();var j=function(){k.un("load",j);e.updateHash(h,true);e.finishLoading()};k.on("load",j);Signavio.Core.StoreManager.loadChildEntitiesStore(h)};if(a.getRecords().length>0){d()}else{a.on("load",d)}return}}var b=Signavio.Core.StoreManager.getStore(this.hash,true,function(){var h=b.getRecords("parents")[0];if(!h){window.setTimeout(function(){e.finishLoading()},50);return}var l=h.get("rep").pluck("href");if(this.hash.startsWith("/directory/")){l.unshift(this.hash)}var k=l.first();if(l.length<=0){return}var m=Signavio.Core.StoreManager.getChildEntitiesStore();var j=function(){if(l.length<=0){window.setTimeout(function(){Signavio.Core.StoreManager.loadChildEntitiesStore(k);e.finishLoading()},50);return}Signavio.Core.StoreManager.getStore(l.pop(),true,j)};j()}.bind(this))},hash:"",updateHash:function(b,a){b=encodeURI(b||"");if(b===this.hash){return}this.hash=b||"";Signavio.Helper.HashUtils.set(this.hash,a)}};Signavio.Plugins.DirectFolderURL=Signavio.Core.Plugin.extend(Signavio.Plugins.DirectFolderURL)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.BPMN2Migration={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"edit",index:20,name:Signavio.I18N.Repository.Offer.migration,description:Signavio.I18N.Repository.Offer.migrationDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_bpmn2.png",functionality:this.migrateBPMN.bind(this),isDisabled:function(){return this.selectionInSearch()||!this.oneSelected()||!this.selectionIsBpmn11()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},migrateBPMN:function(){var c=this.getSelection()[0].get("href").split("/").last();var b=this.getSelection()[0].get("rep").name+Signavio.I18N.Repository.Offer.copyPrefix;var a=window.open();window.setTimeout(window.focus,1);Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.MIGRATION_PATH,[function(d){if(d instanceof Array&&d.length>0){var e=Signavio.Config.BACKEND_PATH+"/editor?id="+d[0];window.setTimeout(function(){a.location=window.location.protocol+"//"+window.location.host+""+e;a.focus()},100);this.facade.askForRefresh()}}.bind(this),function(){Ext.Msg.alert(Signavio.I18N.Repository.Offer.migration,Signavio.I18N.Repository.Offer.migrationFailed).setIcon(Ext.Msg.INFO).getDialog().syncSize()}],{models:[c],names:[b]})}};Signavio.Plugins.BPMN2Migration=Signavio.Core.Plugin.extend(Signavio.Plugins.BPMN2Migration)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Views={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.registerOnEvent(Signavio.Const.EVENT.REVISION_SELECTION_CHANGED,this.onRevisionChanged.bind(this))},onRevisionChanged:function(b,c){if(c.revision&&c.node&&c.revision.get("rel")==Signavio.Const.REL.REVISION){var a=c.node.child("div.x-views");if(!a){window.setTimeout(function(e,f){var d=Signavio.Core.StoreManager.getStore(e.get("href")+Signavio.Config.VIEWS_PATH,true,function(k,l){var j=d.getRecords(Signavio.Const.REL.INFO);var m=l?Ext.fly(l).child("div.x-revert"):undefined;if(j&&m&&m.dom.parentNode){var h=Object.toQueryString(Ext.Ajax.getSecurityParameter());var g=new Ext.XTemplate('<div class="x-views">','<tpl if="values.length&gt;0">','<br/><a href="',Signavio.Config.BACKEND_PATH+k.get("href")+"/png?inline=true&"+h,'" class="x-view-select x-view-selected">{[Signavio.I18N.Repository.Revision.resetView]}</a>',"</tpl>",'<tpl for=".">',', <a href="{[Signavio.Config.BACKEND_PATH+values.data.href.replace("/info", "")]}/png?inline=true&',h,'" class="x-view-select" onclick="return false;">{[values.data.rep.view.name]}</a>','<tpl if="values.data.rep.view.description">','<img ext:qtip="{[values.data.rep.view.description]}" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information_small.png">',"</tpl>","</tpl>",'<tpl if="values.length&gt;0">',"<br/>","</tpl>","</div>").insertBefore(m,j,true);g.fadeIn();var n=g.select("a.x-view-select");n.on("click",function(q,s){Event.stop(q);var p=Ext.fly(s);var r=p.parent().query("a").indexOf(s);this.onViewClick(r===0?null:j[r-1],k);n.removeClass("x-view-selected");p.addClass("x-view-selected");return false}.bind(this))}}.bind(this,e,f))}.bind(this,c.revision,c.node.dom),100)}else{a.select("a.x-view-select").removeClass("x-view-selected");a.select("a.x-view-select:first-child").addClass("x-view-selected")}}},onViewClick:function(a,c){var b=c.get("href");if(a){b=a.get("href").replace("/info","")}this.facade.raiseEvent(Signavio.Const.EVENT.SHOW_INFO_IMG,Signavio.Config.BACKEND_PATH+b+"/png")}};Signavio.Plugins.Views=Signavio.Core.Plugin.extend(Signavio.Plugins.Views)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ViewSelector={enabled:true,viewTypes:[{icon:Signavio.Config.IMAGE_PATH+"/famfamfam/application_view_tile.png",tooltip:Signavio.I18N.Repository.IconView.description,view:"icon"},{icon:Signavio.Config.IMAGE_PATH+"/famfamfam/application_view_detail.png",tooltip:Signavio.I18N.Repository.TableView.toolTip,view:"table"}],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.initCP();var a=this.facade.getExtView("view").body;var b=new Ext.Toolbar({renderTo:a,cls:"x-view-selector-toolbar"});this.viewTypes.each(function(c,d){b.add({enableToggle:true,toggleGroup:"view",pressed:c.view===Signavio.Config.INITIAL_VIEW,tooltip:c.tooltip,icon:c.icon,iconCls:"x-dummy",handler:this.switchTo.bind(this,c.view),allowDepress:false});if(d!==this.viewTypes.length-1){b.addSeparator()}}.bind(this))},switchTo:function(a){this.facade.switchView(a);if(this.cp){this.cp.set("view",a)}},initCP:function(){this.cp=new Ext.state.CookieProvider({path:Ext.isIE?"/":window.location.pathname,expires:new Date(new Date().getTime()+(1000*60*60*24*30))});var a=this.cp.get("view");if(a&&this.viewTypes.pluck("view").include(a)){Signavio.Config.INITIAL_VIEW=a||Signavio.Config.INITIAL_VIEW}}};Signavio.Plugins.ViewSelector=Signavio.Core.Plugin.extend(Signavio.Plugins.ViewSelector)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var h=Signavio.I18N.MetaModellingGuidelines;var a="http://b3mn.org/stencilset/bpmn2.0#";var k={IRRELEVANT:"STATE_IRRELEVANT",MUST:"STATE_INFO",SHOULD:"STATE_RESTRICT",COULD:"STATE_WARNING"};var j=7000;var g=["Must","Should","Could"];var c={ignore:k.IRRELEVANT,must:k.MUST,should:k.SHOULD,can:k.COULD};var e={};(function(){$H(c).keys().each(function(l){var m=c[l];e[m]=l})}());isSaveMonitoringActive=true;var d={BASIC_EDITOR:"MG_BASIC_EDITOR",NULL_OPTION_EDITOR:"MG_NULL_OPTION_EDITOR",SINGLE_SELECT_EDITOR:"MG_SINGLE_SELECT_EDITOR",MULTI_SELECT_EDITOR:"MG_MULTI_SELECT_EDITOR",CUSTOM_EDITOR:"MG_CUSTOM_EDITOR",GROUPED_EDITOR:"MG_GROUPED_EDITOR",GROUPED_CALL_EDITOR:"MG_GROUPED_CALL_EDITOR"};var b=Signavio.Config.BACKEND_PATH+Signavio.Config.META_MODELLINGGUIDELINES_CONFIG_PATH;var f=Signavio.Config.BACKEND_PATH+Signavio.Config.META_MODELLINGGUIDELINES_PATH;Signavio.Plugins.ManageModellingGuideLines={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.registerOnEvent(Signavio.Const.EVENT.ADD_MODELLING_GUIDE_LINES,function(m,l){if(!l){return}this.editorStates=k;this.editorBackendToFrontendStates=c;this.editorFrontendToBackendStates=e;this.editorDefaultStateByActivate=k.MUST;this.editorTypes=d;this.configurationsUrl=b;this.metaMGUrl=f;this.oldScroll=null;this.initMGPanel(l);this.mgPanel=l}.bind(this));this.facade.offer({relGroup:"configure",arrange:"right",index:15,name:Signavio.I18N.Repository.MetaData.titleGuidelines,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compass.png",isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this)});Signavio.Const.SHOW_MODELINGGUIDELINE_TAB=true},showWindow:function(){this.facade.raiseEvent(Signavio.Const.EVENT.OPEN_MANAGE_METADATA,Signavio.Const.MODELINGGUIDELINE_TAB_NAME)},initMGPanel:function(l){this.initDataStores();this.initDescriptionPanel(l);this.initAddMGConfigurationUI(l);this.initMGGrid(l);this.hasToBeSaveConfigurations=[]},initDataStores:function(){this.guideLinesStore=new Ext.data.SimpleStore({fields:[],data:[]})},initDescriptionPanel:function(l){this.descriptionPanel=new Ext.Panel({html:"",cls:"y-stencilsets-description",bodyStyle:"padding-bottom:10px; color:#666666;",anchor:"100%",border:false});l.add(this.descriptionPanel);l.doLayout()},initAddMGConfigurationUI:function(l){this.addConfigurationLink=new Ext.LinkButton({text:h.addConfig,cls:"ak-guide-lines-add-config-link",click:function(){this.showDialogForAddingANewConfiguration(function(n,m){if(!n){return}if(m.type==="new"){this.maskGrid();this.clearSaveTimeout();this.saveAllChanges(function(){this.generateNewMGConfiguration(m.name,undefined,function(){this.refreshMGGrid();this.scrollToNewConfig()}.bind(this))}.bind(this));return}if(m.type==="copy"){this.maskGrid();this.clearSaveTimeout();this.saveAllChanges(function(){this.generateNewMGConfiguration(m.name,m.copyId,function(){this.refreshMGGrid();this.scrollToNewConfig()}.bind(this))}.bind(this));return}}.bind(this))}.bind(this)});l.add(this.addConfigurationLink);l.doLayout()},initMGGrid:function(l){this.guideLinesGrid=new Ext.ux.grid.LockingEditorGridPanel({columns:[this.getIndexGuideLineColumn(),this.getCategoryRuleGuideLineColumn()],autoHeight:false,disableSelection:true,enableDragDrop:false,enableHdMenu:false,enableColumnHide:false,enableColumnMove:false,viewConfig:{forceFit:false},cls:"ak-guide-lines-grid",store:this.guideLinesStore});this.guideLinesGrid.on("render",function(m){this.resizeGridBody();this.maskGrid();this.initMGColumns(function(){this.loadAllMGConfigurations(function(n){n.each(function(p){this.addExistingConfigurationToGrid(p)}.bind(this));this.refreshMGGrid()}.bind(this))}.bind(this))}.bind(this));this.guideLinePanel=l;this.guideLinePanel.on("resize",this.handleResize.bind(this));this.guideLinePanel.on("destroy",function(){this.clearSaveTimeout();this.saveAllChanges();this.customMappings=[];this.customHeaderRules=[];this.mappedAttributes=[];this.customMappings=[]}.bind(this));l.add(this.generateLegendPanel());l.add(this.guideLinesGrid);l.doLayout()},handleEmptyRows:function(l){l.getEl().query(".x-grid3-row").each(function(n){var m=Ext.get(n).query(".ak-empty-cell");if(m.length>0){$(n).addClassName("x-empty-row")}})},handleResize:function(){var p=this.guideLinePanel.el.getHeight();var r=this.guideLinePanel.el.getWidth();var m=this.descriptionPanel.el.getHeight();var q=this.addConfigurationLink.el.getHeight();var l=p-m-q-30;var n=r-20;this.guideLinesGrid.setHeight(l);this.guideLinesGrid.setWidth(n);this.resizeGridBody();this.guideLinesGrid.syncSize()},resizeGridBody:function(){var q=this.guideLinesGrid;var p=this.guideLinePanel.el.getHeight();var m=this.descriptionPanel.el.getHeight();var r=this.addConfigurationLink.el.getHeight();var l=p-m-r-30;var n=q.el.child(".x-grid3");if(n){n.setHeight(l)}},scrollToNewConfig:function(){var l=this.getScrollContainer();if(l!==null&&l.dom.childNodes[0]){var m=l.dom.childNodes[0].scrollWidth;if(m>0){l.scrollTo("left",m,true)}}},createSymbol:function(m,l,n){var p=document.createElement("div");p.className=l+"-symbol";var q=document.createElement("div");if(Ext.isIE8===false){q.textContent=n}else{q.innerText=n}q.className=l+"-text";m.body.dom.appendChild(p);m.body.dom.appendChild(q)},createCouldSymbol:function(l){this.createSymbol(l,"ak-guideline-grid-legend-could",h.legendCould)},createShouldSymbol:function(l){this.createSymbol(l,"ak-guideline-grid-legend-should",h.legendShould)},createMustSymbol:function(l){this.createSymbol(l,"ak-guideline-grid-legend-must",h.legendMust)},generateLegendPanel:function(){var l=new Ext.Panel({height:18,border:false,cls:"ak-guide-lines-grid-legend"});var m=this;l.on("render",function(n){m.createMustSymbol(n);m.createShouldSymbol(n);m.createCouldSymbol(n);l.doLayout()});return l},maskGrid:function(){Ext.get(this.guideLinesGrid.el).mask(h.loadGrid,"disabled")},unmaskGrid:function(){Ext.get(this.guideLinesGrid.el).unmask()},showDialogForAddingANewConfiguration:function(v){var r=new Ext.Panel({html:h.addDescriptionText,bodyStyle:"padding-bottom:10px; color:#666666;",anchor:"100%",border:false});var s=new Ext.form.Radio({checked:true,boxLabel:h.newConfig,name:"createNewConfigGroup",ctCls:"ak-guide-lines-add-config-name-radio-button-container",cls:"ak-guide-lines-add-config-name-radio-button"});var x=new Ext.form.TextField({width:266,emptyText:h.configName,cls:"ak-guide-lines-add-config-name-textfield",listeners:{focus:function(){s.setValue(true)}}});var p=new Ext.Panel({border:false,items:[s,x]});var l=new Ext.form.Radio({checked:false,boxLabel:h.copyFrom,name:"createNewConfigGroup",ctCls:"ak-guide-lines-add-config-copy-radio-button-container",cls:"ak-guide-lines-add-config-name-radio-button"});var w=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","id"],data:this.currentMGConfigurations.map(function(z){var y=[];y[0]=h.RulesName[z.name]||z.name;y[1]=z.id;return y})}),displayField:"name",mode:"local",editable:false,triggerAction:"all",selectOnFocus:true,valueField:"id",width:220,emptyText:h.selectConfig,cls:"ak-guide-lines-add-config-copy-combo",listeners:{focus:function(){l.setValue(true)}}});var t=new Ext.form.Label({text:h.withNameConfig,cls:"ak-guide-lines-add-copy-config-name-label"});var q=new Ext.form.TextField({width:220,emptyText:h.emptyConfigName,cls:"ak-guide-lines-add-copy-config-name-textfield",listeners:{focus:function(){l.setValue(true)}}});var u=new Ext.Panel({border:false,items:[l,w,t,q]});var n=new Ext.Panel({border:false,items:[r,p,u]});var m=new Ext.ux.Window({modal:true,title:h.addConfigTitle,items:[n],autoHeight:true,resizable:false,closable:false,width:350,cancelButton:{text:h.cancelConfig,handler:function(){m.close();if(v instanceof Function){v(false)}}.bind(this)},buttons:[{text:h.addConfigButton,handler:function(){var B={};var z,A;if(s.getValue()===true){B.type="new";z=x.getValue();if(z&&z.trim()!==""){B.name=z}else{A=Ext.MessageBox.alert(h.addConfigTitle,h.addConfigMissingName);A.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout();return}}if(l.getValue()===true){B.type="copy";z=q.getValue()||"";var y=w.getValue()||"";if(z.trim()!==""&&y.trim()!==""){B.name=z;B.copyId=y}else{A=Ext.MessageBox.alert(h.addConfigTitle,h.addConfigMissingNameAndType);A.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout();return}}if(v instanceof Function){v(true,B)}m.close()}.bind(this)}]});m.show()},getScrollContainer:function(){return this.guideLinesGrid.el.child(".x-grid3-viewport").child(".x-grid3-scroller")||null},refreshMGGrid:function(){isSaveMonitoringActive=true;this.refreshMGColumnsUI();this.refreshCellEditors();this.setValueForConfigurations();this.applyReadOnlyConfigurations();this.handleEmptyRows(this.guideLinesGrid);this.unmaskGrid();if(Ext.isIE8===true){this.handleResize()}isSaveMonitoringActive=false},getNameOfCategory:function(l){if(l.name&&l.name.trim()!==""){return l.name}return h.Rules[l.categoryID]||""},getNameOfRule:function(l){if(l.name&&l.name.trim()!==""){return l.name}return h.Rules[l.ruleID]||""},createRule:function(s,m,p,x,u){u+=1;var y=this.getNameOfRule(x);var r=this.generateNewRuleRecord(y,x.ruleID,x[x.ruleID],m+"."+u,p);s.push(r);if(x[x.ruleID].ruleType==="grouped"){var w=x[x.ruleID].subRules||[];w.each(function(D){var B=x.ruleID+"@"+D.ruleID;var z=this.getNameOfRule(D)||D.ruleID;var A=D[D.ruleID];var C=this.generateNewSubRuleRecord(z,B,A,r,"");s.push(C)}.bind(this))}if(x[x.ruleID].ruleType==="groupedCall"){var v=Signavio.Config.BACKEND_PATH+x[x.ruleID].uri;var l=r;if(x.ruleID.startsWith("zz_CustomRule")){this.registerCustomHeaderRule(r)}if(x.ruleID.startsWith("AttributeChecker")){this.registerAddCustomMapping(r)}var q=function(B){var A=B.rep||[];var z=[];A.each(function(F){var E=x.ruleID+"@"+F.ruleID;var D=F[F.ruleID];var C=this.getNameOfRule(F);if(D.ruleType==="custom"){C=D.name}D.readonly=F.readonly;if(typeof(F[F.ruleID].singleToMultiSelect)!=="undefined"){D.ruleType="singleToMultiSelect"}var G=this.generateNewGroupedCallRuleRecord(C,E,D,l,"");if(x.ruleID==="AttributeChecker"){this.registerAttributeMapper(G)}if(D.ruleType==="custom"){this.registerCustomRule(G)}z.push(G)}.bind(this));this.facade.raiseEvent(Signavio.Const.EVENT.REQUEST_FOR_RULE_IS_READY,z)}.bind(this);var t=function(){this.showErrorMessage(err);this.facade.raiseEvent(Signavio.Const.EVENT.REQUEST_FOR_RULE_IS_READY,[])}.bind(this);this.facade.raiseEvent("add.dependant.request");var n={category:r.get("parentCategoryId")};Signavio.Core.Stores.RequestManager.doGet(v,[q,t],n)}},createCategory:function(l,p,n){n+=1;var r=this.getNameOfCategory(p);var m=this.generateNewCategoryRecord(r,p.categoryID,n);l.push(m);if(!p.rules){return}var q=p.categoryID;p.rules.each(this.createRule.bind(this,l,n,q));if(this.metaModellingGuideLines.length!==n){l.push(this.generateDummyRowRecord())}},processRecords:function(m){var n={};m.each(function(q){var r=q.get("parentRule").get("mgId");if(!n[r]){n[r]={record:q.get("parentRule"),subRecords:[]}}n[r].subRecords.push(q)});var l=[];for(var p in n){l.push(n[p])}return l},handleLoad:function(m,l,n){this.processRecords(m).sort(function(q,p){return(parseInt(q.record.get("mgIndex"),10)-parseInt(p.record.get("mgIndex"),10))}).each(function(t){var r=t.subRecords;var u=r.first();if(u){var q=l.indexOf(u.get("parentRule"))+1;var s=l.slice(0,q);var p=l.slice(q,l.length);l=[].concat(s,r,p)}});this.guideLinesStore.add(l);if(n instanceof Function){n()}},setupRequestSynchronization:function(s){var l=[];var r=this;var m=0;var p=function(){m+=1};var n=[];this.facade.registerOnEvent("add.dependant.request",p);var q=function(u,t){m-=1;if(t){n=n.concat(t)}if(m>0){return}r.facade.unregisterOnEvent(Signavio.Const.EVENT.REQUEST_FOR_RULE_IS_READY,q);r.facade.unregisterOnEvent("add.dependant.request",p);r.handleLoad(n||[],l,s);n=[]};this.facade.registerOnEvent(Signavio.Const.EVENT.REQUEST_FOR_RULE_IS_READY,q);return l},initMGColumns:function(m){var l=this.setupRequestSynchronization(m);this.loadAllMetaMGs(function(p){p.each(this.createCategory.bind(this,l));var n;if(this.editableMode===false){this.mgPanel.el.addClass("ak-guidelines-no-editable-mode");n=Signavio.I18N.MetaModellingGuidelines.descriptionTextCorporate}else{this.mgPanel.el.addClass("ak-guidelines-editable-mode");n=Signavio.I18N.MetaModellingGuidelines.descriptionTextUltimate}this.descriptionPanel.body.update(n);this.handleResize()}.bind(this))},loadAllMetaMGs:function(l,m){var p=function(q){this.metaModellingGuideLines=q.rep.rules||[];this.editableMode=q.rep.editable;if(l){l(this.metaModellingGuideLines)}}.bind(this);var n=function(q){this.showErrorMessage(q);if(m){m(q)}}.bind(this);Signavio.Core.Stores.RequestManager.doGet(this.metaMGUrl,[p,n],{})},loadAllMGConfigurations:function(l,m){var p=function(s){var r=s.rep;this.currentMGConfigurations=r.sort(function(u,t){if(u.locked&&!t.locked){return -1}if(!u.locked&&t.locked){return 1}if(u.readonly&&!t.readonly){return -1}if(!u.readonly&&t.readonly){return 1}return 0});if(l){l(s.rep)}}.bind(this);var n=function(r){this.showErrorMessage(r);if(m){m(r)}}.bind(this);var q={};Signavio.Core.Stores.RequestManager.doGet(this.configurationsUrl,[p,n],q)},generateNewMGConfiguration:function(p,l,r){if(!p){return}var n=function(t){var s=t.rep;if(s){this.currentMGConfigurations.push(s);this.addExistingConfigurationToGrid(s);if(r instanceof Function){r(s)}}}.bind(this);var m=function(s){this.showErrorMessage(s)}.bind(this);var q={guidelineName:p};if(l){q.copyId=l}Signavio.Core.Stores.RequestManager.doPost(this.configurationsUrl,[n,m],q)},showErrorMessage:function(l){var m=Ext.MessageBox.alert(h.modellingGuideLines,h.errorRequest);m.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout()},addExistingConfigurationToGrid:function(m){if(!m){return}var q=m.name;if(m.readonly&&m.readonly===true){q=h.RulesName[m.name]}var p=this.getConfigGuideLinesColumn(m.id,q);var n=this.guideLinesGrid.getColumnModel();if(n){var l=(n.config||[]);p.readonly=m.readonly;l.push(p);n.setConfig(l)}},putModifiedMGConfigurations:function(l,q){var n=function(r){(r.rep||[]).each(function(s){this.currentMGConfigurations.each(function(u,t){if(u.id===s.id){this.currentMGConfigurations[t]=s}}.bind(this))}.bind(this));if(q instanceof Function){q("success",r)}}.bind(this);var m=function(r){this.showErrorMessage(r);if(q instanceof Function){q("fail",r)}}.bind(this);var p={guidelines:l};Signavio.Core.Stores.RequestManager.doPut(this.configurationsUrl,[n,m],p)},removeMGConfigurationById:function(q,p){var m=function(r){if(r.success){this.removeMGConfigurationColumnById(q);if(p instanceof Function){p(r)}}else{this.showErrorMessage(r)}}.bind(this);var l=function(r){this.showErrorMessage(r)}.bind(this);var n={id:q};Signavio.Core.Stores.RequestManager.doDelete(this.configurationsUrl,[m,l],n)},removeMGConfigurationColumnById:function(q){var p=this.guideLinesGrid.getColumnModel();var m=[];if(!p){return}var n=p.config;n.each(function(r){if(r.dataIndex!==q){m.push(r)}});p.setConfig(m);var l=this.getMGConfigurations();this.currentMGConfigurations=[];l.each(function(r){if(r.id!==q){this.currentMGConfigurations.push(r)}}.bind(this))},removeOldComponentesFromHeader:function(l){var m=Ext.get(l).child(".ak-mg-activate-checkbox");if(m!==null){m.remove()}var n=Ext.get(l.parentNode).child(".ak-mg-header-tool-container");if(n!==null){n.remove()}},createActivateCheckbox:function(m,q){var p=new Element("input",{type:"checkbox"});p.addClassName("ak-mg-activate-checkbox");var l=function(r){if(r){m.removeClass("ak-mg-header-non-active");m.addClass("ak-mg-header-active")}else{m.addClass("ak-mg-header-non-active");m.removeClass("ak-mg-header-active")}};p.toggle=function(r){if(typeof r!=="undefined"){this.checked=r}else{this.checked=!this.checked}l(this.checked)};var n=this;p.observe("click",function(){l(this.checked);n.newChangesForConfiguration(q.id)});p.toggle(q.isActive);return p},createRemoveLink:function(n){var m=this;var l=new Element("a");l.addClassName("ak-mg-header-remove-link");l.insert(h.removeGuideline);if(n.readonly){l.addClassName("ak-mg-disabled-remove-link")}l.observe("click",function(){if(n.readonly){return}Ext.MessageBox.confirm(h.modellingGuideLines,h.deleteConfig,function(p){if(p==="no"){return}m.maskGrid();m.clearSaveTimeout();m.saveAllChanges(function(){m.removeMGConfigurationById(n.id,function(){m.refreshMGGrid()})})}).setIcon(Ext.MessageBox.WARNING).getDialog().doLayout();return false});return l},createOptionCheckbox:function(m,l){return new Ext.form.Checkbox({renderTo:m,checked:l.active,configId:l.id,boxLabel:l.label,listeners:{render:function(){this.wrap.addClass("ak-mg-header-options-"+l.type+"-at-checkbox")},check:function(){if(l.type==="button"){this.newChangesForConfiguration(l.id)}}.bind(this)}})},createOptionCheckboxes:function(l,m){return{button:this.createOptionCheckbox(l,{active:m.checkOnButton||false,label:h.atButton,type:"button",id:m.id}),save:this.createOptionCheckbox(l,{active:m.checkOnSave||false,label:h.atSave,type:"save",id:m.id})}},createHeaderTools:function(v,u,l){this.removeOldComponentesFromHeader(v);var r=this.createActivateCheckbox(u,l);v.appendChild(r);var w=l.name;if(l.readonly===true){w=h.RulesName[l.name]}if(Ext.isIE8===false){v.setAttributeNS(null,"title",w)}else{v.setAttribute("title",w)}var n=new Element("div");n.addClassName("ak-mg-header-tool-container");u.appendChild(n);var t=this.createRemoveLink(l);n.appendChild(t);var s=new Element("div");s.addClassName("ak-mg-header-tool-active-container");n.appendChild(s);var q=new Ext.form.Label({text:Signavio.I18N.MetaModellingGuidelines.headerInEditor,renderTo:s,cls:"ak-guidelines-grid-header-check-label"});var m=this.createOptionCheckboxes(s,l);var p=this;m.save.on("check",function(y,A){if(A===true){var z=p.currentMGConfigurations||[];var x=0;z.each(function(C){if(C.id!==y.configId){var B=p.configurationHeaderObjects[C.id].checkAtSaveCheckbox;if(B&&B.getValue()===true){x+=1}}});if(x>4){Ext.MessageBox.alert(h.moreThanFiveAtSaveConfigsTitle,h.moreThanFiveAtSaveConfigsDesc).setIcon(Ext.MessageBox.WARNING).getDialog().doLayout();y.suspendEvents();y.setValue(false);y.resumeEvents();return}}p.newChangesForConfiguration(y.configId)});this.configurationHeaderObjects[l.id]={checkAtSaveCheckbox:m.save,checkAtButtonCheckbox:m.button,activateConfigCheckbox:r};this.guideLinesGrid.ownerCt.doLayout()},updateHeaderCells:function(l){var m=this.getMGConfigurations();var n=this;l.each(function(p,q){var r=Ext.get(p.parentNode);r.addClass("ak-header-cell-mg");var s=m[q];if(q%2===0){r.addClass("ak-even-header-cell")}else{r.addClass("ak-odd-header-cell")}n.createHeaderTools(p,r,s)})},refreshMGColumnsUI:function(){this.configurationHeaderObjects={};var l=this.guideLinesGrid.getEl().query(".x-grid3-unlocked .x-grid3-hd-row .x-grid3-hd-inner");this.headerUIConfigMap={};this.updateHeaderCells(l)},getMGConfigurations:function(){return this.currentMGConfigurations||[]},getMetaModellingGuideLines:function(){if(!this.metaModellingGuideLines){return[]}return this.metaModellingGuideLines||[]},getCategoryById:function(l){return this.getMetaModellingGuideLines().find(function(m){return m.categoryID===l})},getRuleById:function(l){return this.getMetaModellingGuideLines().map(function(m){return m.rules}).flatten().find(function(m){return m.ruleID===l})},registerSomething:function(m,l){if(!this[m]){this[m]=[]}this[m].push(l)},registerCustomRule:function(l){this.registerSomething("customRules",l)},registerCustomHeaderRule:function(l){this.registerSomething("customHeaderRules",l)},registerAttributeMapper:function(l){this.registerSomething("mappedAttributes",l)},registerAddCustomMapping:function(l){this.registerSomething("customMappings",l)},getDummyProp:function(l){var m=l.get("mgTitle");if(l.get("mgRuleType").config){m=l.get("mgRuleType").config.name}return{stencil:function(){return{properties:Ext.emptyFn}},title:function(){return h.attributeChecker},config:function(){return{hideRootElements:false,enforceRootElements:true,manager:"ModellingsGuidelinesManager",managerConfig:{hideBottom:true,description:h.attributeCheckerDescription,name:m}}}}},parseOldValue:function(l,n){var m=[];n.singleToMultiSelect.each(function(p){m=m.concat(p.attributes.map(function(q){return{stencilset:a,stencil:p.stencilId,id:q}}))});return{items:m,config:n.config||{}}},showWindowForCustomRule:function(n,q,p,t){var u;if(q){q=Signavio.Utils.unescapeHTML(q)}if(p){p=Signavio.Utils.unescapeHTML(p)}var l=new Ext.form.TextField({fieldLabel:h.ruleName,emptyText:h.emptyRuleName,value:q||"",cls:"ak-guide-lines-add-custom-rule-name-textbox"});var s=new Ext.form.TextArea({fieldLabel:h.ruleDescription,emptyText:h.emptyRuleDescription,value:p||"",maxLength:1000,maxLengthText:h.maxDescriptionLengthError,cls:"ak-guide-lines-add-custom-rule-description-textbox",itemCls:"ak-guide-lines-add-custom-rule-description-form-item"});var r;if(n===false){r=[{text:h.addCustomRuleButton,handler:function(){var w=l.getValue()||"";var v=s.getValue()||"";if(s.isValid()===false){return}if(w.trim()===""||v.trim()===""){msg=Ext.MessageBox.alert(h.addCustomRuleErrorTitle,h.addCustomRuleErrorDescription);msg.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout();return}u.close();var x={name:Signavio.Utils.escapeHTML(w),description:Signavio.Utils.escapeHTML(v)};if(t instanceof Function){t("add",x)}}.bind(this)}]}else{r=[{text:h.editCustomRuleButton,handler:function(){if(s.isValid()===false){return}var w=l.getValue()||"";var v=s.getValue()||"";if(w.trim()===""||v.trim()===""){msg=Ext.MessageBox.alert(h.addCustomRuleErrorTitle,h.addCustomRuleErrorDescription);msg.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout();return}u.close();var x={name:Signavio.Utils.escapeHTML(w),description:Signavio.Utils.escapeHTML(v)};if(t instanceof Function){t("edit",x)}}.bind(this)}]}var m=new Ext.Panel({border:false,layout:"form",items:[l,s]});u=new Ext.ux.Window({modal:true,cls:"ak-guide-lines-add-custom-rule-window",title:(n===false)?h.addCutomRuleTitle:h.editCustomRule,items:[m],autoHeight:true,resizable:false,width:420,onEsc:function(){u.close();if(t instanceof Function){t("cancel")}},cancelButton:{text:h.cancelCustomRule,handler:function(){u.close();if(t instanceof Function){t("cancel")}}.bind(this)},buttons:r});if(n===true){u.on("render",function(w){var v=new Ext.Button({text:h.removeCustomRuleButton,renderTo:w.footer,cls:"ak-guide-lines-add-custom-rule-remove-button",handler:function(){Ext.MessageBox.confirm(h.editCustomRule,h.removeCustomRuleConfirm,function(x){if(x=="yes"){u.close();if(t instanceof Function){t("remove")}}},this).setIcon(Ext.MessageBox.WARNING).getDialog().doLayout()}})}.bind(this))}u.show()},handleCustomMappingHeaderClick:function(l){var m=this.getAttributeMapper(l);var n=this;m.onWindowRendered=function(q){var r=h.Rules.My_AttributeChecker;var p=q.el.child(".x-form-text").id;if(p&&Ext.getCmp(p)){Ext.getCmp(p).setValue(r)}};m.onSave=function(q,r){n.maskGrid();r=r.evalJSON(true);var p=n.parseMappingValue(r);n.saveMapping(l,{singleToMultiSelect:p,config:r.config})};m.onTriggerClick()},getInsertPosition:function(l){return this.getRulePosition(l)+this.getRuleCount(l)+1},getRulePosition:function(n){var l=this.guideLinesGrid.getStore();var m;l.each(function(p,q){if(p.get("mgId")===n){m=q;return false}});return m},getRuleCount:function(n){var m=this.guideLinesGrid.getStore();var l=m.queryBy(function(p){var q=p.get("parentRule");return q&&q.get("mgId")===n});return l.length},getRule:function(n){var l=this.guideLinesGrid.getStore();var m=this.getRulePosition(n);return l.getAt(m)},handleRuleAdd:function(p,l,n){var m=this;this.clearSaveTimeout();this.saveAllChanges(function(){var s=n.rep;var r=m.getRule(p);s[s.ruleID].readonly=s.readonly;var t=m.getRuleId(p,s);var q=m.insertRuleAt(s,t,r,l);m.addEditorsForAddedRule(q,t,r,l);m.unmaskGrid()})},addEditorsForAddedRule:function(n,l,t,p){var q=this.getMGConfigurations();var s=this.guideLinesGrid.getView();var r=n.get("mgRuleType");if(!r.ruleType){return}var m=s.getRow(p);var u=m.getElementsByTagName("td");this.refreshCells($A(u),n,q)},insertRuleAt:function(q,r,p,m){var l=this.generateNewGroupedCallRuleRecord(this.getRuleName(q,q.ruleID),r,q[q.ruleID],p,"");if(typeof q[q.ruleID].singleToMultiSelect!=="undefined"){var n=l.get("mgRuleType");n.ruleType="singleToMultiSelect";l.set("mgRuleType",n);this.registerAttributeMapper(l)}else{this.registerCustomRule(l)}this.guideLinesGrid.store.insert(m,l);return l},getRuleId:function(l,m){return l+"@"+(m.ruleID||m||"")},getRuleName:function(l){return l[l.ruleID].name||l.name},handleCustomRuleHeaderClick:function(q,p){p.preventDefault();p.stopPropagation();var l=q.get("mgRuleType");var n=q.get("parentCategoryId");var m=q.get("mgId");this.showWindowForCustomRule(false,undefined,undefined,function(t,w){if(t!=="add"){return}this.maskGrid();var s=Signavio.Config.BACKEND_PATH+l.uri;var r=this.getInsertPosition(m);var v=this.handleRuleAdd.bind(this,m,r);var u=function(x){this.showErrorMessage(x);this.unmaskGrid()}.bind(this);var w={name:w.name,description:w.description,category:n};Signavio.Core.Stores.RequestManager.doPost(s,[v,u],w)}.bind(this));p.returnValue=false;return false},handleCustomRuleEditClick:function(m,p){p.preventDefault();var l=m.get("mgRuleType").name;var n=m.get("mgRuleType").description;this.showWindowForCustomRule(true,l,n,function(q,r){if(q==="remove"){this.removeCustomRule(m)}else{if(q==="edit"){this.editCustomRule(m,r.name,r.description)}}}.bind(this));return false},editCustomRule:function(m,p,n){this.maskGrid();var t=m.get("mgId");t=t.slice(t.indexOf("@")+1);var l=m.get("parentRule");var r=Signavio.Config.BACKEND_PATH+l.get("mgRuleType").uri;var s={};s.ruleID=t;s[t]={ruleType:"custom",name:p,description:n,category:l.get("parentCategoryId")};var u=function(w){var v=m.get("mgRuleType");v.name=p;v.description=n;m.set("mgRuleType",v);this.saveAllChanges(function(){var z=this.guideLinesStore.indexOf(m);var y=this.guideLinesGrid.el.child(".x-grid3-locked");var x=y.select(".x-grid3-row");var C=Ext.get(x.elements[z]);var B=C.child(".ak-rule-tooltip").dom;var A=Signavio.Utils.unescapeHTML(v.name);B.textContent=Signavio.Helper.TruncateByWidth(A,300,"...");if(Ext.isIE8===false){B.setAttributeNS(null,"title",Signavio.Utils.unescapeHTML(v.description))}else{B.setAttribute("title",Signavio.Utils.unescapeHTML(v.description))}this.unmaskGrid()}.bind(this))}.bind(this);var q=function(v){this.showErrorMessage(v);this.unmaskGrid()}.bind(this);Signavio.Core.Stores.RequestManager.doPut(r,[u,q],{mgcustomrule:s})},removeCustomRule:function(q){this.maskGrid();var v=q.get("mgId");v=v.slice(v.indexOf("@")+1);var p=q.get("parentRule");var u=p.get("mgRuleType").uri;var t=Signavio.Config.BACKEND_PATH+u;var l={id:v};var m=function(x){this.unmaskGrid();this.guideLinesStore.remove(q)}.bind(this);var r=function(x){this.unmaskGrid();this.showErrorMessage(x)}.bind(this);Signavio.Core.Stores.RequestManager.doDelete(t,[m,r],l);var w=this.currentMGConfigurations;var n=q.get("mgId").substr(0,(q.get("mgId").indexOf("@")));var s=[];w.each(function(y){if(y.readonly===false){var x=this.serializeConfigurationById(y.id);if(typeof x.ruleConfigurations[n].ruleConfig.warnLevel[v]!=="undefined"){delete x.ruleConfigurations[n].ruleConfig.warnLevel[v]}s.push(x)}}.bind(this));this.currentMGConfigurations=w;if(s.length>0){this.putModifiedMGConfigurations(s)}},getAttributeMapper:function(l){var q=this.getDummyProp(l);var n=new Ext.ux.propertyeditor.AttributeMapper(q,this.facade);var p=this;n.on("render",function(r){});n.restrictions={stencilsets:{positiveLogic:true,stencilsets:[a]},elements:{stencils:[],attributes:[],managers:["Ext.ux.propertyeditor.ModellingsGuidelinesManager"]}};var m=l.get("mgRuleType");if(m.readonly===false){n.windowCreate.buttons=[{text:h.removeAttributeChecker,cls:"ak-guide-lines-remove-attribute-mapping",handler:function(){var r=this.ownerCt;var s=Ext.MessageBox.confirm(h.removeAttributeCheckerTitle,h.removeAttributeCheckerDesc,function(t){if(t!=="yes"){return}p.maskGrid();p.removeCustomRule(l);r.close()});s.setIcon(Ext.MessageBox.WARNING);s.getDialog().doLayout()}}]}return n},handleMappingClick:function(l,s){s.preventDefault();var p=l.get("mgRuleType");var q=this;if(!p.singleToMultiSelect){return}var n=this.getAttributeMapper(l);var r=this.parseOldValue(l,p);if(p.readonly){var m=function(w,t,u){this.facade.unregisterOnEvent(Signavio.Config.Events.AttributeMapper.PanelExpanded,m);var v=t.ownerCt;v.setReadonly(true,true);u.setReadonly(true)}.bind(this);this.facade.registerOnEvent(Signavio.Config.Events.AttributeMapper.PanelExpanded,m)}n.getValue=function(){return $H(r).toJSON()};n.onSave=function(u,v){if(p.readonly){return}q.maskGrid();v=v.evalJSON(true);var t=q.parseMappingValue(v);l.get("mgRuleType").singleToMultiSelect=t;l.get("mgRuleType").config=v.config;l.commit(true);q.updateMapping(l)};n.onWindowRendered=function(t){if(p.readonly){if(t.buttons&&t.buttons.length>1){t.buttons[0].el.remove();t.buttons[1].setText(h.closeAttributeChecker)}}};n.onTriggerClick();return false},parseMappingValue:function(n){var m={};(n.items||[]).each(function(p){if(!m[p.stencil]){m[p.stencil]=[]}m[p.stencil].push(p.id)});var l=$H(m).keys().map(function(p){return{stencilId:p,attributes:m[p]}});return l},updateMapping:function(l){var p=l.get("parentRule");var n=p.get("mgRuleType");var m=Signavio.Config.BACKEND_PATH+n.uri;var r=l.get("mgId");var q={mgattribute:{singleToMultiSelect:l.get("mgRuleType").singleToMultiSelect,ruleID:r.slice(r.indexOf("@")+1),config:l.get("mgRuleType").config}};Signavio.Core.Stores.RequestManager.doPut(m,[this.handleAttributeMapperUpdate.bind(this,l)],q)},handleAttributeMapperUpdate:function(u,r){var x=u.get("parentRule");var m=r.rep.ruleID;var p=r.rep[m].config;var w=r.rep[m].singleToMultiSelect;var t=u.get("mgRuleType");t.config=p;t.singleToMultiSelect=w;var s=this.guideLinesStore.indexOf(u);var n=this.guideLinesGrid.el.child(".x-grid3-locked");var q=n.select(".x-grid3-row");var y=Ext.get(q.elements[s]);var v=y.child(".ak-rule-tooltip").dom;var l=Signavio.Utils.unescapeHTML(u.get("mgRuleType").config.name);if(v){v.childNodes[0].textContent=Signavio.Helper.TruncateByWidth(l,300,"...")}this.unmaskGrid()},saveMapping:function(l,r){var q=l.get("mgRuleType");var n=Signavio.Config.BACKEND_PATH+q.uri;var s={mgattribute:r};var p=l.get("mgId");var m=this.getInsertPosition(p);Signavio.Core.Stores.RequestManager.doPost(n,[this.handleRuleAdd.bind(this,p,m)],s)},initSomething:function(p,l,q,m){if(this[p]){window.clearTimeout(this[p])}var n=this;this[p]=Signavio.Utils.defer(function(){(l||[]).each(function(r){var s=$(q+"-"+r.id);if(s){s.stopObserving("click");s.observe("click",function(t){t.preventDefault();return m(r,t)})}})})},initAttributeMapper:function(){this.initSomething("updating",this.mappedAttributes,"mapping",this.handleMappingClick.bind(this))},initCustomRules:function(){this.initSomething("updateCustomRules",this.customRules,"delete-custom-rule",this.handleCustomRuleEditClick.bind(this))},initCustomRulesHeader:function(){this.initSomething("updateCustomRulesHeader",this.customHeaderRules,"add-custom-rule",this.handleCustomRuleHeaderClick.bind(this))},initCustomMapping:function(){this.initSomething("updateCustomMapping",this.customMappings,"add-custom-mapping",this.handleCustomMappingHeaderClick.bind(this))},hasMapping:function(l,m){var n=l.get("mgRuleType");return n.config||n[m]&&n[m].length>0},renderMapping:function(l,m){if(this.hasMapping(l,m)){icon="ak-icon-edit";if(l.get("mgRuleType").readonly){icon="ak-icon-view"}return" <a href='#' class='ak-mapping-rule-link' id='mapping-"+l.id+"'><span class='ak-guidelines-icon "+icon+"'></span></a>"}return" <a href='#' class='ak-mapping-rule-link' id='mapping-"+l.id+"'>"+h.addAttributeChecker+"</a>"},renderCustomRuleLinks:function(l){return" <a href='#' class='add-custom-rule-link' id='add-custom-rule-"+l.id+"'>"+h.addNewCustomRule+"</a>"},renderCustomMappingLink:function(l){return" <a href='#' class='ak-mapping-rule-link' id='add-custom-mapping-"+l.id+"'>"+h.addNewRule+"</a>"},getIndexGuideLineColumn:function(){return{id:"guideLinesIndexColumn",locked:true,header:"",fixed:true,menuDisabled:true,align:"right",resizable:false,width:35,sortable:false,hideable:false,dataIndex:"mgIndex",renderer:function(n,l,m,p){l.css+=" ak-index-column-cell";if(m.get("isCategory")){l.css+=" ak-category-cell"}if(m.get("isSubRule")){l.css+=" ak-sub-rule-cell"}if(m.get("isGCRule")){l.css+=" ak-gc-rule-cell"}if(m.get("isRule")){l.css+=" ak-rule-cell"}if(m.get("isEmptyRecord")){l.css+=" ak-empty-cell"}return n}}},getCategoryRuleGuideLineColumn:function(){var l=this;return{id:"modellingMetaGuideLines",header:h.rulesHeader,width:370,sortable:false,resizable:false,hideable:false,locked:true,menuDisabled:true,dataIndex:"mgTitle",renderer:function(r,m,n){m.css+=" ak-category-column-cell";if(n.get("isCategory")){m.css+=" ak-category-cell";return r}if(n.get("isSubRule")){m.css+=" ak-sub-rule-cell"}if(n.get("isGCRule")){m.css+=" ak-gc-rule-cell";if(n.get("mgId").startsWith("AttributeChecker")){r=Signavio.Helper.TruncateByWidth(r,300,"...");r+=l.renderMapping(n,"singleToMultiSelect");l.initAttributeMapper()}}if(n.get("isRule")){m.css+=" ak-rule-cell";if(n.get("mgId").startsWith("zz_CustomRule")&&n.get("isGCRule")===false){r+=l.renderCustomRuleLinks(n);l.initCustomRulesHeader()}if(n.get("mgId").startsWith("AttributeChecker")&&n.get("isGCRule")===false){r+=l.renderCustomMappingLink(n);l.initCustomMapping()}var p="title='"+(h.Rules["desc_"+n.get("mgId")]||"")+"'";if(n.get("mgId").startsWith("zz_CustomRule")&&n.get("isGCRule")===true){var r=n.get("mgRuleType").name;var q=n.get("mgRuleType").description||"";if(n.get("mgRuleType").readonly===true){r=h.Rules[r];q=h.Rules[q]||""}r=Signavio.Helper.TruncateByWidth(r,300,"...");p="title='"+Signavio.Utils.unescapeHTML(q)+"'";r="<div style='float:left' "+p+" class='ak-rule-tooltip'>"+Signavio.Utils.unescapeHTML(r)+"</div>";if(n.get("mgRuleType").readonly===false){r+="<span class='ak-guidelines-icon ak-icon-edit' id='delete-custom-rule-"+n.id+"'></span>";l.initCustomRules()}return r}if(n.data.isSubRule===false&&n.data.isGCRule===false){return"<span "+p+" class='ak-rule-tooltip'>"+r+"</span>"}if(n.data.isSubRule===true||n.data.isGCRule===true){p="title='"+(h.Rules["desc_"+n.get("parentRule").get("mgId")]||"")+"'";return"<span "+p+" class='ak-rule-tooltip'>"+r+"</span>"}}if(n.data.isEmptyRecord){m.css+=" ak-empty-cell"}return r}}},getConfigGuideLinesColumn:function(m,l){return{id:m,header:l,width:250,sortable:false,menuDisabled:true,hideable:false,dataIndex:m,resizable:false,renderer:function(q,n,p){n.css+=" ak-config-cell";if(p.get("isCategory")){n.css+=" ak-category-cell"}if(p.get("isEmptyRecord")){n.css+=" ak-empty-cell"}}}},generateNewRuleRecord:function(p,q,m,l,n){return new Ext.data.Record({mgTitle:p||"",mgId:q,mgRuleType:m,parentCategoryId:n,isCategory:false,isRule:true,isSubRule:false,isGCRule:false,isEmptyRecord:false,mgIndex:(typeof l!=="undefined")?l.toString():""})},generateNewSubRuleRecord:function(p,q,n,m,l){return new Ext.data.Record({mgTitle:p||"",mgId:q,mgRuleType:n,isCategory:false,isRule:true,isEmptyRecord:false,isGCRule:false,isSubRule:true,parentRule:m,mgIndex:(typeof l!=="undefined")?l.toString():""})},generateNewGroupedCallRuleRecord:function(p,q,n,m,l){return new Ext.data.Record({mgTitle:p||"",mgId:q,mgRuleType:n,isCategory:false,isRule:true,isEmptyRecord:false,isGCRule:true,isSubRule:false,parentRule:m,mgIndex:(typeof l!=="undefined")?l.toString():""})},generateNewCategoryRecord:function(m,n,l){return new Ext.data.Record({mgTitle:m||"",mgId:n,isCategory:true,isRule:false,isEmptyRecord:false,isGCRule:false,isSubRule:false,mgIndex:(typeof l!=="undefined")?l.toString():""})},generateDummyRowRecord:function(){return new Ext.data.Record({mgTitle:"",mgId:"",isCategory:false,isRule:false,isSubRule:false,isGCRule:false,isEmptyRecord:true,mgIndex:""})},getEditorMethod:function(l){return"generate"+l.ruleType.toUpperCase()+"Editor"},hasEditor:function(l){return !!this[this.getEditorMethod(l)]},getEditor:function(l,m){return this[this.getEditorMethod(l)](m,l)},stubEditor:function(l,n,m){return{type:l,relatedRuleId:n,subRules:m||[]}},getEditorStub:function(m,l){if(m.ruleType==="grouped"){return this.stubEditor(d.GROUPED_EDITOR,l,m.subRules)}if(m.ruleType==="groupedCall"){return this.stubEditor(d.GROUPED_CALL_EDITOR,l)}return null},createEditor:function(l,r,m){var q=m.get("mgRuleType");var p=m.get("mgId");if(this.hasEditor(q)){var n=this.getEditor(q,r);if(n&&n.dom){n.relatedRuleId=p;l.appendChild(n.dom);return n}return null}return this.getEditorStub(q,p)},refreshCells:function(v,q,r){var n=q.get("mgId");for(var p=0,m=v.length;p<m;p++){var l=r[p].id;var s=this.editorConfigMaps.get(l);var u=v[p];u.innerHTML="";var t=this.createEditor(u,l,q);if(r[p].readonly===true&&t.setDisabled instanceof Function){t.setDisabled(true)}s[n]=t;this.editorConfigMaps.set(l,s)}},refreshCellEditors:function(){this.editorConfigMaps=new Hash();var m=this.getMGConfigurations();m.each(function(n){this.editorConfigMaps.set(n.id,{})}.bind(this));var l=this.guideLinesGrid.getView();this.guideLinesStore.each(function(n,r){if(!n.get("isRule")||typeof n.get("mgRuleType")==="undefined"){return}var s=n.get("mgRuleType");if(!s.ruleType){return}var q=l.getRow(r);var p=q.getElementsByTagName("td");this.refreshCells($A(p),n,m)}.bind(this))},saveAllChanges:function(m){m=m||Ext.emptyFn;var l=[];(this.hasToBeSaveConfigurations||[]).each(function(n){l.push(this.serializeConfigurationById(n))}.bind(this));this.hasToBeSaveConfigurations=[];if(l.length>0){this.putModifiedMGConfigurations(l,m)}else{m()}},newChangesForConfiguration:function(l){if(isSaveMonitoringActive===true){return}this.hasToBeSaveConfigurations=this.hasToBeSaveConfigurations||[];this.clearSaveTimeout();if(!this.hasToBeSaveConfigurations.include(l)){this.hasToBeSaveConfigurations.push(l)}this.saveTimeoutRoutine=window.setTimeout(function(){this.clearSaveTimeout();this.saveAllChanges()}.bind(this),j)},clearSaveTimeout:function(){if(!this.saveTimeoutRoutine){return}window.clearTimeout(this.saveTimeoutRoutine);delete this.saveTimeoutRoutine},serializeConfigurationById:function(l){var n=this.editorConfigMaps.get(l);var q=Object.clone(this.getMGConfigurations().find(function(x){return x.id===l}));var w=this.configurationHeaderObjects[q.id];if(w){if(w.checkAtSaveCheckbox.el&&w.checkAtSaveCheckbox.el.dom){q.checkOnSave=w.checkAtSaveCheckbox.el.dom.checked}if(w.checkAtButtonCheckbox.el&&w.checkAtButtonCheckbox.el.dom){q.checkOnButton=w.checkAtButtonCheckbox.el.dom.checked}q.isActive=w.activateConfigCheckbox.checked}q.ruleConfigurations={};if(!n||!q){return{}}for(var p in n){var s=n[p];if(p.indexOf("@")!==-1||s===null){continue}q.ruleConfigurations[p]={};var m=q.ruleConfigurations[p];m.isCustom=false;m.ruleConfig={};var u=m.ruleConfig;switch(s.type){case this.editorTypes.GROUPED_EDITOR:u.warnLevel={};(s.subRules||[]).each(function(z){var y=n[this.getRuleId(p,z)];var x=this.editorFrontendToBackendStates[y.getState()];u.warnLevel[z.ruleID]=x;var B=this.serializeValueFromEditor(y);if(B&&B.name&&B.value){var A={};A[B.name]=B.value;if(!u.grouped){u.grouped={}}u.grouped[z.ruleID]=A}else{if(B&&B.nulloption){if(!u.grouped){u.grouped=[]}u.grouped.push(z.ruleID)}}}.bind(this));break;case this.editorTypes.GROUPED_CALL_EDITOR:var r=[];for(var t in n){if(t.startsWith(p+"@")){r.push(n[t])}}u.warnLevel={};u.groupedCall={};r.each(function(z){if(z){var x=this.editorFrontendToBackendStates[z.getState()];var B=z.relatedRuleId.slice(z.relatedRuleId.indexOf("@")+1);u.warnLevel[B]=x;var A=this.serializeValueFromEditor(z);if(A&&A.name&&A.value){var y={};y[A.name]=A.value;u.groupedCall[B]=y}}}.bind(this));break;default:u.warnLevel=this.editorFrontendToBackendStates[s.getState()];var v=this.serializeValueFromEditor(s);if(v&&v.name&&v.value){u[v.name]=v.value}}}return q},serializeValueFromEditor:function(l){if(l.type===this.editorTypes.NULL_OPTION_EDITOR){return{nulloption:true}}if(l.type===this.editorTypes.SINGLE_SELECT_EDITOR){return{name:"singleSelect",value:l.getSingleSelectValue()}}if(l.type===this.editorTypes.MULTI_SELECT_EDITOR){return{name:"multiSelect",value:l.getMultiSelectValue()}}},applyReadOnlyConfigurations:function(){var r=this.getMGConfigurations();for(var n=0,q=r.length;n<q;n++){var m=r[n];if(m&&m.readonly){var l=this.editorConfigMaps.get(m.id);for(var s in l){var p=l[s];if(p&&p.setDisabled instanceof Function){p.setDisabled(true)}}}}},setValueForConfigurations:function(){var w=this.getMGConfigurations();for(var v=0,q=w.length;v<q;v++){var r=w[v];var s=this.editorConfigMaps.get(r.id);var m=r.ruleConfigurations||{};for(var l in m){var z=l;var u=m[z].ruleConfig;var A=s[z]||null;if(A&&A.type!==this.editorTypes.GROUPED_CALL_EDITOR&&A.type!==this.editorTypes.GROUPED_EDITOR){this.setStateForSpecificEditor(A,u.warnLevel);this.setValueForSpecificEditor(A,u)}if(u.grouped){var p=u.warnLevel||{};for(var y in p){var t=l+"@"+y;var n=s[t]||null;if(n&&n!==null){this.setStateForSpecificEditor(n,p[y])}}if(u.grouped instanceof Array===false&&u.grouped instanceof Object===true){var x=u.grouped||{};for(var y in x){var t=l+"@"+y;var n=s[t]||null;if(n){this.setValueForSpecificEditor(n,x[y])}}}}if(u.groupedCall){var p=u.warnLevel||{};for(var y in p){var t=this.getRuleId(l,y);var n=s[t]||null;if(n){this.setStateForSpecificEditor(n,p[y])}}}}}},setStateForSpecificEditor:function(l,n){var m=this.editorBackendToFrontendStates[n]||this.editorStates.IRRELEVANT;l.setState(m)},setValueForSpecificEditor:function(m,p){if(m.type===this.editorTypes.SINGLE_SELECT_EDITOR){var n=p.singleSelect||null;if(n&&n!==null){m.setSingleSelectValue(n)}}if(m.type===this.editorTypes.MULTI_SELECT_EDITOR){var l=p.multiSelect||[];if(l){m.setMultiSelectValue(l)}}},generateMULTISELECTEditor:function(s,p){var u=this.generateBasicButtonEditor(s);u.type=this.editorTypes.MULTI_SELECT_EDITOR;var w=p.multiSelect||[];var t=new Ext.XTemplate('<tpl for=".">','<div class="ak-guidelines-mulit-select-option">','<div class="ak-guidelines-mulit-select-option-checkbox"></div>','<span class="ak-guidelines-mulit-select-option-label">{name}</span>',"</div>","</tpl>");var n=function(){var x=Ext.get(this.child("div"));if(x.hasClass("ak-guidelines-mulit-select-option-checkbox-selected")){x.removeClass("ak-guidelines-mulit-select-option-checkbox-selected")}else{x.addClass("ak-guidelines-mulit-select-option-checkbox-selected")}};var m=function(y){var x=$A(y.innerList.dom.childNodes)||[];x.each(function(z,A){Ext.get(z).on("click",n);var B=Ext.get(z.childNodes[0]);(y.selectedValues||[]).each(function(C){if(C.index===A){B.addClass("ak-guidelines-mulit-select-option-checkbox-selected");return}})});y.setInputValue()};var r=function(z){z.selectedValues=[];var x=z.store;var y=$A(z.innerList.dom.childNodes)||[];y.each(function(A,C){var D=Ext.get(A.childNodes[0]);if(D.hasClass("ak-guidelines-mulit-select-option-checkbox-selected")){var B=x.getAt(C);if(B&&B.data){z.selectedValues.push(B.data)}D.removeClass("ak-guidelines-mulit-select-option-checkbox-selected")}Ext.get(A).un("click",n)});this.newChangesForConfiguration(u.configId)}.bind(this);var v=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","id","index"],data:w.map(function(z,y){var x=h.Rules[z]||z;return[x,z,y]})}),displayField:"name",mode:"local",triggerAction:"all",width:120,listWidth:137,selectOnFocus:true,selectedValues:[],editable:false,tpl:t,itemSelector:"div.ak-guidelines-mulit-select-option",valueField:"id",selectedClass:"ak-three-states-buttons-multi-selected-option",emptyText:h.chooseOptions,renderTo:u.elements.editorConfigContainer,cls:"ak-three-states-buttons-multi-select-box",listeners:{focus:function(){if(u.isActive===false){u.setState(this.editorDefaultStateByActivate)}}.bind(this),collapse:function(){r(this);this.setInputValue()},render:function(x){},beforeselect:function(x){return false},expand:m},setValue:function(x){},refreshToolTip:function(x){var y=this.el.dom;if(y){if(Ext.isIE8===false){y.setAttributeNS(null,"title",x)}else{y.setAttribute("title",x)}}},setInputValue:function(){var x=this.selectedValues||[];var y="";if(x.length>0){y=x.map(function(z){return z.name}).join(",")||"";Ext.form.ComboBox.superclass.setValue.call(this,y)}else{this.clearValue()}this.refreshToolTip(y)}});u.elements.multiSelectBox=v;u.setMultiSelectValue=function(y){var A=u.elements.multiSelectBox;var z=[];var x=A.store;A.store.data.items.each(function(B){if(y.indexOf(B.data.id)!==-1){z.push(B.data)}});A.selectedValues=z||[];A.setInputValue()};u.setDisabled=function(z){u.isDisabled=z;if(z===true){u.disableButtonsAndCheckbox();var y=u.elements.multiSelectBox.selectedValues||[];var A=u.elements.editorConfigContainer.childNodes||[];$A(A).each(function(C){u.elements.editorConfigContainer.removeChild(C)});if(y.length>0){var x=y.map(function(C){return C.name}).join(", ");var B=document.createElement("span");B.className+=" ak-editor-multi-select-box-value-span";if(x.length>25){B.textContent=Signavio.Helper.TruncateByWidth(x,100,"...");if(Ext.isIE8){B.setAttribute("title",x)}else{B.setAttributeNS(null,"title",x)}}else{B.textContent=x}u.elements.editorConfigContainer.appendChild(B)}}else{u.enableButtonsAndCheckbox()}};u.getMultiSelectValue=function(x){var y=u.elements.multiSelectBox;var x=y.selectedValues||[];return x.map(function(z){return z.id})};var q=function(){var x=u.getMultiSelectValue();if(x.length===0){u.elements.multiSelectBox.focus();u.elements.multiSelectBox.expand()}};Ext.get(u.elements.editorCheckbox).on("click",function(){if(u.elements.editorCheckbox.checked===true){q()}}.bind(this));var l=u.stateButtonClick;u.stateButtonClick=function(z){var x=u.getState();var y=u.isActive;l(z);if(y===false&&x===this.editorStates.IRRELEVANT){q()}}.bind(this);return u},generateSINGLESELECTEditor:function(r,p){var m=this.generateBasicButtonEditor(r);m.type=this.editorTypes.SINGLE_SELECT_EDITOR;var l=p.singleSelect||[];m.elements.singleSelectBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","id"],data:l.map(function(t){var s=h.Rules[t]||t;return[s,t]})}),displayField:"name",mode:"local",triggerAction:"all",width:100,listWidth:117,selectOnFocus:true,editable:false,valueField:"id",emptyText:h.chooseOption,renderTo:m.elements.editorConfigContainer,cls:"ak-editor-single-select-box",listeners:{focus:function(){if(m.isActive===false){m.setState(this.editorDefaultStateByActivate)}}.bind(this),select:function(s,t,u){if(m.elements.singleSelectBox.lastElementIndex!==u){this.newChangesForConfiguration(m.configId)}m.elements.singleSelectBox.lastElementIndex=u}.bind(this)}});m.getSingleSelectValue=function(){return m.elements.singleSelectBox.getValue()};m.setSingleSelectValue=function(s){m.elements.singleSelectBox.setValue(s)};m.setDisabled=function(t){m.isDisabled=t;if(t===true){m.disableButtonsAndCheckbox();var s=m.elements.singleSelectBox.getRawValue()||"";var u=m.elements.editorConfigContainer.childNodes||[];$A(u).each(function(w){m.elements.editorConfigContainer.removeChild(w)});if(s&&s.trim()!==""){var v=document.createElement("span");v.textContent=s;v.className+=" ak-editor-single-select-box-value-span";m.elements.editorConfigContainer.appendChild(v)}}else{m.enableButtonsAndCheckbox()}};var n=function(){var t=m.getSingleSelectValue();if(t===""){var s=m.elements.singleSelectBox.store.getAt(0);if(typeof(s)!=="undefined"){m.elements.singleSelectBox.setValue(s.get("id"))}m.elements.singleSelectBox.focus();m.elements.singleSelectBox.expand()}};Ext.get(m.elements.editorCheckbox).on("click",function(){if(m.elements.editorCheckbox.checked===true){n()}}.bind(this));var q=m.stateButtonClick;m.stateButtonClick=function(u){var s=m.getState();var t=m.isActive;q(u);if(t===false&&s===this.editorStates.IRRELEVANT){n()}}.bind(this);return m},generateCUSTOMEditor:function(n,m){var l=this.generateBasicButtonEditor(n);l.type=this.editorTypes.CUSTOM_EDITOR;return l},generateSINGLETOMULTISELECTEditor:function(n,l){var m=this.generateBasicButtonEditor(n);return m},generateNULLOPTIONEditor:function(n,m){var l=this.generateBasicButtonEditor(n);l.type=this.editorTypes.NULL_OPTION_EDITOR;return l},generateBasicButtonEditor:function(s){var n={};n.elements={};n.type=this.editorTypes.BASIC_EDITOR;n._currentState=this.editorStates.IRRELEVANT;n.isActive=false;n.isDisabled=false;n.configId=s;n.getState=function(){return n._currentState};var p=document.createElement("div");p.className="ak-editor-container";n.dom=p;var q=document.createElement("div");q.className="ak-editor-checkbox-container";p.appendChild(q);n.elements.editorCheckboxContainer=q;var m=document.createElement("input");m.type="checkbox";m.className="ak-editor-checkbox";q.appendChild(m);n.elements.editorCheckbox=m;n.setActive=function(){n.isActive=true;m.checked=true;Ext.get(p).removeClass("ak-editor-inactive");this.newChangesForConfiguration(n.configId)}.bind(this);n.setInactive=function(){n.isActive=false;m.checked=false;Ext.get(p).addClass("ak-editor-inactive");this.newChangesForConfiguration(n.configId)}.bind(this);Ext.get(m).on("click",function(){if(m.checked===false){n.setState(this.editorStates.IRRELEVANT)}else{var t=n._lastState&&n._lastState!==this.editorStates.IRRELEVANT?n._lastState:this.editorDefaultStateByActivate;n.setState(t)}}.bind(this));var r=document.createElement("div");r.className="ak-editor-state-container";p.appendChild(r);n.elements.editorStateContainer=r;n.resetAllStateButtons=function(){Ext.get(n.elements.editorCouldContainer).removeClass("ak-editor-selected-state-button");Ext.get(n.elements.editorShouldContainer).removeClass("ak-editor-selected-state-button");Ext.get(n.elements.editorMustContainer).removeClass("ak-editor-selected-state-button")};n.stateButtonClick=function(u){if(n.isDisabled===true){return}var t=Ext.get(u);if(t.hasClass("ak-editor-selected-state-button")){n.setState(this.editorStates.IRRELEVANT);t.removeClass("ak-editor-selected-state-button")}else{n.setState(this.editorStates[(u.buttonType||"").toUpperCase()])}}.bind(this);g.each(function(u){var t=document.createElement("div");t.className="ak-editor-"+u.toLowerCase()+"-button-container";t.buttonType=u;if(Ext.isIE8){t.setAttribute("title",h[("legend"+u)]||"")}else{t.setAttributeNS(null,"title",h[("legend"+u)]||"")}r.appendChild(t);var v=document.createElement("div");v.className="ak-editor-"+u.toLowerCase()+"-button-circle";if(Ext.isIE8){v.setAttribute("title",h[("legend"+u)]||"")}else{v.setAttributeNS(null,"title",h[("legend"+u)]||"")}t.appendChild(v);var w=document.createElement("div");w.className="ak-editor-"+u.toLowerCase()+"-button-inner-circle";t.appendChild(w);Ext.get(t).on("click",function(){n.stateButtonClick(t,u)});n.elements["editor"+u+"Container"]=t}.bind(this));n.disableButtonsAndCheckbox=function(){Ext.get(n.dom).addClass("ak-editor-disabled");g.each(function(t){Ext.get(n.elements["editor"+t+"Container"]).addClass("ak-editor-state-button-disabled")});n.elements.editorCheckbox.disabled=true};n.enableButtonsAndCheckbox=function(){Ext.get(n.dom).removeClass("ak-editor-disabled");g.each(function(t){Ext.get(n.elements["editor"+t+"Container"]).removeClass("ak-editor-state-button-disabled")});n.elements.editorCheckbox.disabled=false};n.setDisabled=function(t){n.isDisabled=t;if(t===true){n.disableButtonsAndCheckbox()}else{n.enableButtonsAndCheckbox()}};n.setState=function(t){n._lastState=n._currentState||t;n._currentState=t;n.resetAllStateButtons();if(t===this.editorStates.IRRELEVANT){n.setInactive()}else{n.setActive();if(t===this.editorStates.COULD){Ext.get(n.elements.editorCouldContainer).addClass("ak-editor-selected-state-button")}if(t===this.editorStates.SHOULD){Ext.get(n.elements.editorShouldContainer).addClass("ak-editor-selected-state-button")}if(t===this.editorStates.MUST){Ext.get(n.elements.editorMustContainer).addClass("ak-editor-selected-state-button")}}}.bind(this);var l=document.createElement("div");l.className="ak-editor-config-container";p.appendChild(l);n.elements.editorConfigContainer=l;n.setInactive();return n}};Signavio.Plugins.ManageModellingGuideLines=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageModellingGuideLines)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.ModGuidelines=Signavio.Core.StandardReportsPlugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:15,name:Signavio.I18N.ModGuidelines.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:function(){this.showDialog()}.bind(this),isDisabled:function(){return this.isReportDisabled()}.bind(this)});this.facade.offer({relGroup:"reporting",index:16,seperated:true,isDisabled:function(){return this.isReportDisabled()}.bind(this)})},showDialog:function(){var a=this;this.loadAllMGConfigurations(function(e){if(e.length===0){Ext.MessageBox.alert(Signavio.I18N.ModGuidelines.errorTitle,Signavio.I18N.ModGuidelines.errorDesc).setIcon(Ext.MessageBox.WARNING).getDialog().doLayout();return}var c=a.getPageContent();var d=new Ext.ux.view.Wizard({items:[c],getFirstPage:function(){return c},clb:a.handleExport.bind(a),clbName:Signavio.I18N.Repository.Analysis.responsibilityAnalysisGenerateBtn,activeTab:0,selection:a.selection});var b=new Ext.Window({cls:"y-wizard-window",title:Signavio.I18N.ModGuidelines.title,modal:true,layout:"fit",height:425,width:500,minWidth:450,minHeight:425,items:[d]});b.show()})},getPageContent:function(){var e=this.getSelection().length>0&&this.getSelection()||[this.facade.getCurrentFolderStore()];var d=this.facade.getTrashRecord();var c=false;this.filteredModels=[];var b="";if(this.currentMGConfigurations[0]){b=this.currentMGConfigurations[0].id}var a=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","id"],data:this.currentMGConfigurations.map(function(f){return[Signavio.I18N.MetaModellingGuidelines.RulesName[f.name]||f.name,f.id]})}),displayField:"name",mode:"local",width:275,triggerAction:"all",selectOnFocus:true,valueField:"id",emptyText:Signavio.I18N.MetaModellingGuidelines.Dialog.empty,cls:"ak-guide-lines-add-config-copy-combo",value:b});return new Signavio.Extensions.WizardTreePage({border:false,cls:"y-wizard-tree-page",selection:e,layout:"anchor",optionTitle:Signavio.I18N.MetaModellingGuidelines.Dialog.title,optionDesc:Signavio.I18N.MetaModellingGuidelines.Dialog.select,labelText:Signavio.I18N.MetaModellingGuidelines.Dialog.description,trashRecord:d,showLayerSelection:false,getGuidelineId:a.getValue.bind(a),items:[a],isModel:function(f){return f.get("rel")==Signavio.Const.REL.MODEL&&f.get("rep").namespace=="http://b3mn.org/stencilset/bpmn2.0#"},filterPanel:{labelText:Signavio.I18N.FilterSet.description,border:false,cb:function(f,j,h,g){c=true;this.filteredModels.clear().push.apply(this.filteredModels,j);Signavio.Core.StoreManager.getStore(h,true,function(k){f.expandToAndCheckPreSelection([k[0].store]);var l;if(j.length===0){l=Ext.Msg.alert(Signavio.I18N.FilterSet.windowTitle,Signavio.I18N.FilterSet.emptyResultWarning)}else{l=Ext.Msg.alert(Signavio.I18N.FilterSet.windowTitle,Signavio.I18N.FilterSet.diagramsFoundStart+j.length+Signavio.I18N.FilterSet.diagramsFoundEnd)}l.setIcon(Ext.MessageBox.INFO);l.getDialog().syncSize();if(g instanceof Function){g(j.length!==0)}})}.bind(this),trashRecord:d,folderStore:this.facade.getCurrentFolderStore(),rootFolder:this.facade.getCurrentRootFolder(),filter:new Signavio.Extensions.FilterSet({},this.facade)},listeners:{activate:function(f){if(!this.treeActivated){window.setTimeout(function(){f.adjustPageContentSize(f.tree,30)},1);this.treeActivated=true}},destroy:function(){this.treeActivated=false},resize:function(f){if(!this.isResizing){f.adjustPageContentSize(f.tree,30)}},deactivate:function(f){var g=this.selection;this.selection=f.tree.isVisible()?f.tree.getChecked():this.selection;if(g!==this.selection){this.oldSelection=g}}.bind(this)},treeListeners:{checkchange:function(g,f){if(!f){var h=g.attributes.identifier;this.filteredModels.remove(h)}}.bind(this)},loaderFn:function(g,f){if(c){(f.childNodes||[]).each(function(h){if(this.filteredModels.indexOf(h.attributes.identifier)!==-1){h.attributes.checked=true;h.ui.toggleCheck(true)}else{if(h.attributes.checked){h.attributes.checked=false;h.ui.toggleCheck(false)}}}.bind(this))}}.bind(this)})},handleExport:function(b){var a=function(){if(!b){return}var g=b.getFirstPage();var e=(g.tree.isVisible()?g.tree.getChecked():this.selection);if(e.length===0&&this.filteredModels.length===0){Ext.Msg.alert(b.ownerCt.title,Signavio.I18N.Repository.Offer.processDocumentationSelectDiagramsForReport).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}if(g.getGuidelineId().length===0){Ext.Msg.alert(b.ownerCt.title,Signavio.I18N.Repository.Offer.processDocumentationSelectGuideline).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}b.getEl().mask(Signavio.I18N.Repository.ProcessDocu.waiting,"x-waiting-box");var d=[];var c=[];e.each(function(h){var j=h.attributes?h.attributes.identifier:h.get("href");if(j.indexOf("/model/")==0){d.push(j.replace(/\/model\//,""))}else{if(j.indexOf("/directory/")==0){c.push(j.replace(/\/directory\//,""))}}}.bind(this));this.filteredModels=this.filteredModels.map(function(h){if(h.indexOf("/model/")==0){return h.replace(/\/model\//,"")}else{if(h.indexOf("/directory/")==0){return h.replace(/\/directory\//,"")}}});d=d.concat(this.filteredModels||[]).uniq();var f={models:d,directories:c,guidelineId:g.getGuidelineId()};this.sendRequest(f,function(h){h.ownerCt.close()}.bind(this));b.ownerCt.close()}.bind(this);a()},sendRequest:function(j,g){Ext.apply(j,Ext.Ajax.getSecurityParameter());var a=Ext.isIE7||Ext.isIE8;var h=Ext.isIE6;if(this.frame){this.frame.remove();delete this.frame}var b=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+"/mgchecker";var e;if(a){this.frame=Ext.getBody().createChild({tag:"iframe",cls:"x-hidden",id:"iframe",name:"iframe"});e=this.frame.dom}else{if(h){window.open(b+"?"+Object.toQueryString(j));return}else{var f=window.open();e=f.document.body}}var d=[];$H(j).each(function(k){if(k.value instanceof Array){k.value.each(function(l){d.push(["input",{type:"hidden",value:l,name:k.key}])})}else{d.push(["input",{type:"hidden",value:k.value,name:k.key}])}});var c=Signavio.Core.graft(null,e,["form",{action:b,method:"POST","accept-charset":"UTF-8",enctype:"application/x-www-form-urlencoded"}].concat(d));c.submit()},loadAllMGConfigurations:function(e){var c=function(f){this.currentMGConfigurations=f.rep.findAll(function(g){return g.isActive});if(e){e(f.rep)}}.bind(this);var b=function(f){if(e){e(f)}}.bind(this);var d={shallow:true};var a=Signavio.Config.BACKEND_PATH+"/mgconfig";Signavio.Core.Stores.RequestManager.doGet(a,[c,b],d)},hasValidModelType:function(a){return this.isBpmn20(a)}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}Signavio.Plugins.ViewModelingConventionConfiguration=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"help",index:4,arrange:"right",name:Signavio.I18N.MetaModellingGuidelines.Dialog.configuration_overview,description:"",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report.png",functionality:function(){this.showWindow()}.bind(this),seperated:true,isDisabled:function(){return false}.bind(this)})},showWindow:function(){var a=Signavio.Config.BACKEND_PATH+Signavio.Config.VIEW_MODELLINGGUIDELINES_CONFIG_PATH;var b=Signavio.I18N.MetaModellingGuidelines.Dialog.configuration_overview;this.showIFramePanel(a,b)},showIFramePanel:function(b,e){if(Ext.isIPad){window.open(b);return}var c="<iframe src='"+b+"' class='x-help-iframe'></iframe>";c+='<br/><a class="x-help-a" target="_blank" href="'+b+'">'+Signavio.I18N.Repository.Offer.conventionsOpenInNewWindow+"</a>";var a=new Ext.Panel({height:"100%",width:"100%",html:c});var d=new Ext.Window({cls:"x-help",modal:true,title:e,items:[a],resizable:false,header:true,shadow:false,draggable:false});d.show()}});if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var a=Signavio.Core.Stores.RequestManager;var k=Signavio.I18N.Repository.Layers;var n=5000;var m=3;var f="customlayers.propertytypechanged";var q="customlayers.propertychanged";var j={ICON1:{dark:Signavio.Config.IMAGE_PATH+"/glyphicons/small/usd_dark.png",light:Signavio.Config.IMAGE_PATH+"/glyphicons/small/usd_light.png"},ICON2:{dark:Signavio.Config.IMAGE_PATH+"/glyphicons/small/user_dark.png",light:Signavio.Config.IMAGE_PATH+"/glyphicons/small/user_light.png"},ICON3:{dark:Signavio.Config.IMAGE_PATH+"/glyphicons/small/cogwheel_dark.png",light:Signavio.Config.IMAGE_PATH+"/glyphicons/small/cogwheel_light.png"},ICON4:{dark:Signavio.Config.IMAGE_PATH+"/glyphicons/small/flash_dark.png",light:Signavio.Config.IMAGE_PATH+"/glyphicons/small/flash_light.png"},PROPERTY:{dark:Signavio.Config.IMAGE_PATH+"/glyphicons/small/text_dark.png",light:Signavio.Config.IMAGE_PATH+"/glyphicons/small/text_light.png"}};var h=Object.keys(j).map(function(r){return[r,k.Visualization[r],j[r]["dark"]]});var g={STRING:"MetaDataStringInfo",NUMBER:"MetaDataNumberInfo",BOOLEAN:"MetaDataBoolean",CHOICE:"MetaDataEnum",DATE:"MetaDataDate",URL:"MetaDataUrl",GLOSSARY:"MetaDataGlossaryLink",MODELLINK:"MetaDataModelLink",COMPLEX:"MetaDataComplex"};var p={String:g.STRING,Text:g.STRING,Number:g.NUMBER,Boolean:g.BOOLEAN,Choice:g.CHOICE};var e={META:"meta",META_COMPLEX:"complex",PROPERTY:"property"};var c={getDefaultValue:function(t){var r=t.get("conf");switch(t.get("type")){case g.CHOICE:if(Ext.isDefined(r.defaultValue)&&Ext.isDefined(r.items)){var s=r.items.find(function(u){return u.value===r.defaultValue});if(Ext.isDefined(s)){return s}}return"";case g.BOOLEAN:if(Ext.isDefined(r.defaultValue)){if(typeof r.defaultValue==="boolean"){return r.defaultValue}else{if(typeof r.defaultValue==="string"){return r.defaultValue.toLowerCase()==="true"}}}return true;case g.NUMBER:if(Ext.isNumber(r.defaultValue)){return r.defaultValue}var s=0;if(Ext.isNumber(r.min)&&s<r.min){s=r.min}if(Ext.isNumber(r.max)&&s>r.max){s=r.max}return s;case g.STRING:return Ext.isDefined(r.defaultValue)?String(r.defaultValue).unescapeHTML():"";default:return Ext.isDefined(r.defaultValue)?r.defaultValue:""}}};var d=function(r){Ext.apply(this,r)};Ext.extend(d,Object,{init:function(r){if(r instanceof Ext.grid.EditorGridPanel){this.grid=r;this.grid.on("beforeedit",this.onBeforeEdit,this);this.cm=this.grid.getColumnModel()}},getColumnByDataIndex:function(r){var s;(this.cm.columns||this.cm.config||[]).each(function(t){if(t.dataIndex===r){s=t}});return s},onBeforeEdit:Ext.emptyFn});var b=function(){b.superclass.constructor.apply(this,arguments)};Ext.extend(b,d,{init:function(s){b.superclass.init.call(this,s);if(s instanceof Ext.grid.EditorGridPanel){var r=this.getColumnByDataIndex(this.dataIndex);if(Ext.isDefined(r)&&Ext.isDefined(r.id)&&r.id>-1){this.cm.setRenderer(r.id,this.render.bind(this))}this.grid.addEvents(f);this.grid.on(f,this.onPropertyTypeChanged.bind(this));this.grid.addEvents(q);this.grid.on(q,this.onPropertyChanged.bind(this))}},onBeforeEdit:function(s){if(s.field===this.dataIndex){var r=this.relationStore.get("id",s.record.get("relation"));if(Ext.isDefined(r)){if(!!r.get("conf").noValue){return false}}var t=this.propertyStore.get("id",s.record.get("property").id);if(Ext.isDefined(t)){this.cm.setEditor(s.column,this.getEditor(t))}}},onPropertyTypeChanged:function(s,r){r.set(this.dataIndex,this.getDefaultValue(s))},onPropertyChanged:function(v,s,r){if(v.get("type")===g.NUMBER&&s.get("type")===g.NUMBER){var t=v.get("conf");var u=r.get(this.dataIndex);if((Ext.isNumber(t.min)&&u<t.min)||(Ext.isNumber(t.max)&&u>t.max)){r.set(this.dataIndex,this.getDefaultValue(v))}}},getDefaultValue:c.getDefaultValue,getEditor:function(v){var t;switch(v.get("type")){case g.CHOICE:var s=v.get("conf").items.map(function(w){return[w.value,w.title]});t=new Ext.form.ComboBox({mode:"local",displayField:"displayText",valueField:"value",readOnly:true,editable:false,triggerAction:"all",lazyRender:true,listClass:"y-combo-list",store:new Ext.data.SimpleStore({fields:["value","displayText"],data:s})});break;case g.NUMBER:var r=v.get("conf");var u={allowBlank:false,decimalSeparator:Signavio.Utils.getDecimalSeparator()};if(Ext.isDefined(r)){if(Ext.isNumber(r.max)){u.maxValue=r.max}if(Ext.isNumber(r.min)){u.minValue=r.min}}t=new Ext.form.NumberField(u);break;case g.STRING:default:t=new Ext.form.TextField()}return new Ext.grid.GridEditor(t)},render:function(x,w,s,v,z,y){var u=s.get("property").type||g.STRING;var A=this.relationStore.get("id",s.get("relation"));if(Ext.isDefined(A)){if(!!A.get("conf").noValue){return""}}var t="";switch(u){case g.NUMBER:t=Number(x).toFormatted();break;case g.CHOICE:var r=this.propertyStore.get("id",s.get("property").id);if(Ext.isDefined(r)){(r.get("conf").items||[]).each(function(B){if(x===B.value){t=String(B.title).escapeHTML()}})}else{t=""}break;case g.BOOLEAN:if(x===true||x===1||String(x).toLowerCase()==="true"){t="true"}else{t="false"}break;case g.STRING:default:t=String(x).escapeHTML();break}return t}});var l=function(r){l.superclass.constructor.call(this,r)};Ext.extend(l,d,{init:function(s){l.superclass.init.call(this,s);if(s instanceof Ext.grid.EditorGridPanel){var r=this.getColumnByDataIndex(this.dataIndex);this.relationStore=r.editor.field.store;r=this.getColumnByDataIndex(this.targetIndex);this.propertyStore=r.editor.field.store;this.grid.on("afteredit",this.onAfterEdit,this);this.grid.on("validateedit",this.onValidateEdit,this);this.grid.addEvents(f);this.grid.addEvents(q)}},onBeforeEdit:function(r){if(r.field===this.dataIndex){var s=r.record.get("property");this.relationStore.clearFilter();this.relationStore.filterByProperty(s)}},onAfterEdit:function(r){if(r.field===this.dataIndex){this.relationStore.clearFilter()}},onValidateEdit:function(x){if(x.field===this.targetIndex){var u=x.value;var y=this.propertyStore.get("id",u);if(Ext.isDefined(y)){x.value={id:y.get("id"),type:y.get("type"),group:y.get("group")}}var w=x.value;var t=x.record.get(this.dataIndex);this.relationStore.clearFilter();this.relationStore.filterByProperty(y);var r=this.relationStore.get("id",t);if(!Ext.isDefined(r)){if(this.relationStore.getCount()>0){x.record.set(this.dataIndex,this.relationStore.getAt(0).get("id"))}else{x.record.set(this.dataIndex,"")}this.grid.fireEvent(f,y,x.record)}this.relationStore.clearFilter();if(typeof x.originalValue==="object"&&y.get("id")!==x.originalValue.id){var s=this.propertyStore.get("id",x.originalValue.id);if(Ext.isDefined(s)){this.grid.fireEvent(q,y,s,x.record)}}}}});Signavio.Plugins.ManageLayers=Signavio.Core.Plugin.extend({enabled:true,hasUnsavedChanges:false,saving:false,failCount:0,construct:function(r){arguments.callee.$.construct.apply(this,arguments);this.facade.registerOnEvent(Signavio.Const.EVENT.ADD_CUSTOM_LAYERS_TAB,function(t,s){if(!s){return}this.initStores();this.initDescription(s);this.initGrid(s);s.doLayout();s.on("destroy",function(){this.saveChanges(true)}.bind(this));s.on("activate",this.initPropertyStore.bind(this));s.on("deactivate",function(){this.saveChanges(true)}.bind(this));this.loadConfig()}.bind(this));this.facade.offer({relGroup:"configure",arrange:"right",index:16,name:Signavio.I18N.Repository.Layers.offerTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/large_tiles.png",isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this)});Signavio.Const.SHOW_CUSTOM_LAYERS_TAB=true},showWindow:function(){this.facade.raiseEvent(Signavio.Const.EVENT.OPEN_MANAGE_METADATA,Signavio.Const.CUSTOM_LAYERS_TAB_NAME)},initStores:function(){this.initLayerStore();this.initRuleSetStore();this.initRuleStore();this.initPropertyStore();this.initRelationStore()},initLayerStore:function(){if(!this.layerStore){this.layerStore=new Ext.data.SimpleStore({fields:[{name:"id",mapping:"id",type:"string"},{name:"name",mapping:"name",type:"string"},{name:"enabled",mapping:"enabled",type:"boolean"},{name:"visualization",mapping:"visualization",type:"string"},{name:"ruleSets",mapping:"ruleSets"}],data:[]});this.layerStore.on("add",this.configurationChanged.bind(this));this.layerStore.on("update",this.configurationChanged.bind(this));this.layerStore.on("remove",this.configurationChanged.bind(this))}},initRuleSetStore:function(){if(!this.ruleSetStore){this.ruleSetStore=new Ext.data.SimpleStore({fields:[{name:"parentId",mapping:"parentId",type:"string"},{name:"id",mapping:"id",type:"string"},{name:"color",mapping:"color",type:"string"},{name:"ruleId",mapping:"ruleId",type:"string"},{name:"property",mapping:"property"},{name:"relation",mapping:"relation",type:"string"},{name:"value",mapping:"value",type:"string"},{name:"rules",mapping:"rules"}],data:[]});var r=this;this.ruleSetStore.on("update",function(u,s,t){if(t===Ext.data.Record.COMMIT){var v=s.get("ruleId");var w=r.ruleStore.get("id",v);if(Ext.isDefined(w)){var x=false;if(w.get("property")!==s.get("property")){w.set("property",s.get("property"));x=true}if(w.get("relation")!==s.get("relation")){w.set("relation",s.get("relation"));x=true}if(w.get("value")!==s.get("value")){w.set("value",s.get("value"));x=true}if(x){r.ruleStore.commitChanges()}}r.configurationChanged()}});this.ruleSetStore.on("add",function(t,s,u){var v=s.map(function(w){return new r.Rule({id:w.get("ruleId"),parentId:w.get("id"),property:w.get("property"),relation:w.get("relation"),value:w.get("value")})});r.ruleStore.add.defer(10,r.ruleStore,[v])});this.ruleSetStore.on("remove",function(t,s,u){var w=s.get("id");var v=r.ruleStore.getRange().findAll(function(x){return x.get("parentId")===w});v.each(function(x){r.ruleStore.remove(x)});r.configurationChanged()})}},initRuleStore:function(){if(!this.ruleStore){var r=this;this.ruleStore=new Ext.data.SimpleStore({fields:[{name:"parentId",mapping:"parentId",type:"string"},{name:"id",mapping:"id",type:"string"},{name:"property",mapping:"property"},{name:"relation",mapping:"relation",type:"string"},{name:"value",mapping:"value",type:"string"}],data:[]});this.ruleStore.updateRulesInParent=function(u){var t=this.getRange().findAll(function(v){return v.get("parentId")===u}).map(function(v){return{id:v.get("id"),property:v.get("property"),relation:v.get("relation"),value:v.get("value")}});var s=r.ruleSetStore.get("id",u);if(Ext.isDefined(s)){s.setRaw("rules",t)}r.configurationChanged()};this.Rule=Ext.data.Record.create(this.ruleStore.fields.items);this.ruleStore.on("update",function(u,s,t){if(t===Ext.data.Record.COMMIT){var v=s.get("id");var w=r.ruleSetStore.get("ruleId",v);if(Ext.isDefined(w)){if(w.get("property")!==s.get("property")){w.setRaw("property",s.get("property"))}if(w.get("relation")!==s.get("relation")){w.setRaw("relation",s.get("relation"))}if(w.get("value")!==s.get("value")){w.setRaw("value",s.get("value"))}}u.updateRulesInParent(s.get("parentId"))}});this.ruleStore.on("add",function(t,s,u){var v={};s.each(function(x){var w=x.get("parentId");if(!Ext.isDefined(v[w])){v[w]=true;t.updateRulesInParent(w)}})});this.ruleStore.on("remove",function(u,t,v){var w=r.ruleSetStore.get("ruleId",t.get("id"));if(Ext.isDefined(w)){if(u.getCount()>0){var s=u.getAt(0);w.setRaw("ruleId",s.get("id"));w.setRaw("property",s.get("property"));w.setRaw("relation",s.get("relation"));w.setRaw("value",s.get("value"))}}u.updateRulesInParent(t.get("parentId"))})}},initPropertyStore:function(){if(!this.propertyStore){this.propertyStore=new Ext.data.SimpleStore({fields:["id","name","type","group","conf"],data:[]})}else{this.propertyStore.removeAll()}var r=this;Signavio.Core.StoreManager.getStore("/meta",true,function(t){var s=t.invoke("get","rep");var u=[];s.each(function(v){var w=v.stencilsetBindings.find(function(z){var y=Signavio.Plugins.ManageLayers.FORBIDDEN_STENCILS[z.namespace];if(y){var x=y.find(function(A){if(A===z.stencil){return true}});return !!!x}return false});w=w&&Signavio.Plugins.ManageLayers.ALLOWED_TYPES.any(function(x){return x===v.type});if(w){if(v.type===g.COMPLEX){u=u.concat(r.flattenComplexProperty(v))}else{u.push(r.createProperty(v))}}});u=u.concat(r.getCustomProperties());r.propertyStore.loadData(u.compact())})},initRelationStore:function(){if(!this.relationStore){this.relationStore=new Ext.data.SimpleStore({fields:["id","name","type","conf"],data:[]});var r=this;this.relationStore.filterByProperty=function(v){var s;var t;if(v instanceof Ext.data.Record){s=v.get("conf");t=v.get("type")}else{if("object"===typeof v&&Ext.isDefined(v.id)){t=v.type;var u=r.propertyStore.get("id",v.id);if(Ext.isDefined(u)){s=u.get("conf")}}}if(Ext.isDefined(s)&&s.isList){this.filterBy(function(w,y){var x=w.get("conf");return w.get("type")===t&&Ext.isDefined(x)&&!!x.supportsList})}else{this.filterBy(function(w,y){var x=w.get("conf");return w.get("type")===t&&(!Ext.isDefined(x)||!Ext.isDefined(x.supportsSingle)||x.supportsSingle)})}}}},flattenComplexProperty:function(u){var s=[];if(u&&u.complexItems&&u.complexItems instanceof Array){var t=u.id+".";var r=u.name+" >> ";u.complexItems.each(function(w){var v=[t+w.id,r+w.name.escapeHTML(),p[w.type],e.META_COMPLEX,w];s.push(v)})}return s},createProperty:function(r){if(!r&&typeof r==="object"){return}var s=[r.id,r.name,r.type,e.META,r];return s},getCustomProperties:function(){var r=[];r.push(["name",k.Custom.name,g.STRING,e.PROPERTY,{}]);r.push(["documentation",k.Custom.documentation,g.STRING,e.PROPERTY,{}]);r.push(["costs",k.Custom.costs,g.NUMBER,e.PROPERTY,{}]);r.push(["time",k.Custom.time,g.NUMBER,e.PROPERTY,{}]);r.push(["costcenter",k.Custom.costcenter,g.STRING,e.PROPERTY,{}]);r.push(["applyincalc",k.Custom.applyincalc,g.BOOLEAN,e.PROPERTY,{defaultValue:true}]);r.push(["frequency",k.Custom.frequency,g.NUMBER,e.PROPERTY,{}]);return r},getRelationName:function(s){if(!Ext.isDefined(s)){return""}var r=s.split(".");if(r.length===2&&Ext.isDefined(k.Relations[r[0]])){return(k.Relations[r[0]][r[1]]||"")}return s},loadConfig:function(){a.doGet(Signavio.Config.BACKEND_PATH+Signavio.Config.CUSTOM_LAYERS_CONFIG_PATH,function(s){var r=(s.rep.relations||[]).map(function(w){return[w.id,this.getRelationName(w.id),w.type,w.conf]}.bind(this));this.relationStore.loadData(r);var t=s.rep.layers||[];var v=(t||[]).inject([],function(x,w){return x.concat((w.ruleSets||[]).map(function(z){var y=Object.clone(z);y.parentId=w.id;if(z.rules.length>0){y.ruleId=z.rules[0].id;y.property=z.rules[0].property;y.relation=z.rules[0].relation;y.value=z.rules[0].value}return y}))});var u=v.inject([],function(w,x){return w.concat((x.rules||[]).map(function(z){var y=Object.clone(z);y.parentId=x.id;return y}))});this.ruleStore.loadData(u);this.ruleSetStore.loadData(v);this.layerStore.loadData(t)}.bind(this))},initDescription:function(r){var s=new Ext.form.Label({cls:"y-description-label",text:Signavio.I18N.Repository.Layers.description});r.add(s)},initGrid:function(r){this.grid=new Ext.ux.grid.NestableEditorGridPanel({anchor:"100%",store:this.layerStore,cm:this.getLayerColumnModel(),autoHeight:true,border:true,enableHdMenu:false,enableColumnMove:false,clicksToEdit:1,addNewRowText:k.addNewLayer,defaultValues:{enabled:true,name:k.newLayer,visualization:h[0][0],ruleSets:[]}});if(Ext.isIE){this.grid.on("show",function(){this.el.repaint()})}this.grid.on("afteredit",function(){this.store.commitChanges()});r.add(this.grid)},getDefaultValue:c.getDefaultValue,getLayerColumnModel:function(){return new Ext.grid.ColumnModel([this.getRowRemover(k.removeLayer),this.getEnabledCheckBox(),{header:k.Header.name,dataIndex:"name",editor:new Ext.form.TextField({allowBlank:false})},this.getRuleSetField(),this.getVisualizationComboBox(),{dataIndex:"id",hidden:true}])},getRuleSetColumnModel:function(){return new Ext.grid.ColumnModel({columns:[this.getRowRemover(k.removeRuleSet),this.getColorPickerColumn(),this.getRuleListField(),this.getPropertyComboColumn(),this.getRelationComboColumn(),{header:k.Header.value,dataIndex:"value",editor:new Ext.form.TextField()},{dataIndex:"id",hidden:true},{dataIndex:"ruleId",hidden:true}]})},getRuleSetField:function(){var t=this;var r={color:"#FF00FF",rules:[]};var s=function(w,v,x){if(v.length>0){var y={id:v[0].get("id"),type:v[0].get("type"),group:v[0].get("group")};r.property=y;var u=function(z){z.clearFilter();z.filterByProperty(y);var A=z.getAt(0);r.relation=A.get("id");z.clearFilter();if(!!!A.get("conf").noValue){r.value=t.getDefaultValue(v[0])}};if(t.relationStore.getCount()>0){u.call(this,t.relationStore)}else{t.relationStore.on("load",u)}}};if(this.propertyStore.getCount()>0){s.call(this,this.propertyStore,this.propertyStore.getRange())}else{this.propertyStore.on("load",s)}return new Ext.ux.form.NestedGridField({header:k.Header.ruleSets,dataIndex:"ruleSets",fieldId:"ruleSets",emptyText:k.ruleSetEmptyText,renderTpl:new Ext.XTemplate('<tpl if="records.length &gt; 0">',"{[this.getText(values.records)]}","</tpl>",{getText:function(u){var A=u[0];var w='<div class="y-color-value" style="background-color:'+A.get("color")+';">';var z=t.layerStore.get("id",A.get("parentId"));if(Ext.isDefined(z)){var y=Signavio.Utils.getPerceivedBrightness(A.get("color"));var x=z.get("visualization");if(Ext.isDefined(x)){var v=j[x][(y<130?"light":"dark")];w+='<img src="'+v+'"/>'}}w+='</div><div class="y-color-value-text">';var B=t.propertyStore.get("id",A.get("property").id);if(Ext.isDefined(B)){w+=B.get("name")}else{w+=A.get("property").id}if(u.length>1){w+=" ";w+=new Ext.Template(k.andMore).apply({number:u.length-1})}w+="</div>";return w}})},this.ruleSetStore,this.getRuleSetColumnModel(),{addNewRowText:k.addNewRuleSet,defaultValues:r,additionalIds:["ruleId"],plugins:[new l({dataIndex:"relation",targetIndex:"property"}),new b({dataIndex:"value",propertyStore:this.propertyStore,relationStore:this.relationStore})]})},getRuleListColumnModel:function(){return new Ext.grid.ColumnModel([this.getRowRemover(k.removeRule,true),this.getPropertyComboColumn(),this.getRelationComboColumn(),{header:k.Header.value,dataIndex:"value",editor:new Ext.form.TextField()},{dataIndex:"id",hidden:true}])},getRuleListField:function(){var t=this;var r={};var s=function(w,v,x){if(v.length>0){var y={id:v[0].get("id"),type:v[0].get("type"),group:v[0].get("group")};r.property=y;var u=function(z){z.clearFilter();z.filterByProperty(y);var A=z.getAt(0);r.relation=A.get("id");z.clearFilter();if(!!!A.get("conf").noValue){r.value=t.getDefaultValue(v[0],A)}};if(t.relationStore.getCount()>0){u.call(this,t.relationStore)}else{t.relationStore.on("load",u)}}};if(this.propertyStore.getCount()>0){s.call(this,this.propertyStore,this.propertyStore.getRange())}else{this.propertyStore.on("load",s)}return new Ext.ux.form.NestedGridField({header:"",width:23,fixed:true,dataIndex:"rules",fieldId:"rules",noText:true},this.ruleStore,this.getRuleListColumnModel(),{addNewRowText:k.addNewRule,defaultValues:r,plugins:[new l({dataIndex:"relation",targetIndex:"property"}),new b({dataIndex:"value",propertyStore:this.propertyStore,relationStore:this.relationStore})]})},getRowRemover:function(r,s){return new Ext.grid.RowNumberer({dataIndex:"numberer",firstHidden:!!s,renderer:function(u,w,t,x){if(!!s&&x===0&&t.store.getCount()===1){w.css="y-hidden-numberer"}else{w.cellAttr='title="'+Signavio.Utils.unescapeHTML(r)+'"'}return""}})},getEnabledCheckBox:function(){return{header:"",dataIndex:"enabled",width:25,fixed:true,editor:new Ext.form.Checkbox({setValue:function(r){var s=this.checked;this.checked=(r===true||r==="true"||r==="1"||String(r).toLowerCase()==="on");if(this.el&&this.el.dom){this.el.dom.checked=this.checked;this.el.dom.defaultChecked=this.checked}if(this.hasFocus){this.fireEvent("check",this,this.checked,s===true)}},listeners:{render:function(){if(Ext.isChrome||Ext.isSafari||Ext.isFF){this.el.dom.addEventListener("mousedown",function(r){Event.stop(r)}.bind(this),false)}}}}),renderer:function(r){if(String(r)==="true"){return"<div class='x-value-boolean'><img src='/images/famfamfam/check_small.png'/></div>"}return"<div class='x-value-boolean'></div>"}}},getVisualizationComboBox:function(){return{header:k.Header.visualization,dataIndex:"visualization",editor:new Ext.form.ComboBox({mode:"local",displayField:"displayText",valueField:"value",readOnly:true,editable:false,triggerAction:"all",lazyRender:true,listClass:"y-combo-list",listeners:{select:function(t,r,s){t.triggerBlur()}},store:new Ext.data.SimpleStore({fields:["value","displayText","image"],data:h}),tpl:['<tpl for=".">','<div class="x-combo-list-item">','<img src="{image}" style="width:12px;height:12px;"/>'," {displayText}","</div>","</tpl>"].join("")}),renderer:function(w,u,r,x,t,s){var v=h.find(function(y){return y[0]===w});if(Ext.isDefined(v)&&v.length===3){return['<div class="y-visualization-entry">','<img src="',v[2],'" alt="',v[1],'"/>','<div class="y-visualization-entry-text">',v[1],"</div></div>"].join("")}return w}}},getColorPickerColumn:function(){var r=this;return{header:k.Header.color,dataIndex:"color",fixed:true,width:150,editor:new Ext.grid.GridEditor(new Ext.ux.ColorField({allowBlank:false,listeners:{select:function(t,s){t.triggerBlur()}}})),renderer:function(B,A,u,z,D,C){var w=u.get("parentId");var t=r.layerStore.get("id",w);var v='<div class="y-color-value" style="background-color:'+B+';">';if(Ext.isDefined(t)){var y=Signavio.Utils.getPerceivedBrightness(B);var s=t.get("visualization");if(Ext.isDefined(s)){var x=j[s][(y<130?"light":"dark")];v+='<img src="'+x+'"/>'}}v+="&nbsp;</div>";return v}}},getPropertyComboColumn:function(){var r=this;return{header:k.Header.property,dataIndex:"property",editor:new Ext.form.ComboBox({mode:"local",displayField:"name",valueField:"id",readOnly:true,editable:false,triggerAction:"all",lazyRender:true,listClass:"y-combo-list",store:this.propertyStore,listeners:{select:function(t,s){t.triggerBlur()}},setValue:function(u){var s=u;if(typeof u==="object"){this.store.clearFilter();this.store.filter("type",u.type);var t=this.store.get("id",u.id);if(Ext.isDefined(t)){s=u.id}else{if(this.store.getCount()>0){s=this.store.getAt(0).get("id")}else{s=""}}this.store.clearFilter()}Ext.form.ComboBox.prototype.setValue.call(this,s)}}),renderer:function(w,v,s,z,u,t){var y=w;if(typeof w==="object"){y=w.id}var x=r.propertyStore.get("id",y);return Ext.isDefined(x)?x.get("name"):(typeof w==="object"?w.id:w)}}},getRelationComboColumn:function(){var r=this;return{header:k.Header.relation,dataIndex:"relation",editor:new Ext.form.ComboBox({mode:"local",displayField:"name",valueField:"id",readOnly:true,editable:false,lazyRender:true,listClass:"y-combo-list",store:this.relationStore,listeners:{select:function(t,s){t.triggerBlur()}},doQuery:function(u,t){if(u===undefined||u===null){u=""}var s={query:u,forceAll:t,combo:this,cancel:false};if(this.fireEvent("beforequery",s)===false||s.cancel){return false}u=s.query;t=s.forceAll;if(t===true||(u.length>=this.minChars)){if(this.lastQuery!==u){this.lastQuery=u;if(this.mode=="local"){this.selectedIndex=-1;this.onLoad()}else{this.store.baseParams[this.queryParam]=u;this.store.load({params:this.getParams(u)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}}}),renderer:function(x,w,t,z,v,u){var y=t.get("property");r.relationStore.clearFilter();r.relationStore.filterByProperty(y);var s=r.relationStore.get("id",x);r.relationStore.clearFilter();return Ext.isDefined(s)?s.get("name"):x}}},getLayers:function(){var r=this;var s=this.layerStore.getRawRange().map(function(t){var v=t.get("id");var u={id:t.get("id"),enabled:t.get("enabled"),name:t.get("name"),visualization:t.get("visualization")};u.ruleSets=r.ruleSetStore.getRawRange().map(function(w){if(v===w.get("parentId")){return{id:w.get("id"),color:w.get("color"),rules:w.get("rules")}}else{return null}}).compact();return u});return s},configurationChanged:function(){this.hasUnsavedChanges=true;if(!Ext.isDefined(this.saveTimeoutCb)&&!this.saving){this.saveTimeoutCb=window.setTimeout(this.saveChanges.bind(this,false),n)}},saveChanges:function(r){if(this.saveTimeoutCb){window.clearTimeout(this.saveTimeoutCb);delete this.saveTimeoutCb}if(this.hasUnsavedChanges&&!this.saving){this.saving=true;this.hasUnsavedChanges=false;a.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.CUSTOM_LAYERS_CONFIG_PATH,[function(s){this.saving=false;this.failCount=0;if(this.hasUnsavedChanges){this.configurationChanged()}}.bind(this),function(s){this.saving=false;this.failCount++;if(this.failCount<m){this.configurationChanged()}else{msg=Ext.MessageBox.alert(k.errorTitle,k.errorMsg);msg.setIcon(Ext.MessageBox.ERROR).getDialog().doLayout()}}.bind(this)],{layers:this.getLayers()})}}});Signavio.Plugins.ManageLayers.FORBIDDEN_STENCILS={"http://b3mn.org/stencilset/bpmn2.0#":["BPMNDiagram","SequenceFlow","Association_Undirected","Association_Unidirectional","Association_Bidirectional","MessageFlow"]};Signavio.Plugins.ManageLayers.ALLOWED_TYPES=[g.STRING,g.NUMBER,g.BOOLEAN,g.CHOICE,g.DATE,g.URL,g.GLOSSARY,g.MODELLINK,g.COMPLEX]})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Folder={renderToView:"left",enabled:true,render:function(){this.facade.getExtView("left").collapse=Ext.emptyFn;var a=new Ext.tree.TreeNode({text:"",identifier:"",draggable:false,expanded:true});this.panel=new Ext.tree.TreePanel({id:"folder_plugin",animate:true,enableDD:false,pathSeparator:"#",useArrows:true,loader:new Signavio.Extensions.TreeLoader({showTooltip:true}),lines:false,border:false,rootVisible:false,containerScroll:false});this.panel.getSelectionModel().on("selectionchange",this.onSelectionChange.bind(this));this.panel.getSelectionModel().on("beforeselect",function(c,d){var e=this.panel.getLoader().findRecord(d.attributes.identifier)||Signavio.Core.StoreManager.getRootDirectoryStore().findByIdentifier(d.attributes.identifier);if(e&&e.get("rel")===Signavio.Const.REL.GLOSSARY){window.open(e.get("rep").uri);return false}return true}.bind(this));this.panel.setRootNode(a);this.folders=Signavio.Core.StoreManager.getRootDirectoryStore(this.onFoldersUpdate.bind(this));this.facade.registerOnEvent("searchactivated",function(){this.panel.selectPath("")}.bind(this));this.facade.registerOnEvent("updatefolders",this.onUpdateFolders.bind(this));var b=Signavio.Core.StoreManager.getChildEntitiesStore();b.on("load",this.onChildFolderChange.bind(this))},onFoldersUpdate:function(b,f){var a=this.folders,h=this;var d=b.map(function(k){var n=k.get("rel")===Signavio.Const.REL.GLOSSARY,l=k.get("rep").type=="trash",j=k.get("rep").type=="internal";if(n&&(!Signavio.Config.GLOSSARY_ENABLED||!h.hasGlossaryLicense())){return undefined}var m=n?Signavio.I18N.Repository.Offer.glossaryTitle+" <img src='"+Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/arrow.png'/>":(Signavio.I18N.Repository.Folder[k.get("rep").type]||k.get("rep").name);return(k.get("rep").type==Signavio.Config.FOLDER_TYPE.TRASH||n)&&k.get("rep").visible===false?undefined:{text:m,type:k.get("rep").type,cls:"folder",leaf:false,identifier:k.get("href"),rel:k.get("rel"),cls:n?"x-glossary":(j?"internal":"folder"),dataField:"rep.name",leaf:l||n||j,isChildLeaf:function(p){return p.get("rel")!==Signavio.Const.REL.DIRECTORY},hasChildCls:function(p){return p.get("rel")==Signavio.Const.REL.DIRECTORY?"folder":"x-glossary"},getToolTip:function(p){return p.get("rel")==Signavio.Const.REL.DIRECTORY?"":Signavio.I18N.Repository.Offer.glossaryDescription},parseText:function(q,p){return p.get("rel")===Signavio.Const.REL.DIRECTORY?q:Signavio.I18N.Repository.Offer.glossaryTitle+" <img src='"+Signavio.Config.IMAGE_PATH+"/nuvola/16x16/actions/arrow.png'/>"},recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.GLOSSARY]}}).compact();(d.find(function(j){return j.type==Signavio.Config.FOLDER_TYPE.TRASH})||{}).cls="trash";var e=Ext.get(this.panel.getRootNode().ui.ctNode);e.hide();var g=this.panel.getRootNode();var c=g.childNodes.findAll(function(j){return j.attributes.retain||false});this.removeChildNodes(g);d=d.map(function(j){return new Ext.tree.AsyncTreeNode(j)});g.appendChild(d);c.each(function(j){g.appendChild(new Ext.tree.TreeNode(j.attributes))});e.show();e.slideIn("t");window.setTimeout(function(){if(this.finialized&&!this.panel.getSelectionModel().getSelectedNode()&&!this.currentChildStore&&this.panel.root.firstChild&&this.panel.root.firstChild.attributes.rel===Signavio.Const.REL.DIRECTORY){this.panel.root.item(0).select()}}.bind(this),500);a.un("load",this.onFoldersUpdate);this.onUpdateFolders(true)},finialize:function(){this.finialized=true;if(!this.currentChildStore&&!this.panel.getSelectionModel().getSelectedNode()&&this.panel.root.childNodes.length>0&&this.panel.root.item(0).attributes.rel!==Signavio.Const.REL.GLOSSARY){this.panel.root.item(0).select()}},getSelectionPath:function(a){var b=[];var c=a||this.panel.getSelectionModel().getSelectedNode();while(c.parentNode&&c!==this.panel.root){b.unshift({identifier:c.attributes.identifier,name:c.attributes.text,store:Signavio.Core.StoreManager.getStore(c.attributes.identifer)});c=c.parentNode}return b},onSelectionChange:function(c,e){if(e&&e.attributes.identifier){if(!e.isLeaf()){var b=Signavio.Core.StoreManager.getChildEntitiesStore();b.fireEvent("beforeload");e.expand();var a=Signavio.Core.StoreManager.getStore(e.attributes.identifier);var d=function(){if(a){a.un("load",d)}this.facade.raiseEvent(Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE,this.getSelectionPath(e));Signavio.Core.StoreManager.loadChildEntitiesStore(e.attributes.identifier)}.bind(this);if(!a||!a.isLoading){d()}else{a.on("load",d)}}else{this.facade.raiseEvent(Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE,this.getSelectionPath(e));Signavio.Core.StoreManager.loadChildEntitiesStore(e.attributes.identifier)}}else{return false}},onChildFolderChange:function(h){this.currentChildStore=h;var a=h.getIdentifier();var b=this.panel.getSelectionModel();var c=b.getSelectedNode();if((c&&c.attributes.identifier===a)||h.getIdentifier().startsWith("/search")){return}var g=!!this.finialized;var d=h.getRecords("parents")[0];if(!d){return}var j=d.get("rep").pluck("href");j.unshift(a);var e=function(k){if(k.attributes.identifier===h.getIdentifier()){if(!b.isSelected(k)&&b.selNode!=k){if(b.selNode){b.selNode.ui.onSelectedChange(false)}b.selNode=k;k.ui.onSelectedChange(true);this.facade.raiseEvent(Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE,this.getSelectionPath(k))}}}.bind(this);var f=function(l){if(!l){return}e(l);var k=l.childNodes.find(function(m){return j.include(m.attributes.identifier)});if(k){e(k);if(!k.isExpanded()&&k.attributes.type!=="trash"){k.expand(false,g,function(){f(k)})}else{f(k)}}}.bind(this);f(this.panel.root)},appendChildNodes:function(b,c){c=c instanceof Array?c:[c];var a=c.map(function(d){return new Ext.tree.TreeNode(d)});b.appendChild(a)},removeChildNodes:function(b){var a=b.childNodes.length-1;for(;a>=0;a--){b.childNodes[a].remove()}},onUpdateFolders:function(b){var a=this.panel.root.childNodes.find(function(g){return g.attributes.type=="internal"});if(a){var e=Ext.get(a.getUI().getEl()),d=Signavio.Helper.getCookie("ys-showinternalfolder")&&this.facade.isCurrentUserAdmin(),f=e.isVisible(),c=this.selectionInInternal();if(d&&!f){if(b===true){a.getUI().show()}else{e.slideIn("t",{useDisplay:true,callback:function(g){g.setStyle("background","url("+Signavio.Config.IMAGE_PATH+'/signavio/bgr_left.png") repeat-y scroll right center #B1B1B1')}}).highlight("#eeeeee",{attr:"background-color",endColor:"#B1B1B1",afterStyle:"background:none;",duration:1,callback:function(){if(!c){a.select()}}})}}else{if(!d&&f){if(b===true){a.getUI().hide()}else{e.slideOut("t",{useDisplay:true,callback:function(){if(c){this.panel.root.childNodes[0].select()}}.bind(this)})}}}}},hasGlossaryLicense:function(){try{var a=this.facade.getCurrentUser().getRecords("info")[0].get("rep").licenses||[],b=Signavio.Config.ALL_LICENSES.without(Signavio.Config.QUICKMODEL_LICENSE);return a.any(function(d){return b.include(d)})}catch(c){}return false}};Signavio.Plugins.Folder=Signavio.Core.ComponentPlugin.extend(Signavio.Plugins.Folder)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Toolbar={renderToView:"toolbar",enabled:true,relTypes:[Signavio.Const.REL.PRIVILEGE],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.registerOnEvent("selectionchange",this.checkButtonState.bind(this));(Signavio.Core.StoreManager.getStore("child")||Signavio.Core.StoreManager.getChildEntitiesStore()).on("load",this.checkButtonState.bind(this));Ext.EventManager.onWindowResize(this.updateResize,this);this.facade.getExtView("left").on("resize",this.updateResize,this)},finialize:function(){this.updateResize()},hasClass:function(el,cls){if(el instanceof Ext.Toolbar.Button){if(el.menu instanceof Ext.menu.Menu){return el.menu.el.hasClass(cls)||el.el.hasClass(cls)}else{return el.el.hasClass(cls)}}else{if(el.el.className){return el.el.className.include(cls)}else{return false}}},getWidth:function(r){return r.el.dom?r.el.getWidth():r.el.offsetWidth},getMinWidth:function(r){if(r.hidden||r.el.className==="ytb-spacer"){return 0}else{if(this.hasClass(r,"x-arrange-left")||this.hasClass(r,"x-arrange-right")){return r.menu?32:22}else{var node=(r.el.parentNode||r.el.parent());node=node.dom?node.dom:node;return node.offsetWidth}}},swapClass:function(button,oldClass,newClass){button.el.removeClass(oldClass);button.el.addClass(newClass)},updateResize:function(){if(!this.buttonsWidth||this.parent.items.items.length!==this.buttonsWidth.length){this.buttonsWidth=this.parent.items.items.map(function(r,i){return this.getWidth(r)}.bind(this))}var width=this.parent.container.getWidth();var minButtonWidth=eval(this.parent.items.items.map(function(r){return this.getMinWidth(r)}.bind(this)).join("+"));this.parent.items.items.each(function(button,i){if(!button.hidden&&(this.hasClass(button,"x-arrange-left")||this.hasClass(button,"x-arrange-right"))){var min=this.getMinWidth(button);if(width-min>minButtonWidth-min+this.buttonsWidth[i]){this.swapClass(button,"x-btn-icon","x-btn-text-icon");minButtonWidth=minButtonWidth-min+this.buttonsWidth[i]}else{this.swapClass(button,"x-btn-text-icon","x-btn-icon");width=0}}}.bind(this))},render:function(){},handleOffers:function(options){if(!options){return}var menus=$H({});options=options.partition(function(a){return !a.arrange||a.arrange!=="right"});options.each(function(opt,index){if(index===1){this.parent.addFill()}var cls=index===0?"x-arrange-left":"x-arrange-right";var menuNames=opt.pluck("group").compact().uniq();opt.each(function(offer){if(offer&&offer.relGroup&&menuNames.include(offer.relGroup)){return}if(offer.group){if(!menus.get(offer.group)){var menu=new Ext.menu.Menu({items:[],cls:(offer.cls||"")});var menuItem={iconCls:"class_bugfixing",text:offer.name,menu:menu,disabled:true,icon:Ext.isIPad?(offer.icon||"").replace("/famfamfam/","/famfamfam/24x24/"):offer.icon,offer:offer,cls:[offer.menuCls||undefined,cls||undefined,"x-btn-text-icon"].compact().join(" ")};this.parent.add(menuItem);offer.button=menu;offer.menuButton=this.parent.items.last();menus.set(offer.group,menu)}offer.items=offer.items||offer;var menu=menus.get(offer.group);var items=offer.items;items=items.concat(opt.findAll(function(r){return r&&r.relGroup&&r.relGroup==offer.group}));items=items.sort(function(a,b){return a.index===undefined&&b.index===undefined?0:(a.index===undefined?-1:b.index===undefined?1:(a.index>b.index?1:(a.index<b.index?-1:0)))});items.each(function(i){if(i.seperated&&!i.functionality){menu.addSeparator().offer=i;return}var menuItem={handler:i.functionality,text:i.name,icon:i.icon,tooltip:i.description,checked:i.checked,offer:i,cls:i.cls||undefined};if(i.iconCls){menuItem.iconCls=i.iconCls;menuItem.activeClass=i.activeClass}i.button=menu.addMenuItem(menuItem);if(i.onAdd instanceof Function){i.onAdd(menu.items.last(),menu)}if(i.seperated){menu.addSeparator()}});if(offer.seperated){this.parent.addSeparator().offer={}}if(offer.onAdd instanceof Function){offer.onAdd(this.parent.items.last())}}else{if((offer.seperated||offer.separated)&&!offer.functionality){this.parent.addSeparator().offer=offer}else{var button=new Ext.Toolbar.Button({handler:offer.functionality,iconCls:"class_bugfixing",icon:Ext.isIPad?(offer.icon||"").replace("/famfamfam/","/famfamfam/24x24/"):offer.icon,disabled:true,toggleGroup:offer.toggleGroup,enableToggle:!!offer.toggleGroup,allowDepress:!offer.toggleGroup,pressed:offer.pressed,text:offer.name,tooltip:offer.description,offer:offer,cls:cls+" x-btn-text-icon"});this.parent.add(button);offer.button=button;if(offer.onAdd instanceof Function){offer.onAdd(button)}if(offer.seperated||offer.separated){this.parent.addSeparator()}}}}.bind(this))}.bind(this));this.parent.render();menus.values().each(function(menu){menu.render()});this.checkButtonState();this.updateResize()},update:function(){this.checkButtonState(this.currentStores)},checkButtonState:function(stores){window.clearTimeout(this.timer);var me=this;var update=function(el,forceDisable){if(!el||!el.offer){return}var disabled=el.offer.isDisabled instanceof Function&&el.offer.isDisabled();disabled=disabled||(el.offer.neededPrivileges&&(!(stores instanceof Array)||!stores.all(function(store){return store.hasPrivileges(el.offer.neededPrivileges)})));if(el.el&&el.setDisabled){el.el[disabled?"addClass":"removeClass"]("x-disabled");el.setDisabled(disabled)}el.setVisible(!(el.offer.isVisible instanceof Function)||el.offer.isVisible());if(el.menu&&el.menu instanceof Ext.menu.Menu){var allChildHidden=el.menu.items.items.all(function(item){return item.hidden});if(allChildHidden||el.menu.items.items.length<=0){el.setDisabled(true)}}};this.timer=window.setTimeout(function(){var buttons=this.parent.items.items.findAll(function(b){return(b instanceof Ext.Toolbar.Button||b.ctype=="Ext.Component"||b instanceof Ext.Toolbar.Separator)&&b.offer});buttons.each(function(button){update(button)});var menus=this.parent.items.items.findAll(function(b){return(b.menu instanceof Ext.menu.Menu)&&b.offer});menus.each(function(menu){menu.menu.items.each(function(item){if(!item||!(item instanceof Ext.menu.Item)){return}update(item)});menu.menu.items.each(function(item,index){if(!item||!(item instanceof Ext.menu.Separator)){return}var preVis=false,sucVis=false;for(var i=index+1;i<menu.menu.items.items.length;i++){if(menu.menu.items.items[i] instanceof Ext.menu.Separator){break}if(!menu.menu.items.items[i].hidden){sucVis=true;break}}for(var i=index-1;i>=0;--i){if(menu.menu.items.items[i] instanceof Ext.menu.Separator){if(menu.menu.items.items[i].hidden){continue}else{break}}if(!menu.menu.items.items[i].hidden){preVis=true;break}}item.setVisible(sucVis&&preVis)});update(menu)});buttons=this.parent.items.items;var spacer=buttons.find(function(btn){return btn&&btn.el&&btn.el.className==="ytb-spacer"});var left,right;if(typeof spacer==="undefined"){left=buttons;right=[]}else{left=buttons.slice(0,buttons.indexOf(spacer));right=buttons.slice(buttons.indexOf(spacer)+1)}[left,right].each(function(buttons){buttons.each(function(button){if(button instanceof Ext.Toolbar.Separator&&!button.hidden){for(var i=buttons.indexOf(button)-1;i>=0;--i){if(buttons[i] instanceof Ext.Toolbar.Separator&&!buttons[i].hidden){button.setVisible(false);return false}if(!buttons[i].hidden){break}}var allPrevButtonsHidden=buttons.slice(0,buttons.indexOf(button)).pluck("hidden").all();var allRestButtonsHidden=buttons.slice(buttons.indexOf(button)+1).pluck("hidden").all();if(allPrevButtonsHidden||allRestButtonsHidden){button.setVisible(false)}}})})}.bind(this),10)}};Signavio.Plugins.Toolbar=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.Toolbar)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Message={enabled:true,construct:function(a){arguments.callee.$.construct.apply(this,arguments)},render:function(){this.tpl=new Ext.XTemplate("<div>{message}</div>");this.panel=new Ext.Panel({width:400,cls:"x-message",renderTo:Ext.getBody()});this.panel.el.hide();this.syncPos();Signavio.Log.register(this.onLog.bind(this));Ext.getBody().on("resize",this.syncPos.bind(this))},syncPos:function(){this.panel.el.center();this.panel.el.setTop(this.facade.getExtView("top").el.getHeight())},onLog:function(d,c){c=typeof c=="string"?{message:c}:c;var a=Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.panel.body,["div",{"class":"x-message-item"},c.message]);a=Ext.get(a).boxWrap();a.setStyle({position:"absolute"});a.slideIn("t",{duration:0.25});var b=window.setTimeout(function(){a.slideOut("t",{duration:0.25,remove:true})},Signavio.Config.WARNING_SHOWN||3000);a.on("mouseover",function(){window.clearTimeout(b)});a.on("mouseout",function(){a.slideOut("t",{duration:0.25,remove:true})})}};Signavio.Plugins.Message=Signavio.Core.ComponentPlugin.extend(Signavio.Plugins.Message)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}var abStore;new function(){Signavio.Plugins.Breadcrumb={enabled:true,viewGroup:["icon","table"],lastUrl:"",render:function(){this.template=new Ext.XTemplate('<span class="details">','<tpl for=".">',"{[values.delimiter || Signavio.I18N.Repository.BreadCrumb.delimiter]}",'<a rel="{href}" onclick="{fn}" class="{[values.disabled?"x-disabled":""]}"> {name}</a>  ',"</tpl>","</span>");this.panel=new Ext.Panel({cls:"breadcrumb_plugin",border:false,height:30,html:"<span class='x-breadcrumb-wrapper'><span><span class='details'>"+Signavio.I18N.Repository.BreadCrumb.delimiter+"<span class='x-disabled'>"+Signavio.I18N.Repository.BreadCrumb.none+"</span></span></span><img class='x-msg-loading' style='display:none;' src='"+Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif'/></span>"});var a=Signavio.Core.StoreManager.getChildEntitiesStore();a.on("beforeload",this.show.bind(this));a.on("load",this.update.bind(this));Ext.EventManager.onWindowResize(this.update.bind(this,false));var b=Signavio.Core.StoreManager.getRootDirectoryStore();b.on("beforeload",this.show.bind(this));b.on("load",this.hide.bind(this));Signavio.Core.Stores.RequestManager.on(Signavio.Core.Stores.RequestManager.BEFORELOAD,this.show.bind(this));Signavio.Core.Stores.RequestManager.on(Signavio.Core.Stores.RequestManager.FINISHED,this.hide.bind(this));this.facade.registerOnEvent(Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE,this.onFolderSelectionChange.bind(this))},afterRender:function(){this.panel.content=this.panel.body.first().first();this.panel.waiting=this.panel.body.first().last();this.panel.waiting.setVisibilityMode(Ext.Element.DISPLAY)},onFolderSelectionChange:function(b,a){this.bread=a.map(function(c){return{href:c.identifier,name:c.name,fn:"Signavio.Core.StoreManager.loadChildEntitiesStore( (event.target||event.srcElement).getAttribute('rel') )"}});this.cachedBread=[];this.count=Math.max(this.count-1,0)},count:0,hide:function(){if(!this.panel||!this.panel.waiting||(--this.count>0)){return}this.panel.waiting.hide({duration:0.2});this.count=0},show:function(){if(!this.panel||!this.panel.waiting||++this.count!==1){return}this.panel.waiting.setDisplayed(true)},update:function(a){if(!a){a=Signavio.Core.StoreManager.getChildEntitiesStore()}if(!a||!a.lastOptions){return}this.hide();if(this.panel.bottombar&&this.panel.bottombar.parent()){this.panel.bottombar.update("")}else{var b=this.parent.el.child(".view_plugin");if(b){this.panel.bottombar=b.createChild({html:"",cls:"x-breadcrumb-bottom-bar"})}}if(a.lastOptions.url.endsWith("search")||this.isSearched){this.updateSearch(a.lastOptions.params.q,a)}else{this.updateBread(a)}},updateBread:function(g){if(!this.panel||!this.panel.content){return}var c=this.getBreadCrumb(g);this.lastUrl=(c.last()||{}).href||"";this.template.overwrite(this.panel.content,c);var a=100;if(this.panel.body.first().getWidth()-10>this.parent.getInnerWidth()-a){var e=c.clone();var h=0;var f={name:"...",disabled:true};for(var b=0;b<c.length;b++){var d=(b%2)===0?c.length-((b+2)/2):((b-1)/2);var j=c[d];h+=(this.panel.content.first().dom.childNodes[((c.indexOf(j)*2)+1)].offsetWidth||0)+20;if(h>this.parent.getInnerWidth()-a&&b>0){if(f){e[d]=f;f=false}else{e[d]=undefined}}}this.template.overwrite(this.panel.content,e.compact())}},updateSearch:function(g,k){var l,h;l=h=k.data.items.length;try{l=k.getRecords("search")[0].get("rep").totalNrOfResults}catch(d){}var j=new Ext.XTemplate(Signavio.I18N.Repository.BreadCrumb.nrOfResults).apply({nr:Math.max(l,0)});if(!this.cachedBread||this.cachedBread.length==0){this.cachedBread=this.bread}this.bread=[{name:(g||"").escapeHTML()+" ("+j+")",delimiter:""+Signavio.I18N.Repository.BreadCrumb.search,fn:"Signavio.Core.StoreManager.getRelatedStore( '/search', 'child', ['dir', 'mod'], {force:true,params:"+Object.toJSON(k.lastOptions.params).gsub("'","\\'").gsub('"',"'")+"})"}];if(this.lastUrl){this.bread.last().delimiter="&raquo; "+this.bread.last().delimiter;this.bread.unshift({href:this.lastUrl,delimiter:"&laquo; ",name:Signavio.I18N.Repository.BreadCrumb.goBack,fn:"Signavio.Core.StoreManager.loadChildEntitiesStore( (event.target||event.srcElement).getAttribute('rel') )"})}this.template.overwrite(this.panel.content,this.bread);if(l>h&&k.lastOptions&&k.lastOptions.params){var f=Math.floor(k.lastOptions.params.offset/k.lastOptions.params.limit);var a=Math.floor((l-1)/k.lastOptions.params.limit);var b=f!=0?"<a href='#' class='x-first'>|<big>&laquo;</big></a> <a href='#' class='x-previous'><big>&laquo;</big></a>":"<span class='x-disabled'><span class='x-first'>|<big>&laquo;</big></span> <big>&laquo;</big></span>";var c=f!=a?"<a href='#' class='x-next'><big>&raquo;</big></a> <a href='#' class='x-last'><big>&raquo;</big>|</a>":"<span class='x-disabled'><big>&raquo;</big> <span class='x-last'><big>&raquo;</big>|</span></span>";[this.panel.content,this.panel.bottombar].compact().each(function(m){var e=m.createChild({html:String.format("{0} {1}/{2} {3}",b,f+1,a+1,c),tag:"span",cls:"x-bread-search-pages"});e.select("a").on("click",function(p){var s=Ext.get(p.target);Event.stop(p);var q=Signavio.Core.StoreManager.getStore("child");if(q&&q.isLoading){return}if(!s.is("a")){s=s.parent("a")}if(!s){return}var r=Object.clone(k.lastOptions.params);if(s.hasClass("x-first")){r.offset=0}else{if(s.hasClass("x-previous")){r.offset-=r.limit}else{if(s.hasClass("x-next")){r.offset+=r.limit}else{if(s.hasClass("x-last")){r.offset=a*r.limit}}}}Signavio.Core.StoreManager.getRelatedStore("/search","child",["mod","dir"],{force:true,params:r})})})}},getBreadCrumb:function(a){this.bread=[];var c=a.getRecords("info")[0];if(c){this.bread.push({href:a.getIdentifier(),name:Signavio.I18N.Repository.Folder[c.get("rep").type]||c.get("rep").name||c.get("rep").title||a.getIdentifier(),fn:"Signavio.Core.StoreManager.loadChildEntitiesStore( (event.target||event.srcElement).getAttribute('rel') )"})}var b=a.getRecords("parents")[0];if(b){b.get("rep").each(function(d){this.bread.unshift({href:d.href,name:Signavio.I18N.Repository.Folder[d.rep.type]||d.rep.name||d.rep.title||d.href,fn:"Signavio.Core.StoreManager.loadChildEntitiesStore( (event.target||event.srcElement).getAttribute('rel') )"})}.bind(this))}return this.bread.clone()},onClick:function(a){Signavio.Core.StoreManager.loadChildEntitiesStore(a.getAttribute("rel"))},onViewSelect:function(){this.update()}};Signavio.Plugins.Breadcrumb=Signavio.Core.ViewPlugin.extend(Signavio.Plugins.Breadcrumb)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.IconView={enabled:true,viewGroup:"icon",finialize:function(){if(!Signavio.Const.FRAGMENTS_ENABLED){return}var b=window.location.hash;if(b.include(Signavio.Config.MODEL_PATH)||b.include(Signavio.Config.TALKABOUT_PATH)){b=window.location.hash.replace(/.*\/model\/?/g,"/model/").replace(/.*\/talkabout\/?/g,"/model/");var a=this.panel.getNodeIndexesForRecordId(b);this.panel.select(a.first())}},render:function(){var a='<div class="empty-directory"><div class="thumb"><img title="'+Signavio.I18N.Repository.IconView.none+'" src="'+Signavio.Config.IMAGE_PATH+'/nuvola/64x64/filesystems/folder_grey_white.png"/></div><span>'+Signavio.I18N.Repository.IconView.none+"</span></div>";var b=this;this.panel=new Ext.DataView({store:Signavio.Core.StoreManager.getChildEntitiesStore(),tpl:Signavio.Templates.View,cls:"view_plugin",multiSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:a,anchor:"0 -38",plugins:[new Ext.DataView.DragSelector({dragSafe:false})],getCommentsForModel:function(f){var d=id.split(/\/(model|view)\//i).last(),e=id.include("/view")?Signavio.Portal.Config.VIEW:Signavio.Portal.Config.MODEL,c=e+"/"+d+"/comments";if(Ext.Ajax.extraParams.authkey){c+="?"+Object.toQueryString(Ext.Ajax.extraParams)}},focus:function(){var c=document.activeElement;if(c&&c.tagName.toLowerCase()!=="body"){Ext.get(c).blur()}},prepareData:function(e){var d={};var c=Object.clone(e);c.rep=Object.clone(e.rep);c.rep.shortName=Signavio.Helper.SplitIntoTwoLines((c.rep.name||""),(90*2));if(!c.rep.picture){if(c.rel===Signavio.Const.REL.MODEL){c.rep.picture=Signavio.Config.BACKEND_PATH+c.rep.revision+Signavio.Const.THUMBNAIL+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter());if(Signavio.Config.ShowCommentBubblesForModels&&c.rep.numberOfNewComments&&c.rep.numberOfNewComments!=0){c.rep.renderCommentBadge=true;if(c.rep.numberOfNewComments===1){c.rep.newCommentsQTip=Signavio.I18N.Repository.IconView.toolTipCommentsSingle}else{c.rep.newCommentsQTip=Signavio.I18N.Repository.IconView.toolTipCommentsPlural.replace("{commentsCount}",c.rep.numberOfNewComments)}}}else{if(c.rel===Signavio.Const.REL.FILE){c.rep.picture=Signavio.Utils.getIcon(c.rep.extension,false,"52x62")}else{c.rep.picture=Signavio.Config.IMAGE_PATH+"/nuvola/64x64/filesystems/folder_grey.png"}}}d=this._preparedDeployedIcon(c);Ext.apply(c.rep,d);return c},_preparedDeployedIcon:function(h){var e={},f,d,c,g;if(h.rel!==Signavio.Const.REL.MODEL){return e}d=b.facade.getConfig();if(typeof(d)==="undefined"||typeof(d.deployTarget)!=="string"||d.deployTarget.length<=0){return e}f=d.deployTarget;if(f==="saperion"&&!b.facade.isCurrentUserInGroup("SaperionDeployerUserGroup")){return e}c=h.rep.deployed_revision;g=h.rep.revision;if(c===g){e.badge=Signavio.Config.DIAGRAMS_IMAGE_PATH+"/misc/"+f+".png";e.badgeDescription=Signavio.I18N.Repository["Deploy2"+f.capitalize()].deployedCurrentRevision}else{if(typeof(c)==="string"&&c.startsWith("/revision/")){e.badge=Signavio.Config.DIAGRAMS_IMAGE_PATH+"/misc/"+f+"_gray.png";e.badgeDescription=Signavio.I18N.Repository["Deploy2"+f.capitalize()].deplozedOlderRevision}}return e},onRemove:function(e,c,d){var f=this.getNode(d);if(f){Ext.get(f).hide({duration:0.25,remove:true,callback:function(){if(d>=0){Ext.DataView.prototype.onRemove.apply(this,arguments)}this.refresh()}.bind(this)})}},onAdd:function(e,c,d){Ext.DataView.prototype.onAdd.apply(this,arguments);this.clearSelections();c.each(function(f){var g=this.getNode(this.store.indexOf(f));if(g){this.select(g,true);Ext.fly(g).show({duration:0.25})}}.bind(this))},onUpdate:function(k,d){var c=this.getNodeIndexesForRecordId(d.get("href"));for(var g=0;g<c.length;g++){var e=c[g];if(e>=0){var j=this.isSelected(e);var f=this.all.elements[e];var h=this.bufferRender([d],e)[0];h.setAttribute("id",d.get("href"));this.all.replaceElement(e,h,true);if(j){this.selected.replaceElement(f,h);this.all.item(e).addClass(this.selectedClass)}this.updateIndexes(e,e)}}},getNodeIndexesForRecordId:function(f){var c=[];var d=this.getNodes();for(var e=0;e<d.length;e++){if(d[e].id==f){c[c.length]=this.indexOf(d[e])}}return c},onBeforeLoad:function(){this._oldSelection=this.getSelectedRecords().map(function(c){return c.get("href")});Ext.DataView.prototype.onBeforeLoad.apply(this,arguments)},refresh:function(){Ext.DataView.prototype.refresh.apply(this,arguments);if(this._oldSelection){var d=this.store;var c=this._oldSelection.map(function(e){return d.find("href",e)}).findAll(function(e){return e>=0});this.select(c)}},getSelectedRecords:function(){var h=[],g=this.selected.elements;for(var f=0,c=g.length;f<c;f++){var d=g[f].attributes.getNamedItem("id").value;var e=this.store.find("href",d);if(e>=0){h.push(this.store.getAt(e))}}return h},listeners:{selectionchange:function(){if(this.selectiontimer){window.clearTimeout(this.selectiontimer)}this.selectiontimer=window.setTimeout(this.onSelectionChange.bind(this),10);this.panel.focus()}.bind(this),click:function(e,d,g,f){if(this.selectiontimer){window.clearTimeout(this.selectiontimer)}this.selectiontimer=window.setTimeout(this.onSelectionChange.bind(this),10);this.panel.focus()}.bind(this),dblclick:this.onDblClick.bind(this),containerclick:function(d,c){var e=c.getTarget("div.dataview-group-header",2,true);if(e){e.up("div").toggleClass("x-grid-group-collapsed")}return !d.plugins[0].isDragging()}}});this.facade.registerOnEvent(Signavio.Const.EVENT.FOLDER_SELECTION_CHANGE,function(d,c){if(this.facade.getTrashRecord()&&c.first().identifier==this.facade.getTrashRecord().get("href")){this.panel.addClass("trash")}else{this.panel.removeClass("trash")}}.bind(this));this.facade.registerOnEvent(Signavio.Const.EVENT.SEARCH_ACTIVATED,function(){this.panel.removeClass("trash")}.bind(this))},afterRender:function(){new Ext.KeyMap(document,{key:"a",ctrl:true,fn:function(b,c){if(c.target.tagName==="INPUT"||c.target.tagName==="TEXTAREA"){return}this.selectAll();c.stopEvent()},scope:this});new Ext.KeyMap(document,{key:46,fn:function(b,c){if(c.target.tagName==="INPUT"||c.target.tagName==="TEXTAREA"){return}this.facade.raiseEvent(Signavio.Const.EVENT.DELETE_SELECTED_ITEMS);c.stopEvent()}.bind(this)});var a=new Ext.KeyMap(document,[{key:37,fn:function(b,d){if(Ext.getBody().hasClass("x-body-masked")){return}if(d.target.tagName==="A"){return}if(d.target.tagName==="INPUT"||d.target.tagName==="TEXTAREA"){return}if(!(this.panel.getNodes() instanceof Array)||this.panel.getNodes().compact().length<1){return}var c=this.panel.getSelectedIndexes().first()||0;this.panel.select(Math.max(0,--c));this.panel.getSelectedNodes().first().scrollIntoView(this.panel.el);d.stopEvent()}.bind(this)},{key:39,fn:function(b,f){if(Ext.getBody().hasClass("x-body-masked")){return}if(f.target.tagName==="A"){return}if(f.target.tagName==="INPUT"||f.target.tagName==="TEXTAREA"){return}if(!(this.panel.getNodes() instanceof Array)||this.panel.getNodes().compact().length<1){return}var d=this.panel.getNodes().length-1;var c=this.panel.getSelectedIndexes().first();c=c===undefined?d:c;this.panel.select(Math.min(d,++c));this.panel.getSelectedNodes().first().scrollIntoView(this.panel.el);f.stopEvent()}.bind(this)},{key:38,fn:function(b,f){if(Ext.getBody().hasClass("x-body-masked")){return}if(f.target.tagName==="A"){return}if(f.target.tagName==="INPUT"||f.target.tagName==="TEXTAREA"){return}if(!(this.panel.getNodes() instanceof Array)||this.panel.getNodes().compact().length<1){return}var c=this.panel.getSelectedIndexes().first()||0;var d=Math.floor((this.panel.el.dom.scrollWidth+5)/(this.panel.getNodes().first().offsetWidth+5));this.panel.select(Math.max(c%d,c-d));this.panel.getSelectedNodes().first().scrollIntoView(this.panel.el);f.stopEvent()}.bind(this)},{key:40,fn:function(b,g){if(Ext.getBody().hasClass("x-body-masked")){return}if(g.target.tagName==="A"){return}if(g.target.tagName==="INPUT"||g.target.tagName==="TEXTAREA"){return}if(!(this.panel.getNodes() instanceof Array)||this.panel.getNodes().compact().length<1){return}var f=this.panel.getNodes().length-1;var c=this.panel.getSelectedIndexes().first()||0;var d=Math.floor((this.panel.el.dom.scrollWidth+5)/(this.panel.getNodes().first().offsetWidth+5));this.panel.select(Math.min(f,c+d));this.panel.getSelectedNodes().first().scrollIntoView(this.panel.el);g.stopEvent()}.bind(this)},{key:13,fn:function(b,c){if(Ext.getBody().hasClass("x-body-masked")){return}if(c.target.tagName==="INPUT"||c.target.tagName==="TEXTAREA"){return}if(this.panel.getSelectedIndexes().length!==1){return}this.onDblClick(this.panel,this.panel.getSelectedIndexes().first(),this.panel.getSelectedNodes().first(),c);c.stopEvent()}.bind(this)}])},selectAll:function(){if(this.panel.getNodes().length<1){return}this.panel.select(this.panel.getNodes());this.panel.fireEvent("selectionchange",this.panel,this.panel.getSelectedNodes())},onDblClick:function(b,p,f,q){var c=this.facade.getCurrentRootFolder();var g=this.facade.getTrashRecord();if(c&&c===g){return}var l=f.attributes.getNamedItem("id").value;var p=b.store.find("href",l);if(p<0){return}var m=b.store.getAt(p);if(m.get("rel")===Signavio.Const.REL.DIRECTORY){var a=m.get("href");var d=Signavio.Core.StoreManager.getStore(a);if(d&&d.isLoading){d.missedCallbacks.push(function(h,n,e){Signavio.Core.StoreManager.loadChildEntitiesStore(n.id)})}else{Signavio.Core.StoreManager.loadChildEntitiesStore(a)}}else{if(m.get("rel")===Signavio.Const.REL.MODEL){if(!this.facade.isSupportedBrowserEditor()){var j=this.facade.getCurrentUser().getRecords("info")[0].get("rep").licenses||[],r=Signavio.Config.ALL_LICENSES.without(Signavio.Config.SPREADSHEET_LICENSE);var k=j.include(Signavio.Config.SPREADSHEET_LICENSE)&&!j.any(function(e){return r.include(e)});if(k&&this.facade.isSupportedBrowserQuickModel()){var s=Signavio.Config.SPREADSHEET_EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:m.get("href").split("/")[2]});window.open(s)}else{if(Ext.isIECompatibility){Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.ie9Compatibility).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.newFFOnly).setIcon(Ext.Msg.INFO).getDialog().syncSize()}}}else{var s=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:m.get("href").split("/")[2]});window.open(s)}}else{if(m.get("rel")===Signavio.Const.REL.FILE){var s=Signavio.Config.BACKEND_PATH+m.get("href")+"/content?"+Object.toQueryString(Ext.Ajax.getSecurityParameter());window.open(s)}}}q.preventDefault()},onSelectionChange:function(){if(!this.isViewSelected()){return}var b=[].concat(this.panel.getSelectedRecords());var a=[].concat(this.getSelection());if(b.length==a.length&&b.findAll(function(c){return a.include(c)}).length==a.length){return}this._selection=b;this.facade.raiseEvent("selectionchange",b,a)},onViewSelect:function(){var b=this.getSelection();var a=[];this.panel.clearSelections(true);b.each(function(c){var d=this.panel.store.indexOf(c);if(d>=0){this.panel.select(d,true,true);a.push(c)}}.bind(this));if(a.length!==b.length){this.facade.raiseEvent("selectionchange",a,b)}}};Signavio.Plugins.IconView=Signavio.Core.ViewPlugin.extend(Signavio.Plugins.IconView)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.TableView={enabled:true,viewGroup:"table",render:function(){this.panel=new a(this.facade,{store:Signavio.Core.StoreManager.getChildEntitiesStore(),multiSelect:true,style:"padding-left:5px;margin-top:5px;",anchor:"100% -43",border:false,viewPlugin:this,plugins:[new Ext.grid.DragSelector({dragSafe:true})],listeners:{rowdblclick:this.onDblClick.bind(this),click:function(d){var c=d.getTarget();var b=this.view;var g=b.findHeaderIndex(c);var f=b.findRowIndex(c);if(g===false&&f===false&&!this.plugins[0].isDragging()){this.getSelectionModel().clearSelections()}}}});this.initEvents()},initEvents:function(){this.panel.getSelectionModel().on("selectionchange",this.onSelectionChange.bind(this));new Ext.KeyMap(document,{key:"a",ctrl:true,fn:function(b,c){if(c.target.tagName==="INPUT"||c.target.tagName==="TEXTAREA"||!this.isViewSelected()){return}this.selectAll();c.stopEvent()},scope:this});new Ext.KeyMap(document,{key:46,fn:function(b,c){if(c.target.tagName==="INPUT"||c.target.tagName==="TEXTAREA"){return}this.facade.raiseEvent(Signavio.Const.EVENT.DELETE_SELECTED_ITEMS);c.stopEvent()}.bind(this)});this.panel.store.on("beforeload",function(){this._oldSelection=this.getSelection().map(function(b){return b.get("href")})}.bind(this));this.panel.store.on("load",function(c){if(this._oldSelection&&this.isViewSelected()){var b=this._oldSelection.map(function(e){var d=c.find("href",e);return(d>=0?d:undefined)}).compact();if(b&&b.length>0){this.panel.getSelectionModel().selectRows(b)}}}.bind(this))},onDblClick:function(e,g){var b=this.panel.store.getAt(g);if(!b){return}if(b.get("rel")===Signavio.Const.REL.DIRECTORY){var c=b.get("href");var d=Signavio.Core.StoreManager.getStore(c);if(d&&d.isLoading){d.missedCallbacks.push(function(j,k,h){Signavio.Core.StoreManager.loadChildEntitiesStore(k.id)})}else{Signavio.Core.StoreManager.loadChildEntitiesStore(c)}}else{if(b.get("rel")===Signavio.Const.REL.MODEL){if(this.facade.isSupportedBrowserEditor()){var f=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:b.get("href").split("/")[2]});window.open(f)}else{if(Ext.isIECompatibility){Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.ie9Compatibility).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.edit,Signavio.I18N.Repository.Offer.newFFOnly).setIcon(Ext.Msg.INFO).getDialog().syncSize()}}}else{if(b.get("rel")===Signavio.Const.REL.FILE){var f=Signavio.Config.BACKEND_PATH+b.get("href")+"/content?inline=true";window.open(f)}}}},onSelectionChange:function(d){if(!this.isViewSelected()){return}var c=[].concat(this.panel.getSelectionModel().getSelections());var b=[].concat(this.getSelection());if(c.length==b.length&&c.findAll(function(f){return b.include(f)}).length==b.length){return}window.clearTimeout(this.stimeout);this.stimeout=window.setTimeout(function(f,e){this.facade.raiseEvent("selectionchange",f,e)}.bind(this,c,b),1)},onViewSelect:function(){this.panel.getSelectionModel().suspendEvents();this.panel.getSelectionModel().selectRecords(this.getSelection());this.panel.getSelectionModel().resumeEvents();this.panel.syncSize()},selectAll:function(){if(this.panel&&this.isViewSelected()){this.panel.getSelectionModel().selectAll()}}};Signavio.Plugins.TableView=Signavio.Core.ViewPlugin.extend(Signavio.Plugins.TableView);var a=function(c,b){this.facade=c;b=b||{};b.sm=new Ext.grid.RowSelectionModel({initEvents:function(){Ext.grid.RowSelectionModel.prototype.initEvents.apply(this,arguments);this.grid.un("rowmousedown",this.handleMouseDown,this);this.grid.on("rowclick",this.handleMouseDown,this)}});b.cm=new Ext.grid.ColumnModel([{header:"&nbsp;",width:24,fixed:true,dataIndex:"rel",resizable:false,renderer:function(n,j,g){j.attr='style="position:relative;overflow:visible;"';var m=g.get("rep");var p=m.extension||m.namespace||n;var d=Signavio.Utils.getIcon(p);var l=g.get("rep").type||"";var h="";if(g.get("rep").granted_revision){var e=g.get("rep").revision===g.get("rep").granted_revision;l=(e?Signavio.I18N.Repository.Revision.viewIconTooltipHead:Signavio.I18N.Repository.Revision.viewIconTooltipNoHead)+(l?" - "+l:"");l=" ext:qtip='"+l+"'";var f=Signavio.Config.IMAGE_PATH+"/nuvola/16x16/apps/browser_small.png";var k=Signavio.Config.IMAGE_PATH+"/nuvola/16x16/apps/browser_black_small.png";h="<img src='"+(e?f:k)+"' class='x-icon' style='position:absolute;left:1px;top:10px;' "+l+"/>"}else{l=l?" ext:qtip='"+l+"'":""}return"<img src='"+d+"' class='x-icon' style='position:absolute;left:3px;top:1px;' "+l+"/>"+h},sortable:true,sortBy:function(d){var f=d.get("rep").granted_revision;var e=d.get("rep").revision===d.get("rep").granted_revision;return d.get("rel").toLowerCase()+(f?(e?1:2):3)+(d.get("rep").namespace||"")}},{header:Signavio.I18N.Repository.TableView.parentName,width:150,dataIndex:"rep",renderer:function(f,e,d){if(f.parent!=="undefined"&&d.get("rel")!=="dir"){return f.parent?"<a href='#"+f.parent+"'>"+f.parentName+"</a>":""}else{return""}},sortable:true,sortBy:function(d){return(d.get("rep").name||"").toLowerCase().replace("","a").replace("","o").replace("","u")}},{header:Signavio.I18N.Repository.TableView.name,width:200,dataIndex:"rep",renderer:function(f,e){var g=f.name?'ext:qtip="'+f.name.gsub('"',"&quot;")+(f.extension?("."+f.extension):"")+'" ':"";if(Signavio.Config.ShowCommentBubblesForModels&&f.numberOfNewComments&&f.numberOfNewComments!==0){if(f.numberOfNewComments===1){var d=Signavio.I18N.Repository.TableView.toolTipCommentsSingle}else{var d=Signavio.I18N.Repository.TableView.toolTipCommentsPlural.replace("{commentsCount}",f.numberOfNewComments)}return"<span "+g+">"+f.name+"</span><img ext:qtip='"+d+"' class='ak-explorer-table-view-comments-badge' src='/images/famfamfam/comments.png'>"}else{return"<span "+g+">"+f.name+"</span>"}},sortable:true,sortBy:function(d){return(d.get("rep").name||"").toLowerCase().replace("","a").replace("","o").replace("","u")}},{header:Signavio.I18N.Repository.TableView.description,width:200,dataIndex:"rep",renderer:function(e,d){var f=e.description?'ext:qtip="'+e.description.gsub('"',"&quot;")+'" ':"";return"<span "+f+">"+e.description+"</span>"},sortable:true,sortBy:function(d){return(d.get("rep").description||"").toLowerCase().replace("","a").replace("","o").replace("","u")}},{header:Signavio.I18N.Repository.TableView.revision,width:60,dataIndex:"rep",staticWidth:true,renderer:function(d){return d.rev},defaultSort:"DESC",sortable:true,sortBy:function(d){return d.get("rep").rev||0}},{header:Signavio.I18N.Repository.TableView.lastChanges,width:100,dataIndex:"rep",staticWidth:true,renderer:function(d){return d.updated?Signavio.Helper.ParseDate(d.updated).format("H:i d.m.Y"):""},defaultSort:"DESC",sortable:true,sortBy:function(d){return d.get("rep").updated?Signavio.Helper.ParseDate(d.get("rep").updated).getTime():0}},{header:Signavio.I18N.Repository.TableView.lastAuthor,width:50,dataIndex:"rep",sortable:true,resizable:false,renderer:function(f,d){try{var h=f&&f.authorName?'ext:qtip="'+f.authorName+'" ':"";return"<span "+h+">"+f&&f.authorName||"</span>"}catch(g){return""}},sortable:true,sortBy:function(d){try{return(d.get("rep").authorName||"").toLowerCase()}catch(f){return""}}},{header:"<i>"+Signavio.I18N.Repository.TableView.foundIn+"</i>",width:80,dataIndex:"rep",staticWidth:true,renderer:function(e,d){var e=(e.fields||[]).sortBy(function(f){switch(f){case"name":return 0;case"description":return 1;case"text1":return 2;case"labels":case"text2":return 3;case"comments":return 4;default:return 10}}).map(function(f){return Signavio.I18N.Repository.SearchFields[f]||undefined}).compact().uniq().map(function(f){return"<i>"+f+"</i>"}).join(", ");return e},sortable:true,sortBy:function(d){return(d.get("rep").fields||[]).map(function(e){switch(e){case"name":return 1;case"description":return 2;case"text1":return 3;case"labels":case"text2":return 4;case"comments":return 5;default:return 10}}).sortBy(function(e){return e}).first()||20}}]);b.store.on("load",function(d){b.cm.setHidden(1,!((d.lastOptions||{}).params||{}).q);b.cm.setHidden(7,!((d.lastOptions||{}).params||{}).q)}.bind(this));a.superclass.constructor.call(this,b)};Ext.extend(a,Ext.grid.GridPanel,{enableHdMenu:false,enableColumnMove:false,autoScroll:true,viewConfig:{forceFit:true,emptyText:Signavio.I18N.Repository.IconView.none,onHeaderClick:function(e,d){if(this.headersDisabled||!this.cm.isSortable(d)){return}e.stopEditing(true);var f=this.cm.config[d].sortBy;if(f instanceof Function){var c=this.cm.config[d].defaultSort||"ASC";var b=!this.cm.config[d].dontUseEmptyToogle;if(this.sortState&&this.sortState.field===f){c=this.sortState.direction===c?c.toggle("ASC","DESC"):(b?undefined:c)}if(!c){delete e.store.sortInfo;delete this.sortState;var f=e.store.lastOptions&&e.store.lastOptions.sort instanceof Function?e.store.lastOptions.sort:function(h,g){return h.id<g.id?-1:(g.id<h.id?1:0)};e.store.data.sort("ASC",f);if(e.store.snapshot){e.store.snapshot.sort("ASC",f)}e.store.fireEvent("datachanged",e.store);this.mainHd.select("td").removeClass(this.sortClasses)}else{e.store.sortInfo={field:f,direction:c};e.store.sortData(f,c);e.store.fireEvent("datachanged",e.store)}}},updateHeaderSortState:function(){var b=this.ds.getSortState();if(!b){return}if(!this.sortState||(this.sortState.field!=b.field||this.sortState.direction!=b.direction)){this.grid.fireEvent("sortchange",this.grid,b)}this.sortState=b;var c=this.cm.config.indexOf(this.cm.config.find(function(d){return d.sortBy===b.field}));if(c!=-1){this.updateSortIcon(c,b.direction)}},fitColumns:function(e,h,f){var g=this.cm,v,n,r;var u=g.getTotalWidth(false);var l=this.grid.getGridEl().getWidth(true)-this.scrollOffset;if(l<20){return}var c=l-u;if(c===0){return false}var b=g.getColumnCount(true);var s=b-(typeof f=="number"?1:0);if(s===0){s=1;f=undefined}var m=g.getColumnCount();var k=[];var q=0;var p=0;var j;for(r=0;r<m;r++){if(!g.isHidden(r)&&!g.isFixed(r)&&r!==f&&r>(f||-1)&&!g.config[r].staticWidth){j=g.getColumnWidth(r);k.push(r);q=r;k.push(j);p+=j}}var d=(l-g.getTotalWidth())/p;while(k.length){j=k.pop();r=k.pop();g.setColumnWidth(r,Math.max(this.grid.minColumnWidth,Math.floor(j+j*d)),true)}if((u=g.getTotalWidth(false))>l){var t=s!=b?f:q;g.setColumnWidth(t,Math.max(1,g.getColumnWidth(t)-(u-l)),true)}if(e!==true){this.updateAllColumnWidths()}return true},onRowSelect:function(c){this.addRowClass(c,"x-grid3-row-selected");var d=c>0?Ext.fly(this.getRow(c-1)):null;if(d&&!d.hasClass("x-grid3-row-selected")){this.addRowClass(c,"x-grid3-row-first-selected")}var b=Ext.fly(this.getRow(c+1));if(b&&b.hasClass("x-grid3-row-first-selected")){b.removeClass("x-grid3-row-first-selected")}},onRowDeselect:function(c){this.removeRowClass(c,"x-grid3-row-selected");this.removeRowClass(c,"x-grid3-row-first-selected");var b=Ext.fly(this.getRow(c+1));if(b&&b.hasClass("x-grid3-row-selected")){b.addClass("x-grid3-row-first-selected")}}}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}var abStore;new function(){Signavio.Plugins.Info={renderToView:"hover",enabled:true,relTypes:["info","revision"],render:function(){this.panel=new a({view:this,plugins:[new Ext.DataView.LabelEditor({labelSelector:"span.x-editable",onSave:this.onValueChange.bind(this),id:"headerLabel"}),new Ext.DataView.LabelEditor({labelSelector:"div.x-editable",onSave:this.onValueChange.bind(this),tag:"textarea",grow:false,id:"descriptionLabel",listeners:{beforestartedit:function(b){b.field.el.setHeight(this.parent.fullviewShown?200:30)}.bind(this)}})]})},afterRender:function(){this.parent.on("showfullview",this.panel.showFullView.bind(this.panel));this.parent.on("hidefullview",this.panel.hideFullView.bind(this.panel));this.parent.tools.toggle.addClass("x-disabled");var c=this.parent.tools.toggle;c.dom.innerHTML="<img src='../../libs/ext-2.0.2/resources/images/default/s.gif'/>&nbsp;&nbsp;&nbsp;"+Signavio.I18N.Repository.Info.openDiagramPreview;c.setWidth(c.getTextWidth()+24);this.facade.getExtView("view").margins.bottom=63;this.facade.getExtView("view").ownerCt.doLayout();this.facade.registerOnEvent(Signavio.Const.EVENT.SHOW_INFO_IMG,function(g,f,d){this.panel.img.showImg(f,d)}.bind(this));if(!Ext.isIE6){this.panel.on("resize",this.panel.handlePanelResize.bind(this));var b=this.parent.items.get(1);b.collapse=function(){this.isCollapsing=true;this.constructor.prototype.collapse.call(this)};b.afterCollapse=function(d){this.constructor.prototype.afterCollapse.call(this);delete this.isCollapsing;if(d instanceof Function){d()}}.bind(b,this.panel.handlePanelResize.bind(this))}var c=Signavio.Core.StoreManager.getChildEntitiesStore();c.on("load",function(){if(this.getSelection().length>0){return}var d=this.facade.getCurrentRootFolder();var e=this.facade.getCurrentFolderStore();if(!!d&&d.get("href")===e.getIdentifier()){this.panel.updateRootFolder(d)}else{this.panel.updateSingleFolder(e,true)}}.bind(this));new Ext.KeyMap(document,{key:" ",fn:function(d,f){if((f.target&&f.target.tagName&&["input","textarea"].include(f.target.tagName.toLowerCase()))||Ext.getBody().hasClass("x-body-masked")){return}f.stopEvent();if(this.parent.fullviewShown){this.parent.hideFullView()}else{this.parent.showFullView()}},scope:this});new Ext.KeyMap(document,{key:27,fn:function(d,f){if((f.target&&f.target.tagName&&["input","textarea"].include(f.target.tagName.toLowerCase()))||Ext.getBody().hasClass("x-body-masked")){return}this.parent.hideFullView()},scope:this});new Ext.KeyMap(document,{key:Ext.EventObject.ESC,fn:function(d,f){if((f.target&&f.target.tagName&&["input","textarea"].include(f.target.tagName.toLowerCase()))||Ext.getBody().hasClass("x-body-masked")){return}if(this.parent.fullviewShown){this.parent.hideFullView()}},scope:this})},openEditor:function(b){if(!b){return}var c=Signavio.Config.EDITOR_PATH+"?"+Object.toQueryString({id:b.get("href").split("/")[2]});window.open(c)},onValueChange:function(k,c,b){var l=this.currentRecordsSet.values();var f=c.match(/^\s*$/)||(c==="");if(c===b){if(f){this.panel.body.child(".details div.x-editable").update(Signavio.I18N.Repository.Info.Attributes.nodescription)}return}var j=l.length;if(k.id=="descriptionLabel"&&f&&j===1){var g=l[0];var e=g.find(function(m){return m.get("rel")=="info"});if(e){var d=Object.clone(e.get("rep"));d.name=(d.name||"").unescapeHTML();d.description="".unescapeHTML();d[k.boundEl.id.replace("info_","")]="";e.set("rep",d);e.commit()}this.panel.body.child(".details div.x-editable").update(Signavio.I18N.Repository.Info.Attributes.nodescription);return}if(k.id=="headerLabel"&&f&&j===1){this.panel.body.child(".x-info-details .x-editable").update(b.escapeHTML());return}if(!Signavio.Config.USE_CACHE){Signavio.Core.Stores.RequestManager.onNextLoading(function(){Signavio.Core.StoreManager.getChildEntitiesStore().reload()})}if(l.length===0&&this.panel.folder){var h=this.panel.folder;var d=Object.clone(h.get("rep"));d.name=(d.name||"").unescapeHTML();d.description=(d.description||"").unescapeHTML();d[k.boundEl.id.replace("info_","")]=c;h.set("rep",d,true);h.commit()}else{if(l.length>0){l.each(function(p){var m=(p instanceof Array?p:[p]).find(function(q){return q.get("rel")=="info"});if(m){var n=Object.clone(m.get("rep"));n.name=(n.name||"").unescapeHTML();n.description=(n.description||"").unescapeHTML();n[k.boundEl.id.replace("info_","")]=c;m.set("rep",n);m.commit()}})}}},update:function(d,l){if(!this.parent||!this.panel.rendered){return}var k=d.values().length<=0;var e={};var b=d.values().compact();var l=l.values().compact();if(this._oldRecords){var p=this._oldRecords.keys();var n=d.keys();if(p.length!==n.length){this.parent.hideFullView()}else{if(!p.all(function(q){return n.member(q)})){this.parent.hideFullView()}}}else{this.parent.hideFullView()}this._oldRecords=d;this.parent.tools.toggle.addClass("x-disabled");var c=this.facade.getCurrentRootFolder();var g=this.facade.getCurrentFolderStore();var h=this.facade.getTrashRecord();var j=g&&g===h;var m=!!c&&c.get("href")===g.getIdentifier();if(l.length===1&&l[0] instanceof Signavio.Core.ModelStore){var f=l[0].hasPrivileges(Signavio.Config.RIGHTS.WRITE);this.parent.tools.toggle.removeClass("x-disabled");this.panel.updateSingleModel(l[0],j||!f)}else{if(l.length===1&&l[0] instanceof Signavio.Core.FileStore){var f=l[0].hasPrivileges(Signavio.Config.RIGHTS.WRITE);this.parent.tools.toggle.removeClass("x-disabled");this.panel.updateSingleModel(l[0],j||!f)}else{if(l.length===1){var f=l[0].hasPrivileges(Signavio.Config.RIGHTS.WRITE);this.panel.updateSingleFolder(l[0],j||!f)}else{if(l.length>1){this.panel.updateMultipleElements(b)}else{if(l.length===0&&m){this.panel.updateRootFolder(c)}else{this.panel.updateSingleFolder(g,true)}}}}}this.panel.handlePanelResize.apply(this)},getCurrentFolder:function(){return this.facade.getCurrentRootFolder()||this.facade.getCurrentFolderStore()}};Signavio.Plugins.Info=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.Info);var a=function(){a.superclass.constructor.apply(this,arguments)};Ext.extend(a,Ext.Panel,{region:"center",border:false,cls:"x-info-box",showFullView:function(){if(!this.store||!this.img||this.view.parent.collapsed||this.view.parent.tools.toggle.hasClass("x-disabled")){return false}if(this.store instanceof Signavio.Core.FileStore){var c=this.store.getHeadRevision();var d=c.get("rep");if(["png","jpg"].include((d&&d.extension||"").toLowerCase())){var b=this.view.parent.tools.toggle;b.dom.innerHTML="<img src='../../libs/ext-2.0.2/resources/images/default/s.gif'/>&nbsp;&nbsp;&nbsp;"+Signavio.I18N.Repository.Info.closeDiagramPreview;b.addClass("y-close-diagram-preview");b.setWidth(b.getTextWidth()+24);this.img.showImg(Signavio.Config.BACKEND_PATH+d.href+"/content")}else{var b=this.view.parent.tools.toggle;b.dom.innerHTML="<img src='../../libs/ext-2.0.2/resources/images/default/s.gif'/>&nbsp;&nbsp;&nbsp;"+Signavio.I18N.Repository.Info.closeDiagramPreview;b.addClass("y-close-diagram-preview");b.setWidth(b.getTextWidth()+24);this.img.showImg(undefined,d)}}else{var b=this.view.parent.tools.toggle;b.dom.innerHTML="<img src='../../libs/ext-2.0.2/resources/images/default/s.gif'/>&nbsp;&nbsp;&nbsp;"+Signavio.I18N.Repository.Info.closeDiagramPreview;b.addClass("y-close-diagram-preview");b.setWidth(b.getTextWidth()+24);this.img.showImg(Signavio.Config.BACKEND_PATH+this.store.getHeadRevision().get("href")+"/png")}},hideFullView:function(){if(!this.img){return}var b=this.view.parent.tools.toggle;b.dom.innerHTML="<img src='../../libs/ext-2.0.2/resources/images/default/s.gif'/>&nbsp;&nbsp;&nbsp;"+Signavio.I18N.Repository.Info.openDiagramPreview;if(b.hasClass("y-close-diagram-preview")){b.removeClass("y-close-diagram-preview")}b.setWidth(b.getTextWidth()+24);this.img.hideImg()},handlePanelResize:function(){if(!this.panel.el||!(((this.panel||{}).view||{}).panel||{}).details||Ext.isIE6){return}var c=this.panel.el.next();if(((this.parent||{}).items||{}).get(1).isCollapsing){if(Ext.isIE7||Ext.isIE8){this.panel.view.panel.details.dom.style.setAttribute("cssText","padding-right:200px;")}else{this.panel.view.panel.details.dom.setAttributeNS(null,"style","padding-right:200px;")}return}if(c.isVisible&&c.isVisible()){var b=Math.max(200-c.getWidth(),0);if(Ext.isIE7||Ext.isIE8){this.panel.view.panel.details.dom.style.setAttribute("cssText","padding-right:"+b+"px;")}else{this.panel.view.panel.details.dom.setAttributeNS(null,"style","padding-right:"+b+"px;")}}else{if(Ext.isIE7||Ext.isIE8){this.panel.view.panel.details.dom.style.setAttribute("cssText","padding-right:200px;")}else{this.panel.view.panel.details.dom.setAttributeNS(null,"style","padding-right:200px;")}}if(Ext.isChrome||Ext.isSafari){var f=this.panel.view.panel.details.dom;var d=f.parentNode;d.removeChild(f);d.insertBefore(f,d.childNodes[0])}if(this.panel.view.panel.details.child(".x-info-description")!==null){var e=Math.max(30,(this.panel.view.panel.body.getHeight()*0.3)-this.panel.view.panel.details.child(".x-info-name").getHeight())-15;if(Ext.isIE7||Ext.isIE8){this.panel.view.panel.details.child(".x-info-description").dom.style.setAttribute("cssText","max-height:"+e+"px!important;")}else{this.panel.view.panel.details.child(".x-info-description").dom.setAttributeNS(null,"style","max-height:"+e+"px!important;")}}},onRender:function(){a.superclass.onRender.apply(this,arguments);Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.body.dom,["div",{"class":"x-info-details"}]);Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.body.dom,["div",{"class":"x-info-model",style:"position:relative;width:100%;height:100%;overflow:auto;"},["img",{"class":"x-msg-loading",style:"display:none;",src:Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif"}]]);this.details=this.body.first();this.img=this.body.last();this.img.setWidth("100%");this.img.dom.style.position="relative";this.img.dom.style.overflow="auto";var b;var c=function(e){if(e){return e&&e.dom.naturalWidth&&e.dom.naturalHeight&&e.dom.naturalWidth===e.dom.width&&e.dom.width<=e.dom.parentNode.offsetWidth&&e.dom.naturalHeight===e.dom.height&&e.dom.height<=e.dom.parentNode.offsetHeight}};var d=function(e){if(Signavio.Helper.isIPad()&&"undefined"!=typeof iScroll){if(b){b.resetPosition();b.destroy();b=undefined;e.style.webkitTransform="translate(0,0)"}if(this.img.hasClass("x-scrollable")){b=new iScroll(e,{})}}}.bind(this);this.img.waiting=this.img.last();this.img.imgs={};this.img.iscroll=$H({});this.img.showImg=function(e,g){if(!this.img.imgs[(g?g.href:e)]){if(g){var l=this.getSrcImage(g.extension);e=l.img;var j=Ext.get(Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.img.dom,["img",{src:e+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter()),"class":"y-file-image"}]));var f=Ext.get(document.createElement("div"));f.dom.className="y-file-container";var k=document.createElement("div");k.className="y-file-imgcontainer";var h=document.createElement("div");h.className="y-file-dlcontainer";h.innerHTML="<a href='/p"+g.href+"/content' target='_blank'>"+Signavio.I18N.Filestore.downloadFile+"</a>";var n=document.createElement("div");n.className="y-file-descContainer";n.innerHTML="<span class='y-file-information-key'>"+Signavio.I18N.Filestore.author+"</span><span class='y-file-information-value'>"+g.authorName+"</span><br/><span class='y-file-information-key'>"+Signavio.I18N.Filestore.changed+"</span><span class='y-file-information-value'>"+String.format(Signavio.I18N.Filestore.ago,(g.info||"").match(/<span.*<\/span>/).last())+"</span><br/>"+(l.type?"<span class='y-file-information-key'>"+Signavio.I18N.Filestore.fileType+"</span><span class='y-file-information-value'>"+l.type+"</span><br/>":"")+"<span class='y-file-information-key'>"+Signavio.I18N.Filestore.fileSize+"</span><span class='y-file-information-value'>"+Signavio.Utils.BeautifySize(g.size)+"</span><br/>";var m=j.dom.parentNode;f.dom.appendChild(k);f.dom.appendChild(n);k.appendChild(j.dom);k.appendChild(h);m.appendChild(f.dom)}else{var j=Ext.get(Signavio.Core.graft("http://www.w3.org/1999/xhtml",this.img.dom,["img",{src:e+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter()),style:"display:none;background:white;margin-bottom:-5px;"}]))}this.img.waiting.show(true);this.img.loadingImg=(g?f:j);j.on("load",function(){this.img.hideImg();(g?f:j).show(true);this.img.shownImg=(g?f:j);this.img[(g||c(this.img.shownImg))?"removeClass":"addClass"]("x-scrollenable");if(g){this.img.addClass("x-scrolldisable")}this.img.waiting.hide({useDisplay:true});delete this.img.loadingImg;d((g?f:j).dom)}.bind(this));(g?f:j).setVisibilityMode(Ext.Element.DISPLAY);this.img.imgs[(g?g.href:e)]=(g?f:j)}else{if(this.img.shownImg===this.img.imgs[g?g.href:e]||this.img.loadingImg===this.img.imgs[(g?g.href:e)]){return}else{this.img.hideImg();this.img.imgs[(g?g.href:e)].show(true);this.img.shownImg=this.img.imgs[(g?g.href:e)];this.img[(g||c(this.img.shownImg))?"removeClass":"addClass"]("x-scrollenable");d(this.img.imgs[(g?g.href:e)].dom)}}}.bind(this);this.img.hideImg=function(){if(this.img.shownImg){this.img.shownImg.hide(true);delete this.img.shownImg}}.bind(this);this.on("resize",function(){this.img.setHeight(this.body.getHeight()-this.details.getHeight()-13);if(!this.img.hasClass("x-scrolldisable")){this.img[c(this.img.shownImg)?"removeClass":"addClass"]("x-scrollenable")}}.bind(this));this.img.on("click",function(){if(this.img.hasClass("x-scrollenable")||!this.img.hasClass("x-scrolldisable")){this.img.toggleClass("x-scrollable");d(this.img.shownImg.dom)}}.bind(this));this.resetView()},updateSingleModel:function(b,g){delete this.folder;this.store=b;var f=b.getRecords(Signavio.Const.REL.INFO)[0];if(!f){return}f=Object.clone(f.get("rep"));f.authorName=(f.authorName==="/user/"?"User":f.authorName)||"System";f.bDate=this.beautifyDates(f.updated||f.created);f.notEditable=g===true;f.description=f.description||"";f.info=new Template(Signavio.I18N.Repository.Info.Attributes.info).evaluate({time:f.bDate,user:f.authorName});var c=b.getRecords(Signavio.Const.REL.NOTIFY)[0];f.showNotify=c&&!this.view.facade.getCurrentUser().getRecords("info")[0].get("rep").isGuestUser&&!Signavio.Config.HIDE_NOTIFICATION;if(c){f.notify=c.get("rep")["warehouse.model.save"]}var e=Signavio.Templates.InfoModel.overwrite(this.details,f,true);var d=e.query("a.x-info-notify-link")[0];if(c){Ext.EventManager.addListener(d,"click",function(){var h=Object.clone(c.get("rep"));h["warehouse.model.save"]=!h["warehouse.model.save"];h["talkabout.notify.newcomment"]=h["warehouse.model.save"];c.set("rep",h);c.commit()},this,{preventDefault:true})}},updateRootFolder:function(b){var c={name:Signavio.I18N.Repository.Folder[b.get("rep").type]||b.get("rep").name};Signavio.Templates.InfoRootFolder.overwrite(this.details,c)},updateSingleFolder:function(b,e){delete this.store;var d=b instanceof Ext.data.Record?b:undefined;d=d||(b.snapshot||b.data).items.find(function(f){return f.get("rel")=="info"});this.folder=d;var c=d?Object.clone(d.get("rep")):{};c.name=Signavio.I18N.Repository.Folder[c.type]||c.name;c.notEditableTitle=b instanceof Ext.data.Record;c.notEditable=e===true;c.description=c.description||"";if(Signavio.Templates.InfoFolder){Signavio.Templates.InfoFolder.overwrite(this.details,c)}},updateMultipleElements:function(d){delete this.folder;delete this.store;var c=d.map(function(e){e=e instanceof Array?e:[e];return e.find(function(f){return f.get("rel")===Signavio.Const.REL.INFO})}).compact();var b=this.beautifyDates(c.map(function(e){return e.get("rep").updated||e.get("rep").created})).split(" + ");if(b.length>1){b=new Template(Signavio.I18N.Repository.Info.Attributes.infoMulipleTwo).evaluate({time:b[0],time2:b[1]})}else{b=new Template(Signavio.I18N.Repository.Info.Attributes.infoMulipleOne).evaluate({time:b[0]})}Signavio.Templates.InfoMultiple.overwrite(this.details,{count:d.length,updated:b})},resetView:function(){if(Signavio.Templates.No){Signavio.Templates.No.overwrite(this.details,{})}},beautifyDates:function(e){e=e instanceof Array?e:[e];var b=function(h,g,f){f=h==f?null:f;return"<span title='"+(h&&h instanceof Date?h.format(Signavio.Const.DATE_FORMAT):"")+(f&&f instanceof Date?" - "+f.format(Signavio.Const.DATE_FORMAT):"")+"'>"+g+"</span>"};e=e.map(function(f){return Signavio.Helper.ParseDate(f)}).sort(function(g,f){return g.getTime()-f.getTime()}).reverse();var c=Signavio.Helper.BeautifyDate(e.last(),true);var d=Signavio.Helper.BeautifyDate(e.first(),true);return c!=d?b(e.last(),c)+" + "+b(e.first(),d):b(e.first(),d,e.last())},getSrcImage:function(d){var b="/images/signavio/52x62/",c;switch(d){case"pdf":b+="pdf.png";c="Adobe PDF "+Signavio.I18N.Filestore.document;break;case"doc":b+="word.png";c="MS Word 97-2003 "+Signavio.I18N.Filestore.document;break;case"docx":b+="word.png";c="MS Word 2007-2010 "+Signavio.I18N.Filestore.document;break;case"xls":b+="excel.png";c="MS Excel 97-2003 "+Signavio.I18N.Filestore.document;break;case"xlsx":b+="excel.png";c="MS Excel 2007-2010 "+Signavio.I18N.Filestore.document;break;case"ppt":b+="powerpoint.png";c="MS Powerpoint 97-2003 "+Signavio.I18N.Filestore.document;break;case"pptx":b+="powerpoint.png";c="MS Powerpoint 2007-2010 "+Signavio.I18N.Filestore.document;break;case"rar":b+="zip.png";c=Signavio.I18N.Filestore.archive+" (RAR)";break;case"zip":b+="zip.png";c=Signavio.I18N.Filestore.archive+" (ZIP)";break;case"sgx":b+="zip.png";c=Signavio.I18N.Filestore.archive+" (SGX)";break;default:b+="file.png";c="<i>"+Signavio.I18N.Filestore.unknownFileFormat+" ("+d+")</i>"}return{img:b,type:c}}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Revision={renderToView:"hover",enabled:true,relTypes:["info","revision","filerevision"],render:function(){this.dv=new Ext.DataView({autoWidth:true,emptyText:'<div class="x-revision-no">'+Signavio.I18N.Repository.Revision.none+"</div>",singleSelect:true,store:this.store,itemSelector:"div.x-revision-item",overClass:"x-revision-item-over",trackOver:true,tpl:Signavio.Templates.Revision,cls:"x-revision-plugin",border:false,plugins:[],getData:function(c){if(!c){return undefined}var b=this.indexOf(c);var a=0;var d=this.store.getAt(a).get("rev");while(d instanceof Array&&d.length<=b){b-=d.length;d=this.store.getAt(++a).get("rev")}return d[b]},listeners:{dblclick:function(b,a,f,d){var c=b.getData(f);if(c&&c.hasAccess){window.open(c.editorLink);d.preventDefault()}},beforeclick:function(b,a,d,c){return !(c.target.tagName.toUpperCase()==="A")},selectionchange:function(a,b){if((this.oldSelection||[]).length==b.length&&(this.oldSelection||[]).all(function(c){return b.include(c)})){return}(this.oldSelection||[]).each(function(e){var e=Ext.fly(e);if(e){var d=e.child("div.x-full-view-revision");if(d){d.hide();if(!a.updating&&!Signavio.Helper.isIE6()&&!Signavio.Helper.isIE7()){d.slideOut("t",{useDisplay:true,duration:0.25})}if(Signavio.Helper.isIE6()||Signavio.Helper.isIE7()){d.setDisplayed(false)}}}});b.each(function(h){var g=Ext.fly(h);if(g){var f=g.child("div.x-full-view-revision");if(f){var d=f.child("a.x-link-revert");if(d&&!d.hasClass("x-initialized")){d.on("click",function(c){Event.stop(c);this.revertToRevision(this.dv.store,this.dv.getData(h))}.bind(this));d.addClass("x-initialized")}var e=f.child("a.x-link-approve");if(e&&!e.hasClass("x-initialized")){e.on("click",function(c){Event.stop(c);this.publishRevision(this.dv.store,e.hasClass("x-link-unapprove")?false:this.dv.getData(h))}.bind(this));e.addClass("x-initialized")}f.show();if(!a.updating&&!Signavio.Helper.isIE6()&&!Signavio.Helper.isIE7()){f.slideIn("t",{duration:0.25})}}}}.bind(this));if(b.length===1){this.setImg(this.dv.getData(b[0]));this.facade.raiseEvent(Signavio.Const.EVENT.REVISION_SELECTION_CHANGED,{revision:this.dv.getData(b[0]).revision,node:Ext.get(b[0])})}this.oldSelection=b}.bind(this),containerclick:function(b,a){return false}}});this.panel=new Ext.Panel({region:"east",header:false,cls:"x-revision",border:false,collapsible:true,collapseMode:"mini",floatable:true,collapsed:false,width:290,cmargins:{right:0},margins:{top:0,bottom:0},split:true,autoScroll:true,listeners:{resize:function(){if(this.parent&&this.parent.doLayout instanceof Function){this.parent.doLayout()}}.bind(this),beforeexpand:function(){if(this.initSize===false){this.panel.el.setWidth(290);this.panel.el.setLeft(this.parent.el.getWidth()-290);this.panel.el.setTop(0);this.panel.body.setHeight(this.parent.el.getHeight()-20-28);delete this.initSize}}.bind(this)},items:[this.dv]})},getCurrentModel:function(){return this.currentStores[0]||null},publishRevision:function(a,c){if(!this.getCurrentModel()){return}var b=function(){var e=this.getCurrentModel().getRecords("info")[0];if(e){var d=Object.clone(e.get("rep"));d.name=(d.name||"").unescapeHTML();d.description=(d.description||"").unescapeHTML();d.granted_revision=c?c.href:"";e.set("rep",d);this.getCurrentModel().commitChanges()}}.bind(this);if(c){Ext.Msg.confirm(Signavio.I18N.Repository.Revision.publishDlgTitle,Signavio.I18N.Repository.Revision.publishDlgDesc,function(d){if(d=="yes"){b()}}.bind(this))}else{b()}},addAccessRight:function(){},revertToRevision:function(b,a){var c=new Ext.ux.Window({modal:true,width:500,height:200,resizable:false,title:Signavio.I18N.Repository.Revision.revert,description:new Ext.XTemplate(Signavio.I18N.Repository.Revision.revertPrompt).apply({revision:a.rev,model:b.getAt(0).get("info").data.rep.name}),items:[new Ext.form.TextArea({cls:"y-revert-to-revision-comment",emptyText:Signavio.I18N.Repository.Revision.comment,listeners:{render:function(){var d=c.items.get(0).el.getHeight();var e=c.body.getHeight();this.el.setHeight(e-d-30)}}})],buttons:[{text:Signavio.I18N.Repository.Revision.btnRevert,handler:function(){c.disable();var e=b.getAt(0).get("info").data.href.replace("/info","");var d={revision:a.rev,comment:c.items.get(1).getValue()||"",parent:b.getAt(0).get("info").data.rep.parent};Signavio.Core.Stores.RequestManager.doPut(Signavio.Config.BACKEND_PATH+e,function(){Signavio.Core.StoreManager.reloadChildEntitiesStore();var f=Signavio.Core.StoreManager.getStore(e);if(f){Signavio.Core.StoreManager.reload(f,function(){this.dv.select(0)}.bind(this))}else{this.dv.select(0)}c.close()}.bind(this),d)}.bind(this)}]});c.show()},afterRender:function(){this.initSize=false;this.panel.hide();this.parent.on("showfullview",function(){this.dv.select(0,false,true);this.dv.fireEvent("selectionchange",this.dv,[this.dv.getNode(0)]);this.panel.show()}.bind(this));this.parent.on("hidefullview",function(){this.panel.hide()}.bind(this))},setImg:function(b){var c=(b&&b.extension||"").toLowerCase();var a=c!=="";if(!a||a&&["png","jpg"].include(c)){this.facade.raiseEvent(Signavio.Const.EVENT.SHOW_INFO_IMG,(a?b.icon:Signavio.Config.BACKEND_PATH+b.href+"/png"))}else{this.facade.raiseEvent(Signavio.Const.EVENT.SHOW_INFO_IMG,undefined,b)}},update:function(c){if(this.dv){this.dv.updating=true}var j=new Ext.data.Store({});var a=Ext.data.Record.create(["rev","info"]);var d=[];var f=c.values();var g=(this.currentStores||[]).all(function(l){return l.hasPrivileges(Signavio.Config.RIGHTS.WRITE)});var e=(this.currentStores||[]).all(function(l){return((this.facade.getConfig().mode==="Enterprise"&&this.facade.getConfig().hasGuestUser)||this.facade.getConfig().certificatesOrdered)&&l.hasPrivileges(Signavio.Config.RIGHTS.SHARE)}.bind(this));if(f.length>0){var k=f.map(function(n){n=n instanceof Array?n:[n].compact();var l=n.findAll(function(p){return["revision","filerevision"].include(p.get("rel"))});var m=n.find(function(p){return p.get("rel")=="info"});return l instanceof Array&&l.length>0?{revisions:l,info:m}:null}).compact();k.each(function(m){var l=m.revisions;l=l.sort(function(p,n){return -(Number(p.get("rep").rev)-Number(n.get("rep").rev))});l=l.map(function(r,q){var p=r.get("href");var n=r.get("rep");n.hasAccess=g&&this.facade.isSupportedBrowserEditor();n.href=p;n.previousHref=l[q+1]&&l[q+1].get("href");n.hasShareAccess=e;n.isAutoPublish=this.facade.getConfig().isAutoPublish;n.isGranted=m.info.get("rep").granted_revision&&m.info.get("rep").granted_revision===p;if(this.isFile(p)){n.isFile=true;n.icon=Signavio.Config.BACKEND_PATH+p+"/content?inline=true";n.editorLink=n.icon}else{n.editorLink=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({revision:n.rev,id:m.info.get("href").split("/")[2]})}n.beautifiedDate=Signavio.Helper.BeautifyDate(n.created);n.info=new Template(Signavio.I18N.Repository.Info.Attributes.info).evaluate({time:n.beautifiedDate,delimiter:"<br/>",user:n.authorName||"System"});n.revision=r;return n}.bind(this));d.push(new a({rev:l,info:m.info}))}.bind(this));j.data.addAll(d)}if(this.dv&&this.dv.el){var b=undefined;if(this.dv.getSelectionCount()>=0){b=(this.dv.getData(this.dv.getSelectedNodes()[0])||{}).rev}this.dv.store=j;this.dv.refresh();if(b!==undefined&&d.length>0){var h=d[0].get("rev").find(function(l){return l.rev==b});if(h){this.dv.select(d[0].get("rev").indexOf(h))}}delete this.dv.updating}else{this.store=j}},isFile:function(a){return(a||"").startsWith("/file")}};Signavio.Plugins.Revision=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.Revision)}();if(!Signavio){var Signavio={}}if(!Signavio.Extensions){Signavio.Extensions={}}if(!Signavio.Plugins){Signavio.Plugins={}}if(!Signavio.Plugins.Templates){Signavio.Plugins.Templates={}}(function(){var a=[];Signavio.Plugins.Templates.KaiserKraftTemplate=Clazz.extend({enabled:true,construct:function(){a.push(["pdfStyleSheetKaiserKraft",Signavio.I18N.Repository.ProcessDocu.templatepdfstylesheetkaiserkraft])}});Signavio.Plugins.Templates.SwissPostTemplate=Clazz.extend({enabled:true,construct:function(){a.push(["pdfStyleSheetSwissPost",Signavio.I18N.Repository.ProcessDocu.templatepdfstylesheetswisspost])}});Signavio.Plugins.Templates.SignavioTemplate=Clazz.extend({enabled:true,construct:function(){a.push(["pdfStyleSheet",Signavio.I18N.Repository.ProcessDocu.templatepdfstylesheet])}});Signavio.Plugins.AbstractProcessDocumentation=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments)},triggerCalculation:function(h,g,f,d,c){var b=[];this.getSelection().each(function(j){if(this.isModel(j)||this.isDirectory(j)){b.push(j)}}.bind(this));if(b.length===0){b.push(this.facade.getCurrentFolderStore())}var e=this.getWizardWindow(b,{hideFormatSelection:d===false},h,g,"string"==typeof f?f:undefined,c);e.show()},getWizardWindow:function(c,b,j,f,k,h){this.selection=this.getSelection();var d=this.getFirstPage(b,j,f,k,h);var e=this.getSecondPage(b,j,k,h);var g=new Ext.ux.view.Wizard({items:[d,e],getFirstPage:function(){return d},getSecondPage:function(){return e},clb:this.handleExport.bind(this,k,h),clbName:Signavio.I18N.Repository.ProcessDocu.generate,activeTab:(this.selection.length===1?1:0),selection:this.selection});return new Ext.Window({cls:"y-wizard-window",title:j,modal:true,layout:"fit",height:550,width:500,minWidth:450,minHeight:525,items:[g]})},getFirstPage:function(d,j,h,g,f){var e=this.getSelection().length>0&&this.getSelection()||[this.facade.getCurrentFolderStore()];var c=this.facade.getTrashRecord();var b=false;this.filteredModels=[];return new Signavio.Extensions.WizardTreePage({border:false,cls:"y-wizard-tree-page",labelText:h,selection:e,layout:"anchor",trashRecord:c,showLayerSelection:true,items:[],filterPanel:{labelText:Signavio.I18N.FilterSet.description,border:false,cb:function(k,n,m,l){b=true;this.filteredModels.clear().push.apply(this.filteredModels,n);Signavio.Core.StoreManager.getStore(m,true,function(p){k.expandToAndCheckPreSelection([p[0].store]);var q;if(n.length===0){q=Ext.Msg.alert(Signavio.I18N.FilterSet.windowTitle,Signavio.I18N.FilterSet.emptyResultWarning)}else{q=Ext.Msg.alert(Signavio.I18N.FilterSet.windowTitle,Signavio.I18N.FilterSet.diagramsFoundStart+n.length+Signavio.I18N.FilterSet.diagramsFoundEnd)}q.setIcon(Ext.MessageBox.INFO);q.getDialog().syncSize();if(l instanceof Function){l(n.length!==0)}})}.bind(this),trashRecord:c,folderStore:this.facade.getCurrentFolderStore(),rootFolder:this.facade.getCurrentRootFolder(),filter:new Signavio.Extensions.FilterSet({},this.facade)},listeners:{activate:function(k){if(!this.treeActivated){window.setTimeout(function(){k.adjustPageContentSize(k.tree)},1);this.treeActivated=true}},destroy:function(){this.treeActivated=false},resize:function(k){if(!this.isResizing){k.adjustPageContentSize(k.tree)}},deactivate:function(k){var l=this.selection;this.selection=k.tree.isVisible()?k.tree.getChecked():this.selection;if(l!==this.selection){this.oldSelection=l}}.bind(this)},treeListeners:{checkchange:function(l,k){if(!k){var m=l.attributes.identifier;this.filteredModels.remove(m)}}.bind(this)},loaderFn:function(l,k){if(b){(k.childNodes||[]).each(function(m){if(this.filteredModels.indexOf(m.attributes.identifier)!==-1){m.attributes.checked=true;m.ui.toggleCheck(true)}else{if(m.attributes.checked){m.attributes.checked=false;m.ui.toggleCheck(false)}}}.bind(this))}}.bind(this)})},getSecondPage:function(d,g,j,f){var b=this.facade.getCurrentUser().getRecords("info")[0];var e=Ext.isChrome?"100%":"-20";var h=this.getTemplateSelector(e);var c=this.getLanguageSelector(e);var k=this.getDocumentationOptions(b,d,e);return new Ext.ux.view.WizardPage({title:Signavio.I18N.Repository.ProcessDocu.optionPage,cls:"y-wizard-form-layout"+(Ext.isIE?" y-wizard-form-layout-ie":""),items:[h,c,k].compact(),layout:"anchor",getTemplate:function(){return h.getValue()},getLanguage:function(){return(c&&c.getValue())||""},getOptions:function(){return k}})},handleExport:function(e,c,d){var b=function(){if(!d){return}var p=d.getFirstPage();var q=d.getSecondPage();var h=q.getForm();if(!h||h.items.length===0){return}var f=(p.tree.isVisible()?p.tree.getChecked():this.selection);if(f.length===0&&this.filteredModels.length===0){Ext.Msg.alert(d.ownerCt.title,Signavio.I18N.Repository.Offer.processDocumentationSelectDiagrams).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}d.getEl().mask(Signavio.I18N.Repository.ProcessDocu.waiting,"x-waiting-box");var r=false,n=false;var k=p.layerSelection.items.find(function(s){return s instanceof Ext.ux.form.ComboBox});switch(k.getValue()){case 1:r=true;break;case 2:n=true;break;default:break}var g=[];var l=[];f.each(function(s){var t=s.attributes?s.attributes.identifier:s.get("href");if(t.indexOf("/model/")==0){g.push(t.replace(/\/model\//,""))}else{if(t.indexOf("/directory/")==0){l.push(t.replace(/\/directory\//,""))}}}.bind(this));g=g.concat(this.filteredModels||[]).uniq();var m={models:g,withComments:false,directories:l,template:q.getTemplate(),language:q.getLanguage(),includelinkedprocesses:r,includedirectlylinkedprocesses:n,format:e||"pdf",timeout:180000};var j=function(s){(s||[]).each(function(t){if(t.name&&t.getValue instanceof Function){m[t.name]=t.getValue()}else{if(t instanceof Ext.Panel){j(t.items.items)}}})};j(q.getOptions().getFields());this.facade.setConfig("user","lastUsedProcessDocumentationTemplate",m.template,"explorer");this.sendRequest(m,function(s){s.ownerCt.close()}.bind(this));d.ownerCt.close()}.bind(this);if(c instanceof Function){c(b)}else{b()}},getTemplateSelector:function(d){var c=new Ext.form.Label({text:Signavio.I18N.Repository.Offer.processDocumentationSelectLabel,style:"display: block;"});var b=this.getTemplateComboBox(d);return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.Offer.processDocumentationTemplateTitle,layout:"anchor",cls:(Ext.isIE7?"y-wizard-options-container-ie7":undefined),items:[c,b],getValue:b.getValue.bind(b)})},getLanguageSelector:function(b){var d=(this.facade.getConfig("department","languages")||"[]").evalJSON(true);if(!d||d<=1){return}var c=Signavio.Utils.getLangaugeSelector(d,{value:d.first().rel,anchor:b,suppressGroups:true});return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.ProcessDocu.languageFieldLabel,items:c,getValue:c.getValue.bind(c)})},getOptionsForm:function(b,c){return new Ext.Panel({defaultType:"textfield",labelWidth:180,header:false,height:"auto",layout:"form",anchor:c,cls:"y-panel-no-padding",items:b})},getDocumentationOptions:function(f,d,c){var b=this.getOptionTextFields(f,d,c);var e=this.getOptionsForm(b,c);return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.Offer.processDocumentationConfigurationTitle,cls:(Ext.isIE7?"y-wizard-options-container-ie7":""),layout:"anchor",items:e,getFields:function(){return e.items.items}})},getClipModePanel:function(d){var b=new Ext.data.SimpleStore({data:[[Signavio.I18N.Repository.MapExport.fitToPage,"Portrait",Signavio.Config.IMAGE_PATH+"/map/1page.vertical.png","?pageMode=FitToPage"],[Signavio.I18N.Repository.MapExport.clipBottom,"Portrait",Signavio.Config.IMAGE_PATH+"/map/2pages.ns.vertical.png","?pageMode=FitToPage"]],fields:["name","format","img","url"]});var c=new Ext.DataView({tpl:'<tpl for="."><div class="thumb-wrap"><span class="thumb-title">{name}</span><div class="thumb"><img src="{img}" title="{name}"></div></div></tpl><div class="x-clear"></div>',itemSelector:"div.thumb-wrap",overClass:"x-view-over",store:b,cls:"x-plugin-map-view x-plugin-process-documentation",ctCls:Ext.isIE7?"y-wizard-form-dataview-ct-ie7":"y-wizard-form-dataview-ct",singleSelect:true,doSingleSelection:function(g,f,h){this.select(f,false)},afterRender:function(){Ext.DataView.prototype.afterRender.apply(this,arguments);this.select(0)},listeners:{containerclick:function(f,g){return false}}});return new Ext.Panel({border:false,hidden:d||false,name:"clip",getValue:function(){return c.getSelectedIndexes().include(1)?true:false},bodyStyle:"position:relative;margin-bottom:1px;margin-top:-3px;padding-left:181px;font-size:12px;",anchor:"100%",items:[new Ext.form.Label({text:Signavio.I18N.Repository.ProcessDocu.clip+":",style:"width:180px;position:absolute;left:0;top:4px;"}),c]})},getTemplateComboBox:function(c){var e=new Ext.form.ComboBox({tpl:'<tpl for="."><tpl if="xindex == 1 && isDefault == true"><div class="y-list-item-default">'+Signavio.I18N.Repository.Offer.processDocumentationDefault+'</div></tpl><tpl if="isDefault == false && parent[xindex-2].isDefault == true"><div class="y-list-item-default">'+Signavio.I18N.Repository.Offer.processDocumentationCoorporate+'</div></tpl><div class="x-combo-list-item">{title}</div></tpl>',itemCls:"y-wizard-form-item"+(Ext.isIE8?" y-wizard-form-combobox-ie8":""),anchor:c,value:"",store:new Ext.data.SimpleStore({fields:["value","title","isDefault"],data:[]}),displayField:"title",valueField:"value",forceSelection:true,typeAhead:true,mode:"local",triggerAction:"all",fieldLabel:Signavio.I18N.Repository.ProcessDocu.template,hideLabel:true,selectOnFocus:true});var d=this;e.on("select",function(g,f){if(f.get("isDefault")){d.showDeprecatedElements()}else{d.hideDeprecatedElements()}});var b=Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.PROCESS_DOCU_TEMPLATE_PATH,undefined,undefined,{force:true,callback:function(g){var h=[];b.getRange().each(function(k){var l=k.get("rep");h.push([l.id,Signavio.I18N.Repository.ProcessDocu["template"+String(l.id).toLowerCase()]||l.title,l.isDefault])});e.store.loadData(h);if(h.length>0){var j=this.facade.getConfig("user","lastUsedProcessDocumentationTemplate","explorer")}var f=h.find(function(k){return k[0]==j});if(j&&f){e.setValue(j);if(f.last()===true){this.showDeprecatedElements()}else{this.hideDeprecatedElements()}}else{if(h.length>0){e.setValue(h[0][0])}}}.bind(this)});return e},getOptionTextFields:function(c,d,f){var l=[Signavio.I18N.Repository.ProcessDocu.title,Signavio.I18N.Repository.ProcessDocu.org,Signavio.I18N.Repository.ProcessDocu.author,Signavio.I18N.Repository.ProcessDocu.date,Signavio.I18N.Repository.ProcessDocu.version];var n=[Signavio.I18N.Repository.ProcessDocu.defaultTitle,Signavio.Utils.unescapeHTML(c.get("rep").company),Signavio.Utils.unescapeHTML(c.get("rep").name),new Date().format("j.m.Y"),"1.0.0"];var k=["title","organization","author","generationDate","version"];var j=l.map(function(p,q){return{fieldLabel:p,name:k[q],allowBlank:false,anchor:f,value:n[q],itemCls:"y-wizard-form-item"}});var h=this;var m=c.get("rep").licenses,e=this.facade.getConfig().mode!=="Academic"&&(m.include("premium")||m.include("corporate")),g=this.facade.getConfig().mode!=="Enterprise";var b=new Ext.Panel({header:false,anchor:f,layout:"form",cls:"y-deprecated-options-panel",items:[this.getClipModePanel(d.hideFormatSelection),{fieldLabel:Signavio.I18N.Repository.ProcessDocu.intro,xtype:"textarea",name:"introductionText",anchor:"100%",height:130,value:"",itemCls:"y-wizard-form-item"+(Ext.isIE?" y-wizard-form-textarea-ie":"")},{xtype:"checkbox",fieldLabel:Signavio.I18N.Repository.ProcessDocu.branding,anchor:"100%",itemCls:"y-wizard-form-checkbox",name:"showSignavioBranding",checked:g,disabled:!e,boxLabel:(!e?' <img ext:qtip="'+Signavio.I18N.Repository.ProcessDocu.premiumOnly+'" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" style="position: absolute; left: auto; top: auto; margin-left: -5px; margin-top: 3px;"/>':"")}],listeners:{render:function(p){if(b.hideInitially){b.getEl().mask()}else{b.getEl().unmask()}}}});this.hideDeprecatedElements=function(){if(b.el){b.getEl().mask()}else{b.hideInitially=true}};this.showDeprecatedElements=function(){if(b.el){b.getEl().unmask()}else{b.hideInitially=false}};j.push(b);return j},sendRequest:function(l,j){Ext.apply(l,Ext.Ajax.getSecurityParameter());var b=Ext.isIE7||Ext.isIE8;var k=Ext.isIE6;if(this.frame){this.frame.remove();delete this.frame}var c=l.title.gsub("/","-")+" - "+l.version+"."+l.format;var d=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.PROCESS_DOCU_PATH+"/"+c;l.filename=l.filename||c;var g;if(b){this.frame=Ext.getBody().createChild({tag:"iframe",cls:"x-hidden",id:"iframe",name:"iframe"});g=this.frame.dom}else{if(k){window.open(d+"?"+Object.toQueryString(l));return}else{var h=window.open();g=h.document.body}}var f=[];$H(l).each(function(m){if(m.value instanceof Array){m.value.each(function(n){f.push(["input",{type:"hidden",value:n,name:m.key}])})}else{f.push(["input",{type:"hidden",value:m.value,name:m.key}])}});var e=Signavio.Core.graft(null,g,["form",{action:d,method:"POST","accept-charset":"UTF-8",enctype:"application/x-www-form-urlencoded"}].concat(f));e.submit()},isModel:function(b){return b.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(b){return b.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(b){return this.facade.getTrashRecord()&&b.get("href")==this.facade.getTrashRecord().get("href")}});Signavio.Plugins.ProcessDocumentation=Signavio.Plugins.AbstractProcessDocumentation.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({group:"reporting",name:Signavio.I18N.Repository.Reporting.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this),items:[{index:1,name:Signavio.I18N.Repository.Offer.processDocumentationTitle,description:Signavio.I18N.Repository.Offer.processDocumentationDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png",isDisabled:function(){return this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected()}.bind(this),functionality:this.triggerCalculation.bind(this,Signavio.I18N.Repository.Offer.processDocumentationTitle,Signavio.I18N.Repository.ProcessDocu.select,"pdf")}]});this.facade.offer({relGroup:"reporting",index:2,seperated:true})}});Signavio.Plugins.ProcessDocumentationWord=Signavio.Plugins.AbstractProcessDocumentation.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:1,name:Signavio.I18N.Repository.Offer.processDocumentationWordTitle,description:Signavio.I18N.Repository.Offer.processDocumentationWordDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_word.png",isDisabled:function(){return this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected()}.bind(this),functionality:this.triggerCalculation.bind(this,Signavio.I18N.Repository.Offer.processDocumentationWordTitle,Signavio.I18N.Repository.ProcessDocu.selectWord,"docx",true,function(b){Ext.Msg.alert(Signavio.I18N.Repository.Offer.processDocumentationWordInfoInfo,Signavio.I18N.Repository.Offer.processDocumentationWordInfoDesc,function(){if(b instanceof Function){b()}}).setIcon(Ext.Msg.INFO).getDialog().syncSize()})})}})})();if(!window.Signavio){window.Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.ProcessDocumentationCreateExample=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"new",name:Signavio.I18N.Repository.Offer.processDocumentationCreateExampleTemplateTitle,description:Signavio.I18N.Repository.Offer.processDocumentationCreateExampleTemplateDescription,seperated:false,activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/procdocu-22x22.png",functionality:this.createFolder.bind(this),isVisible:function(){return this.selectionInInternal()}.bind(this)})},createFolder:function(){new Ajax.Request(Signavio.Config.BACKEND_PATH+"/docuexamples",{method:"POST",onSuccess:function(){Signavio.Core.StoreManager.reload()}.bind(this)})}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.XPDLImport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importXPDLTitle,description:Signavio.I18N.Repository.Offer.importXPDLDescription.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS),icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.importXPL.bind(this),index:15,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},importXPL:function(){var c=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{text:Signavio.I18N.Repository.Offer.importXPDLLabel,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{name:"xpdlfile",inputType:"file",style:"display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").getIdentifier()},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});c.getForm().errorReader={read:function(d){return{success:d.responseText.toLowerCase().replace(/<.*?pre.*?>/g,"").startsWith("["),records:[]}}};var b=this;var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.importXPDLTitle,width:400,modal:true,resizable:false,items:[c],buttons:[{text:Signavio.I18N.Repository.Offer.amlImportRestoreBtn,handler:function(){if(c.items.items[1].el.dom.value){c.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.XPDL_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.importXPDLWait,method:"POST",success:function(e,d){a.close();Signavio.Core.StoreManager.reloadChildEntitiesStore()}.bind(this),failure:function(e,d){a.close();if(d.response.responseText.indexOf("xpdlImport.InvalidRequestXPDLFileMissing")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.importXPDLFileMissingTitle,Signavio.I18N.Repository.Offer.importXPDLFileMissingDescription).setIcon(Ext.MessageBox.INFO).getDialog().syncSize()}else{if(d.response.responseText.indexOf("xpdlImport.XPDLFileTooBig")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.importXPDLTooBigTitle,Signavio.I18N.Repository.Offer.importXPDLTooBigDescription).setIcon(Ext.MessageBox.WARNING).getDialog().syncSize()}else{if(d.response.responseText.indexOf("xpdlImport.CouldNotGenerateSvgForDiagram")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.XPDLImport.CouldNotGenerateSvgForDiagramTitle,Signavio.I18N.Repository.Offer.XPDLImport.CouldNotGenerateSvgForDiagram.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("xpdlImport.CouldNotBuildDiagramObjectFromJSON")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.XPDLImport.CouldNotGenerateSvgForDiagramTitle,Signavio.I18N.Repository.Offer.XPDLImport.CouldNotBuildDiagramObjectFromJSON).setIcon(Ext.MessageBox.WARNING)}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.importXPDLWarningTitle,Signavio.I18N.Repository.Offer.importXPDLWarningDescription).setIcon(Ext.MessageBox.WARNING).getDialog().syncSize()}}}}}})}else{}}.bind(this)}]});a.show()},showModelLinkListDialog:function(a){if(!a||!a.length){return}var c="<div><div style='margin-bottom:5px;'>"+Signavio.I18N.Repository.Offer.importXPDLLinkListDescription+"</div>";a.each(function(f,d){var e=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:f});c+="<a href='"+e+"' target='_blank' style='display:block;margin-bottom:3px;'>"+Signavio.I18N.Repository.Offer.importXPDLLinkListProcess+" "+(d+1)+"</a>"});c+="</div>";var b=new Ext.Window({width:300,resizable:false,minimizable:false,modal:true,autoScroll:true,title:Signavio.I18N.Repository.Offer.importXPDLLinkListTitle,bodyStyle:"background-color:#ffffff;padding:5px;",html:c,buttons:[{text:Signavio.I18N.Repository.Offer.importXPDLLinkListBtn,handler:function(){b.hide()}}]});b.show()}};Signavio.Plugins.XPDLImport=Signavio.Core.Plugin.extend(Signavio.Plugins.XPDLImport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.ArchiveImport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",index:5,name:Signavio.I18N.Repository.Offer.archiveRestore,description:Signavio.I18N.Repository.Offer.archiveRestoreDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compress_up.png",functionality:this.showRestoreDialog.bind(this),isVisible:this.selectionNotInTrash.bind(this),isDisabled:function(){return a()||this.selectionInSearch()}.bind(this)});this.facade.registerOnEvent(Signavio.Const.EVENT.IMPORT_REFERENCE_MODEL,this.showRestoreDialog.bind(this))},showRestoreDialog:function(c,d){var b=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:!((d||{}).referenceModelId),items:(((d||{}).referenceModelId)?[{name:"archive",xtype:"hidden",value:d.referenceModelId}]:[{name:"file",inputType:"file",style:"margin-bottom:10px;display:block;margin-top:10px;",itemCls:"ext_specific_window_overflow"}]).concat([{xtype:"panel",layout:"form",border:false,anchor:"100%",defaults:{hideLabel:true},items:[{boxLabel:Signavio.I18N.Repository.Offer.archiveRestoreFiles,xtype:"checkbox",checked:"true",name:"importFiles",style:((d||{}).referenceModelId)?"margin-top:10px;":"",listeners:{render:function(f,g){var e=(this.facade.getConfig("department","fileupload")!==false);e=e&&this.facade.getConfig().allFilesByteQuota>0;if(!e){f.setValue(false);f.disable()}}.bind(this)}},{boxLabel:Signavio.I18N.Repository.Offer.archiveRestoreImportGlossary+'<img style="position:relative;top:4px;margin-left:3px;" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Offer.archiveRestoreImportGlossaryInfo+'"/>',xtype:"checkbox",checked:false,name:"importGlossary",listeners:{check:function(f,g){if(!g){var e=f.ownerCt.items.get(2);e.setValue(false)}},render:function(f){var e=Signavio.Core.StoreManager.getStore("/glossarymanager",true,function(){if(Ext.isDefined(e)){var g=e.hasPrivileges(Signavio.Config.RIGHTS.GLOSSARY_WRITE);if(g===false){f.disable();f.setValue(false);Ext.getCmp(f.el.parent(".x-panel-body").child(".y-checkbox-overwrite-glossary").id).disable();Ext.get(f.el.dom.parentNode).child("img").dom.style.display="none";var h=document.createElement("div");h.className="y-error-hint";h.setAttribute("title",Signavio.I18N.Repository.Offer.noWriteForGlossaryImport);f.el.dom.parentNode.appendChild(h);Ext.get(h).alignTo(Ext.get(f.el.dom.parentNode.childNodes[1]),"r",[0,-7])}}})}.bind(this)}},{boxLabel:Signavio.I18N.Repository.Offer.archiveRestoreOverwriteGlossary,xtype:"checkbox",cls:"y-checkbox-overwrite-glossary",checked:false,style:"margin-left:17px;position:relative;",name:"overwriteGlossary",listeners:{check:function(f,g){if(g){var e=f.ownerCt.items.get(1);e.setValue(true)}}}},{xtype:"checkbox",itemCls:"y-import-hidden-field",checked:false,name:"importStencilSetPerspective",listeners:{render:function(e){if(this.facade.isCurrentUserAdmin()===false){e.el.parent(".x-form-item").remove()}}.bind(this)}},{boxLabel:Signavio.I18N.Repository.Offer.archiveRestoreOwnAttributes,xtype:"checkbox",checked:false,name:"importMetaData",listeners:{check:function(f,g){var e=f.ownerCt.items.items.find(function(h){return(h.name==="importStencilSetPerspective")});if(typeof e!=="undefined"){e.setValue(g)}},render:function(e){if(this.facade.isCurrentUserAdmin()===false){e.el.parent(".x-form-item").remove()}}.bind(this)}}]},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(e){return{name:e.key,inputType:"hidden",value:e.value}})]).flatten()});b.getForm().errorReader={read:function(f){return{success:f.responseText.startsWith("{"),records:[]}}};var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:((d||{}).referenceModelId)?Signavio.I18N.Repository.Offer.importReferenceModel.replace("{referenceModelId}",d.referenceModelId):Signavio.I18N.Repository.Offer.archiveRestore,description:((d||{}).referenceModelId)?Signavio.I18N.Repository.Offer.importReferenceModelDesc.replace("{referenceModelId}",d.referenceModelId):Signavio.I18N.Repository.Offer.archiveRestoreLabel,modal:true,width:500,resizable:false,items:[b],listeners:{render:function(g){if(this.facade.isCurrentUserAdmin()===false){var e=g.el.child(".x-window-body");if(e&&e.dom){var f=document.createElement("div");f.className="y-import-dialog-no-admin-hint";f.textContent=Signavio.I18N.Repository.Offer.archiveNoAdminHint;e.dom.appendChild(f)}}}.bind(this)},buttons:[{text:Signavio.I18N.Repository.Offer.archiveRestoreBtn,handler:function(){if(b.items.items[0].el.dom.value){b.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.ARCHIVE_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.archiveRestoreWait,method:"POST",success:function(f,e){Signavio.Core.StoreManager.reloadChildEntitiesStore();Signavio.Core.StoreManager.reload();a.close();var g=e.response.responseText.evalJSON();if(g.warnings&&g.warnings.length>0){this.showWarnings(g.warnings)}else{this.showLanguageWarnings(g.languages||[])}}.bind(this),failure:function(f,e){var g=e.response.responseText.replace(/<(\/){0,1}pre([^>]*)>/g,"");if(g.startsWith("{")){g=g.evalJSON()}if(g&&String(g.message).include("Incompatible languages")){this.showLanguageWarnings(g.languages||[],409)}else{if(g&&String(g.message).include("file_size_violates_")){Ext.Msg.alert(Signavio.I18N.Repository.Offer.archiveRestore,Signavio.I18N.Repository.Offer.archiveRestoreFileQuotaException).setIcon(Ext.MessageBox.WARNING)}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.archiveRestore,Signavio.I18N.Repository.Offer.archiveRestoreErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}a.close()}.bind(this)})}else{}}.bind(this)}]});a.show()},showLanguageWarnings:function(c,a){var d,b=function(g){var h=g.split("_").first(),f=g.split("_").last();return h==f?(Signavio.I18N.Languages[h]||h):(Signavio.I18N.Languages[h]||h)+" ("+(Signavio.I18N.Countries[f]||f)+")"},e=(this.facade.getConfig("tenant","languages")||"[]").toLowerCase().evalJSON().sortBy(function(f){return f.position||0}).pluck("rel");c=c.invoke("toLowerCase");if(a==409){d=new Ext.Template(Signavio.I18N.Repository.Offer.archiveRestoreLanguageNoMatching).apply({languages:c.map(b).join(", ")})}else{if(e.length>0){if(c.length==0){d=new Ext.Template(Signavio.I18N.Repository.Offer.archiveRestoreLanguageNothingDefined).apply({language:b(e[0])})}else{if(c.length>0&&!c.all(function(f){return e.include(f)})){d=new Ext.Template(Signavio.I18N.Repository.Offer.archiveRestoreLanguageMoreDefined).apply({languages:c.findAll(function(f){return !e.include(f)}).map(b).join(", ")})}}}else{if(c.length>0){d=new Ext.Template(Signavio.I18N.Repository.Offer.archiveRestoreLanguageOnlyDefined).apply({language:b(c[0]),languages:c.slice(1).map(b).join(", ")})}}}if(d){Ext.Msg.alert(Signavio.I18N.Repository.Offer.archiveRestore,d).setIcon(a?Ext.Msg.WARNING:Ext.Msg.INFO).getDialog().syncSize()}},showWarnings:function(b){var a="";b.each(function(d){a+="* "+d+"\n\n"});var c=new Ext.Window({autoCreate:true,cls:"x-window-security-center",bodyStyle:"padding:10px;background:white;",title:Signavio.I18N.Repository.Offer.archiveRestore,width:400,modal:true,resizable:false,layout:"anchor",items:[{text:Signavio.I18N.Repository.Offer.archiveWarnings,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{text:Signavio.I18N.Repository.Offer.archiveWarnings,style:"font-size:12px;margin-bottom:0px;display:block;color:black;overflow:auto;",xtype:"textarea",anchor:"100%",height:150,disabled:true,value:a}],buttons:[{text:Ext.MessageBox.buttonText.ok,handler:function(){c.close()}.bind(this)}]});c.show()},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")}};Signavio.Plugins.ArchiveImport=Signavio.Core.Plugin.extend(Signavio.Plugins.ArchiveImport)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.BPMN2_0Import={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.BPMN2_0Import.title,description:Signavio.I18N.Repository.Offer.BPMN2_0Import.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.importBPMN2_0.bind(this),index:10,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)});var b=Signavio.I18N.Language.split("_").first()},afterRender:function(){},importBPMN2_0:function(){var c=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{text:Signavio.I18N.Repository.Offer.BPMN2_0Import.restorelabel,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{name:"bpmn2_0file",inputType:"file",style:"display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});c.getForm().errorReader={read:function(d){return{success:d.responseText.toLowerCase().endsWith("[true]\n</pre>"),records:[]}}};var b=this;var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.BPMN2_0Import.restore,width:400,modal:true,resizable:false,items:[c],buttons:[{text:Signavio.I18N.Repository.Offer.BPMN2_0Import.restoreBtn,handler:function(){if(c.items.items[1].el.dom.value){c.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.BPMN2_0_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.BPMN2_0Import.wait,method:"POST",success:function(e,d){var h,g,f;a.close();h=d.response.responseText.replace(/<(\/){0,1}pre([^>]*)>/g,"");h=h.replace(/<(\/){0,1}pre([^>]*)>/g,"");h=h.replace("[true]\n","");if(h.startsWith("[")&&h.endsWith("]")){g=h.evalJSON();if(g[0]){f=b.buildValidationResultsWindow(g[0].errors,g[0].warnings);if(f){f.show()}}}else{if(h.startsWith("[")&&!h.endsWith("]")){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.ReadingFileFailedTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.ReadingFileFailedDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}Signavio.Core.StoreManager.reloadChildEntitiesStore()}.bind(this),failure:function(e,d){a.close();if(d.response.responseText.indexOf("BPMN2_0Import.ImportStartedSuccessfully")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0ImportAsyncInfoTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.AsyncInfoDesc).setIcon(Ext.MessageBox.INFO)}else{if(d.response.responseText.indexOf("BPMN2_0Import.FileTooBig")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.FileTooBigTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.FileTooBigDesc).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.ValidationFailed")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.ValidationFailedTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.ValidationFailedDesc).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.NoFile")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.NoFileTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.NoFileDesc).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.CouldNotReadRequest")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotReadRequest.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS),Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotReadRequest.gubs("[supportMailAdresse]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.CouldNotGetFileItemInputStream")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotGetFileItemInputStream.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS),Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotGetFileItemInputStream.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.CouldNotBuildDiagramObjectFromJSON")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotGenerateSvgForDiagramTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotBuildDiagramObjectFromJSON.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.MissingBPMNDIPart")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.MissingBPMNDIPartTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.MissingBPMNDIPart).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.ReadingFileFailed")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.ReadingFileFailedTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.ReadingFileFailedDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.CouldNotGenerateSvgForDiagram")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotGenerateSvgForDiagramTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.CouldNotGenerateSvgForDiagram).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.GeneralError")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.GeneralErrorTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.GeneralErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(d.response.responseText.indexOf("BPMN2_0Import.NonFiniteNumbers")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.GeneralErrorTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.NonFiniteNumbers).setIcon(Ext.MessageBox.WARNING)}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.BPMN2_0Import.GeneralErrorTitle,Signavio.I18N.Repository.Offer.BPMN2_0Import.GeneralErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}}}}}}}}}}}}})}}.bind(this)}]});a.show()},showModelLinkListDialog:function(a){if(!a||!a.length){return}var c="<div><div style='margin-bottom:5px;'>"+Signavio.I18N.Repository.Offer.BPMN2_0Import.LinkListDescription+"</div>";a.each(function(f,d){var e=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:f});c+="<a href='"+e+"' target='_blank' style='display:block;margin-bottom:3px;'>"+Signavio.I18N.Repository.Offer.BPMN2_0Import.LinkListProcess+" "+(d+1)+"</a>"});c+="</div>";var b=new Ext.Window({width:300,resizable:false,minimizable:false,modal:true,autoScroll:true,title:Signavio.I18N.Repository.Offer.importXPDLLinkListTitle,bodyStyle:"background-color:#ffffff;padding:10px;",html:c,buttons:[{text:Signavio.I18N.Repository.Offer.importXPDLLinkListBtn,handler:function(){b.hide()}}]});b.show()},buildValidationResultsWindow:function(f,d){var e;var c=[],b,a;if(!(f instanceof Array)||!(d instanceof Array)||(f.length==0&&d.length==0)){return}b=new Ext.Panel({title:"test",anchor:"100%",height:60,hideCollapseTool:true,header:false,headerAsText:false,hideBorders:true,bodyBorder:false,border:false,frame:false,collapsible:false,html:(f.length>0?Signavio.I18N.Repository.Offer.BPMN2_0Import.ErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.BPMN2_0Import.WarningDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS))});if(f.length>0){c.push(this.setupValidationDetailsPanel(f,"Errors"))}if(d.length>0){c.push(this.setupValidationDetailsPanel(d,"Warnings"))}a=new Ext.Panel({hideBorders:true,layout:"accordion",anchor:"100%",height:350,items:c});e=new Ext.Window({width:600,height:500,resizable:false,minimizable:false,modal:true,autoScroll:false,title:Signavio.I18N.Repository.Offer.BPMN2_0Import.title,bodyStyle:"background-color:#ffffff;padding:10px;",items:[b,a],buttons:[{text:Signavio.I18N.Repository.Offer.BPMN2_0Import.OK,handler:function(){e.hide()}}]});return e},setupValidationDetailsPanel:function(f,d){var a,b,c,e;if(!(f instanceof Array)){return}b=new Ext.data.JsonStore({data:f,fields:["type","details"]});c=function(g,l,h,k,n,m){var j=h.data.type,p,q;if(g instanceof Array){l.css="x-grid-cell-selectable-text";p=Signavio.I18N.Repository.Offer.BPMN2_0Import[j+"Detail"];if(typeof(p)!=="undefined"){q=g.map(function(r){return(new Ext.Template(p)).apply(r.evalJSON()||{})});return q.join("<br />")}}};e=function(l,k,g,m,j,h){if(typeof(Signavio.I18N.Repository.Offer.BPMN2_0Import[l])!=="undefined"){return Signavio.I18N.Repository.Offer.BPMN2_0Import[l]}else{return l}};a=new Ext.grid.GridPanel({title:Signavio.I18N.Repository.Offer.BPMN2_0Import["Title"+d]+" ("+b.getTotalCount()+")",store:b,autoScroll:true,collapsed:true,disableSelection:true,columns:[{id:"type",header:Signavio.I18N.Repository.Offer.BPMN2_0Import["HeaderType"+d],renderer:e,width:120,dataIndex:"type",menuDisabled:true,hidable:false},{id:"details",header:Signavio.I18N.Repository.Offer.BPMN2_0Import["HeaderDetails"+d],editor:new Ext.form.TextField(),renderer:c,width:450,dataIndex:"details",menuDisabled:true,hidable:false}],autoExpandColumn:"details"});return a}};Signavio.Plugins.BPMN2_0Import=Signavio.Core.Plugin.extend(Signavio.Plugins.BPMN2_0Import)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.NPBImport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.NPBImport.title,description:Signavio.I18N.Repository.Offer.NPBImport.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.importNPB.bind(this),index:31,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},importNPB:function(){var c=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{text:Signavio.I18N.Repository.Offer.NPBImport.restorelabel,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{name:"npbfile",inputType:"file",style:"display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});c.getForm().errorReader={read:function(d){return{success:d.responseText.toLowerCase().endsWith("successful\n</pre>"),records:[]}}};var b=this;var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.NPBImport.restore,width:400,modal:true,resizable:false,items:[c],buttons:[{text:Signavio.I18N.Repository.Offer.NPBImport.restoreBtn,handler:function(){if(c.items.items[1].el.dom.value){c.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.NPB_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.NPBImport.wait,method:"POST",success:function(e,d){var f;a.close();f=d.response.responseText.replace(/<pre.*?>/,"");f=f.replace("</pre>","");f=f.replace("\n","");if(f.match("NPBImport.ImageImportSuccessful")){Ext.Msg.alert(Signavio.I18N.Repository.Offer.NPBImport.ImageImportSuccessfulTitle,Signavio.I18N.Repository.Offer.NPBImport.ImageImportSuccessfulDesc).setIcon(Ext.MessageBox.INFO)}Signavio.Core.StoreManager.reloadChildEntitiesStore()}.bind(this),failure:function(e,d){a.close();var f=d.response.responseText.match(/NPBImport\.(\w+)/);if(f&&f.length==2){var h=Signavio.I18N.Repository.Offer.NPBImport[f[1]+"Title"];var g=Signavio.I18N.Repository.Offer.NPBImport[f[1]+"Desc"];if(f[1]==="CouldNotGenerateSvgForDiagram"){Ext.Msg.alert(Signavio.I18N.Repository.Offer.NPBImport.CouldNotGenerateSvgForDiagramTitle,Signavio.I18N.Repository.Offer.NPBImport.CouldNotGenerateSvgForDiagramDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}else{if(h&&f){Ext.Msg.alert(h,g).setIcon(Ext.MessageBox.ERROR)}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.NPBImport.GeneralErrorTitle,Signavio.I18N.Repository.Offer.NPBImport.GeneralErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.NPBImport.GeneralErrorTitle,Signavio.I18N.Repository.Offer.NPBImport.GeneralErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}})}}.bind(this)}]});a.show()}};Signavio.Plugins.NPBImport=Signavio.Core.Plugin.extend(Signavio.Plugins.NPBImport)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.SvgExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:100,name:Signavio.I18N.Repository.Offer.exportItemSVG,description:Signavio.I18N.Repository.Offer.exportItemSVGDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_vector.png",functionality:this.doExport.bind(this,"/svg",Signavio.I18N.Repository.Offer.exportItemSVG),isDisabled:function(){return !this.oneSelected()||this.selectionInTrash()}.bind(this)})}};Signavio.Plugins.SvgExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.SvgExport)}();if(!window.Signavio){window.Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.PngExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:95,name:Signavio.I18N.Repository.Offer.exportItemPNG,description:Signavio.I18N.Repository.Offer.exportItemPNGDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_picture.png",functionality:this.doExport.bind(this,"/png",Signavio.I18N.Repository.Offer.exportItemPNG),isDisabled:function(){return !this.oneSelected()||this.selectionInTrash()}.bind(this)})}};Signavio.Plugins.PngExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.PngExport)}());if(!window.Signavio){window.Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var a=["/bpmn2_0_xml"];Signavio.Extensions.BPMNViewSelectionWindow=function(b){Signavio.Extensions.BPMNViewSelectionWindow.superclass.constructor.call(this,b)};Ext.extend(Signavio.Extensions.BPMNViewSelectionWindow,Signavio.Extensions.ViewSelectionWindow,{getSettings:function(){var c=Signavio.Extensions.BPMNViewSelectionWindow.superclass.getSettings.apply(this,arguments);var d=new Ext.form.Checkbox({fieldLabel:Signavio.I18N.Repository.Offer.includeLinkedProcessesShort,listeners:{check:function(e,f){this.exportSubprocesses=f}.bind(this)}});c.add(d);var b=c.getValue;c.getValue=function(){return Ext.apply(b()||{},{exportSubprocesses:d.getValue()})};return c},submitWithViews:function(b,c,d){return Signavio.Extensions.BPMNViewSelectionWindow.superclass.submitWithViews.call(this,b,c,d+"?includeLinkedProcesses="+((this.exportSubprocesses)?"yes":"no"))}});Signavio.Plugins.BPMN2Export={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);var c=function(){var g=this.getSelection()[0];if(!g){return true}var e=g.get("rel");var h=g.get("rep");var f=h.namespace;return e!="mod"||!["http://b3mn.org/stencilset/bpmn2.0#","http://b3mn.org/stencilset/bpmn2.0conversation#","http://b3mn.org/stencilset/bpmn2.0choreography#"].include(f)}.bind(this);var d=function(){var e=this.getSelection()||[];return(e.length>1)}.bind(this);var b=function(){return !c.call(this)&&!d.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.facade.offer({relGroup:"import",index:60,name:Signavio.I18N.Repository.Offer.exportItemBPMN2,description:Signavio.I18N.Repository.Offer.exportItemBPMN2Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/bpmn2_0_xml",Signavio.I18N.Repository.Offer.exportItemBPMN2),isDisabled:function(){return !b()},isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},doExport:function(d,e){var b=this.currentRecordsSet.values()[0].get("rep");var c=(this.facade.getConfig("department","languages")||"[]").evalJSON(true)||[];if(!c||c.length<=1){c=[]}new Signavio.Extensions.BPMNViewSelectionWindow({views:b,selection:this.getSelection(),suffix:d,title:e,showFor:a,withSubprocesses:true,languages:c})},onSubmit:function(d,b){if(Ext.isIE7||Ext.isIE8){var c=$("download_iframe");if(!c){c=document.createElement("iframe");c.id="download_iframe";document.body.appendChild(c)}c.setAttribute("src",Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+d+"?includeLinkedProcesses="+b+"&"+Object.toQueryString(Ext.Ajax.getSecurityParameter()||{}))}else{window.open(Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+d+"?includeLinkedProcesses="+b+"&"+Object.toQueryString(Ext.Ajax.getSecurityParameter()||{}))}}};Signavio.Plugins.BPMN2Export=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.BPMN2Export)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.RdfExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:70,name:Signavio.I18N.Repository.Offer.exportItemXML,description:Signavio.I18N.Repository.Offer.exportItemXMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/rdf",Signavio.I18N.Repository.Offer.exportItemXML),isDisabled:function(){return !this.oneSelected()||this.selectionInTrash()||(this.getSelection()[0].get("rep").namespace==="http://b3mn.org/stencilset/bpmn2.0#"||this.getSelection()[0].get("rep").namespace==="http://b3mn.org/stencilset/bpmn2.0conversation#"||this.getSelection()[0].get("rep").namespace==="http://b3mn.org/stencilset/bpmn2.0choreography#")}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.RdfExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.RdfExport)}();if(!window.Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var a=false;Signavio.Plugins.AdvancedLanguageExport=Signavio.Core.Plugin.extend({enabled:true,construct:function(b){var c=b.getConfig().numAllowedLanguages>0;if(c&&b.getLanguages().length>1){a=true}}});Signavio.Plugins.ArchiveExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:49,seperated:true});this.facade.offer({relGroup:"import",index:55,name:Signavio.I18N.Repository.Offer.archive,description:Signavio.I18N.Repository.Offer.archiveDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compress_up.png",functionality:this.showArchiveDialog.bind(this),isDisabled:function(){return this.noneSelected()}.bind(this)})},showArchiveDialog:function(){var b=this.getSelection().select(function(c){return this.isModel(c)||this.isFile(c)||this.isDirectory(c)}.bind(this));this._showArchiveDialog(b)},getTreePanel:function(b){return new Signavio.Extensions.ModelDirectoryCheckTreePanel({anchor:"-20",height:350,root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL,Signavio.Const.REL.FILE],filterFn:function(c){if(this.isModel(c)||this.isFile(c)){return true}if(this.isDirectory(c)){return !this.isTrashFolder(c)&&((this.selectionInInternal()&&this.isInternalFolder(c))||(!this.selectionInInternal()&&!this.isInternalFolder(c)))}return false}.bind(this),isChildLeaf:function(c){return[Signavio.Const.REL.MODEL,Signavio.Const.REL.FILE].include(c.get("rel"))},hasChildCls:function(c){switch(c.get("rel")){case Signavio.Const.REL.MODEL:return"model model-"+Signavio.Utils.getIcon(c,true);case Signavio.Const.REL.FILE:return"file-"+Signavio.Utils.getIcon(c,true);default:return"folder"}}.bind(this)})},b)},getFirstPage:function(d){var c=this.getTreePanel(d);var b=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Repository.Offer.archiveHead,checked:true,hideLabel:true});return new Ext.ux.view.WizardPage({items:[new Ext.form.Label({text:Signavio.I18N.Repository.Offer.archiveLabel}),c,b],cls:"y-wizard-tree-page",layout:"anchor",getTree:function(){return c},exportOnlyHead:function(){return b.checked===true}})},getSecondPage:function(){var b=this.createLanguageOptions();return new Ext.ux.view.WizardPage({items:[new Ext.form.Label({text:Signavio.I18N.Repository.Offer.archiveLanguageOptionsDescription})].concat(b),getLanguageOptions:function(){return b},disabled:!a})},getWizard:function(c){var d=this.getFirstPage(c);var b=this.getSecondPage();return new Ext.ux.view.Wizard({items:[d,b],anchor:"100% 100%",clb:this.doExport.bind(this),clbName:Signavio.I18N.Repository.Offer.archiveBtn,getTree:function(){return d.getTree()},exportOnlyHead:function(){return d.exportOnlyHead()},getLanguageOptions:function(){return b.getLanguageOptions()}})},_showArchiveDialog:function(c){var b=this.getWizard(c);var d=new Ext.Window({width:500,height:550,resizable:false,minimizable:false,modal:true,cls:"y-wizard-window",title:Signavio.I18N.Repository.Offer.archive,items:b,layout:"anchor",getTree:function(){return b.getTree()},onlyHead:function(){return b.exportOnlyHead()},getLanguageOptions:function(){return b.getLanguageOptions()}});d.show()},doExport:function(b){var d=b.ownerCt;var e=[];var c=[];d.getTree().getChecked().each(function(f){var g=f.attributes.identifier;if(g.indexOf("/model/")==0){e.push(g.replace(/\/model\//,""))}else{if(g.indexOf("/file/")==0){e.push(g.replace(/\/file\//,""))}else{if(g.indexOf("/directory/")==0){c.push(g.replace(/\/directory\//,""))}}}}.bind(this));this.sendRequest(e,c,d.onlyHead(),d.getLanguageOptions().getValue());d.close()},getLanguageFields:function(d){var e=this.getDefaultLanguageSelect(d);var c=this.getLanguagesToExport(d);var b=c.getComponent();e.getComponent().on("select",function(h,f,g){var j=f.get("value");b.enableAll();b.check(j);b.disable(j)});c.on("beforerender",function(){b.disable(e.getComponent().getValue())});return{"default":e,"export":c}},createLanguageOptions:function(){var d=this.facade.getLanguages();if(!a||d.length<=1){return{getValue:function(){return[]}}}var c=this.getLanguageFields(d);var b=[c["default"],c["export"]];b.getValue=function(){var e=[c["default"].getComponent().getValue()];return e.concat(c["export"].getComponent().getRemainder())};return b},getDefaultLanguageSelect:function(d){var b=Ext.ux.form.LanguageSwitch.create({languages:d,anchor:"100%"});var c=new Ext.form.Label({text:Signavio.I18N.Repository.Offer.archiveDefaultLanguage,cls:"y-label-with-space"});return new Ext.ux.view.OptionsContainer({title:Signavio.I18N.Repository.Offer.archiveDefaultLanguageTitle,items:[c,b],getComponent:function(){return b}})},getLanguagesToExport:function(d){var b=Ext.ux.form.LanguageSwitch.create({languages:d,multi:true,name:"exported-languages"});var c=new Ext.form.Label({text:Signavio.I18N.Repository.Offer.exportLanguages,cls:"y-label-with-space"});return new Ext.ux.view.OptionsContainer({items:[c,b],getComponent:function(){return b},title:Signavio.I18N.Repository.Offer.exportLanguagesTitle})},sendRequest:function(b,k,h,e){if(this.frame){this.frame.remove();delete this.frame}this.frame=Ext.getBody().createChild({tag:"iframe",cls:"x-hidden",id:"iframe",name:"iframe"});var c=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.ARCHIVE_EXPORT_PATH;var l=(b||[]).map(function(n){return["input",{type:"hidden",value:n,name:"models"}]});var m=(k||[]).map(function(n){return["input",{type:"hidden",value:n,name:"directories"}]});var g=$H(Ext.Ajax.getSecurityParameter()).map(function(n){return["input",{type:"hidden",value:n.value,name:n.key}]});var f=e.map(function(n){return["input",{type:"hidden",name:"languageRestrictions",value:n}]});var j=this.frame.dom.contentDocument?this.frame.dom.contentDocument.body:this.frame.dom.document.body;var d=Signavio.Core.graft(null,Ext.isIE?document.body:j,["form",{action:c,method:"POST"},["input",{type:"hidden",value:h,name:"onlyHead"}]].concat(l,m,g,f));d.submit();if(Ext.isIE){this.frame=Ext.get(d)}},isFile:Signavio.Utils.isFile,isModel:Signavio.Utils.isModel,isDirectory:Signavio.Utils.isDirectory,isTrashFolder:function(b){return Signavio.Utils.isTrashFolder(b,this.facade)},isInternalFolder:Signavio.Utils.isInternalFolder};Signavio.Plugins.ArchiveExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.ArchiveExport)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.MapExportEnableSignavioBrandingOption=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);Signavio.Config.SIGNAVIO_BRANDING_CONFIGURABEL=true}});Signavio.Plugins.MapExport=Signavio.Core.ExportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.createOffer()},createOffer:function(){var a=this;this.facade.offer({relGroup:"import",index:105,name:Signavio.I18N.Repository.MapExport.offerTitle,description:Signavio.I18N.Repository.MapExport.offerDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png",functionality:function(){a.exportMap()},isDisabled:function(){return !a.onlyModelsOrFoldersAreSelected()},isVisible:function(){return a.selectionNotInTrash()}})},isHorziontal:function(){var a=this.facade.getExtView("view").body.query("div.thumb-wrap.x-view-selected img");if(a&&a.length>0){return a[0].clientWidth>=a[0].clientHeight}return false},getViews:function(){if(this.currentRecordsSet.values()[0]){return this.currentRecordsSet.values()[0].get("rep")}return[]},getCurrentUser:function(){return this.facade.getCurrentUser().getRecords("info")[0]},getModelId:function(){return this.getSelection()[0].get("href")},exportMap:function(){var a=this.getWizardWindow();a.show()},stripName:function(a){a=a.unescapeHTML();a=a.replace(/[\\\/:*?\"<>|#]/g,"");a=encodeURI(a);a=a.replace(/&/g,"%26");return a},sendRequest:function(j,h){var g=window.open();var e=[];var f=this.facade.getCurrentFolderStore(),a;var d=f?f.getRecords("info")[0]:undefined;if(d){a=Signavio.I18N.Repository.Folder[d.get("rep").type]||d.get("rep").name||d.get("rep").title||f.getIdentifier()}else{a=Signavio.I18N.Repository.MapExport.defaultName+" - "+(new Date().format("d.m.Y H:i"))}var b=window.location.protocol+"//"+window.location.host+Signavio.Config.BACKEND_PATH+Signavio.Config.PRINT_MULTIPLE_PDFS_PATH+"//"+a.gsub("/","-")+".pdf";$H(j).each(function(k){if(k.value instanceof Array){k.value.each(function(l){e.push(["input",{type:"hidden",value:l,name:k.key}])})}else{e.push(["input",{type:"hidden",value:k.value,name:k.key}])}});var c=Signavio.Core.graft(null,g.document.body,["form",{action:b,method:"POST"}].concat(e));c.submit()},doExport:function(f){var g=f.models;var c=f.modelNames;var e=f.directories;if(g.length===1&&e.length===0){var b=g[0];var a=Signavio.Config.BACKEND_PATH+((f.view)?f.view:g[0])+"/pdf/"+this.stripName(c[g[0]]||"")+".pdf?pageMode="+f.cropping+(f.orientation===Signavio.I18N.Repository.MapExport.landscape?"&landscape=true":"")+"&showSignavioBranding="+f.showSignavioBranding+"&isSketchy="+f.isSketchy+"&scale="+(f.scale||1)+"&blackWhite="+(f.blackWhite||false)+"&language="+f.language+"&hash="+(parseInt(Math.random()*10000))+($H(Ext.Ajax.extraParams).size()?"&"+Object.toQueryString(Ext.Ajax.extraParams):"");a+="&"+Object.toQueryString(Ext.apply({},Ext.Ajax.extraParams,Ext.Ajax.getSecurityParameter()));window.open(a)}else{var d={models:f.models,modelNames:f.modelNames,directories:f.directories,pageMode:f.cropping,landscape:(f.orientation===Signavio.I18N.Repository.MapExport.landscape),showSignavioBranding:f.showSignavioBranding,isSketchy:f.isSketchy,language:f.language,blackWhite:f.blackWhite,scale:f.scale,hash:parseInt(Math.random()*10000)};Ext.apply(d,Ext.Ajax.extraParams,Ext.Ajax.getSecurityParameter());this.sendRequest(d)}},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")},getStore:function(){isHor=this.isHorziontal();var a=new Ext.data.SimpleStore({data:[[Signavio.I18N.Repository.MapExport.fitToPage,Signavio.I18N.Repository.MapExport.portrait,Signavio.Config.IMAGE_PATH+"/map/1page.vertical.png","FitToPage",0],[Signavio.I18N.Repository.MapExport.clipAllSides,Signavio.I18N.Repository.MapExport.portrait,Signavio.Config.IMAGE_PATH+"/map/4pages.vertical.png","MapClip",0],[Signavio.I18N.Repository.MapExport.clipBottom,Signavio.I18N.Repository.MapExport.landscape,Signavio.Config.IMAGE_PATH+"/map/2pages.ns.horizontal.png","OneSideClipNS",0],[Signavio.I18N.Repository.MapExport.clipBottom,Signavio.I18N.Repository.MapExport.portrait,Signavio.Config.IMAGE_PATH+"/map/2pages.ns.vertical.png","OneSideClipNS",0],[Signavio.I18N.Repository.MapExport.fitToPage,Signavio.I18N.Repository.MapExport.landscape,Signavio.Config.IMAGE_PATH+"/map/1page.horizontal.png","FitToPage",1],[Signavio.I18N.Repository.MapExport.clipAllSides,Signavio.I18N.Repository.MapExport.landscape,Signavio.Config.IMAGE_PATH+"/map/4pages.horizontal.png","MapClip",1],[Signavio.I18N.Repository.MapExport.clipRight,Signavio.I18N.Repository.MapExport.portrait,Signavio.Config.IMAGE_PATH+"/map/2pages.ew.vertical.png","OneSideClipEW",1],[Signavio.I18N.Repository.MapExport.clipRight,Signavio.I18N.Repository.MapExport.landscape,Signavio.Config.IMAGE_PATH+"/map/2pages.ew.horizontal.png","OneSideClipEW",1]],fields:["name","format","img","url","index"]});a.sort("index",isHor?"DESC":"ASC");return a},getWizardWindow:function(){this.selection=this.getSelection();var b=this.getTreePage();var c=this.getOptionPage();var a=new Ext.ux.view.Wizard({items:[b,c],getTreePage:function(){return b},getOptionsPage:function(){return c},clb:this.handleExport.bind(this),clbName:Signavio.I18N.Repository.MapExport.buttonTitle,activeTab:(this.selection.length===1?1:0),selection:this.selection});return new Ext.Window({cls:"y-wizard-window",title:Signavio.I18N.Repository.MapExport.optionWindowTitle,modal:true,layout:"fit",height:Math.min(550,Ext.getBody().getHeight()*0.9),width:450,items:[a]})},getTreePage:function(){return new Signavio.Extensions.WizardTreePage({title:Signavio.I18N.Repository.MapExport.treePageTitle,cls:"y-wizard-tree-page",labelText:Signavio.I18N.Repository.MapExport.treeDesc,selection:this.getSelection()||[],trashRecord:this.facade.getTrashRecord(),showLayerSelection:false,items:[],listeners:{activate:function(a){if(!this.treeActivated){a.adjustPageContentSize(a.tree);this.treeActivated=true}}.bind(this),destroy:function(){delete this.treeActivated}.bind(this),resize:function(a){if(!this.isResizing){a.adjustPageContentSize(a.tree)}}.bind(this),deactivate:function(a){var b=this.selection;this.selection=a.tree.isVisible()?a.tree.getChecked():this.selection;if(b!==this.selection){this.oldSelection=b}}.bind(this)}})},getLanguages:function(){return(this.facade.getConfig("department","languages")||"[]").evalJSON(true)},getOptionPage:function(){return new Signavio.Extensions.WizardOptionsPage({title:Signavio.I18N.Repository.MapExport.optionPageTitle,cls:"y-wizard-option-page",labelText:Signavio.I18N.Repository.MapExport.offerTitleDesc,user:this.getCurrentUser(),configMode:this.facade.getConfig().mode,store:this.getStore(),selection:this.selection,views:this.getViews(),languages:this.getLanguages(),listeners:{activate:function(c){if(this.selection.length===1){var e,a;if(this.selection[0].attributes){var b=this.selection[0].attributes;e=b.identifier;a=b.rel}else{e=this.selection[0].get("href");a=this.selection[0].get("rel")}if(a==="mod"){var d=e+"/views";c.items.last().el.mask(Signavio.I18N.Repository.MapExport.waitMask,"x-waiting-box");Signavio.Core.StoreManager.getStore(d,true,this.showViewContainer.bind(this,c))}else{this.hideViewContainer(c)}}else{this.hideViewContainer(c)}}.bind(this),destroy:function(){delete this.optionPageActivated}.bind(this),resize:function(a){if(!this.isResizing){a.adjustPageContentSize(a.formatSelector)}}.bind(this)}})},selectionChanged:function(){if(this.selection&&this.oldSelection&&this.selection!==this.oldSelection){return true}return false},showViewContainer:function(c,e){var b=e.pluck("data");var d=c.items.last();if(b.length===0){this.hideViewContainer(c)}else{var d=c.items.last();var a;if(d){a=d.items.find(function(f){return f instanceof Ext.ux.view.OptionsContainer&&f.identifier==="Signavio.OptionsContainer.ViewSelector"});d.remove(a)}if(d&&this.selection.length===1&&b.length>0){a=c.getViewsContainer(b);if(a){d.add(a);d.doLayout()}}}d.el.unmask();c.adjustPageContentSize(c.formatSelector)},hideViewContainer:function(c,b){var d=c.items.last();var a;if(d){a=c.items.last().items.find(function(e){return e instanceof Ext.ux.view.OptionsContainer&&e.identifier==="Signavio.OptionsContainer.ViewSelector"})}d.remove(a);delete a;if(!b){c.adjustPageContentSize(c.formatSelector)}},handleExport:function(l){var f=l.getTreePage();var q=f.getTree();var b=q.isVisible()?q.getChecked():l.selection;if(b.length===0){Ext.Msg.alert(Signavio.I18N.Repository.MapExport.optionWindowTitle,Signavio.I18N.Repository.MapExport.noModelsSelected).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}var c=[];var d=[];var n=[];b.each(function(t){var u=t.attributes?t.attributes.identifier:t.get("href");var s=(t.attributes?t.attributes.text:(t.get("rep").name||t.get("rep").title));var r=t.attributes?t.attributes.rel:t.get("rel");switch(r){case"mod":c.push(u);d[u]=s;break;case"dir":n.push(u);break}}.bind(this));var j={models:c,modelNames:d,directories:n};if(j.models.length>0||j.directories.length>0){var k=l.ownerCt;var e=l.getOptionsPage().getFormatSelector();var p=l.getOptionsPage().getOptions();var h=p.getExportOptions();var m=undefined;var g=p.getViewOptions();if(g){var a=g.getCurrentView();if(a){m=a}}k.body.mask(Signavio.I18N.Repository.ProcessDocu.waiting,"y-wizard-options-waiting-box");j.cropping=e.getSelectedRecords()[0].get("url");j.orientation=e.getSelectedRecords()[0].get("format");j.showSignavioBranding=h.showSignavioBranding();j.blackWhite=h.isBlackAndWhite();j.isSketchy=h.isSketchy();if(this.getLanguages().length>1&&l.getOptionsPage().getLanguageSelector()){j.language=l.getOptionsPage().getLanguageSelector().getValue()}j.scale=1.4;if(m){j.view=m}this.doExport(j);k.close()}}})}());ns("Plugins");(function(){Signavio.Plugins.PDFExport=Signavio.Plugins.MapExport.extend({enabled:true,createOffer:function(){var a=this;this.facade.offer({relGroup:"import",index:106,name:Signavio.I18N.Repository.PDFExport.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png",functionality:function(){a.exportMap()},isDisabled:function(){return !a.onlyModelsOrFoldersAreSelected()},isVisible:function(){return a.selectionNotInTrash()}})},exportMap:function(){var a=new Signavio.ux.dialog.Print(this.facade,{horizontal:this.isHorziontal(),diagram:this.getModelRep(),selection:this.getSelection().select(function(b){return Signavio.Utils.isModel(b)||Signavio.Utils.isDirectory(b)}),user:this.getCurrentUser(),title:Signavio.I18N.Repository.PDFExport.title});a.show()},getModelRep:function(){return this.getSelection()[0]}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.NPBExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||(this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn1.1#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/epc#")}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return !b.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.facade.offer({relGroup:"import",index:70,name:Signavio.I18N.Repository.Offer.exportItemNPB,description:Signavio.I18N.Repository.Offer.exportItemNPBDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.checkBeforeExport.bind(this),isDisabled:function(){return !a()},isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},checkBeforeExport:function(){var a=Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+Signavio.Config.NPB_UPLOAD_PATH;var b=this;Signavio.Core.Stores.RequestManager.doGet(a,[function(c){if(c.rep&&c.rep.isNPBModel===true){b.doExport(Signavio.Config.NPB_EXPORT_PATH,Signavio.I18N.Repository.Offer.exportItemNPB)}else{Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.NPBExchange.Errors.exportErrorTitle,Signavio.I18N.Repository.SecurityCenter.NPBExchange.Errors.exportErrorDesc).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}},function(c){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.NPBExchange.Errors.generalErrorTitle,Signavio.I18N.Repository.SecurityCenter.NPBExchange.Errors.generalErrorDesc).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}],{})}};Signavio.Plugins.NPBExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.NPBExport)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.CostAndEffortAnalysis=Signavio.Core.StandardReportsPlugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return !isNotSelected.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.treeAnchor="100% -16";this.defaultWorkingdaysperyear=220;this.defaultWorkinghoursperday=7.3;this.defaultPersonalallowance=11;this.defaultTechnicalallowance=5;this.facade.offer({relGroup:"reporting",index:11,name:Signavio.I18N.Repository.Analysis.titleCost,description:Signavio.I18N.Repository.Analysis.descriptionCost,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.titleCost,Signavio.I18N.Repository.Analysis.descriptionCost,true,true,[]),isDisabled:this.isDisabled.bind(this)});this.facade.offer({relGroup:"reporting",index:12,name:Signavio.I18N.Repository.Analysis.titleRes,description:Signavio.I18N.Repository.Analysis.descriptionRes,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.titleRes,Signavio.I18N.Repository.Analysis.descriptionRes,false,true,[]),isDisabled:this.isDisabled.bind(this)});this.facade.offer({relGroup:"reporting",index:13,seperated:true})},showSecondStepDialogForResourcePlaning:function(n,s,f){if((s||[]).concat(f).length===0){this.showError(Signavio.I18N.Repository.Analysis.error1);return}var p=function(v){var u=this.facade.getConfig().configuration;var w=null;if(u){u.each(function(x){if(x.data.rep.name===v){w=x.data.rep.value}})}return w}.bind(this);var m=function(w,x){var v=w.el.dom.parentNode;var u=document.createElement("div");u.className="y-second-personal-dialog-field-panel-hint";u.title=x;v.appendChild(u);Ext.get(u).alignTo(w.el,"tr",[5,4])};var g=new Ext.form.Label({text:Signavio.I18N.Repository.Analysis.quantityAnalysisDescr,style:"margin-bottom:12px;",x:10,y:10});var j=p("defaultPersonalallowance");var b=new Ext.form.NumberField({fieldLabel:Signavio.I18N.Repository.Analysis.personalAllowanceTimeField,labelSeparator:"",decimalSeparator:Signavio.I18N.Repository.Analysis.decimalSeperator,allowNegative:false,validator:function(){return(this.getValue()>=0&&this.getValue()<=100)?true:Signavio.I18N.Repository.Analysis.invalidBetweenonehundred},value:Ext.isEmpty(j)?this.defaultPersonalallowance:j});b.on("render",function(u){m(u,Signavio.I18N.Repository.Analysis.personalAllowanceTimeFieldTT)});j=p("defaultTechnicalallowance");var h=new Ext.form.NumberField({fieldLabel:Signavio.I18N.Repository.Analysis.objectAllowanceTimeField,labelSeparator:"",decimalSeparator:Signavio.I18N.Repository.Analysis.decimalSeperator,allowNegative:false,validator:function(){return(this.getValue()>=0&&this.getValue()<=100)?true:Signavio.I18N.Repository.Analysis.invalidBetweenonehundred},value:Ext.isEmpty(j)?this.defaultTechnicalallowance:j});h.on("render",function(u){m(u,Signavio.I18N.Repository.Analysis.objectAllowanceTimeFieldTT)});var l=new Ext.form.Checkbox({checked:false,itemCls:"y-second-personal-dialog-field-checkbox",boxLabel:Signavio.I18N.Repository.Analysis.saveForFuture,labelSeparator:""});j=p("defaultWorkingdaysperyear");var c=new Ext.form.NumberField({fieldLabel:Signavio.I18N.Repository.Analysis.shouldWorkDaysPerYear,labelSeparator:"",decimalSeparator:Signavio.I18N.Repository.Analysis.decimalSeperator,allowNegative:false,validator:function(){return(this.getValue()>=0&&this.getValue()<=365)?true:Signavio.I18N.Repository.Analysis.invalidGreaterOneYear},value:Ext.isEmpty(j)?this.defaultWorkingdaysperyear:j});c.on("render",function(u){m(u,Signavio.I18N.Repository.Analysis.shouldWorkDaysPerYearTT)});j=p("defaultWorkinghoursperday");var d=new Ext.form.NumberField({fieldLabel:Signavio.I18N.Repository.Analysis.shouldWorkHoursPerDay,labelSeparator:"",decimalSeparator:Signavio.I18N.Repository.Analysis.decimalSeperator,allowNegative:false,validator:function(){return(this.getValue()>=0&&this.getValue()<=24)?true:Signavio.I18N.Repository.Analysis.invalidGreaterOneDay},value:Ext.isEmpty(j)?this.defaultWorkinghoursperday:j});d.on("render",function(u){m(u,Signavio.I18N.Repository.Analysis.shouldWorkHoursPerDayTT)});var t=new Ext.form.Checkbox({checked:false,itemCls:"y-second-personal-dialog-field-checkbox",boxLabel:Signavio.I18N.Repository.Analysis.saveForFuture,labelSeparator:""});var e=new Ext.Panel({layout:"form",width:500,height:300,cls:"y-second-personal-dialog-field-panel",style:"margin-top:38px",border:false,items:[b,h,l,c,d,t]});var a=new Ext.Button({text:Signavio.I18N.Repository.Analysis.startButton,disabled:true,handler:function(){a.disable();var y={timeout:600000,models:s,directories:f,mode:"timemode",usehierarchy:n,workingdaysperyear:c.getValue(),workinghoursperday:d.getValue(),personalallowance:b.getValue(),technicalallowance:h.getValue()};var w=function(z){q.hide();this.showResult(z.rep)}.bind(this);var v=function(z){q.hide();this.showError(z.message||Signavio.I18N.Repository.HrNeed.unknownError)}.bind(this);Signavio.Core.Stores.RequestManager.doPost("/p/analysis",[w,v],y);var u=l.getValue();var x=t.getValue();if(typeof u!=="undefined"&&typeof x!=="undefined"&&(x===true||u===true)){if(u===true){this.facade.setConfig("user","defaultPersonalallowance",b.getValue(),"explorer","decimal");this.facade.setConfig("user","defaultTechnicalallowance",h.getValue(),"explorer","decimal")}if(x===true){this.facade.setConfig("user","defaultWorkingdaysperyear",c.getValue(),"explorer","decimal");this.facade.setConfig("user","defaultWorkinghoursperday",d.getValue(),"explorer","decimal")}}}.bind(this)});var k=function(){var x=b.getValue();if(typeof x!=="number"||x<0||x>100){a.disable();return}var w=h.getValue();if(typeof w!=="number"||w<0||w>100){a.disable();return}var v=c.getValue();if(typeof v!=="number"||v<0){a.disable();return}var u=d.getValue();if(typeof u!=="number"||u<0){a.disable();return}a.enable()}.bind(this);b.on("blur",function(){k()});h.on("blur",function(){k()});d.on("blur",function(){k()});c.on("blur",function(){k()});b.on("invalid",function(){k()});h.on("invalid",function(){k()});d.on("invalid",function(){k()});c.on("invalid",function(){k()});var r=new Ext.Button({text:Signavio.I18N.Repository.Analysis.backButton,handler:function(){q.hide();this.sendRequest(s,f,false)}.bind(this)});var q=new Ext.Window({width:500,height:400,resizable:false,minimizable:false,modal:true,layout:"form",title:Signavio.I18N.Repository.Analysis.title,bodyStyle:"background-color:#ffffff;padding:10px;",layout:"absolute",items:[g,e],buttons:[r,a]});q.on("render",function(){k()});q.on("show",function(){window.setTimeout(function(){b.focus()},200)});q.show()},sendRequest:function(a,p,b){if((a||[]).concat(p).length===0){this.showError(Signavio.I18N.Repository.Analysis.error1);return}var m=new Ext.form.Label({text:Signavio.I18N.Repository.Analysis.selectMode,style:"margin-bottom:12px;",x:10,y:10});var j=new Ext.form.Radio({boxLabel:Signavio.I18N.Repository.Analysis.costMode,checked:b,name:"radiogroup",style:"margin-bottom:4px;",x:10,y:35});var f=this.getPngPanel(Signavio.I18N.Repository.Analysis.costModeImgTag);f.setPosition(20,65);var q=this.facade.getConfig().currency;var g=q&&typeof q==="object"&&q.sign?q.sign:"";var e=new Ext.form.Label({text:new Ext.XTemplate(Signavio.I18N.Repository.Analysis.costModeDescription).apply({currency:g}),style:"margin-right:10px;",x:185,y:65});var n=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Repository.Analysis.costModeButton,checked:false,style:"margin-right:10px;",x:185,y:115});n.on("check",function(u,t){if(t){k.setText(Signavio.I18N.Repository.Analysis.nextButton)}else{k.setText(Signavio.I18N.Repository.Analysis.startButton)}});var h=new Ext.form.Radio({boxLabel:Signavio.I18N.Repository.Analysis.timeMode,checked:!b,name:"radiogroup",x:10,y:175});h.on("check",function(u,t){if(t){n.setDisabled(true);n.setValue(false);k.setText(Signavio.I18N.Repository.Analysis.nextButton)}else{n.setDisabled(false);k.setText(Signavio.I18N.Repository.Analysis.startButton)}});var s=this.getPngPanel(Signavio.I18N.Repository.Analysis.timeModeImgTag);s.setPosition(20,205);var d=new Ext.form.Label({text:Signavio.I18N.Repository.Analysis.timeModeDescription,style:"margin-right:10px;",x:185,y:205});var c=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Repository.Analysis.includeButton,checked:false,x:10,y:305});var k=new Ext.Button({text:Signavio.I18N.Repository.Analysis.startButton,handler:function(){if(h.getValue()){l.hide();this.showSecondStepDialogForResourcePlaning(c.getValue(),a,p)}else{if(n.getValue()){l.hide();this.showSecondDialog(h.getValue(),c.getValue(),a,p)}else{k.disable();var t=h.getValue()?"timemode":"costmode";Signavio.Core.Stores.RequestManager.doPost("/p/analysis",[function(u){l.hide();this.showResult(u.rep)}.bind(this),function(u){l.hide();this.showError(u.message||Signavio.I18N.Repository.HrNeed.unknownError)}.bind(this)],{timeout:600000,models:a,directories:p,mode:t,usehierarchy:c.getValue()})}}}.bind(this)});var r=new Ext.Button({text:Signavio.I18N.Repository.Analysis.backButton,handler:function(){l.hide();if(b){this.showArchiveDialog(Signavio.I18N.Repository.Analysis.titleCost,Signavio.I18N.Repository.Analysis.descriptionCost,b,true)}else{this.showArchiveDialog(Signavio.I18N.Repository.Analysis.titleRes,Signavio.I18N.Repository.Analysis.descriptionRes,b,true)}}.bind(this)});var l=new Ext.Window({width:500,height:400,resizable:false,minimizable:false,cls:"",modal:true,title:Signavio.I18N.Repository.Analysis.title,bodyStyle:"background-color:#ffffff;padding:10px;",layout:"absolute",items:[m,j,f,e,n,h,s,d,c],buttons:[r,k]});l.show()},showSecondDialog:function(a,b,d,c){Signavio.Core.Stores.RequestManager.doGet("/p/analysis",[function(h){var f=new Ext.data.SimpleStore({fields:["position","costs"],data:h});var j=new Ext.Button({text:Signavio.I18N.Repository.Analysis.startButton,handler:function(){j.disable();n.disable();var p=[];f.each(function(q){p.push([q.get("position"),q.get("costs")])},this);Signavio.Core.Stores.RequestManager.doPost("/p/analysis",[function(q){k.hide();this.showResult(q.rep)}.bind(this),function(q){this.showError(q.message||Signavio.I18N.Repository.HrNeed.unknownError)}.bind(this)],{timeout:600000,models:d,directories:c,mode:"costbytime",costmapping_json:p,usehierarchy:b})}.bind(this)});var n=new Ext.Button({text:Signavio.I18N.Repository.Analysis.backButton,handler:function(){if(k){k.hide()}this.sendRequest(d,c,true)}.bind(this)});var l=new Ext.form.Label({text:Signavio.I18N.Repository.Analysis.specifyMapping,style:"margin-bottom:12px;",x:10,y:10});var m=this.facade.getConfig().currency;var g=m&&typeof m==="object"&&m.sign?m.sign:"";var e=new Ext.grid.EditorGridPanel({store:f,cm:new Ext.grid.ColumnModel([{id:"position",header:Signavio.I18N.Repository.Analysis.mappingPosition,dataIndex:"position",width:199,editable:false},{id:"costs",header:new Ext.Template(Signavio.I18N.Repository.Analysis.mappingCosts).apply({currency:g}),dataIndex:"costs",editor:new Ext.form.NumberField({width:200,disabled:false}),width:199}]),stripeRows:true,clicksToEdit:1,height:200,width:420,selModel:new Ext.grid.CellSelectionModel(),x:20,y:35});var k=new Ext.Window({width:480,height:450,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Analysis.title,bodyStyle:"background-color:#ffffff;padding:10px",layout:"absolute",items:[l,e],buttons:[n,j]});k.show()}.bind(this),function(e){this.showError(e.message||Signavio.I18N.Repository.HrNeed.unknownError)}.bind(this)],{timeout:180000,models:d,directories:c,usehierarchy:b})},showResult:function(p){var l=p.errors;var m=p.downloadLink;var g=p.nrOfSuccessfulModels;var n=p.nrOfModels;if(n==0){this.showError(Signavio.I18N.Repository.HrNeed.noModelSelected);return}var h='<div style="font-size:11px;">';if(g>0){var f=(new Template(Signavio.I18N.Repository.HrNeed.summary)).evaluate({nr1:g,nr2:n});h+='<div style="margin:12px;">'+f+'</div><div style="margin:12px;"><a href="'+m+(m.include("?")?"&":"?")+(Object.toQueryString(Ext.Ajax.getSecurityParameter()))+'" target="_blank">'+Signavio.I18N.Repository.HrNeed.link+"</a></div>";if(g<n){h+='<div style="margin:12px;margin-top:18px;">'+Signavio.I18N.Repository.HrNeed.errors+"</div>"}}else{var f=(new Template(Signavio.I18N.Repository.HrNeed.onlyErrors)).evaluate({nr:n});h+='<div style="margin:12px;">'+f+'</div><div style="margin:12px;">'+Signavio.I18N.Repository.HrNeed.onlyErrors2+"</div>"}if(g<n){h+='<div style="margin:12px;margin-left:24px;">';for(var d=0;d<l.length;d++){var b=l[d];var k=b.returnMessage;if(k==="HRNC_ERR_PLAUS"){k="";var a=b.returnDetails.array;for(var c=0;c<a.length;c++){if(k==""){k+=this.parseCodeToMsg(a[c])}else{k+=", "+this.parseCodeToMsg(a[c])}}}else{k=this.parseCodeToMsg(k)}h+=" - "+Signavio.I18N.Repository.HrNeed.model+" <i>"+b.modelName+": </i>"+k+' (<a href="'+Signavio.Config.EDITOR_HANDLER_URI+"?id="+b.modelId+'" target="_blank">'+Signavio.I18N.Repository.HrNeed.openModel+"</a>)<br />"}h+="</div>"}h+="</div>";var e=new Ext.Window({width:480,height:450,resizable:false,minimizable:false,modal:true,autoScroll:true,title:Signavio.I18N.Repository.Analysis.title,bodyStyle:"background-color:#ffffff;",html:h,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){e.hide()}}]});e.show()},getPngPanel:function(a){return new Ext.Panel({layout:"anchor",width:155,defaults:{border:false},border:false,html:a,height:90})},showError:function(a){Ext.MessageBox.show({title:Signavio.I18N.Repository.HrNeed.error,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},parseCodeToMsg:function(a){return Signavio.I18N.Repository.ReturnCode[a]||a},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isEpc:function(a){if(this.facade.getConfig().isAokTenant){return false}return a.get("rep").namespace=="http://b3mn.org/stencilset/epc#"},isBpmn20:function(a){return a.get("rep").namespace=="http://b3mn.org/stencilset/bpmn2.0#"},isDisabled:function(){return !this.getSelection().all(function(a){return this.isDirectory(a)||this.isBpmn20(a)||this.isEpc(a)}.bind(this))}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ResponsibilityAnalysis={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:20,name:Signavio.I18N.Repository.Analysis.responsibilityAnalysisTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.responsibilityAnalysisTitle,Signavio.I18N.Repository.Analysis.responsibilityAnalysisDesc,"raci"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})}};Signavio.Plugins.ResponsibilityAnalysis=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.ResponsibilityAnalysis)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.IKSReport=Signavio.Core.StandardReportsPlugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:30,name:Signavio.I18N.Repository.Analysis.iksreportTitle,description:"",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.iksreportTitle,Signavio.I18N.Repository.Analysis.iksreportDesc,"iksreport"),isDisabled:function(){return !this.getSelection().all(function(a){return this.isDirectory(a)||this.isBpmn20(a)}.bind(this))}.bind(this)})},hasValidModelType:function(a){return this.isBpmn20(a)}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.DocumentsUsageReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:22,name:Signavio.I18N.Repository.Analysis.docUseTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.docUseTitle,Signavio.I18N.Repository.Analysis.docUseDesc,"documents"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})}};Signavio.Plugins.DocumentsUsageReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.DocumentsUsageReport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ItSystemsUsageReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:23,name:Signavio.I18N.Repository.Analysis.itSystemByDiagramTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.itSystemByDiagramTitle,Signavio.I18N.Repository.Analysis.itSystemByDiagramDesc,"itsystems_diagrams"),isDisabled:function(){return this.isReportDisabled()}.bind(this)});this.facade.offer({relGroup:"reporting",index:24,name:Signavio.I18N.Repository.Analysis.itSystemByRolesTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.itSystemByRolesTitle,Signavio.I18N.Repository.Analysis.itSystemByRolesDesc,"itsystems_roles"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})}};Signavio.Plugins.ItSystemsUsageReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.ItSystemsUsageReport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ProcessMetricsReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:27,name:Signavio.I18N.Repository.Analysis.metricsTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.metricsTitle,Signavio.I18N.Repository.Analysis.metricsDesc,"processMetrics"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})},hasValidModelType:function(a){return this.isEpc(a)||this.isBpmn20(a)||this.isProcessMap(a)||this.isOrganigram(a)}};Signavio.Plugins.ProcessMetricsReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.ProcessMetricsReport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ResponsibilityHandoversReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:21,name:Signavio.I18N.Repository.Analysis.responsibilityHandoverTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.responsibilityHandoverTitle,Signavio.I18N.Repository.Analysis.responsibilityHandoverDesc,"handovers"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})}};Signavio.Plugins.ResponsibilityHandoversReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.ResponsibilityHandoversReport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.AttributesReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:26,name:Signavio.I18N.Repository.Analysis.attributesReportTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,Signavio.I18N.Repository.Analysis.attributesReportTitle,Signavio.I18N.Repository.Analysis.attributesReportDesc,"attributes"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})},hasValidModelType:function(a){return this.isEpc(a)||this.isBpmn20(a)||this.isProcessMap(a)||this.isOrganigram(a)}};Signavio.Plugins.AttributesReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.AttributesReport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.WienerAttributesReport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:40,name:Signavio.I18N.Repository.Analysis.wienerTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",functionality:this.showArchiveDialog.bind(this,"Risiko-Kontroll-Matrix (xls)",Signavio.I18N.Repository.Analysis.wienerDesc,"wienerattributes"),isDisabled:function(){return this.isReportDisabled()}.bind(this)})},hasValidModelType:function(a){return this.isBpmn20(a)}};Signavio.Plugins.WienerAttributesReport=Signavio.Core.StandardReportsPlugin.extend(Signavio.Plugins.WienerAttributesReport)}();(function(){Signavio.Plugins.EmbedDiagram=Clazz.extend({enabled:true,construct:function(){Signavio.Config.DIAGRAM_EMBEDDING_ENABLED=true}})}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.PURLSupport2={modelviewer:null,mashupIsLoaded:false,enabled:true,relTypes:["views"],spreadsheetNamespaces:["http://b3mn.org/stencilset/bpmn2.0#","http://b3mn.org/stencilset/epc#"],construct:function(){arguments.callee.$.construct.apply(this,arguments);var g=function(){return this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);var d=function(){return this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PUBLIC}.bind(this);var l=function(){return this.facade.getCurrentRootFolder()&&this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PUBLIC}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()&&this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PRIVATE}.bind(this);var e=function(){return this.getSelection().length===1&&this.getSelection()[0].get("rel")===Signavio.Const.REL.MODEL}.bind(this);var k=function(){return e()&&this.spreadsheetNamespaces.include(this.getSelection()[0].get("rep").namespace)}.bind(this);var h=function(){return this.getSelection().length>0&&this.getSelection().all(function(m){return m.get("rel")===Signavio.Const.REL.MODEL})}.bind(this);var f=function(){return this.facade.getConfig().mode!=="Enterprise"||this.facade.getConfig().hasGuestUser}.bind(this);var j=function(){return !g()&&!this.selectionInInternal()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.SecurityCenter.Offer.shareTitle,description:Signavio.I18N.Repository.SecurityCenter.Offer.shareDesc,group:"scenter",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png",index:1,isVisible:j,items:[{name:Signavio.I18N.Repository.SecurityCenter.Offer.readTitle,index:1,description:Signavio.I18N.Repository.SecurityCenter.Offer.readDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/picture_key.png",functionality:this.showReadAccessWindow.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.SHARE],isDisabled:function(){return g()||!e()||c()||!f()||(this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected())}.bind(this),isVisible:function(){return j()&&Signavio.Config.DIAGRAM_EMBEDDING_ENABLED}},{name:Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,index:2,description:Signavio.I18N.Repository.SecurityCenter.Offer.discussDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments_key.png",functionality:this.forkDiscussionAccessWindow.bind(this),isDisabled:function(){return g()||(this.getSelection().length&&!this.onlyModelsOrFoldersAreSelected())}.bind(this),isVisible:j},{name:Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle,index:3,description:Signavio.I18N.Repository.SecurityCenter.Offer.writeDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_key.png",functionality:this.showWriteAccessWindow.bind(this,Signavio.Config.EDITOR_PATH),neededPrivileges:[Signavio.Config.RIGHTS.WRITE],isDisabled:function(){return g()||c()||!h()}.bind(this),isVisible:j},{name:Signavio.I18N.Repository.SecurityCenter.Offer.writeSpreadsheetTitle,index:4,description:Signavio.I18N.Repository.SecurityCenter.Offer.writeSpreadsheetDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/table_key.png",functionality:this.showWriteAccessWindow.bind(this,Signavio.Config.SPREADSHEET_PATH),seperated:true,neededPrivileges:[Signavio.Config.RIGHTS.WRITE],isDisabled:function(){return g()||!k()}.bind(this),isVisible:function(){return j||!Signavio.Plugins.Spreadsheet||!Signavio.Plugins.Spreadsheet.enabled}.bind(this)},{name:Signavio.I18N.Repository.SecurityCenter.Offer.manageTitle,index:5,description:Signavio.I18N.Repository.SecurityCenter.Offer.manageDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/application_key.png",functionality:this.showManageWindow.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.WRITE],isDisabled:function(){return g()||!e()}.bind(this),isVisible:j}]})},showReadAccessWindow:function(){var g=this.getCurrentModel();if(!g){return}g=g.split("/").last();this.embedConfig={url:this.getServer()+Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href"),overflowX:"fit",overflowY:"fit",zoomSlider:true,linkSubProcesses:false};var d=this.embedConfig;var r=this.getSelection()[0].get("rep");var h,v,s,k,p;var j;var q=new Ext.Panel({html:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.infoTextShort).apply({name:r.name||r.title})+" "+(this.facade.getConfig().mode==="Enterprise"?Signavio.I18N.Repository.SecurityCenter.infoTextEnterpriseHint:""),height:45,border:false});var m=new Ext.LinkButton({text:Signavio.I18N.Repository.SecurityCenter.shareReadLink,height:25,style:{fontSize:"12px"},click:(function(){if(h&&v&&s&&k){this.store.remove(h,true);this.store.remove(v,false);this.store.remove(s,false);this.store.remove(k,false)}else{if(h){this.store.remove(h,true)}if(v){this.store.remove(v,false)}if(s){this.store.remove(s,false)}if(k){this.store.remove(k,false)}var w=function(x){x=x instanceof Array?x:[x];x.each(function(z){var y=Signavio.Core.RecordCreator.create(z.rel,z.href,z.rep);this.store.add(y)}.bind(this))}.bind(this);this.generateLink(g,Signavio.Const.PURL.PNG,undefined,undefined,undefined,w)}}).bind(this)});var f=new Ext.form.ComboBox({store:this.getViewsStore(this.currentStores[0]),typeAhead:true,triggerAction:"all",mode:"local",fieldLabel:Signavio.I18N.Repository.SecurityCenter.selectView,displayField:"name",valueField:"view",width:150,style:{fontSize:"12px"},selectOnFocus:true,forceSelection:true});f.setValue(Signavio.I18N.Repository.SecurityCenter.originalView);f.on("beforeselect",this.onSelectView,this);var u=new Ext.Panel({layout:"column",border:false,layoutConfig:{columns:2},anchor:"100%",height:25,items:[{border:false,layout:"anchor",width:"50%",style:{paddingTop:"2px"},items:[m]},{id:"plugin-purl-viewSelect",border:false,layout:"form",width:"50%",style:(f.store.totalLength<=1)?{display:"none"}:{},items:[f]}]});this.store=Signavio.Core.StoreManager.getStore(Signavio.Config.PRIVATE_URL_PATH+"/"+g,true,function(){p=function(w){if(this.reloadStore){this.reloadStore=false;Signavio.Core.StoreManager.reload(this.store);return}var y=this.store.getRecords(Signavio.Const.REL.PURL);var x=d.view?("view://"+d.view):"";h=y.find(function(z){return(z.get("rep").type===Signavio.Const.PURL.PNG)&&(z.get("rep").label===x)});v=y.find(function(z){return(z.get("rep").type===Signavio.Const.PURL.JSON)&&(z.get("rep").label===x)});s=y.find(function(z){return z.get("rep").type===Signavio.Const.PURL.STENCILSET});k=y.find(function(z){return(z.get("rep").type===Signavio.Const.PURL.GADGET)&&(z.get("rep").label===x)});if(h&&v&&s&&k){d.authkeyPng=h.get("rep").authkey;d.authkeyJson=v.get("rep").authkey;d.authkeyStencilset=s.get("rep").authkey;d.authkeyGadget=k.get("rep").authkey;this.generateHtml(d);this.setPngLink(h.get("rep").uri,d.authkeyPng);this.setGadgetLink(k.get("rep").uri,d.authkeyGadget);this.setMediaWikiLink(d);Ext.getCmp("plugin-purl-embedPanel").enable();Ext.getCmp("plugin-purl-viewSelect").enable();m.setText(Signavio.I18N.Repository.SecurityCenter.undoShareReadLink)}else{d.authkeyPng="";d.authkeyJson="";d.authkeyStencilset="";this.generateHtml(false);this.setPngLink(false);this.setGadgetLink(false);Ext.getCmp("plugin-purl-embedPanel").disable();Ext.getCmp("plugin-purl-viewSelect").disable();m.setText(Signavio.I18N.Repository.SecurityCenter.shareReadLink)}}.bind(this);p(true);this.store.on("update",p);this.store.on("load",p);this.store.on("add",p);this.store.on("remove",p)}.bind(this));var c=new Ext.Panel({title:Signavio.I18N.Repository.SecurityCenter.embedding,anchor:"100% 100%",layout:"anchor",style:{padding:"5px",backgroundColor:"white"},items:[{html:Signavio.I18N.Repository.SecurityCenter.embedHelp,height:30,border:false},{style:{margin:"10px 0 0 0"},layout:"column",layoutConfig:{columns:2},anchor:"100%",items:[{xtype:"panel",layout:"anchor",width:210,defaults:{border:false},border:false,items:[{xtype:"panel",html:'<img src="'+Signavio.Config.IMAGE_PATH+'/signavio/preview_embed.png" alt="embed preview" class="plugin-purl-previewimg" />',height:110},{xtype:"panel",layout:"form",defaults:{labelWidth:60},items:[{xtype:"textfield",name:"width",value:"auto",cls:"auto",width:35,fieldLabel:Signavio.I18N.Repository.SecurityCenter.embedWidth+' <img ext:qtip="'+Signavio.I18N.Repository.SecurityCenter.embedWidthInfo+'" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png"/>',allowBlank:true,listeners:{change:(function(w,x){x=parseInt(x);if(isNaN(x)){d.width=undefined;w.setRawValue("auto")}else{if(x<200){x=200}d.width=x;w.setRawValue(x)}this.generateHtml(d)}).bind(this),focus:function(w){w.removeClass("auto");w.setRawValue("")},blur:function(w,x){if(w.getValue()=="auto"){w.addClass("auto")}else{w.removeClass("auto")}}}},{xtype:"textfield",name:"height",value:"auto",cls:"auto",width:35,fieldLabel:Signavio.I18N.Repository.SecurityCenter.embedHeight+' <img ext:qtip="'+Signavio.I18N.Repository.SecurityCenter.embedHeightInfo+'" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png"/>',allowBlank:true,listeners:{change:(function(w,x){x=parseInt(x);if(isNaN(x)){d.height=undefined;w.setRawValue("auto")}else{if(x<200){x=200}d.height=x;w.setRawValue(x)}this.generateHtml(d)}).bind(this),focus:function(w){w.removeClass("auto");w.setRawValue("")},blur:function(w,x){if(w.getValue()=="auto"){w.addClass("auto")}else{w.removeClass("auto")}}}}]},new Ext.LinkButton({id:"plugin-purl-previewLink",text:Signavio.I18N.Repository.SecurityCenter.embedPreview,height:30,style:{fontSize:"12px"},click:this.embedPreview.bind(this)})]},{xtype:"panel",layout:"anchor",columnWidth:1,height:"100%",title:Signavio.I18N.Repository.SecurityCenter.embedHtml,items:[{xtype:"textarea",name:"embedHtml",id:"plugin-purl-embedHtml",selectOnFocus:true,anchor:"100%",height:160,listeners:{focus:function(x){var y;var w=function(z){x.selectText();x.el.removeListener("mouseup",y);z.preventDefault()};y=w;x.el.addListener("mouseup",y)}}}]}],border:false,anchor:"100%"}]});var h=new Ext.Panel({title:Signavio.I18N.Repository.SecurityCenter.image,anchor:"100% 100%",layout:"anchor",style:{padding:"5px",backgroundColor:"white"},items:[{html:Signavio.I18N.Repository.SecurityCenter.imageHelp,height:30,border:false},{style:{margin:"10px 0 0 0"},layout:"column",layoutConfig:{columns:2},anchor:"100%",items:[{xtype:"panel",layout:"anchor",width:210,defaults:{border:false},border:false,html:'<img src="'+Signavio.Config.IMAGE_PATH+'/signavio/preview_image.png" alt="image preview" class="plugin-purl-previewimg" />',height:110},{xtype:"panel",layout:"anchor",columnWidth:1,height:"100%",title:Signavio.I18N.Repository.SecurityCenter.imageLink,items:[{xtype:"textarea",name:"pngLink",id:"plugin-purl-pngLink",selectOnFocus:true,anchor:"100%",height:75,readOnly:true}]}],border:false,anchor:"100%"}]});var l=new Ext.Panel({title:Signavio.I18N.Repository.SecurityCenter.more,anchor:"100% 100%",layout:"anchor",style:{padding:"5px",backgroundColor:"white"},items:[{html:Signavio.I18N.Repository.SecurityCenter.moreHelp,height:30,border:false},{style:{margin:"10px 0 0 0"},layout:"column",layoutConfig:{columns:2},anchor:"100%",items:[{xtype:"panel",layout:"anchor",width:210,defaults:{border:false},border:false,html:'<img src="'+Signavio.Config.IMAGE_PATH+'/signavio/preview_gadget.png" alt="image preview" class="plugin-purl-previewimg" />',height:110},{xtype:"panel",layout:"anchor",columnWidth:1,height:"100%",title:Signavio.I18N.Repository.SecurityCenter.gadgetLink,items:[{xtype:"textarea",name:"gadgetLink",id:"plugin-purl-gadgetLink",selectOnFocus:true,anchor:"100%",height:75,readOnly:true}]}],border:false,anchor:"100%"}]});var t=this.getMediaWikiPanel();var n=new Ext.TabPanel({id:"plugin-purl-embedPanel",anchor:"100%",height:300,activeTab:0,deferredRender:false,style:{marginTop:"10px"},items:[c,h,l,t]});var e=new Ext.form.FormPanel({hideLabels:true,border:false,bodyStyle:"padding:10px;",layout:"anchor",anchor:"100% 100%",items:[q,u,n]});j=new Ext.Window({title:Signavio.I18N.Repository.SecurityCenter.Offer.readTitle,cls:"x-window-security-center",items:[e],modal:true,width:700,minWidth:700,height:410,minHeight:410,layout:"anchor",listeners:{resize:function(A,y,z){n.setHeight(z-135);var x=Ext.get("plugin-purl-embedHtml");if(x){x.setStyle({height:(z-250)+"px"})}},close:function(){this.destroy()},destroy:function(){this.store.un("update",p);this.store.un("load",p);this.store.un("add",p);this.store.un("remove",p)}.bind(this)}});j.show()},getMediaWikiPanel:function(){return new Ext.Panel({title:Signavio.I18N.Repository.SecurityCenter.mediaWiki,anchor:"100% 100%",layout:"anchor",style:{padding:"5px",backgroundColor:"white"},items:[{html:Signavio.I18N.Repository.SecurityCenter.mediaWikiHelp,height:30,border:false},{style:{margin:"25px 0 0 0"},layout:"column",layoutConfig:{columns:2},anchor:"100%",items:[{xtype:"panel",layout:"anchor",width:210,defaults:{border:false},border:false,html:'<img src="'+Signavio.Config.IMAGE_PATH+'/signavio/preview_embed.png"  alt="image preview" class="plugin-purl-previewimg" />',height:110},{xtype:"panel",layout:"anchor",columnWidth:1,height:"100%",title:Signavio.I18N.Repository.SecurityCenter.mediaWikiLink,items:[{xtype:"textarea",name:"mediaWikiLink",id:"plugin-purl-mediaWikiLink",selectOnFocus:true,anchor:"100%",height:75,readOnly:true}]}],border:false,anchor:"100%"}]})},generateHtml:function(d){var l=Ext.getCmp("plugin-purl-embedHtml");if(!d){l.setValue(Signavio.I18N.Repository.SecurityCenter.embedNotGeneratedText);l.setDisabled(true);return}var n=this.getSelection()[0].get("rep");l.setDisabled(false);var m=this.getServer()+Signavio.Config.MASHUP_URI+"/signavio.js";var e="http://www.signavio.com";var j=Signavio.I18N.Repository.SecurityCenter.embedSignavioKeywords.split(",");var f="";for(var g=0;g<3;g++){var k=Math.floor(j.length*Math.random());f+=j[k].strip();j=j.without(j[k]);if(g<2){f+=" "}}var c=d.viewId?this.getServer()+Signavio.Config.BACKEND_PATH+Signavio.Config.VIEW_PATH+"/"+d.viewId:d.url;var h='<h3 class="signavio-title"><a href="'+e+'">'+(n.name||n.title)+'</a></h3>\n<script type="text/javascript" src="'+m+'"><\/script>\n<script type="text/plain">\n{\n    url: "'+c+'",\n    authToken: "'+d.authkeyPng+"_"+d.authkeyJson+"_"+d.authkeyStencilset+'",\n    overflowX: "'+d.overflowX+'",\n    overflowY: "'+d.overflowY+'",\n'+(d.width?"    width: "+d.width+",\n":"")+(d.height?"    height: "+d.height+",\n":"")+"    zoomSlider: "+d.zoomSlider+",\n    linkSubProcesses: "+d.linkSubProcesses+"\n}\n<\/script>\n"+(this.facade.getConfig().mode.toLowerCase()!="enterprise"?'<a class="signavio-logo" href="http://www.signavio.com" rel="external"><img src="'+this.getServer()+Signavio.Config.MASHUP_URI+'/img/signavio.png" alt="'+f+'" /></a>':"");l.setValue(h)},onSelectView:function(k,g){if(k.getValue()===g.get("view")||k.getValue()===g.get("name")){return}var j=g.json[0];if(j===Signavio.I18N.Repository.SecurityCenter.originalView){delete this.embedConfig.view;delete this.embedConfig.viewId}else{this.embedConfig.view=j;this.embedConfig.viewId=g.get("id")}var d=this.store.getRecords(Signavio.Const.REL.PURL);var j=this.embedConfig.viewId||this.store.getIdentifier().split("/").last();var d=this.store.getRecords(Signavio.Const.REL.PURL);var h=d.find(function(m){return(m.get("rep").type===Signavio.Const.PURL.PNG)&&(m.get("rep").uri.include(j))});var l=d.find(function(m){return(m.get("rep").type===Signavio.Const.PURL.JSON)&&(m.get("rep").uri.include(j))});var e=d.find(function(m){return(m.get("rep").type===Signavio.Const.PURL.GADGET)&&(m.get("rep").uri.include(j))});if(h&&l&&e){this.embedConfig.authkeyPng=h.get("rep").authkey;this.embedConfig.authkeyJson=l.get("rep").authkey;this.embedConfig.authkeyGadget=e.get("rep").authkey;this.generateHtml(this.embedConfig);this.setMediaWikiLink(this.embedConfig);this.setPngLink(h.get("rep").uri,this.embedConfig.authkeyPng);this.setGadgetLink(e.get("rep").uri,this.embedConfig.authkeyGadget)}else{var f=d.find(function(m){return(m.get("rep").type===Signavio.Const.PURL.PNG)&&(m.get("rep").label==="")});var c=Object.clone(f.get("rep"));c.authkey="UPDATE";f.set("rep",c);this.reloadStore=true;f.commit()}},setMediaWikiLink:function(d){var c=Ext.getCmp("plugin-purl-mediaWikiLink");if(!d.url){c.setValue(Signavio.I18N.Repository.SecurityCenter.embedNotGeneratedText);c.setDisabled(true);return}else{var f=d.url.split("/");var h=f[f.length-1];if(d.view===undefined){var e=d.authkeyPng+"_"+d.authkeyJson+"_"+d.authkeyStencilset;var g="<signavio>"+h+":"+e+"</signavio>";c.setValue(g);c.setDisabled(false)}else{c.setValue(Signavio.I18N.Repository.SecurityCenter.mediaWikiLinkNon);c.setDisabled(true)}}},setPngLink:function(e,f){var c=Ext.getCmp("plugin-purl-pngLink");if(!e){c.setValue(Signavio.I18N.Repository.SecurityCenter.embedNotGeneratedText);c.setDisabled(true);return}else{var d=this.getServer()+e+"?inline&authkey="+f;c.setValue(d);c.setDisabled(false)}},setGadgetLink:function(e,f){var c=Ext.getCmp("plugin-purl-gadgetLink");if(!e){c.setValue(Signavio.I18N.Repository.SecurityCenter.embedNotGeneratedText);c.setDisabled(true);return}else{var d=this.getServer()+e+"?authkey="+f;c.setValue(d);c.setDisabled(false)}},embedPreview:function(){var e=this.getSelection()[0].get("rep");var c=Ext.getCmp("plugin-purl-embedHtml").getValue();var d=this.getServer()+Signavio.Config.MASHUP_URI+"/preview/style.css";var f=window.open("");f.focus();f.document.write('<html xmlns="http://www.w3.org/1999/xhtml"><head><title>'+Signavio.I18N.Repository.SecurityCenter.embedPreview+' | Signavio</title><link rel="stylesheet" href="'+d+'" type="text/css" media="screen" /></head><body><div id="page"><div id="header"><div id="headerimg"><h1>'+Signavio.I18N.Repository.SecurityCenter.embedPreview+'</h1></div></div><hr /><div id="content" class="narrowcolumn"><div class="post"><h2>'+Signavio.I18N.Repository.SecurityCenter.embedPreview+'</h2><div class="entry"><p>'+((e.description&&e.description.length>0)?e.description:Signavio.I18N.Repository.SecurityCenter.embedPreviewDefaultText)+"</p><p>"+c+"</p><p>"+Signavio.I18N.Repository.SecurityCenter.embedPreviewDescription+'</p><p class="code">'+this.nl2br(c.escapeHTML().replace(/ /g,"&nbsp;"))+'</p></div></div></div><hr /><div id="footer"></div></div></body></html>');f.document.close()},nl2br:function(d){d=escape(d);var c;if(d.indexOf("%0D%0A")>-1){c=/%0D%0A/g}else{if(d.indexOf("%0A")>-1){c=/%0A/g}else{if(d.indexOf("%0D")>-1){c=/%0D/g}}}if(typeof(c)=="undefined"){return unescape(d)}else{return unescape(d.replace(c,"<br />"))}},escapeSequences:function(d){var e=new Hash({"\\":"\\\\",'"':'\\"',"\f":"\\f","\b":"\\b","\n":"\\n","\r":"\\r","\t":"\\t"});var c=d;e.each(function(f){c=c.replace(f.key,f.value)});return c},forkDiscussionAccessWindow:function(){var c=this.getSelection();if(c.length===1&&c[0].data.rel!="dir"){this.showDiscussionAccessWindow()}else{this.showMultiSelectedDiscussionWindow()}},showMultiSelectedDiscussionWindow:function(e,j,f,h){if(e){e.checked=!!h;e.emailadresses=j;e.mailMessage=f;e.show();return e}var d=[];this.getSelection().each(function(k){d.push(k)}.bind(this));if(d.length==0){d.push(this.facade.getCurrentFolderStore())}var c=new Signavio.Extensions.ModelDirectoryCheckTreePanel({anchor:"100% -13",root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL],filterFn:function(k){if(this.isModel(k)){return true}else{if(this.isDirectory(k)){return !this.isTrashFolder(k)&&!this.isInternalFolder(k)}else{return false}}}.bind(this),isChildLeaf:function(k){return k.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(k){return k.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(k,true):"folder"}})},d);var g=new Ext.Window({width:520,minWidth:420,height:410,minHeight:350,resizable:true,minimizable:false,modal:true,autoScroll:false,cls:"x-plugin-archive",title:Signavio.I18N.Repository.SecurityCenter.Offer.discussManyTitle,layout:"anchor",bodyStyle:"background-color:#ffffff;padding:10px;",items:[new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.multiSelectDiscussion}),c],buttons:[new Ext.LinkButton({text:Ext.MessageBox.buttonText.cancel,click:function(){g.close()}.bind(this)}),{text:Signavio.I18N.Repository.HrNeed.selectionButton+" >",handler:function(){var l=[];var k=[];var m="";c.getChecked().each(function(n){var p=n.attributes.identifier;if(n.attributes.rel==="mod"){l.push(p.replace(/\/model\//,""))}else{if(n.attributes.rel==="dir"){k.push(p.replace(/\/directory\//,""))}}}.bind(this));if(l.length==0&&k.length==0){this.alert(Signavio.I18N.Repository.SecurityCenter.Hint.oneModelMustDefined);return}else{if(l.length==0){}else{if(l.length==1&&k.length==0){m=c.getChecked()[0].attributes.text}}}this.showDiscussionAccessWindow(l,k,m,g);g.hide()}.bind(this)}]});g.emailadresses=j;g.mailMessage=f;g.checked=!!h;g.show();return g},renderModelNames:function(e,d,f){var c;if(f){c=new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.sendDiscussion).apply({name:f})}else{if(d.length==0){c=new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.DiagramDiscussionNumber).apply({number:e.length})}else{c=Signavio.I18N.Repository.SecurityCenter.DiagramDiscussion}}return c},showDiscussionAccessWindow:function(k,s,w,t){var p;var f;var x="";var n;var y;if(t){var j=t.emailadresses;var r=t.mailMessage;var l=t.checked;n=[];y=Signavio.I18N.Repository.SecurityCenter.writeInfoManageWithoutLink;if(k.length==1&&s.length==0){var d=Signavio.Core.StoreManager.getStore(t.items.get(1).getChecked()[0].parentNode.attributes.identifier);if(d){f=d.findByIdentifier("/model/"+k[0]);y=undefined}}}else{f=this.getSelection()[0];w=this.getSelection()[0].get("rep").name||this.getSelection()[0].get("rep").title}if(f){x=Signavio.I18N.Repository.SecurityCenter.mailDefaultDiscussText}else{x=Signavio.I18N.Repository.SecurityCenter.mailDefaultDiscussTextForMultiSelection}if(r){x=r}var h=this.renderModelNames(k,s,w);var m=new b({text:x},l);if(j){m.mail.value=j.join("\n")}var q=this.getManageDialogHint(f,y,!!f);var v=new Ext.Panel({html:h+" "+this.info(Signavio.I18N.Repository.SecurityCenter.sendDiscussionInfo),border:false,anchor:"100%",afterRender:function(z){Ext.Panel.prototype.afterRender.apply(v,arguments);v.el.query("a.x-manage-access").each(function(A){Ext.get(A).on("click",function(B){Event.stop(B);p.close();this.showManageWindow()}.bind(this))}.bind(this))}.bind(this)});var g=(!!f&&this.getSimplifiedViewHint(f))||undefined;var u=(!!f&&this.getSelectedViewPanel())||undefined;var e=new Ext.form.FormPanel({hideLabels:true,border:false,bodyStyle:"padding:10px;",layout:"anchor",anchor:"100% 100%",items:[v,m,g,u,q].compact()});var c=function(){if(!v.el){return}var A=p.el.getHeight();var z=v.el.getHeight()+q.el.getHeight()+((g&&g.el.getHeight())||0)+((u&&u.el.getHeight())||0)+115;m.setHeight(A-z)};p=new Ext.Window({title:Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,cls:"x-window-security-center",items:[e],modal:true,width:520,minWidth:420,height:410,minHeight:350,selectedViewPanel:u,selectedCheckboxPanel:g,layout:"anchor",listeners:{resize:c,show:c},buttons:[new Ext.LinkButton({text:Signavio.I18N.Repository.SecurityCenter.Button.cancel,click:function(){p.close();if(t){t.close()}}}),{text:"< "+Signavio.I18N.Repository.SecurityCenter.Button.changeModelSelection,handler:(function(){var z=this.showMultiSelectedDiscussionWindow(t,m.getMailAddresses(),m.getMailText(),m.check.checked);if(z){z.updateBox(p.getBox())}p.close()}).bind(this)},{text:Signavio.I18N.Repository.SecurityCenter.Button.ok,handler:function(z){z.disable();var B=m.getMailAddresses(),A;if(B.any(function(E){return !m.isMail(E)})){this.alert(Signavio.I18N.Repository.SecurityCenter.invalidMail);z.enable();return}if(m.includeCopy()){var D=this.facade.getCurrentUser().getRecords(Signavio.Const.REL.INFO)[0].get("rep").mail;B.push(D)}if(B.length<=0){this.alert(Signavio.I18N.Repository.SecurityCenter.Hint.oneReceiverMustDefined);z.enable();return}if(p.selectedView&&p.selectedCheckboxPanel.items.get(0).items.get(0).getValue()==true){if(p.selectedView.isAdhocView==false){if(p.selectedView.viewName==Signavio.I18N.Repository.SecurityCenter.originalView){A=undefined}else{A=p.selectedView.viewID}}else{A=p.selectedView.adhocOptions}}if(!!f){var C=f.get("href").split("/model/").last();this.generateLink(C,Signavio.Const.PURL.DISCUSSION,B,m.getMailText(),A,function(H){var F=H.findAll(function(I){return I.rel==="purl-failed"}).pluck("rep");var E=Signavio.Core.StoreManager.getStore(Signavio.Config.PRIVATE_URL_PATH+"/"+C);if(E){H.each(function(J){if(J.rel!=="purl-failed"){var I=Signavio.Core.RecordCreator.create(J.rel,J.href,J.rep);E.add(I)}}.bind(this))}if(t){t.close()}var G=Signavio.I18N.Repository.SecurityCenter.SendInvitations;if(F&&F.length>0){G=Signavio.I18N.Repository.SecurityCenter.SendInvitationsError+"<br/>"+F.join("<br/>")}Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,G,function(){p.close()}.bind(this)).setIcon(Ext.Msg.INFO).getDialog().syncSize()}.bind(this))}else{this.generateLinks(k,s,"multi"+Signavio.Const.PURL.DISCUSSION,B,m.getMailText(),A,function(F){var E;F.each(function(G){if(G.names&&G.names[0].length>0){E=true}});if(E){if(t){t.close()}Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,Signavio.I18N.Repository.SecurityCenter.SendInvitations,function(){p.close()}.bind(this)).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{this.alert(Signavio.I18N.Repository.SecurityCenter.callbackMsg);z.enable()}}.bind(this))}z.setText(Signavio.I18N.Repository.SecurityCenter.sent);this.currentStores.each(function(E){Signavio.Core.StoreManager.reload(E);E.reload()})}.bind(this)}]});if(g){g.items.get(1).items.get(0).ownerWindow=p;g.items.get(0).items.get(0).on("check",this.selectedViewCheckboxOnCheck.bind(this,p))}p.show();if(t){p.updateBox(t.getBox())}},showSimplifiedViews:function(p,I,j){var r=Signavio.Core.StoreManager.getStore(j.get("href"));if(!r){Signavio.Core.StoreManager.getStore(j.get("href"),true,function(){this.showSimplifiedViews(p,I,j)}.bind(this));return}var C;var F=Math.max(Math.min((Ext.getBody().getWidth())*0.8,1200),800);var v=Math.max(Math.min((Ext.getBody().getHeight())*0.9,800),560);var A;var z;var f=this.getViewsStore(Signavio.Core.StoreManager.getStore(j.get("href")));var J="width:100%;height:100%;border:none;";var w=new Ext.Panel({id:"previewIFrame",title:Signavio.I18N.Views.preview,anchor:"100% "+(f.getTotalCount()<2?"-82":"-77"),layout:"anchor",html:'<iframe id="iframeForView"; style='+J+"></iframe>",style:"border-top: 1px solid;border-color: rgb(70,70,70)",cls:"ak-views-iframepanel-header",border:false});var E=new Ext.form.ComboBox({store:f,anchor:"100%",editable:false,typeAhead:true,triggerAction:"all",mode:"local",fieldLabel:Signavio.I18N.Repository.SecurityCenter.selectView,displayField:"name",valueField:"id",width:300,style:{fontSize:"12px"},selectOnFocus:true,forceSelection:true,cls:"x-predefinied-view-combobox",iFrameContainer:w,parent:A,border:false});E.on("beforeselect",this.onSelectPreviewView.bind(this,j));if(Ext.isIE6){var B={width:220,bodyStyle:"padding-left:10px; padding-top:12px; font-size: 12px;",border:false,html:Signavio.I18N.Views.choosePredefiniedView}}else{var B={bodyStyle:"padding-left:10px; padding-top:12px; font-size: 12px;",border:false,html:Signavio.I18N.Views.choosePredefiniedView}}A=new Ext.FormPanel({anchor:"100%",layout:"column",cls:"ak-views-combobox",border:false,items:[B,{columnWidth:1,bodyStyle:"padding-top: 10px; padding-left: 10px",border:false,items:[E]}]});var l=0;if(E.store.getTotalCount()<2){z=Signavio.I18N.Views.descriptionNoPredefiniedView;A.setVisible(false);l=1;this.noViewsExists=true}else{z=Signavio.I18N.Views.descriptionPredefiniedView;A.setVisible(true);this.noViewsExists=false}var n=new Ext.Panel({bodyStyle:"padding-left:8px; padding-top:5px; font-size: 12px;",html:z,anchor:"100%",layout:"anchor",border:false,cls:"x-panel-body x-panel-body-noheader x-panel-body-noborder x-predefinied-view-description-panel"});var k=new Ext.Panel({title:Signavio.I18N.Views.predefinedViews,bodyStyle:"padding-bottom:10px; overflow:auto; overflow-x:hidden;",border:false,anchor:"100% 100%",layout:"anchor",cls:"ak-views-create-panel",items:[n,A],viewsSelect:E});var y=Signavio.I18N.Views.descriptionCreateView;var m=new Ext.Panel({bodyStyle:"padding-left:10px; padding-top:5px; font-size: 12px;",html:y,anchor:"100%",layout:"anchor",border:false,cls:"x-predefinied-view-description-panel"});var q=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Views.comments,checked:true});var e=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Views.iTSystems,checked:true});var h=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Views.roles,checked:true});var d=new Ext.form.Checkbox({boxLabel:Signavio.I18N.Views.dataObjects,checked:true});var D=0.25;var x=15;var H=new Ext.Panel({anchor:"100%",layout:"column",border:false,cls:"x-container-view-checkboxen ak-views-checkbox-position",items:[{width:140,border:false,bodyStyle:"padding-top:10px;padding-left:"+x+"px;white-space: nowrap;",items:[h]},{width:115,border:false,bodyStyle:"padding-top:10px;padding-left:"+x+"px;white-space: nowrap;",items:[e]},{width:125,border:false,bodyStyle:"padding-top:10px;padding-left:"+x+"px;white-space: nowrap;",items:[d]},{width:80,border:false,bodyStyle:"padding-top:10px;padding-left:"+x+"px;white-space: nowrap;",items:[q]}]});if(!this.isSpecialIE()){H.on("afterlayout",function(M,S){if(H.rendered){var Q=M.items;var P=48;if(Q){for(i=0;i<4;i++){var O=Q.items[i];if(O.rendered&&O.items.items[0].rendered){var L=O.items.items[0].container.dom.childElements()[0].childElements()[1].getWidth();var N=O.items.items[0].getSize().width;var R=L+N+P;O.setWidth(R)}}}}}.bind(this))}else{w.on("resize",function(L,O){if(L.rendered){var N=L.body.child("iframe");if(N){var Q=N.dom.contentWindow.MOVI;if(Q){var P=Q.widget.ModelViewer.getInstance(0);if(P){var R=N.getSize().height-6;var M=N.getSize().width-6;P.getScrollboxEl().setStyle("height",R+"px");P.getScrollboxEl().setStyle("width",M+"px");P.onModelLoadEnd.fire(P._modelUri);P.setZoomLevel(P.getZoomLevel(),false)}}}}}.bind(this))}var g=new Ext.Panel({anchor:"100%",layout:"column",border:false,items:[{width:200,bodyStyle:"padding-left:10px; padding-top:12px; font-size: 12px;white-space: nowrap;",border:false,html:Signavio.I18N.Views.selectionCriteria},{columnWidth:1,bodyStyle:"padding-top: 2px; padding-left: 10px;white-space: nowrap;",border:false,items:[H]}]});var u=new Ext.Panel({title:Signavio.I18N.Views.createViews,bodyStyle:"padding-bottom:10px;",border:false,anchor:"100% 100%",layout:"anchor",items:[m,g]});u.on("activate",function(L){L.doLayout()});var s=new Ext.TabPanel({layoutOnTabChange:true,border:false,activeTab:l,height:this.noViewsExists?105:100,anchor:"100%",cls:"ak-views-too-long-header ak-views-tabpanel",items:[k,u]});var c=new Ext.Panel({layout:"anchor",anchor:"100% 100%",bodyStyle:"background-color: rgb(150,150,150);",border:false,items:[s,w]});var K={text:Signavio.I18N.Views.oK,handler:function(){this.cacheSelectedView(C);this.viewWasSelected(C);this.setSelectedViewTitle(C);Signavio.Plugins.PURLSupport2.mashupIsLoaded=false;C.ownerWindow.fireEvent("resize");C.close()}.bind(this)};var t=new Ext.LinkButton({text:Signavio.I18N.Views.cancel,style:"color: white; display: block; font-size: 11px; padding-bottom: 2px; padding-left: 5px;padding-right: 5px;padding-top: 2px; white-space: nowrap;",click:function(){var L=C.ownerWindow.selectedCheckboxPanel.items.get(0).items.get(0);if(p.cacheView){L.suspendEvents();L.setValue(true);L.showViewWindow=false;L.resumeEvents()}else{L.suspendEvents();L.setValue(false);L.showViewWindow=true;L.resumeEvents()}Signavio.Plugins.PURLSupport2.mashupIsLoaded=false;C.close()}.bind(this)});C=new Ext.Window({title:Signavio.I18N.Views.titleViews,cls:"x-window-security-center",items:[c],modal:true,minWidth:800,minHeight:560,maximizable:true,ownerWindow:p,width:F,height:v,IFrameContainer:w,layout:"fit",buttons:[t,K],iFramePanel:w,tabPanel:s,columnPanel:g,checkboxPanel:H});s.on("resize",function(){if(s.rendered&&C.columnPanel.rendered){C.columnPanel.setWidth(s.body.getWidth()-10);C.columnPanel.doLayout()}}.bind(this));A.items.get(1).items.get(0).ownerWindow=C;C.show();s.on("beforetabchange",this.viewBeforeTabChanged.bind(this,C,j));q.on("check",this.showAdHocViews.bind(this,C,j));e.on("check",this.showAdHocViews.bind(this,C,j));h.on("check",this.showAdHocViews.bind(this,C,j));d.on("check",this.showAdHocViews.bind(this,C,j));if(p.cacheView){cacheView=p.cacheView;E.setValue(cacheView.selectedViewID);q.setValue(cacheView.showComments);e.setValue(cacheView.showITSystem);d.setValue(cacheView.showDataObjects);h.setValue(cacheView.showRoles);if(p.cacheView.selectedTab==0){s.setActiveTab(k);this.viewBeforeTabChanged(C,j,s,k,u)}else{s.setActiveTab(u);this.viewBeforeTabChanged(C,j,s,u,k)}}else{if(I.data.length>0&&I.data.get(0)&&I.data.get(0).data.rep.view.definition){var G=I.data.get(0).data.rep.view.definition;q.setValue(!G.hideComments);e.setValue(!G.hideITSystems);d.setValue(!G.hideData);h.setValue(!G.hideRoles);s.setActiveTab(u)}else{if(l==1){s.setActiveTab(u);C.checkboxPanel.doLayout();this.showAdHocViews(C,j)}else{this.onSelectPreviewView(j,E,E.store.data.get(0))}}E.setValue(Signavio.I18N.Repository.SecurityCenter.originalView)}},getViewsStore:function(d){var c=[[Signavio.I18N.Repository.SecurityCenter.originalView,Signavio.I18N.Repository.SecurityCenter.originalView,Signavio.I18N.Repository.SecurityCenter.originalView]];var h=d.getRecords("views")[0];if(h){var g=h.get("rep");for(var e=0,f=g.length;e<f;++e){c.push([g[e].rep.view.name,g[e].rep.view.name,g[e].rep.view.viewId])}}return new Ext.data.SimpleStore({fields:["view","name","id"],data:c})},onSelectPreviewView:function(e,d,c){if(this.timeOutID!==undefined){window.clearTimeout(this.timeOutID)}this.timeOutID=window.setTimeout(function(){var f=this.getViewHtml(d.ownerWindow,e,c.json[2]);if(f!==false){this.fillIFrameWithView(d.ownerWindow,f)}}.bind(this),2000)},cacheSelectedView:function(f){var d=new Object();var h=f.items.get(0).items.get(0);if(h.activeTab.title!==Signavio.I18N.Views.createViews){d.selectedTab=0}else{d.selectedTab=1}d.selectedViewID=h.items.get(0).items.get(1).items.get(1).items.get(0).getValue();var k=h.items.get(0).items.get(1).items.get(1).items.get(0).store;k.data.items.each(function(m){if(m.data.id==d.selectedViewID){d.selectedViewName=m.data.name}}.bind(this));var e=f.items.get(0).items.get(0).items.get(1).items.get(1).items.get(1).items.get(0);var g=e.items.get(3).items.get(0);var l=e.items.get(1).items.get(0);var c=e.items.get(0).items.get(0);var j=e.items.get(2).items.get(0);d.showComments=g.checked;d.showITSystem=l.checked;d.showDataObjects=j.checked;d.showRoles=c.checked;f.ownerWindow.cacheView=d},viewWasSelected:function(f){var m=new Object();var h=f.items.get(0).items.get(0);if(h.activeTab.title!==Signavio.I18N.Views.createViews){m.isAdhocView=false;m.viewID=h.items.get(0).items.get(1).items.get(1).items.get(0).getValue();var c=h.items.get(0).items.get(1).items.get(1).items.get(0).getValue();var k=h.items.get(0).items.get(1).items.get(1).items.get(0).store;k.data.items.each(function(n){if(n.data.id==c){m.viewName=n.data.name}}.bind(this))}else{m.isAdhocView=true;var e=f.items.get(0).items.get(0).items.get(1).items.get(1).items.get(1).items.get(0);var g=e.items.get(3).items.get(0);var l=e.items.get(1).items.get(0);var d=e.items.get(0).items.get(0);var j=e.items.get(2).items.get(0);if(g.checked&&j.checked&&l.checked&&d.checked){m.isAdhocView=false;m.viewName=Signavio.I18N.Repository.SecurityCenter.originalView}else{m.adhocOptions={hideComments:!g.checked,hideData:!j.checked,hideITSystems:!l.checked,hideRoles:!d.checked}}}f.ownerWindow.selectedView=m},showAdHocViews:function(d,c){if(this.timeOutID!==undefined){window.clearTimeout(this.timeOutID)}this.timeOutID=window.setTimeout(function(){var f=d.items.get(0).items.get(0).items.get(1).items.get(1).items.get(1).items.get(0);var k=f.items.get(3).items.get(0);var l=f.items.get(1).items.get(0);var h=f.items.get(0).items.get(0);var g=f.items.get(2).items.get(0);if(k&&l&&h&&g&&k.rendered&&l.rendered&&h.rendered&&g.rendered){if(k.checked&&l.checked&&h.checked&&g.checked){var j=this.getViewHtml(d,c,Signavio.I18N.Repository.SecurityCenter.originalView);if(j!==false){this.fillIFrameWithView(d,j)}}else{var e={hideComments:!k.checked,hideData:!g.checked,hideITSystems:!l.checked,hideRoles:!h.checked};var j=this.getViewHtml(d,c,"",Object.toJSON(e));if(j!==false){this.fillIFrameWithView(d,j)}}}}.bind(this),2000)},viewBeforeTabChanged:function(h,g,k,e,c){if(this.noViewsExists===true){return}if(e.title==Signavio.I18N.Views.createViews){h.checkboxPanel.doLayout();this.showAdHocViews(window,g)}else{var l=e&&e.viewsSelect;if(l&&l.rendered){var d=l.getValue();var j=l.store.find("name",d);if(j!==-1){this.onSelectPreviewView(g,l,l.store.data.get(j))}else{var f=this.getViewHtml(h,g,Signavio.I18N.Repository.SecurityCenter.originalView);if(f!==false){this.fillIFrameWithView(h,f)}}}}},selectedViewCheckboxOnCheck:function(e,c,d){},setSelectedViewTitle:function(e){sPanel=e.ownerWindow.selectedViewPanel;cacheView=e.ownerWindow.cacheView;sCheckbox=e.ownerWindow.selectedCheckboxPanel.items.get(0).items.get(0);var d="";sCheckbox.enable();if(cacheView.selectedTab==0){if(cacheView.selectedViewName==Signavio.I18N.Repository.SecurityCenter.originalView){d=Signavio.I18N.Views.noViewSelected;sCheckbox.suspendEvents();sCheckbox.setValue(false);sCheckbox.resumeEvents();sCheckbox.showViewWindow=true;e.ownerWindow.cacheView=undefined;sPanel.body.dom.setAttribute("style","padding-left:16px; font-style:italic; color:rgb(150, 150, 150);")}else{d=Signavio.I18N.Views.viewSelected+cacheView.selectedViewName;sCheckbox.suspendEvents();sCheckbox.setValue(true);sCheckbox.resumeEvents();sCheckbox.showViewWindow=false;sCheckbox.enable();sPanel.body.dom.setAttribute("style","padding-left:16px; color:rgb(0, 0, 0);")}}else{d=Signavio.I18N.Views.adhocViewSelected;var c=false;if(cacheView.showComments==false){c=true;d+=Signavio.I18N.Views.comments+", "}if(cacheView.showITSystem==false){c=true;d+=Signavio.I18N.Views.iTSystems+", "}if(cacheView.showDataObjects==false){c=true;d+=Signavio.I18N.Views.dataObjects+", "}if(cacheView.showRoles==false){c=true;d+=Signavio.I18N.Views.roles+", "}if(c){d=d.substring(0,d.length-2);sCheckbox.suspendEvents();sCheckbox.setValue(true);sCheckbox.resumeEvents();sCheckbox.showViewWindow=false;sPanel.body.dom.setAttribute("style","padding-left:16px; color:rgb(0, 0, 0);")}else{d=Signavio.I18N.Views.noViewSelected;sCheckbox.suspendEvents();sCheckbox.setValue(false);sCheckbox.resumeEvents();sCheckbox.showViewWindow=true;e.ownerWindow.cacheView=undefined;sPanel.body.dom.setAttribute("style","padding-left:16px; font-style:italic; color:rgb(150, 150, 150);")}}sPanel.body.update(d);sCheckbox.oldTitle=d},isSpecialIE:function(){return(Ext.isIE6||Ext.isIE7||Ext.isIE8)},fillIFrameWithView:function(f,d){var e=f.IFrameContainer;if(e.rendered&&!this.isSpecialIE()){var c=Ext.fly("iframeForView");if(!c){return}c.fadeOut({duration:0.6,remove:false})}window.setTimeout(function(){var g=e.initialConfig.html+"";if(!this.isSpecialIE()){g+=this.getWaitDiv();g+=this.getWaitDivForHidingAlternativeImage()}e.body.update(g);var h=e.body.child("iframe");var j=h.dom.contentDocument||h.dom.Document;if(!j){return}j.write(d);j.close();e.body.mask(Signavio.I18N.Views.loadPreview,"x-waiting-box")}.bind(this),500)},getWaitDivForHidingAlternativeImage:function(){return'<div id="hideAlternativeDiv" style="position:absolute;top:0;left:0; width:100%;height:100%; background-color:rgb(255,255,255);"><span> </span></div>'},getWaitDiv:function(){return'<div id="spinlockForView" style="position:absolute;top:0;left:0; width:100%;height:100%; background-color:rgb(250,250,250);opacity:0.7;"><span> </span></div>'},getCallbackMethodForLoadedFrame:function(c){if(this.isSpecialIE()){return'function(facade){window.setTimeout(function(){window.parent.Ext.getCmp("previewIFrame").body.unmask();window.parent.Signavio.Plugins.PURLSupport2.modelviewer = facade.getModelViewer();var iframeheight = window.parent.Ext.getCmp("previewIFrame").getSize().height-6;var iframewidth = window.parent.Ext.getCmp("previewIFrame").getSize().width-6;window.parent.Ext.getCmp("previewIFrame").body.child("iframe").dom.contentWindow.MOVI.widget.ModelViewer.getInstance(0).getScrollboxEl().setStyle("height", iframeheight+"px");window.parent.Ext.getCmp("previewIFrame").body.child("iframe").dom.contentWindow.MOVI.widget.ModelViewer.getInstance(0).getScrollboxEl().setStyle("width", iframewidth+"px");window.parent.Ext.getCmp("previewIFrame").body.child("iframe").dom.contentWindow.MOVI.widget.ModelViewer.getInstance(0).fitModelToViewer();window.parent.Ext.getCmp("previewIFrame").body.child("iframe").dom.contentWindow.MOVI.widget.ModelViewer.getInstance(0).getScrollboxEl().set("scrollTop",'+c+");},600);}"}else{return'function(facade){window.setTimeout(function(){window.parent.Ext.getCmp("previewIFrame").body.unmask();window.parent.Signavio.Plugins.PURLSupport2.modelviewer = facade.getModelViewer();window.parent.Signavio.Plugins.PURLSupport2.mashupIsLoaded = true;window.parent.document.getElementById("hideAlternativeDiv").setAttribute("style","display:none");window.parent.document.getElementById("spinlockForView").setAttribute("style","display:none");window.parent.Ext.getCmp("previewIFrame").body.child("iframe").dom.contentWindow.MOVI.widget.ModelViewer.getInstance(0).getScrollboxEl().set("scrollTop",'+c+');window.setTimeout(function(){window.parent.Ext.fly("iframeForView").fadeIn({duration:1.0});},200);},600);}'}},getSelectedViewPanel:function(){var c=new Ext.Panel({border:false,bodyStyle:"padding-left:16px; font-style:italic; color:rgb(150, 150, 150);",html:Signavio.I18N.Views.noViewSelected,anchor:"100%",cls:"ak-views-relative-column2"});return c},getViewHtml:function(s,m,f,d){var j=-1;if(s.oldZoomLevel){if(Signavio.Plugins.PURLSupport2.modelviewer){j=Signavio.Plugins.PURLSupport2.modelviewer.getZoomLevel()}else{j=-1}s.oldZoomLevel=j}else{s.oldZoomLevel=-1}var r=0;if(s.oldScrollTop){r=s.oldScrollTop}if(!s.IFrameContainer.rendered){return false}var c=(s.IFrameContainer.body.child("iframe").dom.contentWindow||{}).MOVI;if(c){var h=c.widget.ModelViewer.getInstance(0);if(h){s.oldScrollTop=h.getScrollboxEl().get("scrollTop")}else{s.oldScrollTop=1}}else{s.oldScrollTop=1}var q={url:this.getServer()+Signavio.Config.BACKEND_PATH+m.get("href"),zoomSlider:true,linkSubProcesses:false,mode:"simple",view:(f===Signavio.I18N.Repository.SecurityCenter.originalView)?"":f,callback:this.getCallbackMethodForLoadedFrame(r)};var e;if(!d){e=(q.view?'    view: "'+this.escapeSequences(q.view)+'",\n':"")}else{e=("    view: "+d+",\n")}var p=q.url+e;if(s.oldURL&&s.oldURL==p){return false}s.oldURL=p;q.authkeyPng="";q.authkeyJson="";q.authkeyStencilset="";var t=this.getServer()+Signavio.Config.MASHUP_URI+"/signavio.js";var g="http://www.signavio.com";if(this.isSpecialIE()){var k=""}else{var k="!important"}var n="body, .x-wrapper, .movi-scrollbox { width: 100%; height: 100% "+k+"; padding: 0; margin: 0; } a {display: none !important;}";n+=" .ak-views-zoom-margin .signavio-zoom{ margin-top: 20px !important;}";var l="<html><head><style>"+(n)+'</style></head><body class=\'ak-views-zoom-margin\'>\n<script type="text/javascript" src="'+t+'"><\/script>\n<div class="x-wrapper" id="x-wrapper"></div><script type="text/plain">\n{\n    url: "'+q.url+'",\n'+e+(q.width?"    width: "+q.width+",\n":"")+(q.height?"    height: "+q.height+",\n":"")+"zoomSlider: "+q.zoomSlider+",\n";if(j==-1){l+='	   overflowX: "fit" ,\n	   overflowY: "fit" ,\n'}else{l+="	   zoom: "+j+" ,\n"}return l+"    linkSubProcesses: "+q.linkSubProcesses+',\n    mode: "'+q.mode+'",\n	   element: "x-wrapper" ,\n	   callback: '+q.callback+"\n}\n<\/script>\n</body></html>"},getSimplifiedViewHint:function(h){var k=this;var c=h.get("rep").namespace.endsWith("bpmn2.0#"),l="",g="";if(c){l=Signavio.I18N.Views.infoButtonDescription}else{l=Signavio.I18N.Views.infoButtonDescriptionDisable}var e=' <img style="padding-top:5px" src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+l+'" class="x-info-img"/>';if(c){g="<table><tr><td>"+Signavio.I18N.Views.simplifiedViewsHint+"</td><td>"+e+"</td></tr></table>"}else{g="<table><tr><td>"+Signavio.I18N.Views.simplifiedViewsHintDisable+"</td><td>"+e+"</td></tr></table>"}var f=new Ext.Panel({html:g,border:false,anchor:"100%",cls:"ak-views-relative-column x-purl-hint",afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-simplified-view").each(function(m){Ext.get(m).on("click",function(q){Event.stop(q);var p=h.get("href")+"/adhocviews";var n=Signavio.Core.StoreManager.getRelatedStore(p,undefined,undefined,{force:true,callback:function(){k.showSimplifiedViews(f.ownerWindow,n,h)}})})})}});var j=new Ext.form.Checkbox({checked:false,style:"padding-top:5px",showViewWindow:true,disabled:!c});j.on("check",function(p,q){if(p.showViewWindow==true&&q==true){p.showViewWindow=false;var n=h.get("href")+"/adhocviews";var m=Signavio.Core.StoreManager.getRelatedStore(n,undefined,undefined,{force:true,callback:function(){this.showSimplifiedViews(f.ownerWindow,m,h)}.bind(this)})}}.bind(this));var d=new Ext.Panel({layout:"column",anchor:"100%",border:false,items:[{bodyStyle:"padding-top: 8px;padding-right:3px",border:false,items:[j]},{border:false,items:[f]}]});return d},getContentByPath:function(c){if(c===Signavio.Config.EDITOR_PATH){return{mailText:Signavio.I18N.Repository.SecurityCenter.mailDefaultWriteText,titleHTMLSingle:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.writeInfo),titleHTMLMulti:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.writeInfoMultiple),title:Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle}}if(c===Signavio.Config.SPREADSHEET_PATH){return{mailText:Signavio.I18N.Repository.SecurityCenter.mailSpreadsheetDefaultWriteText,titleHTMLSingle:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.writeSpreadsheetInfo),titleHTMLMulti:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.writeSpreadsheetInfoMultiple),title:Signavio.I18N.Repository.SecurityCenter.Offer.writeSpreadsheetTitle}}return{mailText:"",titleHTMLSingle:new Ext.XTemplate("{name}"),titleHTMLMulti:new Ext.XTemplate("{count}"),text:""}},showWriteAccessWindow:function(q){var l;var c=(this.getSelection()||[]).findAll(function(s){return s.get("rel")=="mod"});if(c.length<=0){return}var f=this.getContentByPath(q);var n=this;var m;if(q===Signavio.Config.EDITOR_PATH){var j=Signavio.Config.ALL_LICENSES.without(Signavio.Config.QUICKMODEL_LICENSE);m=function(r){return(r.data.rep.licenses||[]).any(function(s){return j.include(s)})}}else{m=function(r){return true}}var k=new b({userStore:Signavio.Core.StoreManager.getAllUserStore(),text:f.mailText+this.facade.getCurrentUser().getRecords("info")[0].data.rep.name+"\n",filterFn:m},false,true);var p=new Ext.Panel({html:this.facade.isCurrentUserAdmin()?Signavio.I18N.Repository.SecurityCenter.Hint.addUser:Signavio.I18N.Repository.SecurityCenter.Hint.addUserNoAdmin,border:false,anchor:"100%",hidden:!Signavio.Config.SHOW_LICENSE,bodyStyle:"padding-top:10px;",afterRender:function(r){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-add-user").each(function(s){Ext.get(s).on("click",function(t){Event.stop(t);l.close();n.facade.showAdministrationPanel(0)})})}});var e="";if(c.length==1){e=f.titleHTMLSingle.apply({name:c[0].get("rep").name||c[0].get("rep").title})}else{e=f.titleHTMLMulti.apply({count:c.length})}var h=new Ext.Panel({html:e+" "+this.info(Signavio.I18N.Repository.SecurityCenter.writeInfoDesc),border:false,anchor:"100%"});var d=new Ext.form.FormPanel({hideLabels:true,border:false,layout:"anchor",items:[h,p,k]});var g=function(){if(!h.el||!p.el){return}var s=l.el.getHeight();var r=h.el.getHeight()+p.el.getHeight()+105;k.setHeight(s-r)};l=new Ext.ux.Window({title:f.title,cls:"x-window-security-center",items:[d],modal:true,width:600,minWidth:600,height:410,minHeight:350,layout:"fit",listeners:{resize:g,show:g},buttons:[{text:Signavio.I18N.Repository.SecurityCenter.Button.ok,handler:function(r){r.disable();var s=k.getMailAddresses();if(k.includeCopy()){var t=this.facade.getCurrentUser().getRecords(Signavio.Const.REL.INFO)[0].get("rep").mail;s.push(t)}if(s.length<=0){this.alert(Signavio.I18N.Repository.SecurityCenter.Hint.oneReceiverMustDefined,f.title);r.enable();return}this.sendNotification(c.pluck("data").pluck("href"),s,k.getMailText(),q,[function(u){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle,Signavio.I18N.Repository.SecurityCenter.SendInvitations,function(){r.setText(Signavio.I18N.Repository.SecurityCenter.sent);l.close()}.bind(this)).setIcon(Ext.Msg.INFO).getDialog().syncSize()}.bind(this),function(){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle,Signavio.I18N.Repository.SecurityCenter.Offer.writeError,function(){r.enable()}.bind(this)).setIcon(Ext.Msg.WARNING).getDialog().syncSize()}])}.bind(this)}]});l.show()},generatePURLPanel:function(){var c=this;return new Ext.Panel({cls:"x-div-textbackground",autoScroll:true,anchor:"100%",beginUpdate:function(){this.el.addClass("x-loading")},update:function(d){var e=false;(this.items||[]).each(function(f){this.remove(f)}.bind(this));d.getRecords(Signavio.Const.REL.PURL).each(function(f){if([Signavio.Const.PURL.DISCUSSION,Signavio.Const.PURL.ANALYTICS_PAYLOAD,Signavio.Const.PURL.ANALYTICS_INSTANCES].include(f.get("rep").type)){this.add(c.generateManageEntryPanel(f));e=true}}.bind(this));if(!e){this.add(new Ext.Panel({border:false,cls:"x-window-security-center-manage-entry x-empty",html:Signavio.I18N.Repository.SecurityCenter.manageEmpty}))}this.doLayout();this.el.removeClass("x-loading")}})},showManageWindow:function(d){var h;if(!(d instanceof Ext.data.Record)){d=this.getSelection()[0]}if(!(d instanceof Ext.data.Record)){return}var f=d.get("rep");d=d.get("href").split("/").last();var j=new Ext.Panel({html:new Ext.XTemplate(Signavio.I18N.Repository.SecurityCenter.manageInfo).apply({name:f.name||f.title})+" "+this.info(Signavio.I18N.Repository.SecurityCenter.manageInfoDesc),anchor:"100%",border:false,style:"padding-bottom:10px;"});var e=this.generatePURLPanel();var g=this;var c=Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.PRIVATE_URL_PATH+"/"+d,undefined,undefined,{force:true,callback:function(){e.update(c)}.bind(this)});c.on("remove",function(m,l){e.items.each(function(n){if(n.record==l){e.remove(n);if(e.items.length<=0){e.add(new Ext.Panel({border:false,cls:"x-window-security-center-manage-entry x-empty",html:Signavio.I18N.Repository.SecurityCenter.manageEmpty}))}}});e.doLayout()});c.on("add",function(m,l){l=l instanceof Array?l:[l];l.each(function(n){if([Signavio.Const.PURL.DISCUSSION,Signavio.Const.PURL.ANALYTICS_PAYLOAD,Signavio.Const.PURL.ANALYTICS_INSTANCES].include(n.get("rep").type)){e.add(this.generateManageEntryPanel(n))}}.bind(this));e.doLayout()}.bind(this));var k=function(){if(!j.el||!e.el){return}var m=h.el.getHeight();var l=j.el.getHeight()+90;e.setHeight(m-l)};h=new Ext.Window({title:Signavio.I18N.Repository.SecurityCenter.Offer.manageTitle,cls:"x-window-security-center",bodyStyle:"padding:10px;background:white;",items:[j,e],modal:true,width:520,minWidth:420,height:410,minHeight:350,layout:"anchor",listeners:{resize:k,show:k},buttons:[{text:Signavio.I18N.Repository.SecurityCenter.Button.close,handler:function(){this.ownerCt.close()}}]});h.show()},generateManageEntryPanel:function(d,h){var g=d.get("rep").type,e,f="<span>"+(d.get("rep").label||Signavio.I18N.Repository.SecurityCenter.Hint[g]||g)+"</span>",c='<a href="#" class="x-remove-entry">'+Signavio.I18N.Repository.SecurityCenter.manageRemove+"</a>";if(g==Signavio.Const.PURL.PNG){e="picture.png"}else{if(g==Signavio.Const.PURL.JSON){e="table.png"}else{if(g==Signavio.Const.PURL.ANALYTICS_PAYLOAD){e="chart_group.png"}else{if(g==Signavio.Const.PURL.ANALYTICS_INSTANCES){e="chart_user.png"}else{e="comments.png"}}}}e='<img src="'+Signavio.Config.IMAGE_PATH+"/famfamfam/"+e+'" />';return new Ext.Panel({html:e+" "+f+" "+c,cls:"x-window-security-center-manage-entry",record:d,border:false,afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-remove-entry").each(function(j){j=Ext.get(j);var k=function(l){Event.stop(l);Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.removeInvitationTitle,Signavio.I18N.Repository.SecurityCenter.removeInvitationDesc,function(m,n){if(m==="yes"){j.un("click",k);j.addClass("x-disabled");if(d.store){d.store.remove(d,true)}}})};j.on("mouseover",j.addClass.bind(j,"x-hover"));j.on("mouseout",j.removeClass.bind(j,"x-hover"));j.on("click",k)})}})},generateLink:function(d,e,h,g,c,j){if(c){var f={sbo:d,label:"",type:e,mails:h,message:g||"",view:c}}else{var f={sbo:d,label:"",type:e,mails:h,message:g||""}}Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.PRIVATE_URL_PATH,function(k){j(k)},f)},generateLinks:function(k,e,d,h,g,c,j){if(c){var f={models:k,directories:e,label:"",type:d,mails:h,message:g||"",view:c}}else{var f={models:k,directories:e,label:"",type:d,mails:h,message:g||""}}Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.PRIVATE_URL_PATH,function(l){j(l)},f)},getManageDialogHint:function(d,f,c){var e=this;var g=f?f:Signavio.I18N.Repository.SecurityCenter.writeInfoManage;return new Ext.Panel({html:g,border:false,anchor:"100%",style:c?"padding-top:18px;":"",afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);var h=this.ownerCt;while(h&&!(h instanceof Ext.Window)){h=h.ownerCt}this.el.query("a.x-manage-access").each(function(j){Ext.get(j).on("click",function(k){if(h){h.close()}if(d){e.showManageWindow(d)}Event.stop(k)})})}})},sendNotification:function(h,g,e,c,f){var d={users:g,message:e||"",models:h,path:c};Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.MAIL_PATH,f,d)},isModel:function(c){return c.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(c){return c.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(c){return this.facade.getTrashRecord()&&c.get("href")==this.facade.getTrashRecord().get("href")},isInternalFolder:function(c){return c.get("rep").type=="internal"},alert:function(d,c){Ext.Msg.show({title:c||Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,msg:d,buttons:Ext.Msg.OK,animEl:"elId",icon:Ext.MessageBox.INFO})},info:function(c){return' <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+c+'" class="x-info-img"/>'},getCurrentModel:function(){return this.getSelection().length==1?this.getSelection()[0].get("href"):undefined},getServer:function(){return window.location.protocol+"//"+window.location.host},getUri:function(c){return this.getServer()+""+c.get("rep").uri+"&authkey="+c.get("rep").authkey}};Signavio.Plugins.PURLSupport2=Signavio.Core.ContextPlugin.extend(Signavio.Plugins.PURLSupport2);var a=function(c){c=c||{};this.input=new Ext.form.TextField({emptyText:Signavio.I18N.Repository.SecurityCenter.linkInputText,readOnly:true,selectOnFocus:true,anchor:"-80",style:"display:inline;"});this.generate=new Ext.LinkButton({text:Signavio.I18N.Repository.SecurityCenter.Button.generate,click:function(){this.onGenerate()}.bind(this),style:"display:inline;margin-left:8px;padding:2px;"});this.remove=new Ext.LinkButton({text:Signavio.I18N.Repository.SecurityCenter.Button.remove,hidden:true,click:function(){this.onRemove()}.bind(this),style:"display:inline;margin-left:8px;padding:2px;"});c.items=[this.input,this.generate,this.reset,this.remove].compact();a.superclass.constructor.call(this,c)};Ext.extend(a,Ext.Panel,{anchor:"100%",layout:"anchor",border:false,onGenerate:function(){},onReset:function(){},onRemove:function(){},onRender:function(){a.superclass.onRender.apply(this,arguments);if(this.reset){this.reset.setVisible(false)}if(this.remove){this.remove.setVisible(false)}},setValue:function(d,c){this.input.setValue.apply(this.input,arguments);if(this.generate){this.generate.setVisible(!d)}if(this.reset){this.reset.setVisible(d)}if(this.remove){this.remove.setVisible(d)}if(c==true){window.setTimeout(function(){this.input.focus(true)}.bind(this),10)}},getValue:function(){return this.input.getValue()}});var b=function(j,m,e){var l=this;m=!!m;e=!!e;j=j||{};var p=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.mailTitleText});var n=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.textTitleText});this.notification=new Ext.form.TextArea({emptyText:Signavio.I18N.Repository.SecurityCenter.mailTextEmptyText,value:j.text||undefined,anchor:"100% -14"});this.check=new Ext.form.Checkbox({checked:m,boxLabel:Signavio.I18N.Repository.SecurityCenter.addSender});this.mail=new Ext.form.TextArea({emptyText:Signavio.I18N.Repository.SecurityCenter.mailAddressEmptyText,anchor:"100% -32",maxHeight:200,validator:function(q){if(q){var r=this.parseMailAddresses(q);if(r.any(function(s){return !this.isMail(s)}.bind(this))){return Signavio.I18N.Repository.SecurityCenter.invalidMail}}return true}.bind(this)});var h;var g=false;if(j.userStore&&j.userStore instanceof Signavio.Core.DataStore){this.users=new Ext.Panel({border:true,autoScroll:true,cls:"x-div-textbackground x-waiting-panel",anchor:"100% -29",listeners:{render:function(){this.users.el.mask()}.bind(this)}});var d=function(){var r=h.el.child(".y-write-access-count");if(r){var q=0;j.userStore.getRecords().each(function(s){if(s.get("rep").isSelected===true){q+=1}});r.update(q+Signavio.I18N.Repository.SecurityCenter.select)}};var k=this.users;var c;j.userStore.on("load",function(){window.setTimeout(function(){g=j.userStore.getTotalCount()>Signavio.Config.MIN_USERS_FOR_INVITE_TO_EDIT;if(g===true&&Ext.isDefined(c)&&Ext.isDefined(c.el)&&c.el.hasClass("y-security-center-visible-tools")===false){c.el.addClass("y-security-center-visible-tools");delete k.anchorSpec;k.anchor="100% -36";k.ownerCt.doLayout();c.fireEvent("resize",c)}if(Ext.isDefined(k.items)){k.items.each(function(r){k.remove(r)})}var q=l.sortingDirection;j.userStore.data.sort(q||"ASC",Signavio.Utils.BusinessObjectSortingFunction);j.userStore.each(function(r){if((r.get("rep").licenses||[]).indexOf(Signavio.Config.API_ACCESS_LICENSE)<0){if(!j.filterFn||j.filterFn.call(this,r)){k.add(new Ext.form.Checkbox({checked:r.get("rep").isSelected||false,boxLabel:r.get("rep").name||r.get("rep").title,record:r,listeners:{check:function(s,t){s.record.get("rep").isSelected=t;d()}}}))}}});if(k.items.length===0){k.add(new Ext.form.Checkbox({checked:false,disabled:true,boxLabel:'<i style="color:silver;">'+Signavio.I18N.Repository.SecurityCenter.noUser+"</i>"}))}k.doLayout();k.el.unmask();d()},500)});h=new Ext.Panel({html:Signavio.I18N.Repository.SecurityCenter.Span.selectionCount+" "+Signavio.I18N.Repository.SecurityCenter.Button.selectAll+" "+Signavio.I18N.Repository.SecurityCenter.Button.deselectAll,border:false,cls:"y-select-link-container",bodyStyle:"white-space:nowrap",afterRender:function(){Ext.Panel.prototype.afterRender.apply(this,arguments);this.el.query("a.x-link-select-all").each(function(q){Ext.get(q).on("click",function(r){Event.stop(r);k.items.each(function(s){s.setValue(true)});d()})});this.el.query("a.x-link-deselect-all").each(function(q){Ext.get(q).on("click",function(r){Event.stop(r);k.items.each(function(s){s.setValue(false)});d()})})}});p=new Ext.form.Label({text:Signavio.I18N.Repository.SecurityCenter.userTitleText})}var f=[this.users,h];if(e===true){c=new Ext.Panel({border:false,anchor:"-50",cls:"ak-security-center-mail-list-tools",listeners:{resize:function(r){var s=r.el.getWidth();var q=r.el.child(".ak-security-center-mail-search-input");if(q){q.setWidth(s-20)}},destroy:function(){j.userStore.getRecords().each(function(q){delete q.get("rep").isSelected})},render:function(q){var u=q.body;if(u){var v,w="";var y=document.createElement("div");y.className="ak-security-center-mail-search-container";u.appendChild(y);var z=document.createElement("img");if(Ext.isIE6){z.setAttribute("src",Signavio.Config.IMAGE_PATH+"/signavio/s.gif");$(z).setStyle("filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Signavio.Config.IMAGE_PATH+"/fugue/icons/cross-small.png',sizingMethod='image');background:none !important; margin-top: -1px;")}else{z.setAttribute("src",Signavio.Config.IMAGE_PATH+"/fugue/icons/cross-small.png");z.style.marginTop="-1px"}var t=document.createElement("a");t.appendChild(z);t.className="ak-security-center-mail-search-input-cross";Ext.get(t).on("click",function(A){v.setValue("");Ext.get(t).hide()});y.appendChild(t);Ext.get(t).hide();v=new Ext.form.TextField({emptyText:Signavio.I18N.Repository.SecurityCenter.filterUser,cls:"ak-security-center-mail-search-input",renderTo:Ext.get(y)});var x=function(A){if(A===w){return}k.el.mask();var B=A.toLowerCase().match(/[a-z0-9%F6%E4%FC%DF:]*/ig).filter(function(C){return !!C});j.userStore.filterBy(function(C){var D=C.get("rep");return D&&B.all(function(E){return(D.company||"").toLowerCase().include(E)||(D.name||"").toLowerCase().include(E)})});j.userStore.fireEvent("load");w=A};v.on("valid",function(B){var A=B.getValue()||"";x(A);if(A.trim()===""){Ext.get(t).hide()}else{Ext.get(t).show()}});var r=function(C,B){var E=Ext.get(B);var D=E.hasClass("ak-list-sort-ascending")?"DESC":"ASC";if(Ext.isDefined(k.items)===false){return}if(k.items.length<=1){E.toggleClass("ak-list-sort-ascending");E.toggleClass("ak-list-sort-descending");l.sortingDirection=D;return}k.el.mask();if(k.items.length>1){l.sortingDirection=D;j.userStore.fireEvent("datachanged",j.userStore);j.userStore.fireEvent("load")}E.toggleClass("ak-list-sort-ascending");E.toggleClass("ak-list-sort-descending");var A=(D==="ASC")?Signavio.I18N.Repository.SecurityCenter.sortAscending:Signavio.I18N.Repository.SecurityCenter.sortDescending;if(Ext.isIE8===false){E.dom.setAttributeNS(null,"title",A)}else{E.dom.setAttribute("title",A)}};var s=document.createElement("div");s.className="ak-security-center-mail-sort-button ak-list-sort-ascending";Ext.get(s).on("click",r);y.appendChild(s)}}}});f=[c,this.users,h]}j.items=[new Ext.Panel({items:[p,this.users?f:[this.mail,this.check]].flatten(),layout:"anchor",style:"position:relative;left:-5px;",cls:"x-window-security-center-mail",border:false,width:200,height:150,columnWidth:0.5}),new Ext.Panel({items:[n,this.notification],layout:"anchor",border:false,width:200,height:150,columnWidth:0.5})];b.superclass.constructor.call(this,j)};Ext.extend(b,Ext.Panel,{bodyStyle:"padding:0px 0px 0px 5px; margin:10px 0px 10px 0px;",border:false,anchor:"100%",layout:"column",isMail:function(c){return !c||!!c.match(Signavio.Const.MAIL_VALIDATOR)},setHeight:function(c){b.superclass.setHeight.apply(this,arguments);if(this.users&&this.users.ownerCt.el){this.users.ownerCt.setHeight(c-(5+(this.buttons&&this.buttons.length>0?40:0)))}if(this.notification&&this.notification.ownerCt&&this.notification.ownerCt.el){this.notification.ownerCt.setHeight(c-(5+(this.buttons&&this.buttons.length>0?40:0)))}if(this.mail&&this.mail.ownerCt&&this.mail.ownerCt.el){this.mail.ownerCt.setHeight(c-(5+(this.buttons&&this.buttons.length>0?40:0)))}},parseMailAddresses:function(c){return c.replace(/[,;\n]/g,";").replace(/;+/g,";").replace(/ /g,"").split(";").map(function(d){return d.replace(/.*<([\w\.\-+%]+@[\w\.\-+]+.[a-zA-Z]{2,4})>.*/g,"$1")}).uniq().findAll(function(d){return d&&this.isMail(d)}.bind(this))},enable:function(){b.superclass.enable.apply(this,arguments);this.check.enable()},disable:function(){b.superclass.disable.apply(this,arguments);this.check.disable()},includeCopy:function(){return this.check.checked},getMailAddresses:function(){return this.users?this.users.items.items.map(function(d){return d.checked&&d.record?d.record.get("href"):undefined}).compact():this.parseMailAddresses(this.mail.getValue())},getMailText:function(){return this.notification.getValue().trim()||undefined}})})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.EnableCommentBubblesForModels={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);Signavio.Config.ShowCommentBubblesForModels=true}};Signavio.Plugins.EnableCommentBubblesForModels=Signavio.Core.Plugin.extend(Signavio.Plugins.EnableCommentBubblesForModels)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var d=Signavio.I18N.Repository.SecurityCenter.NPBExchange;var g=Signavio.Core.Stores.RequestManager;var b={NO_MODEL:"noModel",NO_UPDATE:"noUpdate",UPDATE_AVAILABLE:"updateAvailable",UNSUPPORTED_MODEL:"unsupportedModel"};var a={UPDATE_CONFLICT:"xpr:UpdateKonflikt",MISC:"xpr:SonstigerFehler",MISSING_META:"xpr:FehlendeMetaInformation",WRONG_META:"xpr:FehlerInMetaInformation",TOKEN_ERROR:"tokenError",UPDATE_ERROR:"updateError",DOWNLOAD_ERROR:"downloadError",MISSING_MODEL_ID:"missingModelId"};var f={CREATE:"create",OVERWRITE:"overwrite"};var e=["OE","PR","SP","OG"];var c=function(j,h){c.superclass.constructor.call(this,j);h.on("activate",function(){this.show();this.container.removeClass("cw-npb-button-hidden")}.bind(this));h.on("deactivate",function(){this.hide();this.container.addClass("cw-npb-button-hidden")}.bind(this))};Ext.extend(c,Ext.Button,{hidden:true,ctCls:"cw-npb-button-hidden"});Signavio.Plugins.NPBExchange={enabled:true,updateStatus:null,buttons:[],construct:function(){arguments.callee.$.construct.apply(this,arguments);var j=function(){return this.getSelection().length>1||this.getSelection().length===1&&(this.getSelection()[0].get("rel")!="mod"||(this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn1.1#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/epc#"))}.bind(this);var k=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var h=function(){return !j.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.facade.offer({relGroup:"scenter",name:d.dialogTitle,description:d.dialogDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_go.png",functionality:this.showDialog.bind(this),index:51,isDisabled:function(){return !h()},isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)});this.facade.offer({name:d.userGuideTitle,description:d.userGuideDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png",relGroup:"help",arrange:"right",index:20,functionality:this.showUserGuide.bind(this),seperated:true})},showUserGuide:function(){var h=(Signavio.I18N.Language.toLowerCase().startsWith("de"))?Signavio.Config.NPB_USER_GUIDE_DE:Signavio.Config.NPB_USER_GUIDE;Signavio.Helper.openIFramePanel(h,d.userGuideTitle)},showDialog:function(){var j=this.facade.getCurrentUser();var h=this.getSelection().length===1;var k=this.facade.getCurrentFolderStore()&&this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE);this.buttons=[];this.updateStatus=null;g.doGet(Signavio.Config.BACKEND_PATH+j.id+Signavio.Config.NPB_OAUTH_PATH,[function(n){var p=n!==null&&typeof n.rep==="object"&&n.rep.token!=="type.access";var m=function(s){var r=s!==null&&typeof s.rep==="object"?s.rep:null;var q=new Ext.ux.Window({autoCreate:true,bodyStyle:"background-color: white;",title:d.dialogTitle,width:450,height:318,modal:true,resizable:false,items:[new Ext.TabPanel({cls:"x-window-security-center",layoutOnTabChange:true,border:false,bodyStyle:"background-color: white; padding: 10px;",activeTab:p?3:!h?1:r!==null&&r.hasRef?2:0,items:[this.getUploadPanel(p,h,r),this.getDownloadPanel(p,k),this.getUpdatePanel(p,h,k,r),this.getOAuthPanel(p)]})],buttons:this.buttons});q.show()}.bind(this);if(p||!h){m(null)}else{var l=this.getSelection()[0].get("href");Signavio.Core.Stores.RequestManager.doGet(Signavio.Config.BACKEND_PATH+l+Signavio.Config.NPB_UPLOAD_PATH,m,{})}}.bind(this),function(l){Ext.MessageBox.alert(d.Errors.generalErrorTitle,d.Errors.generalErrorDesc).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}],{})},showWaitMsg:function(h){this.hideWaitMsg();this.waiting=Ext.Msg.wait(Ext.isDefined(h)?h:"",d.waitTitle)},hideWaitMsg:function(h){if(Ext.isDefined(this.waiting)){this.waiting.hide()}},getLanguages:function(){var h=(this.facade.getConfig("department","languages")||"[]").evalJSON(true)||[];if(!h||h.length<=1){h=[]}return h},getUploadPanel:function(p,A,s){var t=this.getLanguages();var z,k;if(A&&s!==null){var y=this.getSelection()[0].get("href").split("/");var m=Signavio.Config.BACKEND_PATH+Signavio.Config.EDITOR_PATH+"?id="+y[y.length-1];z={general:d.uploadDesc,info:s.hasRef?d.oldVersionExists:d.noVersionExists,valid:!s.isNPBModel||!s.hasValidMeta?new Ext.XTemplate(d.addMissingAttributes).apply({url:m}):""};k=Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+Signavio.Config.NPB_UPLOAD_PATH}else{z={general:"",info:"",valid:""};k=""}var x=[];x.push([d.oldVersionExistsCreate,f.CREATE]);if(s!==null&&s.hasRef){x.push([d.oldVersionExistsOverwrite,f.OVERWRITE])}var l=new Ext.ux.form.RadioGroup({fieldLabel:d.options,layout:"form",cls:"cw-npb-choices",store:new Ext.ux.form.ChoiceStore({choices:x}),values:[f.CREATE]});var u=new Ext.ux.form.ComboBox({anchor:"100%",readOnly:true,fieldLabel:d.clearanceLevel,store:new Ext.ux.form.ChoiceStore({choices:e.map(function(B){return[d.ClearanceLevel[B],B]})}),value:e[1],mode:"local",listClass:"x-combo-list-wrap"});var w=[l,u];var j=null;if(t.length>1){j=Signavio.Utils.getLangaugeSelector(t,{value:t.first().rel,fieldLabel:Signavio.I18N.Repository.ProcessDocu.languageFieldLabel,anchor:"100%",suppressGroups:true});w.push(j)}var n=new Ext.form.FormPanel({border:false,cls:"cw-npb-panel",disabled:s!==null&&!s.hasValidMeta,items:w});var v=new Ext.Panel({autoHeight:true,border:false,title:d.tabUploadTitle,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:new Ext.XTemplate('<div class="cw-npb-desc">{general}</div><div <tpl if="valid.length &gt; 0">class="cw-npb-desc"</tpl>>{info}</div><div>{valid}</div>').apply(z)}),n],disabled:p||!A});var h;var q=this;var r=function(){h.click=Ext.emptyFn;q.showWaitMsg(d.waitUpload);var B={uploadCmd:l.getValue().length>0?l.getValue()[0]:l.getValue(),clearanceLevel:u.getValue()};if(j!==null){B.language=j.getValue()}g.doPost(k,[function(D){q.hideWaitMsg();if(typeof D==="object"&&Ext.isDefined(D.rep.link)){var C=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:d.uploadSuccessDialogTitle,width:400,modal:true,resizable:false,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:new Ext.XTemplate('<div class="cw-npb-desc">{desc}</div><div><a href="{url}" target="blank">{link}</a></div>').apply({desc:d.uploadSuccessDialogDesc,url:D.rep.link,link:d.uploadDialogSuccessDialogLink})})]});C.show()}v.ownerCt.ownerCt.close();h.click=r},function(H){q.hideWaitMsg();var G="";if(Ext.isDefined(H.errors)){var C=H.errors.find(function(I){return I.type===a.MISC});var F=H.errors.any(function(I){return I.type===a.UPDATE_CONFLICT});var D=H.errors.any(function(I){return I.type===a.TOKEN_ERROR});var E=H.errors.any(function(I){return(I.type===a.MISSING_META||I.type===a.WRONG_META)&&I.details==="administrativeService"});if(Ext.isDefined(C)){if(C.lacksWriteRights||C.modelDoesNotExist){G=C.lacksWriteRights?d.Errors.lacksWriteRights:d.Errors.uploadDoesNotExist;l.check(f.CREATE);l.disable(f.OVERWRITE)}else{if(C.wrongUserOrPassword){G=d.Errors.createNewToken}else{G=d.Errors.uploadUnknownError;v.ownerCt.ownerCt.close()}}}else{if(F){G=d.Errors.newRevision}else{if(D){G=d.Errors.createNewToken}else{if(E){G=d.Errors.leikaNotAccepted}else{G=d.Errors.uploadUnknownError;v.ownerCt.ownerCt.close()}}}}}else{G=d.Errors.uploadUnknownError;v.ownerCt.ownerCt.close()}Ext.MessageBox.alert(d.Errors.uploadErrorTitle,G).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize();h.click=r}],B)};h=new c({text:d.uploadBtn,disabled:p||!A||(s!==null&&(!s.isNPBModel||!s.hasValidMeta)),handler:r},v);this.buttons.push(h);return v},getDownloadPanel:function(m,l){var h=new Ext.Panel({autoHeight:true,border:false,disabled:m||!l,title:d.tabDownloadTitle,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:"<div>"+d.downloadDesc+"</div>"}),new Ext.form.FormPanel({cls:"cw-npb-panel",border:false,items:[new Ext.form.TextField({anchor:"100%",fieldLabel:d.downloadLabel})]})]});var j;var k=this;var n=function(){j.click=Ext.emptyFn;k.showWaitMsg(d.waitDownload);var p=h.items.items[1].items.items[0].getValue();if(Ext.isDefined(p)&&p.length>0){g.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.NPB_DOWNLOAD_PATH,[function(q){k.hideWaitMsg();if(Ext.isDefined(q.rep.imported)&&q.rep.imported==="image"){Ext.MessageBox.alert(d.Errors.onlyImageTitle,d.Errors.onlyImage).setIcon(Ext.MessageBox.INFO).getDialog().syncSize()}h.ownerCt.ownerCt.close();Signavio.Core.StoreManager.reloadChildEntitiesStore();j.click=n},function(v){k.hideWaitMsg();var u="";if(typeof v==="object"&&Ext.isDefined(v.errors)){var t=v.errors.any(function(w){return w.type===a.MISSING_MODEL_ID||(w.type===a.MISC&&w.modelDoesNotExist)});var r=v.errors.any(function(w){return w.type===a.MISC&&w.lacksReadRights});var s=v.errors.any(function(w){return w.type===a.TOKEN_ERROR||(w.type===a.MISC&&w.wrongUserOrPassword)});var q=v.errors.find(function(w){return w.type===a.DOWNLOAD_ERROR});if(t){u=d.Errors.missingModelId;h.items.items[1].items.items[0].selectText()}else{if(r){u=d.Errors.lacksReadRights;h.items.items[1].items.items[0].selectText()}else{if(s){u=d.Errors.createNewToken}else{if(Ext.isDefined(q)){u=d.Errors[q.details];h.ownerCt.ownerCt.close()}else{u=d.Errors.downloadUnknownError;h.ownerCt.ownerCt.close()}}}}}else{u=d.Errors.downloadUnknownError;h.ownerCt.ownerCt.close()}Ext.MessageBox.alert(d.Errors.downloadErrorTitle,u).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize();j.click=n}],{modelId:p,directory:Signavio.Core.StoreManager.getStore("child").lastOptions.id})}};j=new c({disabled:m||!l,text:d.downloadBtn,handler:n},h);this.buttons.push(j);return h},getUpdatePanel:function(k,t,j,r){var s;var m;var l=t?Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+Signavio.Config.NPB_UPDATE_PATH:"";var u=new Ext.Panel({cls:"cw-npb-panel-optional",hidden:true,border:false,html:""});var n=this;var p=function(){s.click=Ext.emptyFn;n.showWaitMsg(d.waitUpdateCheck);g.doGet(l,[function(w){n.hideWaitMsg();if(typeof w==="object"){if(Ext.isDefined(w.rep.status)){this.updateStatus=w.rep.status;if(this.updateStatus===b.UPDATE_AVAILABLE){m.enable()}else{m.disable()}var v=Ext.isDefined(d.UpdateStatus[w.rep.status])?d.UpdateStatus[w.rep.status]:d.UpdateStatus[b.NO_MODEL];u.body.update(v);u.show()}else{u.hide()}}else{u.hide()}s.click=p}.bind(this),function(A){n.hideWaitMsg();var z="";if(Ext.isDefined(A.errors)){var w=A.errors.any(function(B){return B.type===a.MISC&&B.lacksReadRights});var y=A.errors.any(function(B){return B.type===a.MISC&&B.modelDoesNotExist});var x=A.errors.any(function(B){return B.type===a.TOKEN_ERROR||(a.MISC&&B.wrongUserOrPassword)});var v=A.errors.find(function(B){return B.type===a.DOWNLOAD_ERROR});if(w){z=d.Errors.updateLacksReadRights}else{if(y){z=d.Errors.updateDoesNotExist}else{if(x){z=d.Errors.createNewToken}else{if(v){z=d.Errors[v.details]}else{z=d.Errors.updateUnknownError}}}}}else{z=d.Errors.updateUnknownError}Ext.MessageBox.alert(d.Errors.updateErrorTitle,z).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize();m.disable();u.hide();this.updateStatus=null;s.click=p}.bind(this)],{})}.bind(this);s=new Ext.LinkButton({text:d.checkForUpdateLink,click:p});var h=new Ext.Panel({border:false,autoHeight:true,title:d.tabUpdateTitle,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:new Ext.XTemplate('<div><div class="cw-npb-desc">{desc}</div><a href="{processLink}" target="_blank">{processLinkTitle}</a></div>').apply({desc:d.updateDesc,processLinkTitle:d.updateProcessLink,processLink:r!==null?r.link:""})}),s,u],disabled:k||!t||!j||!r.hasRef});var q=function(){m.click=Ext.emptyFn;n.showWaitMsg(d.waitUpdate);g.doPost(l,[function(v){n.hideWaitMsg();h.ownerCt.ownerCt.close();Signavio.Core.StoreManager.reloadChildEntitiesStore()},function(B){n.hideWaitMsg();var A="";if(Ext.isDefined(B.errors)){var w=B.errors.any(function(C){return C.type===a.MISC&&C.lacksReadRights});var z=B.errors.any(function(C){return C.type===a.MISC&&C.modelDoesNotExist});var x=B.errors.any(function(C){return C.type===a.TOKEN_ERROR||(a.MISC&&C.wrongUserOrPassword)});var y=B.errors.any(function(C){return C.type===a.UPDATE_ERROR&&C.details===b.UNSUPPORTED_MODEL});var v=B.errors.find(function(C){return C.type===a.DOWNLOAD_ERROR});if(w||z){A=w?d.Errors.updateLacksReadRights:d.Errors.updateDoesNotExist;h.ownerCt.ownerCt.close()}else{if(x){A=d.Errors.createNewToken;m.click=q}else{if(y){A=d.Errors.updateUnsupportedDiagram;h.ownerCt.ownerCt.close()}else{if(v){A=d.Errors[v.details];h.ownerCt.ownerCt.close()}else{A=d.Errors.updateUnknownError;h.ownerCt.ownerCt.close()}}}}}else{A=d.Errors.updateUnknownError;h.ownerCt.ownerCt.close()}Ext.MessageBox.alert(d.Errors.updateErrorTitle,A).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}],{})};m=new c({disabled:k||!t||!j||!r.hasRef||this.updateStatus!==b.UPDATE_AVAILABLE,text:d.updateBtn,handler:q},h);this.buttons.push(m);return h},getOAuthPanel:function(k){var j=this.facade.getCurrentUser();var h;var l=k?function(){Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+j.id+Signavio.Config.NPB_OAUTH_PATH,[function(m){var n=m!==null&&typeof m==="object"?m.href:null;var p=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:d.OAuthCreateTokenDialogTitle,width:400,modal:true,resizable:false,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:new Ext.XTemplate('<div class="cw-npb-desc">{desc}</div><div><a href="{url}">{link}</a></div>').apply({desc:d.OAuthCreateTokenDialogDesc,url:n,link:d.OAuthCreateTokenDialogLink})})]});p.show()},function(m){Ext.MessageBox.alert(d.Errors.oauthErrorTitle,d.Errors.oauthErrorDesc).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize();h.ownerCt.ownerCt.close()}],{})}:function(){Ext.Msg.confirm(d.OAuthDeleteTokenDialogTitle,d.OAuthDeleteTokenDialogDesc,function(m){if(m==="yes"){Signavio.Core.Stores.RequestManager.doDelete(Signavio.Config.BACKEND_PATH+j.id+Signavio.Config.NPB_OAUTH_PATH);h.ownerCt.ownerCt.close()}},this)}.bind(this);h=new Ext.Panel({autoHeight:true,border:false,title:d.tabOAuthTitle,items:[new Ext.Panel({cls:"cw-npb-panel",border:false,html:new Ext.XTemplate('<div class="cw-npb-desc">{desc}</div><div>{status}</div>').apply({desc:d.OAuthDesc,status:d[k?"OAuthTokenExistsNot":"OAuthTokenExists"]})}),new Ext.LinkButton({text:d[k?"OAuthCreateToken":"OAuthDeleteToken"],click:l})]});return h}};Signavio.Plugins.NPBExchange=Signavio.Core.Plugin.extend(Signavio.Plugins.NPBExchange)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.EnableIksMetaData={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);if(Signavio&&Signavio.Const&&Signavio.Const.META_TYPES&&Signavio.Const.META_TYPES.STENCILSET instanceof Array){Signavio.Const.META_TYPES.STENCILSET.push({type:"MetaDataIks",asList:false})}}};Signavio.Plugins.EnableIksMetaData=Signavio.Core.Plugin.extend(Signavio.Plugins.EnableIksMetaData)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var NEGATIVE_INFINITY=NEGATIVE_INFINITY;var POSITIVE_INFINITY=POSITIVE_INFINITY;var I18N=Signavio.I18N.Repository.MetaData;var CONFIG=Signavio.Config;var GLOSSARY_ROOT="/glossarycategory/";var CORE_CATEGORIES=[];var TYPE_UNGROUPED="ungrouped";var TYPE_GROUPED="grouped";var TYPE_DEFAULT="default";var TYPE={STRING:"MetaDataStringInfo",STRING_MULTI:"MetaDataStringInfoMulti",GLOSSARY:"MetaDataGlossaryLink",DATE:"MetaDataDate",ENUM:"MetaDataEnum",NUMBER:"MetaDataNumberInfo",COMPLEX:"MetaDataComplex"};var SHOW_GLOSSARY_TAB=false;Signavio.Plugins.customGlossaryCategories=Signavio.Core.Plugin.extend({enabled:true,construct:function(){SHOW_GLOSSARY_TAB=true}});var CategoryUIProvider=Ext.extend(Ext.tree.TreeNodeUI,{render:function(){Ext.tree.TreeNodeUI.prototype.render.apply(this,arguments);if((this.node.attributes||{}).color){this.getIconEl().style.background=this.node.attributes.color}}});var StencilSetLoader={loadedStencilSets:{},loadExtensions:function(clb){if(this.loadedExtensions===undefined){Signavio.Core.Stores.RequestManager.doGet("/p/editor_ssextensions",function(ssext){ssext=ssext instanceof Object?ssext:{};this.loadedExtensions=ssext;if(clb instanceof Function){clb(ssext)}}.bind(this))}else{if(clb instanceof Function){clb(this.loadedExtensions)}}},load:function(uri,clb){if(!this.loadedStencilSets[uri]){Signavio.Core.Stores.RequestManager.doRequest(uri,function(result){result=result instanceof Object?result:{};this.loadedStencilSets[uri]=result;if(clb instanceof Function){clb(result)}}.bind(this),{},"get",false)}else{if(clb instanceof Function){clb(this.loadedStencilSets[uri])}}}};Signavio.Plugins.ManageMetaData={enabled:true,hideStencilsets:["http://www.signavio.com/stencilsets/processdoctemplate#"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",arrange:"right",index:9,name:I18N.title,icon:CONFIG.IMAGE_PATH+"/famfamfam/table_edit.png",isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this)});this.facade.offer({relGroup:"configure",arrange:"right",index:17,seperated:true});this.callbacks={};this.facade.registerOnEvent(Signavio.Const.EVENT.OPEN_MANAGE_METADATA,function(a,tabName){this.showWindow(tabName)}.bind(this))},bpmn20Namespace:"http://b3mn.org/stencilset/bpmn2.0#",onTabChange:function(){var meta=Signavio.Core.StoreManager.getStore("/meta");if(meta){meta.fireEvent("load",meta,meta.data.items,meta.lastOptions,true)}},showWindow:function(tab){if(!this.facade.isCurrentUserAdmin()){return}Signavio.Core.StoreManager.getRelatedStore("/glossarymanager").on("load",function(store){var $infoRep=$H(store.getRecords("info")[0].get("rep"));CORE_CATEGORIES=$infoRep.keys().map(function(key){if(key.endsWith("Category")){return $infoRep.get(key)}}).compact()});this.glossaryCategories=this.getCategoryStore();this.perspectives=Signavio.Core.StoreManager.getRelatedStore("/perspective");this.perspectives.on("load",this.updatePerspectives,this);this.perspectives.on("add",this.updatePerspectives,this,{select:true});this.perspectives.on("remove",this.updatePerspectives,this);var tabItems=[new Ext.Panel({border:false,bodyStyle:"padding: 10px;",layout:"anchor",title:I18N.stencilset,items:[new Ext.Panel({html:I18N.stencilsetsDescriptionText,cls:"y-stencilsets-description",bodyStyle:"padding-bottom:10px; color:#666666;",anchor:"100%",border:false}),new Ext.Panel({layout:"column",anchor:"100%",cls:"y-grids",items:this.getStencilsetPanel(),border:false})],listeners:{afterLayout:function(){var w=this;var a=w.items.get(0);var b=w.items.get(1);var h=w.getInnerHeight()-a.el.getHeight()-22;b.setHeight(h);b.items.get(0).setHeight(h);b.items.get(1).setHeight(h);b.items.get(2).setHeight(h);b.items.get(2).items.get(0).setHeight(h/2)}}}),this.getDictionaryTabPage(),this.getModellingGuidelinesTab(),this.getCustomLayersTab()].compact();var tabIndex=0;if(typeof tab==="number"){tabIndex=tab}else{if(typeof tab==="string"){var index=-1;for(var i=0;i<tabItems.length;i++){if(tabItems[i].tabName===tab){index=i}}if(index>-1){tabIndex=index}}}var tabPanel=new Ext.TabPanel({activeTab:tabIndex,layoutOnTabChange:true,anchor:"100% 100%",border:false,items:tabItems,listeners:{tabchange:this.onTabChange.bind(this)}});var dialog=new Ext.ux.Window({modal:true,title:I18N.windowTitle,width:Math.max(Math.min((document.width||window.innerWidth||0)*0.7,1100),600),height:Math.max(Math.min((document.height||window.innerHeight||0)*0.8,700),500),minWidth:600,minHeight:500,bodyStyle:"padding:0;",layout:"anchor",resizable:true,items:[tabPanel],cancelText:Ext.MessageBox.buttonText.close,listeners:{close:function(){this.onDestroy()}.bind(this)},noLinkButton:true,cancelButton:{text:I18N.closeBtn,handler:function(){if(this.isEdit==true){this.showWarning(dialog)}else{dialog.close()}delete this.isEdit}.bind(this)}});dialog.show()},getCustomLayersTab:function(){if(!Signavio.Const.SHOW_CUSTOM_LAYERS_TAB){return}return new Ext.Panel({tabName:Signavio.Const.CUSTOM_LAYERS_TAB_NAME,border:false,bodyStyle:"padding: 10px;",layout:"anchor",cls:"",title:Signavio.I18N.Repository.Layers.title,listeners:{render:function(panel){this.facade.raiseEvent(Signavio.Const.EVENT.ADD_CUSTOM_LAYERS_TAB,panel)}.bind(this)}})},getModellingGuidelinesTab:function(){if(!Signavio.Const.SHOW_MODELINGGUIDELINE_TAB){return}return new Ext.Panel({tabName:Signavio.Const.MODELINGGUIDELINE_TAB_NAME,border:false,bodyStyle:"padding: 10px;",layout:"anchor",cls:"ak-guide-lines-panel",title:Signavio.I18N.MetaModellingGuidelines.modellingGuideLinesTabName,listeners:{render:function(panel){this.facade.raiseEvent(Signavio.Const.EVENT.ADD_MODELLING_GUIDE_LINES,panel)}.bind(this)}})},showWarning:function(dialog){Ext.Msg.confirm(I18N.WarningBox.title,I18N.WarningBox.description,function(btn){if(btn=="yes"){window.location.reload(false)}dialog.close()}.bind(this)).setIcon(Ext.Msg.INFO).getDialog().syncSize()},onDestroy:function(){delete this.root;for(var i in this.callbacks){if(!Hash.prototype[i]){var store=Signavio.Core.StoreManager.getStore(i)}if(!store){continue}for(var j in this.callbacks[i]){if(Hash.prototype[j]){continue}var fns=this.callbacks[i][j];fns=fns instanceof Array?fns:[fns];fns.each(function(fn){store.un(j,fn)})}}this.callbacks={};delete this.attributeGrid;delete this.glossaryItemInfoPanel;delete this.categoryTree},registerEventOn:function(store,event,fn){var id=store.getIdentifier();if(!this.callbacks[id]){this.callbacks[id]={}}if(!(this.callbacks[id][event] instanceof Array)){if(!this.callbacks[id][event]){this.callbacks[id][event]=[]}else{this.callbacks[id][event]=[this.callbacks[id][event]]}}store.on(event,fn,this);this.callbacks[id][event].push(fn)},isActiveTab:function(panel){while(panel.ownerCt&&!(panel.ownerCt instanceof Ext.TabPanel)){panel=panel.ownerCt}return panel&&panel.ownerCt&&panel.ownerCt.activeTab===panel},getPerspectives:function(stencilset){if(!this.perspectives||!this.perspectives.lastOptions){return[]}return this.perspectives.getRecords("perspective").findAll(function(rec){return rec.get("rep").stencilSetNamespace===stencilset})},commitInStore:function(category,value,isValueAdded){if("disabledStencilSets"===category){this.isEdit=true}window.clearTimeout(this.commitFn);var clb=function(category,value,isValueAdded){var store=Signavio.Core.StoreManager.getStore(CONFIG.METACONFIG_PATH);if(!store){return}var conf=store.getRecords("metaconfig")[0];var rep=Object.clone(conf.get("rep"));if(isValueAdded==true){rep[category].push(value);rep[category]=rep[category].without("").compact().uniq()}else{rep[category]=rep[category].without(value).without("").compact().uniq()}conf.set("rep",rep);this.commitFn=window.setTimeout(function(){conf.commit()},1000)}.bind(this,category,value,isValueAdded);var store=Signavio.Core.StoreManager.getStore(CONFIG.METACONFIG_PATH);if(!store){store=Signavio.Core.StoreManager.getStore(CONFIG.METACONFIG_PATH,true,clb)}else{clb()}},updatePerspectives:function(){if(!this.root||!this.perspectives||!this.perspectives.lastOptions){return}var me=this;var meta=Signavio.Core.StoreManager.getStore(CONFIG.METACONFIG_PATH,true,function(){this.root.childNodes.each(function(child){var childNodes=child.childNodes;var existingPerspectives=childNodes.pluck("attributes").pluck("namespace");var perspectives=this.getPerspectives(child.attributes.namespace);var newPerspectives=perspectives.pluck("data").pluck("rep").pluck("namespace");perspectives.each(function(perspective){if(!existingPerspectives.include(perspective.get("rep").namespace)){var rep=perspective.get("rep");var text=this.getI18N(rep,"title");text=rep.isReadOnly?"<i style='color:#666666;'>"+text+"</i>":text;var config={text:text,oldText:text,leaf:true,cls:"y-perspective-row",identifier:perspective.get("href"),rel:"perspective",isReadOnly:rep.isReadOnly,icon:CONFIG.IMAGE_PATH+"/famfamfam/application_side_boxes.png",namespace:rep.namespace};config.checked=this.isNamespaceInArray("disabledPerspectives",rep.namespace,meta);var newNode=new Ext.tree.TreeNode(config);newNode.setText((newNode.attributes.checked)?text:"<strike>"+text+"</strike>");newNode.on("checkchange",function(){var text=this.text;text=this.attributes.checked?"<i style='color:#444444;'>"+text+"</i>":text;if(this.attributes.checked==false){text="<strike><i style='color:#666666;'>"+this.attributes.oldText+"</i></strike>";me.commitInStore("disabledPerspectives",this.attributes.namespace,true);this.parentNode.select()}else{text=this.attributes.oldText;me.commitInStore("disabledPerspectives",this.attributes.namespace,false)}this.setText(text)});newNode.on("dblclick",function(){var chech=this.attributes.checked;this.getUI().checkbox.setValue(chech);var perspective=me.perspectives.findByIdentifier(this.attributes.identifier);if(perspective&&perspective.get("rep").isReadonly===false){this.ownerTree.showEditWindowForPerspective(perspective)}});child.appendChild(newNode);existingPerspectives.push(rep.namespace)}}.bind(this));childNodes.each(function(existingPerspective){if(!newPerspectives.include(existingPerspective.attributes.namespace)){existingPerspective.remove()}})}.bind(this))}.bind(this))},getRemoveStencilsId:function(store,namespace){var rmstencils=store.data.items.findAll(function(rec){return !rec.get("used")}).pluck("data").pluck("id");if(this.bpmn20Namespace==namespace){var laneSet=function(used){var lane=store.getAt(store.find("id","Lane"));if(lane){lane.set("used",used);lane.commit(true)}};if(rmstencils.include("Pool")){rmstencils.push("VerticalPool","Lane","VerticalLane");laneSet(false)}else{rmstencils=rmstencils.without("VerticalPool","Lane","VerticalLane");laneSet(true)}if(rmstencils.include("CollapsedPool")){rmstencils.push("CollapsedVerticalPool")}else{rmstencils=rmstencils.without("CollapsedVerticalPool")}}return rmstencils},updateStencilsInPerspective:function(perspective,stencilStore){if(!this.perspectives||!perspective||!stencilStore){return}var rep=Object.clone(perspective.get("rep"));var newRemoveStencils=this.getRemoveStencilsId(stencilStore,perspective.get("rep").stencilSetNamespace);if(rep.removeStencilIds.sort().toJSON()==newRemoveStencils.sort().toJSON()){return}rep.removeStencilIds=newRemoveStencils;rep.title=(rep.title||"").unescapeHTML();perspective.set("rep",rep);perspective.commit();delete this.waitForCommit},getItemInfoTemplate:function(multilanguage,asList){var getTpl=function(type,label,isList){label=label||I18N.Template[type]||"";var list="";if(isList){list="<tpl if='isList'> "+I18N.Template.isList+"</tpl>"}var tpl='<tpl if="'+type+'"><tr><td class="y-attr-desc">'+label+'</td><td class="y-attr-val">{'+type+"}"+list+"</td></tr></tpl>";return tpl};return new Ext.XTemplate('<div class="y-attrInfoTemplate">',"<table>",getTpl("name"),getTpl("type","",asList),getTpl("description"),getTpl("defaultValue"),getTpl("items"),getTpl("bindings"),getTpl("dateFormat"),getTpl("min",I18N.Template.minNumber),getTpl("max",I18N.Template.maxNumber),multilanguage?'<tpl if="multilanguage"><tr><td class="y-attr-val"></td><td class="y-attr-desc" style="padding-left: 0; font-style: italic; ">'+I18N.Template.multilanguage+"</td></tr></tpl>":"","</table>","</div>")},getLoadingIndicator:function(store){if(!store){return""}var loadingIndicator=new Ext.Toolbar.Button({handleMouseEvents:false,hidden:true,icon:"/libs/ext-2.0.2/resources/images/default/tree/loading.gif",iconCls:"x-dummy"});var timer;this.registerEventOn(store,"beforesubmit",function(){window.clearTimeout(timer);loadingIndicator.show()});this.registerEventOn(store,"submitted",function(){timer=window.setTimeout(loadingIndicator.hide.bind(loadingIndicator),100)});return loadingIndicator},isNamespaceInArray:function(arrayname,namespace,store){var conf=store.getRecords("metaconfig")[0];var rep=Object.clone(conf.get("rep"));var isIn=true;rep[arrayname].each(function(sname){if(namespace==sname){isIn=false}}.bind(this));return isIn},setCheckvalueOfChildNodes:function(parentNode,value){parentNode.childNodes.each(function(child){if(value==false){child.disable();child.unselect();this.toggleCheck(child,false);var firstChild=(child.getUI().getTextEl()||{}).firstChild;if(firstChild&&(firstChild.tagName||"").toLowerCase()!=="strike"){Element.wrap(firstChild,new Element("strike"))}}else{child.enable();this.toggleCheck(child,true);var firstChild=(child.getUI().getTextEl()||{}).firstChild;if(firstChild&&(firstChild.tagName||"").toLowerCase()==="strike"){this.flattenElement(firstChild)}}}.bind(this))},toggleCheck:function(element,value){element.getUI().toggleCheck(value);element.attributes.checked=!!value;element.fireEvent("checkchange")},flattenElement:function(element){var child,parent=element.parentNode;while((child=element.firstChild)){parent.insertBefore(child,element)}parent.removeChild(element)},handleBPMN20PoolLane:function(conf,stencil){if(conf.namespace!==this.bpmn20Namespace){return}var res={};if(["Pool"].include(id)){res.title="Pool/Lane"}if(["VerticalLane","VerticalPool","CollapsedVerticalPool"].include(stencil.id)){res.hide=true}if(["Lane"].include(stencil.id)){stencil.isReadonly=true}return res},getStencilsetPanel:function(win){var stencilsets=[];var stencils=[];var stencilsetTree;var me=this;var root=new Ext.tree.TreeNode({text:"root",leaf:false,cls:"folder",expanded:true});this.root=root;this.facade.loadStencilSets(function(stencilsets){var meta=Signavio.Core.StoreManager.getStore(CONFIG.METACONFIG_PATH,true,function(){stencilsets.each(function(stencilset){if(this.hideStencilsets.include(stencilset.namespace)){return}var s=new Ext.tree.TreeNode({text:this.getI18N(stencilset,"title"),oldText:this.getI18N(stencilset,"title"),checked:this.isNamespaceInArray("disabledStencilSets",stencilset.namespace,meta),leaf:false,cls:"y-stencilset-row",identifier:CONFIG.STENCILSET_PATH+stencilset.uri,expandable:false,namespace:stencilset.namespace,icon:CONFIG.DIAGRAMS_IMAGE_PATH+stencilset.icon_url});if(s.attributes.checked==false){s.setText("<strike><i style='color:#666666;'>"+s.attributes.oldText+"</i></strike>")}s.on("dblclick",function(){var check=this.attributes.checked;this.getUI().checkbox.setValue(check)});s.on("checkchange",function(){var text=this.text;text=this.attributes.checked?"<i style='color:#444444;'>"+text+"</i>":text;if(this.attributes.checked==false){text="<strike><i style='color:#666666;'>"+this.text+"</i></strike>";me.commitInStore("disabledStencilSets",this.attributes.namespace,true)}else{text=this.attributes.oldText;me.commitInStore("disabledStencilSets",this.attributes.namespace,false)}this.setText(text);me.setCheckvalueOfChildNodes(this,this.attributes.checked);var checked=this.attributes.checked;this.attributes.checked=true;this.select();this.attributes.checked=checked});s.collapse();root.appendChild(s)}.bind(this));this.updatePerspectives();if(root.childNodes.length>0&&root.getOwnerTree()){root.childNodes.first().select()}}.bind(this))}.bind(this));var ownAttrStore=Signavio.Core.StoreManager.getStore("/meta")||Signavio.Core.StoreManager.getRelatedStore("/meta",undefined,["dummy"]);var stencilGrid,ownAttrGrid;var stencilStore=new Ext.data.SimpleStore({data:[],fields:[{name:"stencils"},{name:"namespace"},{name:"used"},{name:"id"},{name:"imagepath"},{name:"disabled"},{name:"type"}]});stencilStore.on("load",function(){var countOfStencils=stencilStore.getCount();var disable=countOfStencils===0||stencilStore.data.items.all(function(r){return r.get("disabled")});stencilGrid.getTopToolbar().items.get(0).setDisabled(disable);stencilGrid.getTopToolbar().items.get(1).setDisabled(disable)});var updateStencilStore=function(){if(this.waitForCommit){window.clearTimeout(this.waitForCommit.timer);this.waitForCommit.fn.call(this);delete this.waitForCommit}var sel=stencilsetTree.getSelectionModel().getSelectedNode();if(stencilsetTree.getTopToolbar()&&stencilsetTree.getTopToolbar().items){stencilsetTree.getTopToolbar().items.get(0).setDisabled(!sel);stencilsetTree.getTopToolbar().items.get(0).setText(I18N[!sel||sel.attributes.rel!=="perspective"?"addSubset":"copySubset"]);stencilsetTree.getTopToolbar().items.get(1).setDisabled(!sel||sel.attributes.rel!=="perspective"||sel.attributes.isReadOnly)}if(sel&&sel.rendered){stencils=[];var stencilsetNode=sel.attributes.rel==="perspective"?sel.parentNode:sel;var uri=stencilsetNode.attributes.identifier;var imagepath=uri.split("/").slice(0,uri.split("/").length-1).join("/")+"/icons/";var removestencils=[],isReadonlyPerspective=false;if(sel!==stencilsetNode){var perspective=this.perspectives.findByIdentifier(sel.attributes.identifier);if(perspective){removestencils=perspective.get("rep").removeStencilIds;isReadonlyPerspective=perspective.get("rep").isReadOnly}}stencilGrid.view.mainBody.update('<div class="x-grid-empty"><img src="/libs/ext-2.0.2/resources/images/default/tree/loading.gif"/>'+I18N.loading+"</div>");StencilSetLoader.load(uri,function(result){var stencilData=[];var isReadonly=sel===stencilsetNode||isReadonlyPerspective;result.stencils.each(function(stencil,i){stencils.push(stencil);var title=this.getI18N(stencil,"title");if(result.namespace===this.bpmn20Namespace){var res=this.handleBPMN20PoolLane(result,stencil);if(res&&"string"===typeof res.title){title=res.title}if(res&&res.hide){return}}stencilData.push([title,result.namespace,!removestencils.include(stencil.id),stencil.id,i===0?stencilsetNode.attributes.icon:imagepath+stencil.icon,i===0||stencil.isReadonly||isReadonly,stencil.type])}.bind(this));var selection=stencilGrid.getSelectionModel().getSelections();stencilStore.loadData(stencilData);selection=stencilStore.data.items.findAll(function(rec){return selection.any(function(rec,s){return rec.get("namespace")===s.get("namespace")&&rec.get("id")===s.get("id")}.bind(this,rec))});stencilGrid.getSelectionModel().selectRecords(selection)}.bind(this))}}.bind(this);var updateExcludedStencils=function(recordOfClickedCheckbox){stencilStore.each(function(record){if(record.id==recordOfClickedCheckbox.get("id")){record.used=!record.used}})};var createAddEditWindowForPerspective=function(isEdit,isDuplicating,perspectivesOptions){var perspectiveDialog;var perspectiveDescription=new Ext.form.Label({text:!!isEdit===false?(isDuplicating===true?Signavio.I18N.Repository.MetaData.Subsets.SubsetDuplicateDescription:Signavio.I18N.Repository.MetaData.Subsets.SubsetAddDescription):Signavio.I18N.Repository.MetaData.Subsets.SubsetEditDescription,cls:"y-stencilset-add-edit-window-description"});var perspectiveNameField=new Ext.form.TextField({fieldLabel:I18N.Subsets.SubsetName,value:Signavio.Utils.unescapeHTML(perspectivesOptions.perspectiveName)||"",width:200,cls:"y-stencilset-add-edit-window-name-textbox"});var perspectiveGroupedField=new Ext.form.Checkbox({fieldLabel:Signavio.I18N.Repository.MetaData.Subsets.SubsetGrouping,checked:(perspectivesOptions.perspectiveGrouping&&perspectivesOptions.perspectiveGrouping===TYPE_GROUPED)||false,width:200,cls:"y-stencilset-add-edit-window-no-grouping-checkbox"});var perspectivePanel=new Ext.Panel({layout:"form",itemCls:"y-stencilset-add-edit-window-form-item",labelWidth:120,border:false,items:[perspectiveDescription,perspectiveNameField,perspectiveGroupedField]});if(!!isEdit===false){var buttons=[{text:Signavio.I18N.Repository.MetaData.Subsets.Button,handler:function(){var perspectiveName=perspectiveNameField.getValue()||"";if(typeof perspectiveName==="string"&&perspectiveName.trim()===""){Ext.Msg.alert(I18N.Subsets.AddSubset,I18N.Subsets.NoNameDescription).setIcon(Ext.Msg.WARNING).getDialog().syncSize();return}var newPerspective=Signavio.Core.RecordCreator.create("perspective","",{title:perspectiveName,description:"",groupType:perspectiveGroupedField.getValue()?TYPE_GROUPED:TYPE_UNGROUPED,stencilSetNamespace:perspectivesOptions.stencilset,removeStencilIds:perspectivesOptions.removeStencilIds});var selectLast=function(){this.perspectives.un("add",selectLast,this);perspectivesOptions.node.expand();perspectivesOptions.node.childNodes.last().select()};this.perspectives.on("add",selectLast,this);this.perspectives.add(newPerspective,true);perspectiveDialog.close()}.bind(this)}]}else{var buttons=[{text:Signavio.I18N.Repository.MetaData.Subsets.Button,handler:function(){var perspectiveName=perspectiveNameField.getValue()||"";if(typeof perspectiveName==="string"&&perspectiveName.trim()===""){Ext.Msg.alert(I18N.Subsets.EditSubset,I18N.Subsets.NoNameDescription).setIcon(Ext.Msg.WARNING).getDialog().syncSize();return}var rep=Object.clone(perspectivesOptions.perspective.get("rep")||{});rep.title=perspectiveName;rep.groupType=perspectiveGroupedField.getValue()?TYPE_GROUPED:TYPE_UNGROUPED;perspectivesOptions.perspective.set("rep",rep);perspectivesOptions.perspective.commit();var node=stencilsetTree.getSelectionModel().getSelectedNode();if(node){node.setText(rep.title)}perspectiveDialog.close()}.bind(this)}]}perspectiveDialog=new Ext.ux.Window({modal:true,cls:"y-stencilset-add-edit-window",title:(isEdit===false)?(isDuplicating===false?I18N.Subsets.AddSubset:I18N.copySubset):I18N.Subsets.EditSubset,items:[perspectivePanel],autoHeight:true,resizable:false,width:400,cancelButton:{text:I18N.Subsets.CancelButton,handler:function(){perspectiveDialog.close()}},buttons:buttons});if(isEdit===true){perspectiveDialog.on("render",function(win){var removeButton=new Ext.Button({text:I18N.Subsets.RemoveButton,renderTo:win.footer,cls:"y-stencilset-add-edit-window-remove-button",listeners:{render:function(button){button.el.alignTo(win.footer,"tl",[5,8])}},handler:function(){var node=stencilsetTree.getSelectionModel().getSelectedNode();if(!this.perspectives||!node||node.attributes.rel!=="perspective"){return}var perspective=this.perspectives.findByIdentifier(node.attributes.identifier);if(!perspective){return}Ext.Msg.confirm(I18N.Subsets.ConfirmRemoval,I18N.Subsets.ConfirmRemovalText,function(btn){if(btn==="yes"){node.parentNode.select();this.perspectives.remove(perspective,true);perspectiveDialog.close()}}.bind(this)).setIcon(Ext.Msg.QUESTION).getDialog().syncSize()}.bind(this)})}.bind(this))}return perspectiveDialog}.bind(this);stencilsetTree=new Ext.tree.TreePanel({columnWidth:0.3,cls:"y-stencilset-tree",root:root,animate:true,enableDD:false,rootVisible:false,useArrows:true,autoScroll:true,showEditWindowForPerspective:function(perspective){var perspectivesOptions={perspectiveName:perspective.get("rep").title,perspectiveGrouping:perspective.get("rep").groupType||TYPE_UNGROUPED,perspective:perspective};var editDialog=createAddEditWindowForPerspective(true,false,perspectivesOptions);editDialog.show()},title:I18N.stencilset,listeners:{collapsenode:function(collapsedNode){var selectedNode=collapsedNode.ownerTree.getSelectionModel().getSelectedNode();if(selectedNode&&selectedNode.parentNode&&!selectedNode.parentNode.isRoot&&(collapsedNode.parentNode.isRoot&&collapsedNode.childNodes.indexOf(selectedNode)!==-1)){collapsedNode.ownerTree.getSelectionModel().select(selectedNode.parentNode)}}},tbar:[{text:I18N.addSubset,icon:CONFIG.IMAGE_PATH+"/famfamfam/add.png",cls:"x-btn-text-icon",disabled:true,handler:function(){var node,selNode;node=selNode=stencilsetTree.getSelectionModel().getSelectedNode();if(!this.perspectives||!node){return}node=node.attributes.rel==="perspective"?node.parentNode:node;var stencilset=node.attributes.namespace;if(!stencilset){return}var removeStencilIds=[];var perspectiveGrouping=TYPE_UNGROUPED;var perspectiveName="";var isDuplicating=false;if(node!==selNode){var pers=this.perspectives.findByIdentifier(selNode.attributes.identifier);if(pers){isDuplicating=true;removeStencilIds=(pers.get("rep").removeStencilIds||[]).clone();perspectiveGrouping=pers.get("rep").removeStencilIds||false;perspectiveName=pers.get("rep").title||""}}var perspectivesOptions={perspectiveName:perspectiveName,perspectiveGrouping:TYPE_UNGROUPED,stencilset:stencilset,removeStencilIds:removeStencilIds,node:node};var addDialog=createAddEditWindowForPerspective(false,isDuplicating,perspectivesOptions);addDialog.show();try{window.setTimeout(dialog.getDialog().focusEl.dom.select.bind(dialog.getDialog().focusEl.dom),100)}catch(e){}}.bind(this)},{text:I18N.editSubset,icon:CONFIG.IMAGE_PATH+"/famfamfam/application_form_edit.png",cls:"x-btn-text-icon",disabled:true,handler:function(){var node=stencilsetTree.getSelectionModel().getSelectedNode();if(!this.perspectives||!node||node.attributes.rel!=="perspective"){return}var perspective=this.perspectives.findByIdentifier(node.attributes.identifier);if(!perspective||!perspective.get("rep")){return}var perspectivesOptions={perspectiveName:perspective.get("rep").title,perspectiveGrouping:perspective.get("rep").groupType||TYPE_UNGROUPED,perspective:perspective};var editDialog=createAddEditWindowForPerspective(true,false,perspectivesOptions);editDialog.show()}.bind(this)}]});stencilsetTree.getSelectionModel().on("selectionchange",updateStencilStore);if(Ext.isIE10){stencilsetTree.on("dblclick",function(node,e){if("undefined"==typeof node.parentNode.attributes.checked){}}.bind(this))}var timer,isActive,selectRecs;var updateMetaStore=function(a,b,c,doImmediate){if(!this.isActiveTab(stencilGrid)||isActive){if(ownAttrGrid.getSelectionModel().lastActive>=0){selectRecs=ownAttrGrid.getSelectionModel().lastActive}return}if(c===Ext.data.Record.EDIT){var row=ownAttrGrid.store.indexOf(b);if("number"==typeof row&&row>=0){var node=Ext.get(ownAttrGrid.getView().getRow(row));if(node){node.addClass("x-editing")}}return}doImmediate=doImmediate===true||((a.lastOptions===c&&c!==undefined)||(a.lastOptions===undefined&&c!==undefined));var isAdd=!doImmediate&&(b instanceof Array);var isUpdate=c===Ext.data.Record.COMMIT||c===Ext.data.Record.EDIT;selectRecs=isAdd?b:(isUpdate?[b]:(doImmediate?selectRecs:undefined));var update=function(){isActive=true;var sel=stencilGrid.getSelectionModel().getSelections();ownAttrGrid.getTopToolbar().items.get(0).setDisabled(sel.length===0);ownAttrGrid.view.emptyText=sel.length===0?I18N.requestStencilSelection:(sel.length===1?I18N.noOwnAttributes:I18N.noSharedAttributes);if(sel.length===0){ownAttrStore.filterBy(function(record){return false})}else{var metaDataSelection=ownAttrGrid.getSelectionModel().getSelections();var namespace=sel[0].get("namespace");var stencils=sel.map(function(record){return record.get("id")});ownAttrStore.filterBy(function(record){var bindings=record.get("rep").stencilsetBindings;return stencils.all(function(stencil){return bindings.any(function(binding){return binding.namespace===namespace&&stencil==binding.stencil})})});var selectedStencils=this.extractStencilInfo(stencilGrid.getSelectionModel().getSelections());var size=String(ownAttrStore.getCount()).length;ownAttrStore.sortBy(function(record){return(Math.min.apply(Math,this.findBindings(record,selectedStencils).pluck("order"))||0).toPaddedString(size+2)+""+record.get("rep").name.toLowerCase()}.bind(this));if(selectRecs!==undefined||metaDataSelection.length>0){if(typeof selectRecs==="number"){selectRecs=[ownAttrStore.getAt(selectRecs)]}ownAttrGrid.getSelectionModel().selectRecords(selectRecs||metaDataSelection);var index=ownAttrGrid.store.indexOf(ownAttrGrid.getSelectionModel().getSelected());var n=index>=0?Ext.get(ownAttrGrid.view.getRow(index)):undefined;if(n){window.setTimeout(function(){try{n.scrollIntoView(ownAttrGrid.view.scroller)}catch(e){}},10)}}}isActive=false}.bind(this);window.clearTimeout(timer);if(doImmediate){update()}else{timer=window.setTimeout(update,10)}}.bind(this);stencilGrid=new Ext.grid.GridPanel({store:stencilStore,id:"stencilGrid",columns:[{width:1,dataIndex:"used",renderer:function(v,p,r,rowIndex,colIndex,ds){return'<input class="x-input-checkbox" type="checkbox" '+(v?"checked":"")+(r.get("disabled")?" disabled":"")+" />"}},{id:"stencils",dataIndex:"stencils",renderer:function(name,metadata,record){metadata.css="y-stencil-row";return'<img src="'+record.get("imagepath")+'" class="y-meta-data-icon" />'+name}}],viewConfig:{emptyText:I18N.requestStencilsetSelection,forceFit:true,scrollOffset:0,updateCheckbox:function(){this.mainBody.select("input.x-input-checkbox").on("click",function(evt){var target=evt.target;var row=evt.getTarget(".x-grid3-row");if(row){var record=this.grid.store.getAt(row.rowIndex);if(record){record.set("used",target.checked);record.commit();this.grid.fireEvent("checkchanged",row.rowIndex,target.checked)}}}.bind(this)).removeClass("x-input-checkbox")},processRows:function(){Ext.grid.GridView.prototype.processRows.apply(this,arguments);this.updateCheckbox()},onUpdate:function(){Ext.grid.GridView.prototype.onUpdate.apply(this,arguments);this.updateCheckbox()}},hideHeaders:true,stripeRows:false,autoExpandColumn:"stencils",cls:"y-stencilgrid",columnWidth:0.3,title:I18N.stencil,tbar:[{text:I18N.selectAll,icon:"/libs/ext-2.0.2/resources/images/default/menu/checked.gif",disabled:true,cls:"x-btn-text-icon",handler:function(){stencilStore.data.items.each(function(a){if(!a.get("disabled")){a.set("used",true)}});stencilStore.commitChanges()}.bind(this)},{text:I18N.deselectAll,icon:"/libs/ext-2.0.2/resources/images/default/menu/unchecked.gif",cls:"x-btn-text-icon",disabled:true,handler:function(){stencilStore.data.items.without(stencilStore.data.items[0]).each(function(a){if(!a.get("disabled")){a.set("used",false)}});stencilStore.commitChanges()}.bind(this)},"->",this.getLoadingIndicator(this.perspectives)]});stencilGrid.on("render",function(){this.view.applyEmptyText()});stencilGrid.getSelectionModel().on("selectionchange",updateMetaStore);stencilStore.on("update",function(store,record,operation){if(operation===Ext.data.Record.COMMIT){var node=stencilsetTree.getSelectionModel().getSelectedNode();if(!node){return}var perspective=this.perspectives.findByIdentifier(node.attributes.identifier);if(!perspective){return}window.clearTimeout((this.waitForCommit||{}).timer);delete this.waitForCommit;var fn=this.updateStencilsInPerspective.bind(this,perspective,store);this.waitForCommit={timer:window.setTimeout(fn,1000),fn:fn}}}.bind(this));var updateAttrInfo=function(ownAttrInfo){var sel=ownAttrGrid.getSelectionModel().getSelected();if(!sel){ownAttrInfo.body.update("")}else{var rep=sel.get("rep");var o={name:rep.name,type:I18N.Types[rep.lineWrap?TYPE.STRING_MULTI:rep.type]||"",description:rep.description?rep.description:false,defaultValue:rep.defaultValue,isList:rep.isList,dateFormat:rep.dateFormat,min:typeof rep.min==="number"&&rep.min!==NEGATIVE_INFINITY?rep.min:undefined,max:typeof rep.max==="number"&&rep.max!==POSITIVE_INFINITY?rep.max:undefined,multilanguage:rep.multilanguage};var info=this.getItemInfoTemplate(rep.multilanguage,rep.isList);if(o.defaultValue){o.defaultValue=Signavio.Utils.unescapeHTML(o.defaultValue)}if(rep.items&&rep.type===TYPE.ENUM){o.items=rep.items.collect(function(item){return String(item&&"string"==typeof item.title?item.title:"string"==typeof item?item:"").replace(/</g,"&lt;")+(o.defaultValue==item.id?"*":"")}).join(", ")}else{o.items=false}if(rep.stencilsetBindings||rep.glossaryBindings){var bindings=[];if(rep.glossaryBindings[0]){bindings.push(rep.glossaryBindings.collect(function(binding){var lbl=Signavio.I18N.Repository.GlossaryTypes[binding.category.split("=").last()];if(typeof lbl!=="string"){var catId=binding.category.split("=").last();var catR=this.glossaryCategories.get("href",GLOSSARY_ROOT+catId);if(catR){lbl=catR.get("rep").name}if(!lbl){lbl=catId}}return lbl+"<span class='y-used-in-annotation'> ("+I18N.Template.glossary+")</span>"}.bind(this)).compact().join(", "))}var currentNamespace=stencilGrid.getSelectionModel().getSelections()[0].get("namespace");var bondStencils=0;if(rep.stencilsetBindings){bindings.push(rep.stencilsetBindings.collect(function(binding){if(currentNamespace==binding.namespace){bondStencils+=1;return this.getI18N(stencils.find(function(stencil){return stencil.id==binding.stencil}),"title")}else{return null}}.bind(this)).compact().join(", "))}else{return null}o.bindings=bindings.compact().join(", ");if(rep.stencilsetBindings&&rep.stencilsetBindings.size()-bondStencils!=0){o.bindings+=new Ext.XTemplate(I18N.Template.furtherBindings).apply([(rep.stencilsetBindings.size()-bondStencils)])}}else{o.bindings=false}info.overwrite(ownAttrInfo.body,o)}}.bind(this);ownAttrGrid=new Ext.grid.GridPanel({store:ownAttrStore,columns:[{dataIndex:"rep",renderer:function(rep,metadata,record){return rep.name}}],viewConfig:{emptyText:I18N.requestStencilSelection,forceFit:true,scrollOffset:0,onUpdate:function(ds,record,op){if(-1===this.ds.indexOf(record)&&this.ds.snapshot&&-1!==this.ds.snapshot.indexOf(record)){return}if(op===Ext.data.Record.EDIT){return}this.refreshRow(record)}},hideHeaders:true,selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:false,cls:"y-ownAttrgrid",title:I18N.ownAttributes,listeners:{render:this.updateGlossaryAttributeStore.bind(this)},tbar:[{text:I18N.addAttributes,icon:CONFIG.IMAGE_PATH+"/famfamfam/add.png",cls:"x-btn-text-icon",disabled:true,handler:function(){this.showAddWindow(stencilGrid.getSelectionModel().getSelections(),false,ownAttrGrid)}.bind(this)},{text:I18N.editAttributes,icon:CONFIG.IMAGE_PATH+"/famfamfam/application_form_edit.png",cls:"x-btn-text-icon",disabled:true,handler:function(){this.showAddWindow(stencilGrid.getSelectionModel().getSelections(),true,ownAttrGrid)}.bind(this)},{text:I18N.removeAttributes,icon:CONFIG.IMAGE_PATH+"/famfamfam/delete.png",cls:"x-btn-text-icon",disabled:true,handler:function(){this.removeSelection(ownAttrGrid.getSelectionModel().getSelected(),stencilGrid)}.bind(this)},"->",this.getLoadingIndicator(ownAttrStore),{text:I18N.moveUp,icon:CONFIG.IMAGE_PATH+"/famfamfam/bullet_arrow_up.png",cls:"x-btn-text-icon",disabled:true,handler:function(){this.moveSelection(ownAttrGrid.getSelectionModel().getSelected(),this.extractStencilInfo(stencilGrid.getSelectionModel().getSelections()),-1)}.bind(this)},{text:I18N.moveDown,icon:CONFIG.IMAGE_PATH+"/famfamfam/bullet_arrow_down.png",cls:"x-btn-text-icon",disabled:true,handler:function(){this.moveSelection(ownAttrGrid.getSelectionModel().getSelected(),this.extractStencilInfo(stencilGrid.getSelectionModel().getSelections()),1)}.bind(this)}]});var ownAttrInfo=new Ext.Panel({cls:"y-ownAttrInfo",id:"ownAttrInfo",anchor:"100%",border:false});var ownAttrContainer=new Ext.Panel({items:[ownAttrGrid,ownAttrInfo],columnWidth:0.4,cls:"y-ownAttrContainer",border:false,style:Ext.isIE?"margin-right:-5px;":""});ownAttrGrid.getSelectionModel().on("selectionchange",function(selModel){var sel=selModel.getSelected();var grid=selModel.grid;grid.getTopToolbar().items.get(1).setDisabled(!sel);grid.getTopToolbar().items.get(2).setDisabled(!sel);grid.getTopToolbar().items.get(5).setDisabled(!sel||grid.store.indexOf(sel)===0);grid.getTopToolbar().items.get(6).setDisabled(!sel||grid.store.indexOf(sel)===grid.store.getCount()-1);updateAttrInfo(ownAttrInfo)}.bind(this));this.registerEventOn(ownAttrStore,"load",updateMetaStore);this.registerEventOn(ownAttrStore,"update",updateMetaStore);this.registerEventOn(ownAttrStore,"remove",updateMetaStore);this.registerEventOn(ownAttrStore,"add",updateMetaStore);return[stencilsetTree,stencilGrid,ownAttrContainer]},extractStencilInfo:function(records){return records.map(function(record){return{namespace:record.get("namespace"),id:record.get("id")}})},extractGlossaryInfo:function(records){return records.map(function(record){var href;if(record.get instanceof Function){href=record.get("href")}else{var href=record.attributes.identifier}return{category:href}})},getI18N:function(obj,attr){var lang=Signavio.I18N.Language;var count=lang.split("_").first();return obj[attr+"_"+lang]||obj[attr+"_"+count]||obj[attr]},findBindings:function(meta,query){if(!(query instanceof Array)){query=[query].compact()}return[].concat(meta.get("rep").glossaryBindings||[],meta.get("rep").stencilsetBindings||[]).findAll(function(binding){return query.any(function(q){var bindingID=binding.category||"";if(bindingID&&!bindingID.startsWith(GLOSSARY_ROOT)){bindingID=GLOSSARY_ROOT+bindingID}return(bindingID===q.category&&q.category!==undefined)||(binding.namespace===q.namespace&&binding.stencil===q.id&&q.namespace!==undefined&&q.id!==undefined)})})},countBindings:function(record){return(record.get("rep").glossaryBindings||[]).length+(record.get("rep").stencilsetBindings||[]).length},removeSelection:function(selection,parent){if(this.countBindings(selection)===1){Ext.Msg.confirm(I18N.confirmRemove,new Ext.XTemplate(I18N.confirmRemoveText).apply([selection.get("rep").name]),function(btn){if(btn=="yes"){selection.store.remove(selection,true)}})}else{var fn;if(parent.getSelectionModel().getSelections){fn=function(){return parent.getSelectionModel().getSelections()}}else{fn=function(){return parent.getSelections()}}var parentsel=fn();var more=parentsel.size()>1;var stencil=!!parentsel[0].get("stencils");Ext.Msg.show({title:I18N.removeAttributes,msg:new Ext.XTemplate(I18N.removeAttributesText).apply([selection.get("rep").name,I18N.removeFrom[(more?(stencil?"moreStencil":"moreCategory"):(stencil?"singleStencil":"singleCategory"))]]),icon:Ext.MessageBox.QUESTION,buttons:{yes:I18N.removeBtn[(more?(stencil?"moreStencil":"moreCategory"):(stencil?"singleStencil":"singleCategory"))],no:I18N.removeFromAll,cancel:I18N.cancelRemove},fn:function(btn){if(btn=="yes"){var rep=Object.clone(selection.get("rep"));var sToRemove=[];parentsel.each(function(stencil){sToRemove=sToRemove.concat(rep.stencilsetBindings.findAll(function(stencil,binding){return stencil.get("id")===binding.stencil&&stencil.get("namespace")===binding.namespace}.bind(this,stencil)))});var gToRemove=[];parentsel.each(function(glossar){gToRemove=gToRemove.concat(rep.glossaryBindings.findAll(function(glossar,binding){return glossar.get("href")===binding.category}.bind(this,glossar)))});rep.glossaryBindings=rep.glossaryBindings.without.apply(rep.glossaryBindings,gToRemove);rep.stencilsetBindings=rep.stencilsetBindings.without.apply(rep.stencilsetBindings,sToRemove);selection.set("rep",rep);selection.commit()}else{if(btn=="no"){selection.store.remove(selection,true)}}}})}},getObjectByOrder:function(data,order){return data.find(function(r){return r.order===order})},getMetaDataByBinding:function(binding){var store=Signavio.Core.StoreManager.getStore("/meta");if(!store){return}return store.data.items.find(function(rec){return[].concat(rec.get("rep").glossaryBindings||[],rec.get("rep").stencilsetBindings||[]).include(binding)})},forceForSequentialOrder:function(bindings,allBindings){var n=bindings.length-1;if(eval(bindings.pluck("order").compact().map(function(r){return r*r}).join("+"))!==(n*(n+1)*((2*n)+1))/6){allBindings.sortBy(function(b){return(b.order||0)}).each(function(binding,index){if(binding.order!==index){binding.order=index;var rec=this.getMetaDataByBinding(binding);if(rec){rec.set("rep",Object.clone(rec.get("rep")))}}}.bind(this))}},moveSelection:function(meta,selections,step){if(!meta||!selections||selections.length===0||typeof step!=="number"||step===0){return}var metaStore=Signavio.Core.StoreManager.getStore("/meta");metaStore.fireEvent("beforesubmit",metaStore,meta);metaStore.suspendEvents();selections.each(function(selection){var binding,otherBindings,allBindings;if(selection.category!==undefined){binding=(meta.get("rep").glossaryBindings||[]).find(function(r){var bindingID=r.category||"";if(!bindingID.startsWith(GLOSSARY_ROOT)){bindingID=GLOSSARY_ROOT+bindingID}return bindingID===selection.category});allBindings=this.getGlossaryBindings(selection.category);otherBindings=allBindings.without(binding)}else{if(selection.namespace!==undefined&&selection.id!==undefined){binding=(meta.get("rep").stencilsetBindings||[]).find(function(r){return r.namespace===selection.namespace&&r.stencil===selection.id});allBindings=this.getStencilSetBindings(selection.namespace,selection.id);otherBindings=allBindings.without(binding)}}if(!binding){return}this.forceForSequentialOrder([].concat(otherBindings,binding),allBindings);if(binding.order+step<0||binding.order+step>=otherBindings.length+1){return}var order=this.getObjectByOrder(otherBindings,binding.order+step);if(!order){log("There is no binding above "+step+" step.");return}binding.order=order.order;order.order=binding.order-step;var cmeta=Object.clone(meta.get("rep"));cmeta.name=cmeta.name.unescapeHTML();meta.set("rep",cmeta);var rMeta=this.getMetaDataByBinding(order);if(rMeta&&rMeta!==meta){cmeta=Object.clone(rMeta.get("rep"));cmeta.name=cmeta.name.unescapeHTML();rMeta.set("rep",cmeta)}}.bind(this));metaStore.commitChanges(undefined,function(){metaStore.resumeEvents();metaStore.fireEvent("update",metaStore,meta,Ext.data.Record.COMMIT,true);metaStore.fireEvent("submitted",metaStore,meta)})},getAddForm:function(win,availableMetaDataNames,editing,rep){var me=this;return new Ext.form[(availableMetaDataNames.length===0||editing)?"TextField":"ComboBox"]({fieldLabel:I18N.ShowAddDialog.Name,emptyText:"",store:new Ext.data.SimpleStore({fields:["name","id","rep"],data:[].concat([["","",""]],availableMetaDataNames)}),displayField:"name",typeAhead:true,mode:"local",allowBlank:false,blankText:I18N.AddDialog.requiredField,invalidText:I18N.ShowAddDialog.invalidTitle,triggerAction:"all",selectOnFocus:true,valueField:"name",allowBlank:false,value:editing?(rep.name||"").unescapeHTML():"",getValue:function(){return this.getRawValue()},getRecord:function(){var rec=this.selectedIndex>=0?this.store.getAt(this.selectedIndex):null;if(!rec||rec.get("id")===""){return null}return rec},isValid:function(val){return(val||"").trim().length>0}.bind(this),updateForm:function(){var predefined=!!this.getRecord();var rec=this.getRecord();var idField=win.items.get(1);if(idField){var text;if(rec){text=rec.get("id");idField.value=""}else{var value=this.getValue();text=!value.trim()?idField.initialConfig.emptyText||"":me.generateID(value)}idField.setRawValue(idField.value||"");idField.emptyText=text;idField.applyEmptyText();idField.setValue(idField.value||"")}if(predefined){var rep=rec.get("rep");this.ownerCt.items.items.each(function(item,i){if(i>1&&item&&(item.valueField||item.dataField)){if(rec&&item instanceof Ext.form.ComboBox&&item.dataField){item.setValue(rep[item.dataField]||"")}else{if(rec&&rep.type===TYPE.COMPLEX){item.setValue(rep[item.valueField]||[])}else{if(rec&&rep[item.valueField]!==undefined){var val=rep[item.valueField];if(typeof val==="number"&&(val==NEGATIVE_INFINITY||val==POSITIVE_INFINITY)){item.setValue((item.initialConfig||{}).value||"")}else{if(val instanceof Array){if(rep.type===TYPE.ENUM){val=val.map(function(v){if(typeof v==="string"){return v.unescapeHTML()}return{id:v.id,title:v.title.unescapeHTML(),value:v.value}})}else{val=val.invoke("unescapeHTML")}}item.setValue(val)}}else{item.setValue((item.initialConfig||{}).value||"")}}}}})}this.ownerCt.items.items.invoke("setDisabled",predefined);this.setDisabled(false);var type=this.ownerCt.getSelectedDataType();if(type){this.ownerCt.items.get(4).setDisabled(!type.asList||predefined)}if(editing){this.ownerCt.items.get(3).setDisabled(true)}},listeners:{select:function(){this.updateForm()},change:function(){this.updateForm()}}})},getIDField:function(editing,rep){return new Ext.form.TextField({fieldLabel:I18N.ShowAddDialog.Identifier,selectOnFocus:true,hidden:true,tabIndex:-100,emptyText:" ",valueField:"id",value:editing?rep.id:"",getValue:function(){return this.el.getValue().trim()},listeners:{change:function(){this.value=this.getRawValue()}}})},getDescriptionField:function(editing,rep){return new Ext.form.TextField({fieldLabel:I18N.ShowAddDialog.Description,emptyText:"",valueField:"description",value:editing?(rep.description||"").unescapeHTML():""})},getTypeField:function(win,editing,types){return new Ext.form.ComboBox({store:this.getAllMetaDataTypesStore(types),value:types[0].type||types[0],fieldLabel:I18N.ShowAddDialog.DataType,displayField:"title",valueField:"type",typeAhead:true,mode:"local",allowBlank:false,triggerAction:"all",forceSelection:true,selectOnFocus:true,disabled:editing,listeners:{change:this.syncSize.bind(this,win,editing),select:this.syncSize.bind(this,win,editing)}})},getIsListField:function(win,editing){return new Ext.form.Checkbox({valueField:"isList",boxLabel:I18N.ShowAddDialog.AsList,hideLabel:true,disabled:editing?false:true,style:"margin:4px 0px 2px 0px;",onRender:function(){Ext.form.Checkbox.prototype.onRender.apply(this,arguments);this.wrap.setStyle({left:"350px",position:"absolute",top:"-24px"});this.container.parent().setStyle({overflow:"visible",margin:"0"});this.container.child("label").setStyle({top:"-2px"})},listeners:{check:this.syncSize.bind(this,win,editing)}})},getStringInfoField:function(){return new Ext.form.TextField({fieldLabel:I18N.ShowAddDialog.DefaultValue,valueField:"defaultValue",displayType:TYPE.STRING,displayTypeList:false})},getStringInfoMultiField:function(){return new Ext.form.TextArea({fieldLabel:I18N.ShowAddDialog.DefaultValue,valueField:"defaultValue",displayType:TYPE.STRING_MULTI,displayTypeList:false,maxLength:255,maxLengthText:I18N.ShowAddDialog.maxLengthText})},getGlossaryLinkField:function(){return new Signavio.glossary.CategorySelector({fieldLabel:I18N.ShowAddDialog.UseOnly,displayType:TYPE.GLOSSARY,categoryStore:this.glossaryCategories,showDummy:true,allowBlank:true})},getDateField:function(editing){return new Ext.form.TextField({fieldLabel:I18N.ShowAddDialog.DateFormat+" "+this.getInfo(I18N.ShowAddDialog.DateFormatInfo),valueField:"dateFormat",displayType:TYPE.DATE,getValue:function(){var value=Ext.form.TextField.prototype.getValue.call(this);return value.replace(/[\&\<\>]/g," ")},disabled:editing?true:false})},getTextListField:function(win,editing){return new Ext.ux.form.TextFieldList({fieldLabel:I18N.ShowAddDialog.Items,valueField:"items",invalidText:I18N.ShowAddDialog.invalidItems,displayType:TYPE.ENUM,data:[],itemFieldTpl:new Ext.XTemplate("<ol>",'<tpl for=".">',"<li>","{[Signavio.Utils.escapeHTML(values)]} ",'<span class="x-smaller x-icons">'," ",'<tpl if="xindex != 1">','<a href="#{[xindex-1]}" class="x-move-up" tabindex="-1" ext:qtip="{[(Ext.ux.getI18N("moveUp"))]}">&nbsp;</a> ',"</tpl>",'<tpl if="xindex != xcount">','<a href="#{[xindex-1]}" class="x-move-down" tabindex="-1" ext:qtip="{[(Ext.ux.getI18N("moveDown"))]}">&nbsp;</a> ',"</tpl>",'<a href="#{[xindex-1]}" class="x-edit" tabindex="-1" ext:qtip="{[(Ext.ux.getI18N("btnEdit"))]}">&nbsp;</a> ','<a href="#{[xindex-1]}" class="x-star {[xindex-1 == this.defaultItemIndex?"x-stared":""]}" tabindex="-1" ext:qtip="{[(Signavio.I18N.Repository.MetaData.ShowAddDialog[xindex-1 == this.defaultItemIndex?"stared":"star"])]}">&nbsp;</a> ','<a href="#{[xindex-1]}" class="x-remove" tabindex="-1" ext:qtip="{[(Ext.ux.getI18N("btnRemove"))]}">&nbsp;</a>',"</span>","</li></tpl></ol>"),onUpdateView:this.syncSize.bind(this,win,editing),updateView:function(){var data=this.data.map(function(d){return String(d&&"string"==typeof d.title?d.title:"string"==typeof d?d:"").replace(/</g,"&lt;")});if(!this.itemFieldTpl||!this.itemField){return}this.itemFieldTpl.defaultItemIndex=this.defaultItemIndex;this.itemFieldTpl.overwrite(this.itemField,data||[]);if(!this.emptyListText){this.itemField.setDisplayed((data||[]).length>0)}this.updateEvents();if(this.ownerCt&&this.ownerCt.updateSize){this.ownerCt.updateSize()}this.onUpdateView()},isValid:function(val){return val instanceof Array&&val.length>0},getValue:function(){var value=Ext.ux.form.TextFieldList.prototype.getValue.apply(this,arguments);if(value instanceof Array){value=value.without("").compact()}return value},startEdit:function(index){if(this.editing!==undefined){this.stopEdit()}this.editing=index;var el=this.itemField.query("li")[index];Ext.fly(el).addClass("x-editing");this.setRawValue(this.data[index].title);window.setTimeout(this.focus.bind(this),10);this.onStartEdit()},updateEvents:function(){Ext.ux.form.TextFieldList.prototype.updateEvents.call(this);this.itemField.select("a.x-star").on("click",function(e,t){Event.stop(e);var index=parseInt(t.getAttribute("href").split("#").last());this.setDefaultItem(index);this.updateView()}.bind(this))},setDefaultItem:function(index){if(this.defaultItemIndex==index){delete this.defaultItemIndex}else{this.defaultItemIndex=index}},onTriggerClick:function(){var index=this.editing!==undefined?this.editing:this.data.length;var value=String(this.getRawValue()).strip();if(!value){return}if(this.editing!==undefined){this.data[this.editing].title=value;this.stopEdit()}else{this.data.push({id:value,title:value,value:value})}this.setRawValue("");this.updateView();var ni=(this.itemField.query("li")||[])[index];if(ni&&this.ownerCt){Ext.fly(ni).scrollIntoView(this.ownerCt.body)}window.setTimeout(this.focus.bind(this),10)}})},getMininumNumberField:function(){return new Ext.form.NumberField({fieldLabel:I18N.ShowAddDialog.Minimum,valueField:"min",displayType:TYPE.NUMBER,decimalPrecision:3,decimalSeparator:Signavio.Utils.getDecimalSeparator(),invalidText:I18N.ShowAddDialog.invalidMinMax,isValid:function(min){var max=this.ownerCt.items.get(this.ownerCt.items.indexOf(this)+1).getValue();return typeof max!=="number"||typeof min!=="number"||max>=min}})},getMaximumNumberField:function(){return new Ext.form.NumberField({fieldLabel:I18N.ShowAddDialog.Maximum,valueField:"max",decimalPrecision:3,decimalSeparator:Signavio.Utils.getDecimalSeparator(),displayType:TYPE.NUMBER})},getComplexField:function(isEditingMode){var complexSubAttributeWidth=150;var defaultType=TYPE.STRING;var gridHeight=250;var gridWidth=600;var that=this;var newCount=0;var complexMetaTypes=[{type:TYPE.STRING,asList:true},TYPE.STRING_MULTI,TYPE.ENUM,TYPE.NUMBER,"MetaDataBoolean"];var complexTypeToStencilSetType=new Hash();complexTypeToStencilSetType.set(TYPE.STRING,"String");complexTypeToStencilSetType.set(TYPE.STRING_MULTI,"Text");complexTypeToStencilSetType.set(TYPE.ENUM,"Choice");complexTypeToStencilSetType.set(TYPE.NUMBER,"Number");complexTypeToStencilSetType.set("MetaDataBoolean","Boolean");var complexTypeGrid=new Ext.grid.EditorGridPanel({store:new Ext.data.SimpleStore({fields:["name","description","type","asList","specificFields"],data:[]}),sm:new Ext.grid.CellSelectionModel({handleKeyDown:function(){},initEvents:function(){}}),width:gridWidth,height:gridHeight,cls:"ak-complex-type-grid",columns:[{fixed:true,header:I18N.Complex.Name,width:100,sortable:false,dataIndex:"name",renderer:function(value,cell,record,row,col){cell.css+=" ak-complex-type-grid-cell";cell.css+=" ak-complex-type-name-cell";complexTypeGrid.renderNameField(record,value,row,col)}},{fixed:true,header:I18N.Complex.DataType,width:120,sortable:false,dataIndex:"type",renderer:function(value,cell,record,row,col){cell.css+=" ak-complex-type-grid-cell";cell.css+=" ak-complex-type-type-cell";complexTypeGrid.renderTypeField(record,value,row,col)}},{header:I18N.Complex.SpecificData,sortable:false,width:225,fixed:true,dataIndex:"specificData",renderer:function(value,cell,record,row,col){cell.css+=" ak-complex-type-grid-cell";cell.css+=" ak-complex-type-specfic-data-cell";cell.css+=" ak-complex-type-grid-vertical-align-column";complexTypeGrid.renderTypeSpecificFields(record.get("type"),record,value,row,col)}},{header:I18N.Complex.ColWidth,sortable:false,width:70,fixed:true,dataIndex:"width",renderer:function(value,cell,record,row,col){cell.css+=" ak-complex-type-grid-cell";cell.css+=" ak-complex-type-width-cell";complexTypeGrid.renderColWidthField(record,value,row,col)}},{header:"",sortable:false,width:65,fixed:true,renderer:function(value,cell,record,row,col){cell.css+=" ak-complex-type-tools-cell";cell.css+=" ak-complex-type-grid-cell";complexTypeGrid.renderListToolsField(record,value,row,col)}}],valueField:"complexItems",enableColumnResize:false,enableDragDrop:false,enableColumnMove:false,enableHdMenu:false,disableSelection:true,displayType:TYPE.COMPLEX,listeners:{render:function(complexGrid){complexGrid.addAttributeLink=new Ext.LinkButton({style:'right: 0; position: absolute; top: -17px; background-image: url("/images/famfamfam/add.png");background-position: 1px -1px;background-repeat: no-repeat;padding-left: 22px;padding-bottom: 3px;cursor:pointer;',text:I18N.Complex.AddAttribute,renderTo:complexGrid.el,click:function(){complexTypeGrid.store.add(new Ext.data.Record({name:I18N.Complex.NewAttribute+" "+(++newCount),type:defaultType,isList:false,specificData:{},isOld:false,width:complexSubAttributeWidth}));window.setTimeout(function(){complexTypeGrid.updateMoveArrows()},100)}});var attributesLabel=document.createElement("div");if(Ext.isIE8){attributesLabel.innerText=I18N.Complex.Attributes}else{attributesLabel.textContent=I18N.Complex.Attributes}attributesLabel.className="ak-complex-type-grid-attributes-label";complexGrid.el.dom.appendChild(attributesLabel);window.setTimeout(function(){if(isEditingMode===true){complexGrid.el.mask(I18N.Complex.LoadingChildAttributes,"x-waiting-box")}},200)}},renderNameField:function(record,value,row,col){window.setTimeout(function(){var fieldCell=Ext.get(this.view.getCell(row,col));while(fieldCell.dom.firstChild){fieldCell.dom.removeChild(fieldCell.dom.firstChild)}var nameField=new Ext.form.TextField({cls:"ak-complex-type-grid-name-field",renderTo:fieldCell,value:value||"",width:90,record:record,cellCol:col,cellRow:row,listeners:{change:function(textField,newValue){complexTypeGrid.store.suspendEvents();record.set("name",newValue);complexTypeGrid.store.resumeEvents()}}});record.nameField=nameField}.bind(this),100)},renderColWidthField:function(record,value,row,col){window.setTimeout(function(){var fieldCell=Ext.get(this.view.getCell(row,col));while(fieldCell.dom.firstChild){fieldCell.dom.removeChild(fieldCell.dom.firstChild)}var colWidthField=new Ext.form.NumberField({cls:"ak-complex-type-grid-width-field",renderTo:fieldCell,width:50,allowDecimals:false,allowNegative:false,record:record,value:value,cellCol:col,cellRow:row,listeners:{change:function(numberField,newValue){complexTypeGrid.store.suspendEvents();record.set("width",newValue);complexTypeGrid.store.resumeEvents()},render:function(){var pxLabel=document.createElement("div");pxLabel.className="ak-complex-type-grid-width-field-label";if(Ext.isIE8){pxLabel.innerText=I18N.Complex.ColPx}else{pxLabel.textContent=I18N.Complex.ColPx}fieldCell.dom.appendChild(pxLabel)}}})}.bind(this),100)},renderTypeField:function(record,value,row,col){window.setTimeout(function(){var fieldCell=Ext.get(this.view.getCell(row,col));while(fieldCell.dom.firstChild){fieldCell.dom.removeChild(fieldCell.dom.firstChild)}var availableTypes=[];(complexMetaTypes||[]).each(function(metaType){var type=(typeof(metaType)==="string")?metaType:metaType.type;if(type!==TYPE.COMPLEX){availableTypes.push([I18N.Types[type],type,false]);if(typeof(metaType)!=="string"){availableTypes.push([I18N.Types[type]+I18N.Complex.AsList,type+"-list",true])}}});var typeField=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","id","isList"],data:availableTypes}),displayField:"name",mode:"local",triggerAction:"all",disabled:(isEditingMode===true&&record.get("isOld")===true),valueField:"id",renderTo:fieldCell,listClass:"ak-complex-type-grid-type-field-list",record:record,cellCol:col,width:110,editable:false,value:value,cellRow:row,listWidth:180,listeners:{select:function(typeField,valueRecord){complexTypeGrid.store.suspendEvents();record.set("type",valueRecord.get("id"));record.set("isList",valueRecord.get("isList"));record.set("specificData",{});complexTypeGrid.store.resumeEvents();complexTypeGrid.renderTypeSpecificFields(valueRecord.get("id"),record,null,complexTypeGrid.store.indexOfId(record.id),col+1)},render:function(typeField){typeField.el.parent().addClass("ak-complex-type-grid-type-field")}}})}.bind(this),100)},renderTypeSpecificFields:function(type,record,value,row,col){window.setTimeout(function(){var fieldCell=Ext.get(this.view.getCell(row,col));while(fieldCell.dom.firstChild){fieldCell.dom.removeChild(fieldCell.dom.firstChild)}var fieldsWrapper=new Ext.Panel({border:false,cls:"ak-complex-type-grid-fields-wrapper",renderTo:fieldCell,width:320,listeners:{render:function(fieldsWrapper){var isList=record.get("isList");var fieldsToAdd=[];switch(type){case TYPE.STRING:if(isList===false){var stringInfoListField=that.getStringInfoField();stringInfoListField.valueField="value";stringInfoListField.addClass("ak-complex-type-grid-input");fieldsToAdd.push(stringInfoListField)}break;case TYPE.STRING_MULTI:var stringInfoMultiField=that.getStringInfoMultiField();stringInfoMultiField.valueField="value";stringInfoMultiField.setHeight(20);stringInfoMultiField.addClass("ak-complex-type-grid-input");fieldsToAdd.push(stringInfoMultiField);break;case TYPE.NUMBER:var minField=that.getMininumNumberField();minField.addClass("ak-complex-type-grid-input");fieldsToAdd.push(minField);var maxField=that.getMaximumNumberField();maxField.addClass("ak-complex-type-grid-input");fieldsToAdd.push(maxField);break;case TYPE.ENUM:var enumField=that.getTextListField();enumField.onUpdateView=Ext.emptyFn;fieldsToAdd.push(enumField);break}fieldsToAdd.each(function(field){var fieldLabel=field.fieldLabel;var fieldName=field.dataField||field.valueField;field.addClass("ak-complex-type-grid-element-"+type);var label=new Ext.form.Label({html:fieldLabel+":",cls:"ak-complex-type-grid-element-label ak-complex-type-grid-element-label-"+type});fieldsWrapper.add(label);field.on("render",function(){var specficData=record.get("specificData");if(typeof(specficData[fieldName])!=="undefined"){if(field.setValue instanceof Function){field.setValue(specficData[fieldName]);if(record.get("type")===TYPE.ENUM){var defaultValue=record.get("defaultValue");if(defaultValue&&defaultValue!==""){var selIndex=-1;(specficData[fieldName]||[]).each(function(item,index){if(item.id===defaultValue){selIndex=index}});if(selIndex>=0){field.setDefaultItem(selIndex)}}field.initValue()}}}});var changeFunction=function(){if(field.getValue instanceof Function){var specificValues=record.get("specificData");specificValues[fieldName]=field.getValue();record.set("specificData",specificValues)}};field.on("change",changeFunction);fieldsWrapper.add(field)});fieldsWrapper.doLayout();var makeValidIdentifier=function(key){return(key||"").replace(/[^0-9a-zA-Z_.]+/g,"")};var makeNewValidId=function(index){return"ci"+Date.now()+Math.floor((Math.random()*100000000)+1)+index};fieldsWrapper.getValue=function(){var serializedFields=[];fieldsToAdd.each(function(field){var value=field.getValue();if(field.valueField==="items"&&field instanceof Ext.ux.form.TextFieldList){var newItems=[];(value||[]).each(function(item,index){var newId=makeNewValidId(index);if(typeof item.value!=="undefined"&&typeof item.title!=="undefined"){var newItem={};newItem.id=makeValidIdentifier(item.id)||newId;newItem.value=makeValidIdentifier(item.value)||newId;newItem.title=Signavio.Utils.escapeHTML(item.title);newItems.push(newItem)}});value=newItems}serializedFields.push({name:field.dataField||field.valueField,value:value})});return serializedFields};if(fieldsToAdd.length===0){var noFieldsSpan=document.createElement("div");if(Ext.isIE8){noFieldsSpan.innerText=I18N.Complex.NoFields}else{noFieldsSpan.textContent=I18N.Complex.NoFields}noFieldsSpan.className="ak-complex-type-grid-no-fields-text";fieldsWrapper.body.dom.appendChild(noFieldsSpan)}record.fieldsWrapper=fieldsWrapper;record.fieldsWrapper.fields=fieldsToAdd}}})}.bind(this),100)},moveRecord:function(record,down){var store=complexTypeGrid.store;var recordIndex=store.indexOfId(record.id);store.remove(record);store.insert(recordIndex+(down===true?1:-1),[record]);complexTypeGrid.updateMoveArrows()},updateMoveArrows:function(){window.setTimeout(function(){var recordLength=complexTypeGrid.store.getCount();for(var i=0;i<recordLength;i++){var cell=Ext.get(this.view.getCell(i,4));var cellArrowTop=cell.child(".ak-complex-type-grid-attributes-top-arrow-link");if(cellArrowTop!==null){cellArrowTop.removeClass("ak-complex-type-grid-attributes-hidden-arrow-link")}var cellArrowDown=cell.child(".ak-complex-type-grid-attributes-bottom-arrow-link");if(cellArrowDown!==null){cellArrowDown.removeClass("ak-complex-type-grid-attributes-hidden-arrow-link")}}var firstCell=Ext.get(this.view.getCell(0,4));var cellArrowTop=firstCell.child(".ak-complex-type-grid-attributes-top-arrow-link");if(cellArrowTop!==null){cellArrowTop.addClass("ak-complex-type-grid-attributes-hidden-arrow-link")}var lastCell=Ext.get(this.view.getCell(recordLength-1,4));var cellArrowDown=lastCell.child(".ak-complex-type-grid-attributes-bottom-arrow-link");if(cellArrowDown!==null){cellArrowDown.addClass("ak-complex-type-grid-attributes-hidden-arrow-link")}}.bind(this),200)},renderListToolsField:function(record,value,row,col){window.setTimeout(function(){var fieldCell=Ext.get(this.view.getCell(row,col));while(fieldCell.dom.firstChild){fieldCell.dom.removeChild(fieldCell.dom.firstChild)}var removeLink=document.createElement("div");removeLink.className="ak-complex-type-grid-attributes-remove-link";if(Ext.isIE8){removeLink.setAttribute("title",I18N.Complex.RemoveAttr)}else{removeLink.setAttributeNS("ext","qtip",I18N.Complex.RemoveAttr)}fieldCell.dom.appendChild(removeLink);Ext.get(removeLink).on("click",function(){Ext.Msg.confirm(I18N.Complex.RemoveAttr,I18N.Complex.RemoveAttrMsg,function(buttonText){if(buttonText==="yes"){complexTypeGrid.store.remove(record);if(complexTypeGrid.store.getCount()!==0){complexTypeGrid.updateMoveArrows()}}})});var topArrow=document.createElement("div");topArrow.className="ak-complex-type-grid-attributes-top-arrow-link";if(Ext.isIE8){topArrow.setAttribute("title",I18N.Complex.MoveUp)}else{topArrow.setAttributeNS("ext","qtip",I18N.Complex.MoveUp)}Ext.get(topArrow).on("click",function(){complexTypeGrid.moveRecord(record,false)});fieldCell.dom.appendChild(topArrow);var bottomArrow=document.createElement("div");bottomArrow.className="ak-complex-type-grid-attributes-bottom-arrow-link";if(Ext.isIE8){bottomArrow.setAttribute("title",I18N.Complex.MoveDown)}else{bottomArrow.setAttributeNS("ext","qtip",I18N.Complex.MoveDown)}Ext.get(bottomArrow).on("click",function(){complexTypeGrid.moveRecord(record,true)});fieldCell.dom.appendChild(bottomArrow)}.bind(this),100)},getValue:function(){var attributes=[];complexTypeGrid.store.each(function(record){var recordType=record.get("type");if(record.get("isList")===true){recordType=recordType.substring(0,recordType.length-5)}var recordName=Signavio.Utils.escapeHTML(record.get("name"))||"";var jsonAttribute={name:recordName,type:complexTypeToStencilSetType.get(recordType),id:record.get("id")||recordName.toLowerCase().replace(/[^0-9a-z]+/g,"").substring(0,32),width:record.get("width")||complexSubAttributeWidth};if(record.get("isList")===true){jsonAttribute.isList=true}if(record.fieldsWrapper){var serializedSpecificFields=record.fieldsWrapper.getValue()||[];serializedSpecificFields.each(function(serializedSpecificField){jsonAttribute[serializedSpecificField.name]=serializedSpecificField.value;if(recordType===TYPE.ENUM&&serializedSpecificField.name==="items"){var items=serializedSpecificField.value;var defaultIndex=record.fieldsWrapper.fields[0].defaultItemIndex;if("number"==typeof defaultIndex&&items[defaultIndex]){jsonAttribute.value=items[defaultIndex].id}}})}attributes.push(jsonAttribute)});return(attributes.length>0)?attributes:null},setValue:function(value){var complexItems=(value||[]).clone();complexItems.each(function(subAttribute){var complexType=complexTypeToStencilSetType.find(function(){return(arguments[0][1]===subAttribute.type)})[0];if(subAttribute.isList===true){complexType+="-list"}var newAttributeRecord=new Ext.data.Record({name:Signavio.Utils.unescapeHTML(subAttribute.name),type:complexType,id:subAttribute.id,isList:subAttribute.isList||false,width:subAttribute.width||complexSubAttributeWidth,isOld:true,specificData:{}});var dummySubAttribute=Object.clone(subAttribute);delete dummySubAttribute.name;delete dummySubAttribute.type;delete dummySubAttribute.isList;newAttributeRecord.set("specificData",dummySubAttribute);if(complexType===TYPE.ENUM&&subAttribute.value&&subAttribute.value!==""){newAttributeRecord.set("defaultValue",subAttribute.value)}complexTypeGrid.store.add(newAttributeRecord)});if(isEditingMode===true){window.setTimeout(function(){complexTypeGrid.el.unmask();complexTypeGrid.updateMoveArrows()},1000)}},validate:function(){var invalidRecord=null;if(complexTypeGrid.store.getCount()===0){return I18N.Complex.NoChildAttributes}invalidRecord=null;complexTypeGrid.store.each(function(record){var name=record.get("name")||"";if(name.trim()===""){invalidRecord=record;return}});if(invalidRecord!==null){return I18N.Complex.NoChildAttributeName}invalidRecord=null;complexTypeGrid.store.each(function(record){var width=record.get("width")||"";if(width===""||width<=0){invalidRecord=record;return}});if(invalidRecord!==null){return I18N.Complex.WrongColWidth}complexTypeGrid.store.each(function(record){if(record.get("type")===TYPE.ENUM){var value=record.fieldsWrapper.getValue();if(value instanceof Array&&value[0].value instanceof Array&&value[0].value.length<=0){invalidRecord=record;return}}});if(invalidRecord!==null){return I18N.ShowAddDialog.invalidItems}invalidRecord=null;complexTypeGrid.store.each(function(record){var fieldsWrapper=record.fieldsWrapper;fieldsWrapper.fields.each(function(field){if(field.visible!==false&&field.isValid instanceof Function&&field.isValid===false){invalidRecord=invalidItem;return}})});if(invalidRecord!==null){var invalidText=I18N.ShowAddDialog.InvalidFields+invalidItem.fieldLabel;if(invalidItem.invalidText){invalidText=invalidItem.invalidText}return invalidText}invalidRecord=null;complexTypeGrid.store.each(function(record){if(record.get("type")===TYPE.NUMBER){var value=record.fieldsWrapper.getValue();var minVal=value[0].value||-2147483648;var maxVal=value[1].value||2147483647;if(minVal>=maxVal){invalidRecord=record}}});if(invalidRecord!==null){return I18N.ShowAddDialog.invalidMinMax}var twoSameRecords=false;complexTypeGrid.store.each(function(record1,index1){complexTypeGrid.store.each(function(record2,index2){if(index1!==index2&&record1.get("name").trim()===record2.get("name").trim()){twoSameRecords=true}})});if(twoSameRecords===true){return I18N.Complex.InvalidNames}return null}});return complexTypeGrid},getMultilanguageField:function(isGlossary){return new Ext.form.Checkbox({valueField:"multilanguage",boxLabel:I18N.ShowAddDialog.asMultilanguage,labelSeparator:"",disabled:false,style:"position: relative; top: 2px;",displayType:[TYPE.STRING,TYPE.STRING_MULTI,TYPE.COMPLEX]})},syncSize:function(win,editing){var isExisting=!!win.getForm().getRecord();var isList=!!win.getIsList().getValue();var type;if(editing){win.getIsList().setDisabled(true)}else{type=win.getSelectedDataType();if(type){isList=!!type.asList&&isList;var field=win.getIsList();if(field instanceof Ext.form.Checkbox&&!isList){field.checked=false;field.el.dom.checked=false}field.setRawValue(isList);field.value=isList;field.setDisabled(!type.asList||isExisting)}}type=win.getType().getValue();win.items.each(function(item){if(item.displayType&&item.container){var types=[].concat(item.displayType).compact();var visible=!!type&&types.include(type)&&(item.displayTypeList!==false||!isList);if(item.displayType!==TYPE.COMPLEX){item.container.parent().setDisplayed(visible);item[visible?"show":"hide"]()}else{item[visible?"removeClass":"addClass"]("ak-complex-type-grid-hidden")}item.visible=visible}else{if(item.hidden){item.container.parent().setDisplayed(false)}}});win.body.setHeight();var height=0;var isComplexAttribute=win.getType().getValue()===TYPE.COMPLEX;win.items.each(function(item){if(item&&item.container&&item.el&&!item.hidden){if(item.displayType!==TYPE.COMPLEX){height+=item.container.parent().getHeight()+item.el.getPadding("tb")+item.el.getMargins("tb")+1}else{height+=item.el.getHeight()+item.el.getPadding("tb")+item.el.getMargins("tb")+1}}});win.body.setHeight(height+win.body.getPadding("tb"));win.setWidth(isComplexAttribute?800:450);if(isComplexAttribute){win.getComplex().setWidth(600)}win.syncSize();win.center()},fillData:function(win,rep){win.getIsList().setValue(!!rep.isList);win.getMultilanguage().setValue(!!rep.multilanguage);switch(rep.type){case TYPE.COMPLEX:var sel_complexItems=rep.complexItems||[];win.getComplex().setValue(sel_complexItems);break;case TYPE.STRING:var sel_defaultText=String(rep.defaultValue||"").unescapeHTML();if(rep.lineWrap==false){win.getStringInfo().setValue(sel_defaultText)}else{win.getStringInfoMulti().setValue(sel_defaultText)}break;case TYPE.GLOSSARY:var sel_category=rep.category||"";if(!sel_category.startsWith(GLOSSARY_ROOT)){sel_category=GLOSSARY_ROOT+sel_category}win.getGlossaryLink().setValue(sel_category);break;case TYPE.DATE:var sel_dateFormat=rep.dateFormat;win.getDate().setValue(sel_dateFormat);break;case TYPE.NUMBER:var sel_min=rep.min;var sel_max=rep.max;win.getMinimumNumber().setValue("number"==typeof sel_min&&sel_min!==NEGATIVE_INFINITY?sel_min:"");win.getMaximumNumber().setValue("number"==typeof sel_max&&sel_max!==POSITIVE_INFINITY?sel_max:"");case TYPE.ENUM:var sel_items=rep.items;if(sel_items!==undefined){if(sel_items instanceof Array){sel_items=sel_items.map(function(item){if(typeof item==="string"){return item.unescapeHTML()}return{id:item.id,value:item.value,title:item.title}})}win.getTextList().value=sel_items;if(rep.defaultValue){win.getTextList().defaultItemIndex=rep.items.indexOf(rep.items.find(function(item){return(rep.defaultValue)?Signavio.Utils.unescapeHTML(rep.defaultValue)==item.id:rep.defaultValue==item.id}))}win.getTextList().initValue()}}},getRootNode:function(node){while(node.parentNode){node=node.parentNode}return node},getParentNode:function(rep,tree){var root=tree.root;if(!rep.parentCategory){return root}return root.childNodes.find(function(node){return node.attributes.identifier===rep.parentCategory})||root},createCategory:function(root,attrs){var rep={name:attrs.name,color:attrs.color,order:attrs.order};if(attrs.parent){rep.parentCategory=attrs.parent}var record=Signavio.Core.RecordCreator.create("cat","",rep);var parent=this.getParentNode(rep,this.categoryTree);var that=this;var createNode=function(parent){var store=parent.attributes.store;var success=function(){store.un("submitted",success);that.reloadParentCategory(null,parent)};var failure=function(context,record){store.un("submitfailed",failure);store.remove(record,false);that.handleSubmitFail(name)};store.on("submitfailed",failure);store.on("submitted",success);store.add(record,true)};if(!parent.attributes.store){this.categoryTree.loader.requestData(parent,function(tree,enhancedNode){createNode(enhancedNode)}.bind(this))}else{createNode(parent)}},notifyCategoryChange:function(clb){var options=this.glossaryCategories.lastOptions;options.force=true;options.callback=clb;this.glossaryCategories.load(options)},updateUI:function(){var nodes=$A(arguments).compact();nodes.each(function(node){var store=node.attributes.store;if(store){node.attributes.expandable=store.getCount()>1;node.ui.updateExpandIcon()}})},editCategory:function(store,node,attrs){var record=store.findByIdentifier(node.attributes.identifier);if(!record){return}var rep=Object.clone(record.get("rep"));rep.name=attrs.name;rep.color=attrs.color;rep.order=attrs.order;var oldParent=node.parentNode;store.suspendEvents();if(attrs.parent!=rep.parentCategory){rep.parentCategory=attrs.parent;if(!attrs.parent){delete rep.parentCategory}store.remove(record,false);store.removedRecords=[]}var parent=this.getParentNode(rep,this.categoryTree);var that=this;record.set("rep",rep);store.resumeEvents();store.commitChanges(false,function(){if(parent===oldParent){that.notifyCategoryChange();return}that.reloadParentCategory(node,parent,oldParent)})},reloadParentCategory:function(node,parent,oldParent){var that=this;var options=parent.attributes.store.lastOptions;options.force=true;options.callback=function(){that.updateCategoryTree(node,parent,oldParent)};parent.attributes.store.load(options)},updateCategoryTree:function(node,parent,oldParent){var that=this;this.notifyCategoryChange(function(){parent=that.findNode(parent.attributes.identifier)||that.categoryTree.root;if(!parent.attributes.store){that.categoryTree.loader.requestData(parent,function(tree,extendedParent){that.afterCategoryChange(node,extendedParent,oldParent)})}else{that.afterCategoryChange(node,parent,oldParent)}})},afterCategoryChange:function(node,parent,oldParent){this.updateUI(parent,oldParent);if(parent.attributes.store&&parent.attributes.expandable){parent.expand()}if(!node){return}var n=this.findNode(node.attributes.identifier);if(n){n.select()}},handleSubmitFail:function(name,editing){var invalidText=Signavio.I18N.Repository.MetaData.Categories[editing?"editError":"addError"].replace("{name}",name);Ext.Msg.alert(Signavio.I18N.Repository.MetaData.Categories[editing?"editCategory":"addNew"],invalidText).setIcon(Ext.Msg.INFO).getDialog().syncSize()},handleCategoryChange:function(node,attrs,editing){var root=this.categoryTree.root;var that=this;if(editing){var store=(node.parentNode||node).attributes.store;var failure=function(context,record){store.un("submitfailed",failure);that.handleSubmitFail(attrs.name,true)};store.on("submitfailed",failure);this.editCategory(store,node,attrs)}else{this.createCategory(root,attrs)}},handleMetaChange:function(win,editing,selection,selections){if(!editing){var id=win.getID().getValue()||"";if(!id.trim()){id=this.generateID(win.getForm().getValue());win.getID().setValue(id)}var meta=this.getMetaByIdentifier(id);if(meta){this.setBindingsForMetaData(selections,meta);win.close();return}var o={};win.items.each(function(item){var key=item.dataField||item.valueField;var value=item.getValue();var isVal=!!(value||value instanceof Array)||(value===0);if(TYPE.ENUM===o.type&&key==="items"){var makeValidIdentifier=function(key){return(key||"").replace(/[^0-9a-zA-Z_.]+/g,"")};var makeNewValidId=function(index){return"ci"+Date.now()+Math.floor((Math.random()*100000000)+1)+index};var valItems=value instanceof Array?value.clone():[];value=[];valItems.forEach(function(valueItem,index){var newValue={};var newId=makeNewValidId(index);if(typeof valueItem.value!=="undefined"&&typeof valueItem.title!=="undefined"){newValue.id=makeValidIdentifier(valueItem.id)||newId;newValue.value=makeValidIdentifier(valueItem.value)||newId;newValue.title=Signavio.Utils.escapeHTML(valueItem.title);value.push(newValue)}})}if(key&&isVal&&item.visible!==false){o[key]=value}});if(TYPE.STRING_MULTI===o.type){o.lineWrap=true;o.type=TYPE.STRING}if(TYPE.ENUM===o.type&&o.items){if("number"==typeof win.getTextList().defaultItemIndex){o.defaultValue=o.items[win.getTextList().defaultItemIndex].id}else{delete o.defaultValue}}var invalidItems=this.getInvalidItems(win.items.items,o);if(invalidItems.length>0){var invalidText=I18N.ShowAddDialog.InvalidFields+invalidItems.pluck("fieldLabel").join("','")+"'";if(invalidItems.first().invalidText){invalidText=invalidItems.first().invalidText}Ext.Msg.alert(editing===true?I18N.ShowAddDialog.EditAttribute:I18N.ShowAddDialog.AddNewAttribute,invalidText).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}if(TYPE.COMPLEX===o.type){var validateComplexTypeState=win.items.items.find(function(item){return(item.displayType===TYPE.COMPLEX)}).validate();if(typeof(validateComplexTypeState)==="string"){Ext.Msg.alert(editing===true?I18N.ShowAddDialog.EditAttribute:I18N.ShowAddDialog.AddNewAttribute,validateComplexTypeState).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}}this.addNewMetaData(selections,o);win.close()}else{var saveStatus=true;var rep=Object.clone(selection.get("rep"));switch(rep.type){case TYPE.COMPLEX:var validateComplexTypeState=win.items.items.find(function(item){return(item.displayType===TYPE.COMPLEX)}).validate();if(typeof(validateComplexTypeState)==="string"){Ext.Msg.alert(editing===true?I18N.ShowAddDialog.EditAttribute:I18N.ShowAddDialog.AddNewAttribute,validateComplexTypeState).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}break;case TYPE.NUMBER:var old_min=rep.min;var old_max=rep.max;var new_min=win.getMinimumNumber().getValue();var new_max=win.getMaximumNumber().getValue();old_min="number"==typeof old_min?old_min:NEGATIVE_INFINITY;old_max="number"==typeof old_max?old_max:POSITIVE_INFINITY;new_min="number"==typeof new_min?new_min:NEGATIVE_INFINITY;new_max="number"==typeof new_max?new_max:POSITIVE_INFINITY;if((new_max-new_min)<(old_max-old_min)){saveStatus=false;this.showWarningForMetaData(I18N.warnTitle,I18N.warnNumber,selection,rep,win)}break;case TYPE.GLOSSARY:var old_category=rep.category;var new_category=win.getGlossaryLink().getValue();if(old_category!==new_category){saveStatus=false;this.showWarningForMetaData(I18N.warnTitle,I18N.warnGlossaryLink,selection,rep,win)}break;case TYPE.ENUM:var old_items=rep.items.map(function(item){if(typeof item==="string"){return item.unescapeHTML()}return{id:item.id,title:item.title.unescapeHTML(),value:item.value}});var new_items=win.getTextList().getValue();var new_items_ids=new_items.map(function(item){return item.id});var count_deleted=0;old_items.each(function(element){if(!new_items_ids.include(element.id)){count_deleted+=1}}.bind(this));if(count_deleted>0){saveStatus=false;this.showWarningForMetaData(I18N.warnTitle,new Ext.Template(I18N.warnEnum).apply([count_deleted]),selection,rep,win)}}this.saveAfterWarning(selection,rep,win,saveStatus,true)}},showCategoryAddWindow:function(node,editing){if(!node){return}var that=this;var form=this.getCategoryAddForm(node,editing);var win=new Ext.ux.Window({title:editing?I18N.editAttributes:I18N.addAttributes,width:450,modal:true,resizable:false,cls:"y-window-add-category",layout:"form",defaults:{width:200,labelStyle:"text-align:right; white-space:nowrap; width: 140px;",hideParent:true},labelWidth:140,items:form.items,buttons:[{text:editing?I18N.editMetaDate:I18N.commitMetaDate,handler:function(){if(!form.name.isValid()){var invalidText=form.name.invalidText||I18N.ShowAddDialog.InvalidFields+form.name.fieldLabel+"'";Ext.Msg.alert(editing?I18N.Categories.edit:I18N.Categories.addNew,invalidText).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}var attrs={name:form.name.getValue(),color:form.color.getValue(),parent:form.parent.getValue()};var parent=that.findNode(attrs.parent)||that.categoryTree.root;that.getPosition(node,parent,editing,function(position){attrs.order=position;that.handleCategoryChange(node,attrs,editing);win.close()})}}]});win.show()},getPosition:function(node,parent,editing,clb){clb=clb||Ext.emptyFn;var loader=this.categoryTree.loader;if(editing&&parent.childNodes.include(node)){var record=loader.findRecord(node.attributes.identifier);return clb(record.get("rep").order)}var getPosition=function(node,position){position=position||0;if(!node){return clb(position)}var record=loader.findRecord(node.attributes.identifier);var current=record.get("rep").order;return getPosition(node.nextSibling,Math.max(position,current+1))};var fired=false;if(!parent.attributes.store){loader.requestData(parent,function(tree,extendedParent){node.parentNode=node.parentNode||extendedParent;if(!fired){fired=true;getPosition(extendedParent.firstChild)}});return}getPosition(parent.firstChild)},getTypes:function(selections,isGlossary){var types=[].concat(Signavio.Const.META_TYPES[isGlossary?"GLOSSARY":"STENCILSET"]);if(selections.length>0&&selections.first().get("namespace")!==this.bpmn20Namespace){types=types.findAll(function(type){return(type.type||type)!=="MetaDataIks"})}return types},showAddWindow:function(selections,editing,grid){var sel,rep;var currentName="";var isGlossary=this.isGlossary(selections),metaTypes=this.getTypes(selections,isGlossary);if(editing){sel=grid.getSelectionModel().getSelected();rep=sel.get("rep");currentName=sel.get("rep").name}var createGetter=function(value){return function(){return value}};var win=new Ext.Window({title:editing?I18N.editAttributes:I18N.addAttributes,width:450,modal:true,resizable:false,layout:"form",cls:"x-window-add-meta-data",bodyStyle:"background:white;padding:10px 0 10px 10px;",defaults:{width:200,labelStyle:"text-align:right;white-space:nowrap;width:130px;",hideParent:true},labelWidth:130,getSelectedDataType:function(){var value=this.getType().getValue();return metaTypes.find(function(t){return t&&(t===value||t.type===value)})},items:null,buttons:[new Ext.Button({text:I18N.cancelRemove,template:new Ext.Template("<a href='#' class='x-button-plain'>{0}</a>"),handler:function(){win.close()},onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.el.on("click",function(e,t){this.handler.apply(this,arguments);e.stopEvent();return false}.bind(this))}}),{text:editing?I18N.editMetaDate:I18N.commitMetaDate,handler:function(){this.handleMetaChange(win,editing,sel,selections)}.bind(this)}]});var availableMetaDataNames=this.getAllMetaDataNames(selections);if(isGlossary===true){availableMetaDataNames=this.filterMetaDataWithGlossaryDatatypeSupport(availableMetaDataNames,metaTypes)}var form=this.getAddForm(win,availableMetaDataNames,editing,rep),id=this.getIDField(editing,rep),description=this.getDescriptionField(editing,rep),type=this.getTypeField(win,editing,metaTypes),isList=this.getIsListField(win,editing),stringInfo=this.getStringInfoField(),stringInfoMulti=this.getStringInfoMultiField(),glossaryLink=this.getGlossaryLinkField(),dateField=this.getDateField(editing),textList=this.getTextListField(win,editing),minimumNumber=this.getMininumNumberField(),maximumNumber=this.getMaximumNumberField(),multilanguage=this.getMultilanguageField(isGlossary),complexGrid=this.getComplexField(editing);var showDuplicateHint=function(form,error){var hint=document.createElement("div");hint.className="y-meta-data-error-hint";if(Ext.isIE8){hint.setAttribute("title",error)}else{hint.setAttributeNS(null,"title",error)}if(form.container&&form.container.parent()){var c=form.container.parent();c.dom.appendChild(hint);Ext.get(hint).alignTo(form.el,"r",[(editing===true)?5:20,-8])}};var removeDuplicateHint=function(form){var parent=form.container.parent();var existingHint=parent.child(".y-meta-data-error-hint");if(existingHint!==null){existingHint.remove()}};var duplicateId=false;form.on("valid",function(formField){removeDuplicateHint(formField);var newIdField=win.getForm();if(newIdField&&newIdField.getValue instanceof Function){var newId=newIdField.getValue()||"";var metaDataNames=(this.getAllMetaDataNames(selections)||[]).map(function(metaData){return metaData[0]});var metaStore=Signavio.Core.StoreManager.getStore("/meta");var allMetaDataNames=[];if(metaStore){allMetaDataNames=(metaStore.getRecords("meta")||[]).map(function(record){return record.get("rep").name})}diffMetaDataNames=allMetaDataNames.findAll(function(name){return metaDataNames.indexOf(name)===-1}).without(currentName);var isNotAvailable=false;diffMetaDataNames.each(function(metaDataName){if((metaDataName||"").toLowerCase()===Signavio.Utils.escapeHTML(newId).toLowerCase()){isNotAvailable=true}});if(isNotAvailable===true){win.buttons[1].disable();formField.el.addClass("x-form-invalid");duplicateId=true;showDuplicateHint(formField,I18N.idErrorHint2)}else{win.buttons[1].enable();duplicateId=false;formField.el.removeClass("x-form-invalid")}}}.bind(this));if(isGlossary===true&&id){form.on("valid",function(formField){if(duplicateId===false){removeDuplicateHint(formField)}var newIdField=win.getForm();var isWrongMetaDataName=false;if(newIdField&&newIdField.getValue instanceof Function){isWrongMetaDataName=this.isAvailableMetaDataName(newIdField.getValue()||"",metaTypes,editing,currentName)}if(isWrongMetaDataName===true){removeDuplicateHint(formField);win.buttons[1].disable();formField.el.addClass("x-form-invalid");showDuplicateHint(formField,I18N.idErrorHint)}else{win.buttons[1].enable();formField.el.removeClass("x-form-invalid")}}.bind(this))}[form,id,description,type,isList,stringInfo,stringInfoMulti,glossaryLink,dateField,textList,minimumNumber,maximumNumber,multilanguage,complexGrid].each(function(component){win.add(component)});win.getForm=createGetter(form);win.getID=createGetter(id);win.getDescription=createGetter(description);win.getType=createGetter(type);win.getIsList=createGetter(isList);win.getStringInfo=createGetter(stringInfo);win.getStringInfoMulti=createGetter(stringInfoMulti);win.getGlossaryLink=createGetter(glossaryLink);win.getDate=createGetter(dateField);win.getTextList=createGetter(textList);win.getMinimumNumber=createGetter(minimumNumber);win.getMaximumNumber=createGetter(maximumNumber);win.getMultilanguage=createGetter(multilanguage);win.getComplex=createGetter(complexGrid);win.on("show",this.syncSize.bind(this,win,editing));win.show();if(editing){type.disabled=false;var sel_value;if(TYPE.STRING==rep.type){if(rep.lineWrap){type.setValue(TYPE.STRING_MULTI)}else{type.setValue(TYPE.STRING)}}else{type.setValue(rep.type)}this.syncSize(win,editing);this.fillData(win,rep);type.disabled=true}return win},isAvailableMetaDataName:function(value,metaTypes,editing,currentName){var newId=this.generateID(value).trim();if(newId===""){return false}var metaDataRecord=this.getMetaByIdentifier(newId);if(typeof metaDataRecord==="undefined"){return false}else{var allowedDataTypes=this.getGlossarySupportedDataTypeNames(metaTypes);return allowedDataTypes.indexOf(metaDataRecord.get("rep").type)===-1}},getGlossarySupportedDataTypeNames:function(metaTypes){return metaTypes.map(function(metaType){return(typeof metaType==="string")?metaType:metaType.type}).compact()},filterMetaDataWithGlossaryDatatypeSupport:function(availableMetaDataNames,metaTypes){var glossaryMetaTypes=this.getGlossarySupportedDataTypeNames(metaTypes);return availableMetaDataNames.findAll(function(metaDataName){var metaData=metaDataName[2];if(typeof metaData!=="undefined"){return glossaryMetaTypes.indexOf(metaData.type)!==-1}}).compact()},saveAfterWarning:function(sel,rep,dialog,status,commitStatus){if(status&&commitStatus){sel.beginEdit();dialog.items.each(function(item){var val=item.getValue();if((item.dataField||item.valueField)&&item.visible!==false){if(item.valueField!=="isList"&&item.valueField!=="type"){rep[(item.dataField||item.valueField)]=val}}if(item.visible!==false&&item.dataField==="category"){rep[item.dataField]=val}});if(TYPE.STRING_MULTI===rep.type){rep.lineWrap=true;rep.type=TYPE.STRING}if(TYPE.ENUM===rep.type){if("number"==typeof dialog.getTextList().defaultItemIndex){rep.defaultValue=rep.items[dialog.getTextList().defaultItemIndex].id}else{delete rep.defaultValue}}if(TYPE.NUMBER===rep.type){rep.min="number"==typeof rep.min?rep.min:NEGATIVE_INFINITY;rep.max="number"==typeof rep.max?rep.max:POSITIVE_INFINITY}sel.set("rep",rep);sel.endEdit();sel.commit()}if(status){dialog.close()}},showWarningForMetaData:function(title,message,sel,rep,window){Ext.MessageBox.show({title:title,msg:message,buttons:Ext.MessageBox.YESNO,fn:function(btn){if(btn=="yes"){this.saveAfterWarning(sel,rep,window,true,true)}if(btn=="no"){this.saveAfterWarning(sel,rep,window,true,false)}}.bind(this),icon:Ext.MessageBox.QUESTION})},getInfo:function(text){return'<img src="'+CONFIG.IMAGE_PATH+'/famfamfam/information.png" class="ak-complex-type-grid-info" ext:qtip="'+text+'" />'},getInvalidItems:function(items,data){data=data||{};return items.findAll(function(item){if(item.dataField||item.valueField){var value=data[(item.dataField||item.valueField)];if(item.initialConfig.allowBlank===false){return !value||(item.isValid instanceof Function&&!item.isValid(value))}else{if(item.visible!==false&&item.isValid instanceof Function){return !item.isValid(value)}else{return value instanceof Array&&value.length<=0}}}else{return false}})},isGlossary:function(selections){return selections.all(function(selection){return selection.get("rel")==="cat"})},getAllMetaDataTypesStore:function(types){var store=new Ext.data.SimpleStore({fields:["title","type"],data:types.map(function(type){var tname=typeof type==="object"?type.type:type;return[I18N.Types[tname]||tname||"",tname||""]})});return store},nodesToBindings:function(selections){var data={};data.glossaryBindings=selections.findAll(function(selection){return selection.get("rel")==="cat"}).map(function(selection,index){return this.getGlossaryBinding(selection.get("href"),this.getGlossaryBindings(selection.get("href")).length)}.bind(this));data.stencilsetBindings=selections.findAll(function(selection){return !selection.get("rel")}).map(function(selection){return this.getStencilsetBinding(selection,this.getStencilSetBindings(selection.get("namespace"),selection.get("id")).length)}.bind(this));return data},setBindingsForMetaData:function(selections,meta){var bindings=this.nodesToBindings(selections);var rep=Object.clone(meta.get("rep"));rep.name=rep.name.unescapeHTML();if(rep.items&&rep.items instanceof Array&&rep.items.length>0){if(rep.type===TYPE.ENUM){rep.items=rep.items.map(function(item){if(typeof item==="string"){return item.unescapeHTML()}return{id:item.id,value:item.value,title:item.title.unescapeHTML()}})}else{rep.items=rep.items.invoke("unescapeHTML")}}var oldGBindingIds=this.getCategories(rep);var gBindings=bindings.glossaryBindings.findAll(function(r){return !oldGBindingIds.include(r.category)});var oldSBindingIds=this.getStencils(rep);var sBindings=bindings.stencilsetBindings.findAll(function(r){return !oldSBindingIds.include(r.namespace+""+r.stencil)});rep.glossaryBindings=[].concat(rep.glossaryBindings,gBindings);rep.stencilsetBindings=[].concat(rep.stencilsetBindings,sBindings);if(gBindings.length>0||sBindings.length>0){meta.set("rep",rep);meta.commit()}},addNewMetaData:function(selections,data){data.isGlossaryDefinition=true;var store=Signavio.Core.StoreManager.getStore("/meta");var loaded=function(){data=Ext.apply({},data,this.nodesToBindings(selections));if(data.glossaryBindings.length===0){delete data.glossaryBindings}if(data.stencilsetBindings.length===0){delete data.stencilsetBindings}this.doAddNewMetaData(store,data)}.bind(this);if(!store){store=Signavio.Core.StoreManager.getStore("/meta",true,loaded)}else{loaded()}},doAddNewMetaData:function(store,data){var record=Signavio.Core.RecordCreator.create("meta","",data);store.add(record,true)},generateID:function(value){var newId=(value||"").toLowerCase().replace(/[^0-9a-z]+/g,"");if((newId||"").trim()===""){newId="prop";for(var i=0;i<(value||"").length;i++){newId+=value.charCodeAt(i)}}return newId.substring(0,32)},getGlossaryBinding:function(id,size){return{category:id,order:size}},getStencilsetBinding:function(selection,size){return{namespace:selection.get("namespace"),stencil:selection.get("id"),order:size}},getMetaByIdentifier:function(id){var meta=Signavio.Core.StoreManager.getStore("/meta");if(!meta||!id){return null}return meta.getRecords("meta").find(function(r){return r.get("rep").id===id||r.get("href")===id})},getCategories:function(data){return((data||{}).glossaryBindings||[]).pluck("category")},getStencils:function(data){var b=((data||{}).stencilsetBindings||[]);return b.pluck("namespace").zip(b.pluck("stencil")).invoke("join","")},getAllMetaDataNames:function(selections){var meta=Signavio.Core.StoreManager.getStore("/meta");if(!meta){return[]}var bindings=this.nodesToBindings(selections);var gb=this.getCategories(bindings);var sb=this.getStencils(bindings);var metaTypes=this.getTypes(selections).map(function(type){return typeof type=="string"?type:type.type});return meta.getRecords("meta").findAll(function(mData){return((mData.get("rep").glossaryBindings instanceof Array&&mData.get("rep").glossaryBindings.length>0)||(mData.get("rep").stencilsetBindings instanceof Array&&mData.get("rep").stencilsetBindings.length>0))&&(mData.get("rep").glossaryBindings instanceof Array&&!mData.get("rep").glossaryBindings.any(function(r){return gb.include(r.category)})&&mData.get("rep").stencilsetBindings instanceof Array&&!mData.get("rep").stencilsetBindings.any(function(r){return sb.include(r.namespace+""+r.stencil)}))&&metaTypes.include(mData.get("rep").type)}).map(function(mData){return[mData.get("rep").name.unescapeHTML(),mData.get("rep").id,mData.get("rep")]})},getGlossaryBindings:function(category){var metas=Signavio.Core.StoreManager.getStore("/meta").getRecords("meta");return metas.map(function(rec){return(rec.get("rep").glossaryBindings||[]).findAll(function(r){var id=r.category;if(!id.startsWith(GLOSSARY_ROOT)){id=GLOSSARY_ROOT+id}return id===category})}).flatten()},findAllGlossaryBindings:function(metas,category){if(!metas){metas=Signavio.Core.StoreManager.getStore("/meta").getRecords("meta")}return metas.findAll(function(rec){return(rec.get("rep").glossaryBindings||[]).any(function(r){var id=r.category;if(!id.startsWith(GLOSSARY_ROOT)){id=GLOSSARY_ROOT+id}return id===category})})},sortByGlossaryBindings:function(metas,category){var get=function(a){return(a.get("rep").glossaryBindings||[]).find(function(r){var id=r.category;if(!id.startsWith(GLOSSARY_ROOT)){id=GLOSSARY_ROOT+id}return id===category})};var m=metas.sort(function(a,b){var gBindingsA=get(a);var gBindingsB=get(b);if(!gBindingsA||!gBindingsB){return !gBindingsA&&gBindingsB?1:-1}else{if(gBindingsA!==gBindingsB&&gBindingsA.order===gBindingsB.order){gBindingsB.order++}return gBindingsA.order>gBindingsB.order?1:-1}});m.each(function(meta,index){var bind=get(meta);if(bind){bind.order=index}});return m},getStencilSetBindings:function(namespace,stencil){var metas=Signavio.Core.StoreManager.getStore("/meta").getRecords("meta");return metas.map(function(rec){return(rec.get("rep").stencilsetBindings||[]).findAll(function(r){return r.namespace===namespace&&r.stencil===stencil})}).flatten()},findAllStencilSetBindings:function(metas,namespace,stencil){if(!metas){metas=Signavio.Core.StoreManager.getStore("/meta").getRecords("meta")}return metas.findAll(function(rec){return(rec.get("rep").stencilsetBindings||[]).any(function(r){return r.namespace===namespace&&r.stencil===stencil})})},sortByStencilSetBindings:function(metas,namespace,stencil){var m=metas.sort(function(a,b){var gBindingsA=a.get("rep").name.toLowerCase();var gBindingsB=b.get("rep").name.toLowerCase();return gBindingsA<gBindingsB?-1:(gBindingsA>gBindingsB?1:0)});return m},updateMetaData:function(root,store,foo,change){if(typeof change==="string"&&change!==Ext.data.Record.COMMIT){return}var metaData=store.getRecords("meta");root.childNodes.each(function(node){node.childNodes.each(function(child){var currentMetas;if(child.attributes.rel==="cat"&&child.attributes.identifier){currentMetas=this.findAllGlossaryBindings(metaData,child.attributes.identifier);currentMetas=this.sortByGlossaryBindings(currentMetas,child.attributes.identifier)}else{if(child.attributes.rel==="stencil"&&child.attributes.namespace&&child.attributes.stencil){currentMetas=this.findAllStencilSetBindings(metaData,child.attributes.namespace,child.attributes.stencil);currentMetas=this.sortByStencilSetBindings(currentMetas,child.attributes.namespace,child.attributes.stencil)}else{return}}this.updateMetaNode(child,currentMetas)}.bind(this))}.bind(this));root.ui.fireEvent("checkchange",root,false)},getDictionaryTabPage:function(){if(!SHOW_GLOSSARY_TAB){return}return new Ext.Panel({border:false,bodyStyle:"padding: 10px;",layout:"anchor",title:I18N.Template.glossary,items:[new Ext.Panel({html:I18N.glossaryDescriptionText,cls:"y-glossary-description",bodyStyle:"padding-bottom:10px; color:#666666;",anchor:"100%",border:false}),new Ext.Panel({layout:"column",anchor:"100%",cls:"y-grids",items:this.getGlossaryPanel(),border:false})],listeners:{afterLayout:function(){var w=this;var a=w.items.get(0);var b=w.items.get(1);var h=w.getInnerHeight()-a.el.getHeight()-22;b.setHeight(h);b.items.get(0).setHeight(h);b.items.get(1).setHeight(h);b.items.get(1).items.get(0).setHeight(h/2)}}})},getAttributeGrid:function(){if(!this.attributeGrid){var store=Signavio.Core.StoreManager.getStore("/meta")||Signavio.Core.StoreManager.getRelatedStore("/meta",undefined,["dummy"]);var grid=new Ext.grid.GridPanel({title:I18N.ownAttributes,store:store,autoExpandColumn:"rep",stripeRows:false,hideHeaders:true,cls:"y-glossary-attrgrid",columnWidth:0.3,tbar:this.getAttributeGridToolBar(store),selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{emptyText:I18N.requestCategorySelection,forceFit:true,scrollOffset:0,onUpdate:function(ds,record,op){if(-1===this.ds.indexOf(record)&&this.ds.snapshot&&-1!==this.ds.snapshot.indexOf(record)){return}if(op===Ext.data.Record.EDIT){return}this.refreshRow(record)}},columns:[{dataIndex:"rep",renderer:function(rep,metadata,record){return rep.name}}]});grid.getSelectionModel().on("selectionchange",this.handleAttributeGridSelectionChange.bind(this));$w("load update remove add").each(function(operation){this.registerEventOn(grid.store,operation,this.updateGlossaryAttributeStore)}.bind(this));this.attributeGrid=grid}return grid},handleAttributeGridSelectionChange:function(selModel){var sel=selModel.getSelected();var grid=selModel.grid;var toolbar=grid.getTopToolbar();toolbar.items.each(function(item){if(!item.handleSelectionChange){return}item.handleSelectionChange(selModel,grid)});if(!sel){this.getGlossaryItemInfoPanel().update("")}else{var rep=sel.get("rep");var o={name:rep.name,type:I18N.Types[rep.lineWrap?"MetaDataStringInfoMulti":rep.type]||"",description:rep.description?rep.description:false,defaultValue:rep.defaultValue,isList:rep.isList,dateFormat:rep.dateFormat,min:typeof rep.min==="number"&&rep.min!==NEGATIVE_INFINITY?rep.min:undefined,max:typeof rep.max==="number"&&rep.max!==POSITIVE_INFINITY?rep.max:undefined};if(rep.items){o.items=rep.items.collect(function(item){return item.value||item}).join(", ")}else{o.items=false}if(rep.stencilsetBindings||rep.glossaryBindings){var bindings=[];if(rep.glossaryBindings[0]){var categories=this.glossaryCategories.getRecords();bindings.push(rep.glossaryBindings.collect(function(binding){var catId=(binding.category||"").startsWith(GLOSSARY_ROOT)?binding.category:GLOSSARY_ROOT+binding.category;var cat=categories.find(function(rec){return rec.data.href===catId});return(cat&&cat.data.rep.name||binding.category)+"<span class='y-used-in-annotation'> ("+I18N.Template.glossary+")</span>"}.bind(this)).compact().join(", "))}o.bindings=bindings.compact().join(", ");if(rep.stencilsetBindings&&rep.stencilsetBindings.length>0){o.bindings+=new Ext.XTemplate(I18N.Template.furtherBindingsGlossary).apply([rep.stencilsetBindings.size()])}}else{o.bindings=false}this.gItemInfoTemplate(false,o.isList).overwrite(this.getGlossaryItemInfoPanel().body,o)}},getAttributeGridToolBar:function(store){var createButton=function(options){return{text:options.text,icon:CONFIG.IMAGE_PATH+"/famfamfam/"+options.icon+".png",cls:"x-btn-text-icon",disabled:true,handler:options.handler||Ext.emptyFn,handleSelectionChange:options.handleSelectionChange||Ext.emptyFn}};var that=this;return[createButton({text:I18N.addAttributes,icon:"add",handler:function(){that.showAddWindow(that.categoryTree.getSelections(),false,that.attributeGrid)}}),createButton({text:I18N.editAttributes,icon:"application_form_edit",handleSelectionChange:function(model){this.setDisabled(!model.getSelected())},handler:function(){that.showAddWindow(that.categoryTree.getSelections(),true,that.attributeGrid)}}),createButton({text:I18N.removeAttributes,icon:"delete",handleSelectionChange:function(model){this.setDisabled(!model.getSelected())},handler:function(){that.removeSelection(that.attributeGrid.getSelectionModel().getSelected(),that.categoryTree)}}),"-",createButton({text:I18N.moveUp,icon:"bullet_arrow_up",handleSelectionChange:function(model){var selected=model.getSelected();var grid=model.grid;this.setDisabled(!selected||grid.getStore().indexOf(selected)===0)},handler:function(){that.moveSelection(that.attributeGrid.getSelectionModel().getSelected(),that.extractGlossaryInfo(this.categoryTree.getSelections()),-1)}}),createButton({text:I18N.moveDown,icon:"bullet_arrow_down",handleSelectionChange:function(model){var selected=model.getSelected();var grid=model.grid;var count=grid.getStore().getCount();this.setDisabled(!selected||grid.getStore().indexOf(selected)===count-1)},handler:function(){that.moveSelection(that.attributeGrid.getSelectionModel().getSelected(),that.extractGlossaryInfo(this.categoryTree.getSelections()),1)}}),"->",this.getLoadingIndicator(store)]},getCategoryTree:function(){if(this.categoryTree){return this.categoryTree}var root=new Ext.tree.TreeNode({text:"root",leaf:false,cls:"folder",expanded:true,recordRel:"cat",dataField:"rep.name",identifier:GLOSSARY_ROOT,filterFn:function(r){return r.get("rel")==="cat"}});var tree=new Signavio.Extensions.TreePanel({width:420,cls:"x-glossary-list",root:root,animate:true,enableDD:false,rootVisible:false,useArrows:true,autoScroll:true,title:I18N.categories,tbar:this.getCategoryTreeToolBar(),listeners:{checkchange:function(node,checked){var record=this.loader.findRecord(node.attributes.identifier);if(!record){return}var rep=Object.clone(record.get("rep"));rep.hidden=!checked;rep.name=rep.name.unescapeHTML();record.set("rep",rep);record.commit();var handleChildCategories=function(store){store.getRecords().each(function(childRecord){var childRep=Object.clone(childRecord.get("rep"));childRep.hidden=rep.hidden;childRep.name=childRep.name.unescapeHTML();childRecord.set("rep",childRep);childRecord.commit()})};var selectedStore=Signavio.Core.StoreManager.getRelatedStore(record.get("href"));if(selectedStore){handleChildCategories(selectedStore)}else{selectedStore.on("load",handleChildCategories)}}}});tree.loader=new Signavio.Extensions.TreeLoader({panel:tree,baseParams:{allCategories:true,showHidden:true,considerAllPrivilege:true},sortingFn:function(a,b){return a.get("rep").order-b.get("rep").order},filterFn:function(record,parent){var id=parent.attributes.identifier.replace(GLOSSARY_ROOT,"");var parentCategory=(record.get("rep").parentCategory||"").replace(GLOSSARY_ROOT,"");return parentCategory===id},createData:function(store,record,node){var rep=record.get("rep");var attr=node.attributes;var text=store.parseValue(record,node.attributes.dataField);var data=Signavio.Extensions.TreeLoader.prototype.createData.apply(this,arguments);var parse=function(value,record){var result;if(attr.parseText){result=attr.parseText(value,record)}result=result||value||attr.value||"";return result.escapeHTML()};return Ext.apply(data,{text:parse(text,record),oldText:parse(text,record),leaf:!rep.childCategoryCount||(!!rep.parentCategory&&rep.parentCategory!==GLOSSARY_ROOT),order:rep.order,checked:!rep.hidden,hasChildCls:false,color:rep.color,uiProvider:CategoryUIProvider,childCls:false,allowDrag:false,ownerTree:tree})}});tree.getSelections=function(){var node=this.getSelectionModel().getSelectedNode();if(!node){return[]}var o={get:function(key){if(key!=="get"){return o[key]}},rel:"cat",rep:node.attributes,href:(!node.attributes.identifier.startsWith(GLOSSARY_ROOT)?GLOSSARY_ROOT:"")+node.attributes.identifier};return[o]};tree.getSelectionModel().on("selectionchange",function(model){var node=model.getSelectedNode();if(!node){return}var toolbar=tree.getTopToolbar();toolbar.items.each(function(item){if(!item.handleSelectionChange){return}item.handleSelectionChange(node,tree)});this.updateGlossaryAttributeStore.apply(this,arguments)}.bind(this));if(Ext.isIE10){tree.on("dblclick",function(node,e){if("undefined"==typeof node.parentNode.attributes.checked){}}.bind(this))}this.categoryTree=tree;return tree},getCategoryTreeToolBar:function(){var that=this;var getNode=function(){return that.categoryTree.getSelectionModel().getSelectedNode()||that.categoryTree.root};var that=this;return[{text:I18N.Categories.addNew,icon:CONFIG.IMAGE_PATH+"/famfamfam/add.png",cls:"x-btn-text-icon",disabled:false,handler:function(){var node=getNode();if(node.parentNode&&!node.parentNode.isRoot){node=node.parentNode}that.showCategoryAddWindow(node,false)}},{text:I18N.Categories.edit,icon:CONFIG.IMAGE_PATH+"/famfamfam/application_form_edit.png",cls:"x-btn-text-icon",disabled:true,handleSelectionChange:function(node,tree){this.setDisabled(node===tree.root||CORE_CATEGORIES.include(node.attributes.identifier))},handler:function(){var node=getNode();if(node===that.categoryTree.root||node.attributes.rel!=="cat"){return}that.showCategoryAddWindow(node,true)}},{text:I18N.Categories.remove,icon:CONFIG.IMAGE_PATH+"/famfamfam/delete.png",cls:"x-btn-text-icon",disabled:true,handleSelectionChange:function(node,tree){this.setDisabled(that.isCategoryRoot(node)||CORE_CATEGORIES.include(node.attributes.identifier))},handler:function(){var node=this.categoryTree.getSelectionModel().getSelectedNode();if(!node||node==this.categoryTree.root){return}var store=node.parentNode.attributes.store;var record=store.findByIdentifier(node.attributes.identifier);var msg=new Ext.Template(I18N.Categories.removeConfirmation);var isChildCategory=!node.parentNode.isHiddenRoot();var categoryToMove=Signavio.I18N.Repository.MetaData.Categories.other;if(isChildCategory){categoryToMove=node.parentNode.attributes.text}if(node.hasChildNodes()||node.attributes.expandable){msg=msg.apply([I18N.Categories.removeConfirmationSub,categoryToMove])}else{msg=msg.apply(["",categoryToMove])}var that=this;var dialog=Ext.Msg.show({title:I18N.Categories.remove,msg:msg,buttons:{yes:Signavio.I18N.Repository.Offer.deleteTitle,no:Signavio.I18N.Repository.Offer.moveTitle,cancel:Signavio.I18N.Repository.Offer.moveBtnCancel},fn:function(btn){if(btn==="cancel"){return}var parent=node.parentNode;parent.select();parent.expandable=parent.hasChildNodes();if(btn==="no"){record.set("href",record.get("href")+"?moveContent=true")}store.remove(record,true);var submitted=function(){store.un("submitted",submitted);that.updateCategoryTree(node,parent)};store.on("submitted",submitted)},animEl:"elId",icon:Ext.MessageBox.QUESTION});dialog.setIcon(Ext.Msg.QUESTION).getDialog().syncSize()}.bind(this)},"-",{text:I18N.moveUp,icon:CONFIG.IMAGE_PATH+"/famfamfam/bullet_arrow_up.png",cls:"x-btn-text-icon",disabled:true,handleSelectionChange:function(node,tree){var parent=node.parentNode;this.setDisabled(that.isCategoryRoot(node)||parent.childNodes.indexOf(node)===0)},handler:Signavio.Utils.debounce(function(){that.moveCategory(getNode(),-1)})},{text:I18N.moveDown,icon:CONFIG.IMAGE_PATH+"/famfamfam/bullet_arrow_down.png",cls:"x-btn-text-icon",disabled:true,handleSelectionChange:function(node,tree){var parent=node.parentNode;if(!parent){return}var index=parent.childNodes.indexOf(node);this.setDisabled(that.isCategoryRoot(node)||parent.childNodes.length===index+1)},handler:Signavio.Utils.debounce(function(){that.moveCategory(getNode(),1)})}]},isCategoryRoot:function(node){return this.categoryTree.root===node},findNode:function(id,parent){parent=parent||this.categoryTree.root;var node,that=this;(parent.childNodes||[]).each(function(child){if(node){throw $break}if(child.attributes.identifier===id){node=child}if(!node){node=that.findNode(id,child)}});return node},moveCategory:function(node,step){if(!node){return}var record=this.categoryTree.loader.findRecord(node.attributes.identifier);if(!record){return}var store=record.store;var tree=node.ownerTree;var getChangedRecord=function(){var parent=record.get("rep").parentCategory;var records=store.select(function(record){if(record.get("rel")!=="cat"){return}return record.get("rep").parentCategory===parent}).sort(function(a,b){return a.get("rep").order-b.get("rep").order});var index=records.indexOf(record);return records[index+step]};var changedRecord=getChangedRecord();if(!changedRecord){return}var recordPosition=record.get("rep").order;var changedRecordPosition=changedRecord.get("rep").order;record.get("rep").name=record.get("rep").name.unescapeHTML();changedRecord.get("rep").name=changedRecord.get("rep").name.unescapeHTML();record.get("rep").order=changedRecordPosition;changedRecord.get("rep").order=recordPosition;store.touch("rep",record,changedRecord);var that=this;var parent=node.parentNode||this.categoryTree.root;store.commitChanges(false,function(){that.reloadParentCategory(node,parent)})},getCategoryStore:function(){return Signavio.Core.StoreManager.getRelatedStore(GLOSSARY_ROOT,null,null,{params:{search:"title",allCategories:true,showHidden:true,considerAllPrivilege:true}})},getParentSelector:function(node,editing){var id=node.attributes.identifier;var otherCategory=this.glossaryCategories.first(function(record){return record.get("rep").oldCategory==="NONE"});var without=[otherCategory.get("rep").id];var parent=id;if(otherCategory.get("rep").id===id){parent=""}if(editing){parent=node.parentNode.attributes.identifier;without.push(id)}return new Signavio.glossary.CategorySelector({fieldLabel:I18N.Categories.parentCategory,cls:"y-category-parentpicker",value:parent,showDummy:true,hideChildren:true,without:without,categoryStore:this.glossaryCategories,showAll:true,getRecord:function(){var rec=this.selectedIndex>=0?this.store.getAt(this.selectedIndex):null;if(!rec||rec.get("rep").id===""){return null}return rec}})},getColorSelector:function(node){var menu=new Ext.menu.ColorMenu({cls:"y-category-colorpicker",items:[{text:I18N.Categories.resetColor,cls:"y-default-button",listeners:{render:function(button,event){var colorDiv=document.createElement("div");colorDiv.setAttribute("class","y-default-color");colorDiv.setAttribute("style","background:#969696;margin-top:2px;margin-left:2px;position:absolute;border: 1px solid #ccc;width: 10px;height: 10px;display: inline-block;");button.el.insertFirst(colorDiv)}.bind(this)}},"-"],getValue:function(){return this.value},value:node.attributes.color||"#969696"});var label=new Ext.form.Label({height:12,style:"box-shadow:0 0 6px -3px black inset;top: 2px; margin-left:145px;display:block;position:relative;background:"+menu.getValue(),getValue:function(){return menu.getValue()},listeners:{render:function(){this.el.on("click",function(){menu.show(this,"tl-tl?")});this.label=new Ext.form.Label({style:"margin-top:-3px; margin-left:-6px;text-align: right;width: 140px;display: block;position: absolute;left: -140px;font-size:12px;",html:I18N.Categories.color+":"}).render(this.el);this.setSize(12,12)}}});menu.on("itemclick",function(item){if(!(item instanceof Ext.menu.ColorItem)){menu.palette.select("#969696")}});menu.palette.select=function(color){try{Ext.ColorPalette.prototype.select.apply(this,color)}catch(e){}color=(color.startsWith("#")?color:"#"+color);menu.value=color;label.el.setStyle("background",color)};return{label:label,menu:menu}},getCategoryAddForm:function(node,editing){var nameField=new Ext.form.TextField({fieldLabel:I18N.ShowAddDialog.Name,value:editing?(node.attributes.text||"").unescapeHTML():"",valueField:"name",cls:"y-category-title",allowBlank:false,blankText:I18N.AddDialog.requiredField,invalidText:I18N.Categories.needsName,isValid:function(){return this.getValue().trim()&&Ext.form.TextField.superclass.isValid.call(this)}});var parentSelector=this.getParentSelector(node,editing);var colorSelector=this.getColorSelector(node);return{items:[nameField,parentSelector,colorSelector.label],name:nameField,color:colorSelector.label,parent:parentSelector}},getAvailableParentCategories:function(){var root=this.categoryTree.root;return[["","","#969696"]].concat(root.childNodes.map(function(node){return[node.text,node.attributes.identifier,node.attributes.color]}))},gItemInfoTemplate:function(multilanguage,isList){return this.getItemInfoTemplate(multilanguage,isList)},getGlossaryItemInfoPanel:function(){if(!this.glossaryItemInfoPanel){var panel=new Ext.Panel({cls:"y-attrInfo",id:"attrInfo",anchor:"100%",border:false,update:function(content){this.body.update(content)}});this.glossaryItemInfoPanel=panel}return this.glossaryItemInfoPanel},updateGlossaryAttributeStore:function(a,b,c,doImmediate){var isActive,timer,selectRecs;if(!this.categoryTree){return}if(!this.isActiveTab(this.categoryTree)||isActive){if(this.attributeGrid.getSelectionModel().lastActive>=0){selectRecs=this.attributeGrid.getSelectionModel().lastActive}return}if(c===Ext.data.Record.EDIT){var row=this.attributeGrid.store.indexOf(b);if("number"==typeof row&&row>=0){var node=Ext.get(this.attributeGrid.getView().getRow(row));if(node){node.addClass("x-editing")}}return}doImmediate=doImmediate===true||(a.lastOptions===c&&c!==undefined);var isAdd=!doImmediate&&(b instanceof Array);var isUpdate=c===Ext.data.Record.COMMIT||c===Ext.data.Record.EDIT;selectRecs=isAdd?b:(isUpdate?[b]:(doImmediate?selectRecs:undefined));var update=function(){isActive=true;var sel=[this.categoryTree.getSelectionModel().getSelectedNode()].compact();var isRootNodeSelected=sel[0]===this.categoryTree.root;this.attributeGrid.getTopToolbar().items.get(0).setDisabled(isRootNodeSelected||sel.length===0);this.attributeGrid.view.emptyText=isRootNodeSelected||sel.length===0?I18N.requestCategorySelection:(sel.length===1?I18N.noOwnAttributes:I18N.noSharedAttributes);if(isRootNodeSelected||sel.length===0){this.attributeGrid.store.filterBy(function(record){return false})}else{var metaDataSelection=this.attributeGrid.getSelectionModel().getSelections();var categories=sel.map(function(node){return node.attributes.identifier});this.attributeGrid.store.filterBy(function(record){var bindings=record.get("rep").glossaryBindings;return categories.all(function(category){return bindings.any(function(binding){return category===((binding.category||"").startsWith(GLOSSARY_ROOT)?binding.category:GLOSSARY_ROOT+binding.category)})})});var selectedGlossaries=this.extractGlossaryInfo([this.categoryTree.getSelectionModel().getSelectedNode()]);var size=String(this.attributeGrid.store.getCount()).length;this.attributeGrid.store.sortBy(function(record){return(Math.min.apply(Math,this.findBindings(record,selectedGlossaries).pluck("order"))||0).toPaddedString(size+2)+""+record.get("rep").name.toLowerCase()}.bind(this));if(selectRecs!==undefined||metaDataSelection.length>0){if(typeof selectRecs==="number"){selectRecs=[this.attributeGrid.store.getAt(selectRecs)]}this.attributeGrid.getSelectionModel().selectRecords(selectRecs||metaDataSelection);var index=this.attributeGrid.store.indexOf(this.attributeGrid.getSelectionModel().getSelected());window.setTimeout(function(index){try{var n=index>=0?Ext.get(this.attributeGrid.view.getRow(index)):undefined;if(n){n.scrollIntoView(this.attributeGrid.view.scroller)}}catch(e){}}.bind(this,index),100)}}isActive=false}.bind(this);window.clearTimeout(timer);if(doImmediate){update()}else{timer=window.setTimeout(update,100)}},getGlossaryPanel:function(){var categoryTree=this.getCategoryTree();var itemPanel=this.getGlossaryItemInfoPanel();var attributeGrid=this.getAttributeGrid();var attributeContainer=new Ext.Panel({items:[attributeGrid,itemPanel],columnWidth:1,layout:"anchor",cls:"y-glossary-attr-container",border:false});return[categoryTree,attributeContainer]}};Signavio.Plugins.ManageMetaData=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageMetaData)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Comparator={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"edit",name:Signavio.I18N.Repository.Offer.compareTitle,description:"",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report.png",functionality:this.open.bind(this),isDisabled:function(){return !this.onlyModelsAreSelected()||this.getSelection().length>2}.bind(this),isVisible:this.selectionNotInTrash.bind(this),index:2});Signavio.Config.COMPARATOR_ENABLED=true},open:function(){var b=this.getSelection()[0],a=this.getSelection()[1]||b;if(!b||b.get("rel")!=="mod"||!a||a.get("rel")!=="mod"){return}var e=Signavio.Core.StoreManager.getStore(b.get("href"));var c=Signavio.Core.StoreManager.getStore(a.get("href"));if(e&&c){var g;if(e==c){var d=e.getRecords("revision").sortBy(function(j){return j.get("rep").rev});g="#"+d[Math.max(d.length-2,0)].get("href")+""+d.last().get("href")}else{var h=e.getRecords("revision").sortBy(function(j){return j.get("rep").rev});var f=c.getRecords("revision").sortBy(function(j){return j.get("rep").rev});g="#"+h.last().get("href")+""+f.last().get("href")}window.open(Signavio.Config.COMPARATOR_URI+(g||""))}}};Signavio.Plugins.Comparator=Signavio.Core.Plugin.extend(Signavio.Plugins.Comparator)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.FileUpload=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);var b=(this.facade.getConfig("department","fileupload")!==false);if(!b){return}this.facade.registerOnEvent("selectionchange",function(e,c){if((c||[]).length==1&&c[0].get("rel")=="file"){var d=Signavio.Utils.getIcon(c[0].get("rep").extension,true);this.buttonInstance&&this.buttonInstance.setText(String.format(Signavio.I18N.Filestore.update,(d=="picture"?Signavio.I18N.Filestore.picture:Signavio.I18N.Filestore.document)))}else{this.buttonInstance&&this.buttonInstance.setText(Signavio.I18N.Filestore.uploadTitle)}}.bind(this));this.facade.registerOnEvent(Signavio.Const.EVENT.ITEMS_REMOVED,function(e,c){var d=(c||[]).map(function(f){return(f.get("rep").allRevisionsSize||0)}).sum();this.updateUsedFileQuotaBytes(-d);this.updateQuotaWarning()}.bind(this));this.facade.offer({relGroup:"import",index:50,name:Signavio.I18N.Filestore.uploadTitle,icon:"/images/famfamfam/page_white_get.png",isVisible:function(){return this.selectionNotInTrash()&&b}.bind(this),isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),functionality:this.showDialog.bind(this),onAdd:function(c){this.buttonInstance=c}.bind(this)});this.facade.offer({relGroup:"import",index:52,seperated:true});this.facade.registerOnEvent(Signavio.Const.EVENT.OPEN_FILE_UPLOAD,this.showDialog.bind(this));this.singleFileByteQuota=this.facade.getConfig().singleFileByteQuota;this.usedFileQuotaBytes=this.facade.getConfig().usedFileQuotaBytes;this.allFilesByteQuota=this.facade.getConfig().allFilesByteQuota;this.updateQuotaWarning()},showDialog:function(){var b=undefined;if(this.getSelection().length===1&&this.getSelection()[0].get("rel")===Signavio.Const.REL.FILE){b=this.getSelection()[0]}var e=function(k){var j=d.items.items.find(function(l){return l.name=="name"}),g=d.items.items.find(function(l){return l.name=="file"}),f=d.items.items.find(function(l){return l instanceof Ext.Panel}),h;g=g?g.el.dom:false;if(g&&g.files&&g.files.length>0){f&&(f.files=g.files);h=g.files[0]}else{if(f&&f.files){h=f.files[0]}}if(h&&j&&(!j.getValue()||k)){j.setValue(String(h.fileName||h.name||"").replace(/\.[^\.]+$/,""))}f&&f.updateHighlight();a.syncSize()};var d=new Ext.form.FormPanel({defaultType:"textfield",layout:"form",border:false,fileUpload:true,labelAlign:"top",bodyStyle:"padding:0;",defaults:{width:250,labelStyle:"font-size:11px;"},items:[{name:"file",inputType:"file",fieldLabel:Signavio.I18N.Filestore.uploadFile,itemCls:"ext_specific_window_overflow",listeners:{render:function(){if(this.el.dom.addEventListener){this.el.dom.addEventListener("change",e.bind(this,!b),false)}}}},new Ext.form.Label({html:Signavio.I18N.Filestore.maximalFileSize+"<b>"+Signavio.Utils.BeautifySize(this.singleFileByteQuota)+"</b><br/>"+Signavio.I18N.Filestore.youCurrentlyUse+"<b>"+Signavio.Utils.BeautifySize(this.usedFileQuotaBytes)+" / "+Signavio.Utils.BeautifySize(this.allFilesByteQuota)+"</b>",style:"margin-bottom:10px;color:silver;"}),{name:"name",fieldLabel:Signavio.I18N.Filestore.uploadFileName,itemCls:"ext_specific_window_overflow",width:344,value:b?b.get("rep").name:""},{xtype:"textarea",name:"comment",fieldLabel:Signavio.I18N.Filestore.uploadRevisionComment,height:100,width:344,itemCls:"ext_specific_window_overflow",value:b?b.get("rep").description:""},{name:"filetoupdate",inputType:"hidden",value:b?b.get("href").split("/").last():undefined},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(f){return{name:f.key,inputType:"hidden",value:f.value}})].flatten()});d.getForm().errorReader={read:function(f){return{success:f.responseText.toLowerCase().replace(/<.*?pre.*?>/g,"").startsWith("{"),records:[]}}};var c=Signavio.Utils.getIcon(b,true);var a=new Ext.ux.Window({title:b?String.format(Signavio.I18N.Filestore.update,(c!="picture"?Signavio.I18N.Filestore.document:Signavio.I18N.Filestore.picture)):Signavio.I18N.Filestore.uploadTitle,description:b?(c!="picture"?Signavio.I18N.Filestore.updateFileDesc:Signavio.I18N.Filestore.updatePictureDesc):Signavio.I18N.Filestore.uploadDesc,bodyTitle:Signavio.I18N.Filestore.selectDocumentPicture,width:400,resizable:false,modal:true,items:[d],useFrame:true,listeners:{close:function(){if(!a.success){this.facade.raiseEvent(Signavio.Const.EVENT.CANCEL_FILE_UPLOAD)}}.bind(this)},buttons:[{text:Signavio.I18N.Filestore.uploadButton,handler:function(){var h="/p/file",j=d.items.items.find(function(n){return n.name=="file"}),f=d.items.items.find(function(n){return n instanceof Ext.Panel});if(d.items.items.find(function(n){return n.name=="filetoupdate"}).el.dom.value){h=h+"/"+d.items.items.find(function(n){return n.name=="filetoupdate"}).getValue()}var m=function(n){a.success=n;a.close();Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide()};var l=function(p,n){var q={};if(n&&n.response&&n.response.responseText){switch(n.response.responseText[0]){case"<":case">":q=JSON.parse(n.response.responseText.match(/>(.*)</).last()||"");break;case"{":case"[":q=JSON.parse(n.response.responseText.split("\n\n\n\n")[0]||"")}}if(q.error=="file_size_violates_single_file_quota"){return}if(q.error=="file_size_violates_all_files_quota"){return}if(q.rep){this.updateUsedFileQuotaBytes(q.rep.size||0);m(true);Signavio.Core.StoreManager.reload();window.setTimeout(function(){this.updateQuotaWarning()}.bind(this),50);this.facade.raiseEvent(Signavio.Const.EVENT.NEW_FILE_UPLOAD,q.rep)}}.bind(this);var g=function(){Ext.MessageBox.show({title:Signavio.I18N.Filestore.documentPictureTooBig,msg:Signavio.I18N.Filestore.documentPictureTooBigDesc,modal:true,buttons:{ok:"OK"},fn:function(n){m()},icon:Ext.MessageBox.INFO})};if(j&&j.getValue()){d.getForm().submit({url:h,waitMsg:Signavio.I18N.Filestore.uploadInProgress,method:"POST",success:l,failure:g})}else{if(f&&f.files&&f.files.length>0){var k={};d.items.items.each(function(n){if(n.name&&n.getValue&&n.getValue()){k[n.name]=n.getValue()}});Signavio.Core.Stores.RequestManager.doFileUpload(h,f.files,k,l,g);Ext.MessageBox.wait(Signavio.I18N.Filestore.uploadInProgress)}else{}}}.bind(this)}]});a.show()},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")},updateUsedFileQuotaBytes:function(a){this.usedFileQuotaBytes+=(a||0)},updateQuotaWarning:function(){if(!this.quotaWarning){this.createQuotaWarning()}if(this.quotaWarning&&this.facade.isCurrentUserAdmin()){var b=this.usedFileQuotaBytes;var a=this.allFilesByteQuota;if(!b||!a){this.quotaWarning.hide();return}var c=b/a;if(c>Signavio.Const.QUOTA_WARNING_THRESHOLD){this.quotaWarning.curr.textContent=Math.round(c*100)+"%";this.quotaWarning.show()}else{this.quotaWarning.hide()}}},createQuotaWarning:function(){if(!this.facade.isCurrentUserAdmin()){return}var a=document.createElement("span");a.setAttributeNS(null,"class","y-file-quota-warning");a.setAttributeNS(null,"title",Signavio.I18N.Filestore.warningTTip);var c=document.createElement("span");c.setAttributeNS(null,"class","y-current-quota");a.appendChild(c);var d=document.createElement("span");d.setAttributeNS(null,"class","y-quota-description");d.innerHTML=(Signavio.I18N.Filestore.warningText);a.appendChild(d);a.hide();var b=$A(document.getElementsByClassName("login_name")).first();if(b){b.insertBefore(a,$A(b.childNodes).first());this.quotaWarning=a;this.quotaWarning.curr=c}}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.FileDownload=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.registerOnEvent("selectionchange",this.handleSelectionChange.bind(this));this.facade.offer({relGroup:"import",index:51,name:Signavio.I18N.Filestore.downloadTitle,icon:"/images/famfamfam/page_white_put.png",isVisible:function(){return this.selectionNotInTrash()}.bind(this),isDisabled:function(){var a=this.getSelection()||[];return !(a.length==1&&a[0].get("rel")=="file")}.bind(this),functionality:this.downloadFile.bind(this),onAdd:function(a){this.buttonInstance=a}.bind(this)})},downloadFile:function(){var a=this.getSelection();if(a.length!==1){return}window.open(Signavio.Config.BACKEND_PATH+a[0].get("href")+"/content")},handleSelectionChange:function(){var b=this.getSelection();if(b.length!==1){this.buttonInstance&&this.buttonInstance.setText(Signavio.I18N.Filestore.downloadTitle);return}var a=Signavio.Utils.getIcon(b[0].get("rep"),true);this.buttonInstance&&this.buttonInstance.setText(String.format(Signavio.I18N.Filestore.download,(a=="picture"?Signavio.I18N.Filestore.picture:Signavio.I18N.Filestore.document)))}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Spreadsheet={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"edit",index:0,name:Signavio.I18N.Repository.Offer.spreadsheetEdit,description:Signavio.I18N.Repository.Offer.spreadsheetEditDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/table_edit.png",isVisible:function(){return !this.selectionInInternal()}.bind(this),isDisabled:function(){return !this.oneSelected()||!(this.selectionIsEpc()||this.selectionIsBpmn20())}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.WRITE],functionality:function(){if(Ext.isIE6){Ext.Msg.alert(Signavio.I18N.Repository.Offer.descriptionIE6TitleEdit,Signavio.I18N.Repository.Offer.descriptionIE6Info).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}var a=Signavio.Config.SPREADSHEET_EDITOR_HANDLER_URI+"?id="+this.getSelection()[0].get("href").split("/")[2];window.open(a)}.bind(this)});this.facade.offer({relGroup:"new",index:0,seperated:true,name:Signavio.I18N.Repository.Offer.spreadsheetNew,description:Signavio.I18N.Repository.Offer.spreadsheetNewDescription,activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/spreadsheet-22x22.png",isVisible:function(){return !this.selectionInInternal()}.bind(this),functionality:function(){if(Ext.isIE6){Ext.Msg.alert(Signavio.I18N.Repository.Offer.descriptionIE6TitleNew,Signavio.I18N.Repository.Offer.descriptionIE6Info).setIcon(Ext.Msg.INFO).getDialog().syncSize();return}var a=Signavio.Core.StoreManager.getStore("child");window.open(Signavio.Config.SPREADSHEET_EDITOR_HANDLER_URI+"?directory="+a.lastOptions.id);this.facade.askForRefresh()}.bind(this)})}};Signavio.Plugins.Spreadsheet=Signavio.Core.Plugin.extend(Signavio.Plugins.Spreadsheet)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.AnalyticsButton={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"reporting",index:200,seperated:true,isDisabled:function(){return this.isReportDisabled()}.bind(this)});this.facade.offer({name:Signavio.I18N.Repository.AnalyticsLink.name,relGroup:"reporting",separated:true,index:201,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/chart_bar.png",functionality:this.open.bind(this),isVisible:function(){return(this.facade.getConfig().analyticsEnabledModelIds||[]).length>0}.bind(this),isDisabled:function(){return !this.oneSelected()||!(this.facade.getConfig().analyticsEnabledModelIds||[]).any(function(a){return a=="*"||this.getSelection()[0].get("href").endsWith(a)}.bind(this))}.bind(this)})},open:function(a){window.open("/p/analytics/"+this.getSelection()[0].get("href").split("/").last())}};Signavio.Plugins.AnalyticsButton=Signavio.Core.Plugin.extend(Signavio.Plugins.AnalyticsButton)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}if(!Signavio.Plugins.Templates){Signavio.Plugins.Templates={}}if(!Signavio.Plugins.Templates.Portal){Signavio.Plugins.Templates.Portal={}}(function(){var f={ALL:["bg_bg","cs_cz","da_dk","nl_nl","et_ee","fi_fi","fr_fr","fr_ch","fr_be","fr_ca","fr_lu","de_de","de_at","de_ch","de_be","de_lu","de_li","es_mx","lb_lu","hu_hu","ie_ie","it_it","it_ch","lv_lv","lt_lt","mt_mt","pl_pl","pt_pt","pt_br","ro_ro","af_za","sk_sk","sl_si","es_es","es_cl","sv_se","en_us","en_gb","en_au","en_ca","en_nz","en_za"],DEFAULT:"de_de"};var e={ALL:["AUD","BGN","BRL","CAD","CHF","CLP","CZK","DKK","EUR","GBP","HUF","LVL","LTL","MXN","NZD","PLN","RON","RUB","SEK","SGD","USD","ZAR"],DEFAULT:"EUR"};var a={dd:Signavio.I18N.DateFormat.Format.day,mm:Signavio.I18N.DateFormat.Format.month,YYYY:Signavio.I18N.DateFormat.Format.year};var g={ALL:{"dd.mm.YYYY":{languages:["de","fr"],variations:["dd-mm-YYYY","dd/mm/YYYY"]},"mm.dd.YYYY":{languages:["en"],variations:["mm-dd-YYYY","mm/dd/YYYY"]}},DEFAULT:"dd.mm.YYYY"};var h={CONFIGURATION:{id:"configuration",attr:{title:Signavio.I18N.Repository.Configuration.general,windowTitle:Signavio.I18N.Repository.Configuration.offer,bodyStyle:"padding:10px 10px 0px 10px",autoScroll:true}},CONTROLRIGHTS:{id:"controlrights",disabled:true,attr:{title:Signavio.I18N.Repository.ControlRights.offerTitle,windowTitle:Signavio.I18N.Repository.Configuration.offerSecurity,autoScroll:true,bodyStyle:"padding:10px 10px 0px 10px"}},LANGUAGE:{id:"language",disabled:true,attr:{title:Signavio.I18N.LanguageConfiguration.tabTitle,windowTitle:Signavio.I18N.Repository.Configuration.offerLanguages,bodyStyle:"padding:10px 10px 0px 10px; overflow: auto;"}}};var c={DEPARTMENT:"department",TENANT:"tenant",USER:"user",CONTROLRIGHTS:"controlrights"};var d=[];d=d.concat([{id:"passwordpoliciesdescription",title:"",description:"",value:Signavio.I18N.Repository.ControlRights.passwordDialogDescription,type:"description",category:"passwordpolicies",object:c.CONTROLRIGHTS},{id:"shouldbecomplex",title:Signavio.I18N.Repository.ControlRights.ppComplexTitle,description:Signavio.I18N.Repository.ControlRights.ppComplexDescription,type:"boolean",value:false,category:"passwordpolicies",object:c.CONTROLRIGHTS},{id:"shouldnotbeusername",title:Signavio.I18N.Repository.ControlRights.ppUsernameCriteriaTitle,description:Signavio.I18N.Repository.ControlRights.ppUsernameCriteriaDescription,type:"boolean",value:false,category:"passwordpolicies",object:c.CONTROLRIGHTS},{id:"shouldnotincludeusercharacters",title:Signavio.I18N.Repository.ControlRights.ppCharacterCriteriaTitle,description:Signavio.I18N.Repository.ControlRights.ppCharacterCriteriaDescription,type:"boolean",value:false,category:"passwordpolicies",object:c.CONTROLRIGHTS},{id:"passwordminage",title:Signavio.I18N.Repository.ControlRights.ppMinAgeTitle,description:Signavio.I18N.Repository.ControlRights.ppMinAgeDescription,type:"minmaxtextfield",category:"passwordpolicies",options:{min:1,max:365,suffix:Signavio.I18N.Repository.ControlRights.days},object:c.CONTROLRIGHTS},{id:"passwordmaxage",title:Signavio.I18N.Repository.ControlRights.ppMaxAgeTitle,description:Signavio.I18N.Repository.ControlRights.ppMaxAgeDescription,type:"minmaxtextfield",category:"passwordpolicies",options:{min:1,max:365,suffix:Signavio.I18N.Repository.ControlRights.days},object:c.CONTROLRIGHTS},{id:"passwordminlength",title:Signavio.I18N.Repository.ControlRights.ppMinLengthTitle,description:Signavio.I18N.Repository.ControlRights.ppMinLengthDescription,type:"minmaxtextfield",category:"passwordpolicies",options:{min:6,max:365,suffix:Signavio.I18N.Repository.ControlRights.characters},object:c.CONTROLRIGHTS},{id:"passwordmaxlength",title:Signavio.I18N.Repository.ControlRights.ppMaxLengthTitle,description:Signavio.I18N.Repository.ControlRights.ppMaxLengthDescription,type:"minmaxtextfield",category:"passwordpolicies",options:{min:6,max:365,suffix:Signavio.I18N.Repository.ControlRights.characters},object:c.CONTROLRIGHTS},{id:"passwordchronic",title:Signavio.I18N.Repository.ControlRights.ppChronicTitle,description:Signavio.I18N.Repository.ControlRights.ppChronicDescription,type:"minmaxtextfield",category:"passwordpolicies",options:{min:1,max:100,suffix:Signavio.I18N.Repository.ControlRights.passwords},object:c.CONTROLRIGHTS}]);d=d.concat([{id:"controllrightsdescription",title:"",description:"",value:Signavio.I18N.Repository.ControlRights.ipDialogDescription,type:"description",category:"iprange",object:c.CONTROLRIGHTS},{id:"enableiprange",title:Signavio.I18N.Repository.ControlRights.ipCheckTitle,description:"",type:"ipcheckbox",category:"iprange",object:c.CONTROLRIGHTS},{id:"iplist",title:Signavio.I18N.Repository.ControlRights.ipListTitle,description:"",type:"iplist",category:"iprange",object:c.CONTROLRIGHTS}]);d=d.concat([{id:"defaultdiagram",title:Signavio.I18N.Repository.Configuration.defaultdiagramTitle,description:Signavio.I18N.Repository.Configuration.defaultdiagramDescription,type:"model",category:"portal",object:c.DEPARTMENT},{id:"autocomplete",title:Signavio.I18N.Repository.Configuration.autocompleteTitle,description:Signavio.I18N.Repository.Configuration.autocompleteDescription,type:"boolean",value:true,category:"portal",object:c.DEPARTMENT},{id:"showbreadcrumb",title:Signavio.I18N.Repository.Configuration.enablebreadcrumbs,description:Signavio.I18N.Repository.Configuration.enablebreadcrumbsDescription,type:"boolean",value:false,category:"portal",object:"department"},{id:"fittomodel",title:Signavio.I18N.Repository.Configuration.fittomodels,description:Signavio.I18N.Repository.Configuration.fittomodelsDescription,type:"boolean",value:false,category:"portal",object:"department"},{id:"enablecomments",title:Signavio.I18N.Repository.Configuration.enablecommentsTitle,description:Signavio.I18N.Repository.Configuration.enablecommentsDescription,type:"choice",value:"show",items:[{value:"show",title:Signavio.I18N.Repository.Configuration.enablecommentsshow},{value:"add",title:Signavio.I18N.Repository.Configuration.enablecommentsadd},{value:"none",title:Signavio.I18N.Repository.Configuration.enablecommentsnone}],category:"portal",object:c.DEPARTMENT},{id:"portalleftfolderconfig",title:Signavio.I18N.Repository.Configuration.portalleftfolderconfigTitle,description:Signavio.I18N.Repository.Configuration.portalleftfolderconfigDescription,type:"choice",value:"configOpenend",items:[{value:"configOpenend",title:Signavio.I18N.Repository.Configuration.portalleftfolderconfigOpened},{value:"configClosed",title:Signavio.I18N.Repository.Configuration.portalleftfolderconfigClosed},{value:"configHidden",title:Signavio.I18N.Repository.Configuration.portalleftfolderconfigHidden}],category:"portal",object:c.DEPARTMENT},{id:"infotemplate",title:Signavio.I18N.Repository.Configuration.infotemplateTitle,description:Signavio.I18N.Repository.Configuration.infotemplateDescription,type:"choice",value:"lastPublish",items:[{value:"lastPublish",title:Signavio.I18N.Repository.Configuration.infotemplatelastPublish},{value:"lastPublishBefore",title:Signavio.I18N.Repository.Configuration.infotemplatelastPublishBefore},{value:"lastEdit",title:Signavio.I18N.Repository.Configuration.infotemplatelastEdit},{value:"none",title:Signavio.I18N.Repository.Configuration.infotemplatenone}],category:"portal",object:c.DEPARTMENT},{id:"print",title:Signavio.I18N.Repository.Configuration.printTitle,description:Signavio.I18N.Repository.Configuration.printmDescription,type:"boolean",value:true,category:"portal",object:c.DEPARTMENT},{id:"logolink",title:Signavio.I18N.Repository.Configuration.logolinkTitle,description:Signavio.I18N.Repository.Configuration.logolinkDescription,type:"string",value:"/p/explorer",category:"portal",object:c.DEPARTMENT},{id:"completelink",title:Signavio.I18N.Repository.Configuration.completelinkTitle,description:Signavio.I18N.Repository.Configuration.completelinkDescription,type:"boolean",value:false,category:"portal",object:c.DEPARTMENT},{id:"expandedrightpanel",title:Signavio.I18N.Repository.Configuration.expandedrightpanelTitle,description:Signavio.I18N.Repository.Configuration.expandedrightpanelDescription,type:"choice",value:"info",items:[{value:"info",title:Signavio.I18N.Repository.Configuration.expandedrightpanelInfo},{value:"legend",title:Signavio.I18N.Repository.Configuration.expandedrightpanelLegend},{value:"comments",title:Signavio.I18N.Repository.Configuration.expandedrightpanelComment},{value:"none",title:Signavio.I18N.Repository.Configuration.expandedrightpanelNone}],category:"portal",object:c.DEPARTMENT},{id:"template",title:Signavio.I18N.Repository.Configuration.templateTitle,description:Signavio.I18N.Repository.Configuration.templateDescription,type:"choice",value:"x-signavio",items:[{value:"x-signavio",title:Signavio.I18N.Repository.Configuration.Templates.signavio}],category:"portal",object:c.DEPARTMENT},{id:"uilanguage",title:Signavio.I18N.Repository.Configuration.uilanguageTitle,description:Signavio.I18N.Repository.Configuration.uilanguageDescription,type:"choice",value:"automatic",items:[{value:"automatic",title:Signavio.I18N.Repository.Configuration.uilanguageAutomatic}],category:"portal",object:c.DEPARTMENT},{id:"customattributesinbubble",title:Signavio.I18N.Repository.MetaData.manageBubbleTitle,description:Signavio.I18N.Repository.MetaData.manageBubbleDesc,type:"choice",value:"collapsedexpandable",items:[{value:"collapsedexpandable",title:Signavio.I18N.Repository.MetaData.manageCollapsedExpandable},{value:"expandedcollapsible",title:Signavio.I18N.Repository.MetaData.manageExpandedCollapsible},{value:"collapsedlocked",title:Signavio.I18N.Repository.MetaData.managecollapsedLocked},{value:"expandedlocked",title:Signavio.I18N.Repository.MetaData.manageexpandedLocked}],category:"portal",object:"department"}]);d=d.concat([{id:"urlhelplist",title:Signavio.I18N.Repository.Configuration.urlhelplistTitle,description:Signavio.I18N.Repository.Configuration.urlhelplistDescription,type:"urllist",value:[],category:"explorer",object:c.DEPARTMENT},{id:"currency",title:Signavio.I18N.Repository.Configuration.currencyTitle,description:Signavio.I18N.Repository.Configuration.currencyDescription,type:"currencyselector",value:e.DEFAULT,category:"explorer",object:c.DEPARTMENT}]);d=d.concat([{id:"languages",title:Signavio.I18N.LanguageConfiguration.addLanguage,description:Signavio.I18N.LanguageConfiguration.addLanguageDescription,value:false,type:"languageselector",category:"all",showsInCategory:"languages",object:c.DEPARTMENT}]);Signavio.Plugins.ManageFileUpload=Signavio.Core.Plugin.extend({enabled:true,construct:function(){d=d.concat([{id:"fileupload",title:Signavio.I18N.Filestore.configTitle,description:function(){var j="<i>"+Signavio.I18N.Filestore.configDesc+Signavio.Utils.BeautifySize(this.facade.getConfig().allFilesByteQuota)+"</i>";return j},type:"boolean",value:true,category:"explorer",object:"department"}])}});Signavio.Plugins.ManageFilesInPortalTree=Signavio.Core.Plugin.extend({enabled:true,construct:function(){d=d.concat([{id:"filesintree",title:Signavio.I18N.Filestore.manageFilesInTreeTitle,description:Signavio.I18N.Filestore.manageFilesInTreeDesc,type:"boolean",value:true,category:"portal",object:"department"}])}});Signavio.Plugins.ManageIKSInPortal=Signavio.Core.Plugin.extend({enabled:true,construct:function(){d=d.concat([{id:"showRisks",title:Signavio.I18N.Repository.Configuration.showRisksTitle,description:Signavio.I18N.Repository.Configuration.showRisksDescription,type:"boolean",value:true,category:"portal",object:c.DEPARTMENT}])}});Signavio.Plugins.ManageCustomLayersInPortal=Signavio.Core.Plugin.extend({enabled:true,construct:function(){d=d.concat([{id:"showCustomLayers",title:Signavio.I18N.Repository.Configuration.showCustomLayersTitle,description:Signavio.I18N.Repository.Configuration.showCustomLayersDescription,type:"boolean",value:true,category:"portal",object:c.DEPARTMENT}])}});var b=[{id:"portal",title:"Portal",tab:h.CONFIGURATION.id},{id:"explorer",title:"Explorer",tab:h.CONFIGURATION.id},{id:"editor",title:"Editor",tab:h.CONFIGURATION.id},{id:"all",title:"Allgemeine Einstellungen",tab:h.CONFIGURATION.id}];Signavio.Plugins.ManageConfigurationIPSecurity={enabled:true,construct:function(){b=b.concat([{id:"iprange",labelWidth:180,tab:h.CONTROLRIGHTS.id,title:Signavio.I18N.Repository.ControlRights.ipRange}]);h.CONTROLRIGHTS.disabled=false}.bind(this)};Signavio.Plugins.ManageConfigurationIPSecurity=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageConfigurationIPSecurity);Signavio.Plugins.ManageConfigurationPasswordPoliciesSecurity={enabled:true,construct:function(){b=b.concat([{id:"passwordpolicies",labelWidth:230,tab:h.CONTROLRIGHTS.id,title:Signavio.I18N.Repository.ControlRights.passwordPolicies}]);h.CONTROLRIGHTS.disabled=false}.bind(this)};Signavio.Plugins.ManageConfigurationPasswordPoliciesSecurity=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageConfigurationPasswordPoliciesSecurity);Signavio.Plugins.ManageConfigurationLanguages={enabled:true,construct:function(j){if(j.getConfig().numAllowedLanguages>0){b=b.concat([{id:"languages",title:Signavio.I18N.LanguageConfiguration.availableLanguages,tab:h.LANGUAGE.id}]);h.LANGUAGE.disabled=false}}.bind(this)};Signavio.Plugins.ManageConfigurationLanguages=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageConfigurationLanguages);Signavio.Plugins.Templates.Portal.AbstractTemplate=Clazz.extend({enabled:true,getTemplate:function(){return d.find(function(j){return j.id=="template"&&j.category=="portal"})}});Signavio.Plugins.Templates.Portal.AOKTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-dark-green",title:Signavio.I18N.Repository.Configuration.Templates.aok})}}});Signavio.Plugins.Templates.Portal.GrayTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-gray",title:Signavio.I18N.Repository.Configuration.Templates.gray})}}});Signavio.Plugins.Templates.Portal.BlueTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-blue",title:Signavio.I18N.Repository.Configuration.Templates.blue})}}});Signavio.Plugins.Templates.Portal.AquamarinTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-aquamarin",title:Signavio.I18N.Repository.Configuration.Templates.aquamarin})}}});Signavio.Plugins.Templates.Portal.GreenTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-green",title:Signavio.I18N.Repository.Configuration.Templates.green})}}});Signavio.Plugins.Templates.Portal.BRTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-br-template",title:Signavio.I18N.Repository.Configuration.Templates.brCompany})}}});Signavio.Plugins.Templates.Portal.BigPointTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-bigpoint-template",title:Signavio.I18N.Repository.Configuration.Templates.bigPointCompany})}}});Signavio.Plugins.Templates.Portal.HugoBossTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-hugoboss-template",title:Signavio.I18N.Repository.Configuration.Templates.hugoBossCompany})}}});Signavio.Plugins.Templates.Portal.PumaTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-puma-template",title:Signavio.I18N.Repository.Configuration.Templates.pumaCompany})}}});Signavio.Plugins.Templates.Portal.GrunenthalTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-grunenthal-template",title:Signavio.I18N.Repository.Configuration.Templates.grunenthalCompany})}}});Signavio.Plugins.Templates.Portal.ZHAWTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-zhaw-template",title:Signavio.I18N.Repository.Configuration.Templates.zhawCompany})}}});Signavio.Plugins.Templates.Portal.SpardaBankTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-spardabank-template",title:Signavio.I18N.Repository.Configuration.Templates.spardabankCompany})}}});Signavio.Plugins.Templates.Portal.WindMoellerTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-windmoeller-template",title:Signavio.I18N.Repository.Configuration.Templates.windmoellerCompany})}}});Signavio.Plugins.Templates.Portal.CittiTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-citti-template",title:Signavio.I18N.Repository.Configuration.Templates.cittiCompany})}}});Signavio.Plugins.Templates.Portal.StadtwerkeDessauTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-stadtwerkeDessau-template",title:Signavio.I18N.Repository.Configuration.Templates.stadtwerkeDessauCompany})}}});Signavio.Plugins.Templates.Portal.HeadstrongTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-headstrong-template",title:Signavio.I18N.Repository.Configuration.Templates.headstrongCompany})}}});Signavio.Plugins.Templates.Portal.EChTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-ech-template",title:Signavio.I18N.Repository.Configuration.Templates.echCompany})}}});Signavio.Plugins.Templates.Portal.LWBTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-lwb-template",title:Signavio.I18N.Repository.Configuration.Templates.lwbCompany})}}});Signavio.Plugins.Templates.Portal.KPMGTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-kpmg-template",title:Signavio.I18N.Repository.Configuration.Templates.kpmgCompany})}}});Signavio.Plugins.Templates.Portal.ComcastTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-comcast-template",title:Signavio.I18N.Repository.Configuration.Templates.comcastCompany})}}});Signavio.Plugins.Templates.Portal.DeutscheBKK=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-deutschebkk-template",title:Signavio.I18N.Repository.Configuration.Templates.deutscheBKKCompany})}}});Signavio.Plugins.Templates.Portal.TSystemsTemplate=Signavio.Plugins.Templates.Portal.AbstractTemplate.extend({construct:function(){var j=this.getTemplate();if(j&&j.items){j.items.push({value:"x-tsystems-template",title:"T-Systems"})}d.push({id:"documentsurl",title:Signavio.I18N.TSystemsTemplate.documentsUrl,description:Signavio.I18N.TSystemsTemplate.documentsUrlDescription,value:"",type:"string",category:"portal",object:c.DEPARTMENT,tab:h.CONFIGURATION.id})}});Signavio.Plugins.ManageConfiguration={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",arrange:"right",index:10,name:Signavio.I18N.Repository.Configuration.offerLanguages,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_edit.png",isVisible:function(){return !h.LANGUAGE.disabled&&this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this,"language")});this.facade.offer({relGroup:"configure",arrange:"right",index:26,name:Signavio.I18N.Repository.Configuration.offerSecurity,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png",isVisible:function(){return !h.CONTROLRIGHTS.disabled&&this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this,["controlrights"])});this.facade.offer({relGroup:"configure",arrange:"right",index:60,name:Signavio.I18N.Repository.Configuration.offerTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/monitor_edit.png",isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this),functionality:this.showWindow.bind(this,"configuration")});this.appendConfigurationValues()},appendConfigurationValues:function(){var j=d.find(function(k){return k.id=="uilanguage"});if(j){(this.facade.getConfig().languages||[]).each(function(k){j.items.push({value:k,title:Signavio.I18N.Languages[k.split("_").first()]||k})})}},createWindow:function(j){var k=new Ext.ux.Window({title:j.length&&j[0].attr.windowTitle||Signavio.I18N.Repository.Configuration.offerTitle,resizable:true,cls:"x-window-manage-configuration",modal:true,layout:"anchor",bodyStyle:"background-color: white",width:610,height:400,minWidth:610,minHeight:200,cancelButton:{text:Signavio.I18N.Repository.Administration.cancel,handler:function(){this.doCancel(k);k.close()}.bind(this)},autoScroll:j.length===1});k.validate=this.validateWindow.bind(this,k);k.addButton(this.getSaveButton(k));return k},validateWindow:function(k){var j=true;$H(k.getTabPanel().getTabs()).values().each(function(l){if(!l.validate||l.validate&&!l.validate()){j=false;throw $break}});return j},getSaveButton:function(j){return new Ext.Button({text:Signavio.I18N.Repository.Administration.store,minWidth:75,handler:function(){if(j.validate()){this.doSave(j);j.close()}else{Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.save,msg:Signavio.I18N.Repository.ControlRights.invalid,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}}.bind(this)})},addPanelsToTab:function(k,j){j.each(function(l){k.add(l)});k.validate=k.validate||function(){var l=true;j.each(function(m){if(!m.validate()){l=false;throw $break}});return l};k.getCategories=function(){return j};k.getFields=function(){return j.map(function(l){return l.getFields()}).flatten()}},createControlrightsStore:function(l){var k={force:true,params:{load:true},callback:function(m){var n=this.generatePanels(this.getConfiguration(h.CONTROLRIGHTS.id),j);this.addPanelsToTab(l.getTabPanel().getTabs().controlrights,n);l.body.unmask();l.doLayout()}.bind(this)};var j=Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.CONTROLRIGHTS_PATH,undefined,undefined,k)},createStore:function(m,l,n,k){k=k instanceof Function?k:Ext.emptyFn;var j=Signavio.Core.StoreManager.getStore(Signavio.Config.CONFIGURATION_PATH,true,function(p){var q=this.generatePanels(n,j);this.addPanelsToTab(l,q);k(j);m.doLayout()}.bind(this))},createSharepointStore:function(j){},createLanguageStore:function(l){var k=l.getTabPanel().getTabs().language;var j=this.getConfiguration(h.LANGUAGE.id);this.createStore(l,k,j,function(m){l.body.unmask();if(!l.getConfigurationStore){l.getConfigurationStore=function(){return m}}})},createConfigurationStore:function(l){var k=l.getTabPanel().getTabs().configuration;var j=this.getConfiguration(h.CONFIGURATION.id);this.createStore(l,k,j,function(m){l.body.unmask();if(!l.getConfigurationStore){l.getConfigurationStore=function(){return m}}})},createTabPanel:function(k){var j=this.createTabs(k);return new Ext.TabPanel({activeTab:0,bodyStyle:"background:white;",border:false,autoScroll:true,anchor:"100% 100%",layoutOnTabChange:true,items:$H(j).values().compact(),getTabs:function(){return j}})},hasContents:function(j){var k=true;b.each(function(l){if(l.tab===j){d.each(function(m){if((m.showsInCategory||m.category)===l.id){k=false;throw $break}})}if(!k){throw $break}});if(k){return $H(h).values().any(function(l){return l.id==j&&l.attr.html})}return !k},createTabs:function(k){var j={};k.each(function(l){if(this.hasContents(l.id)){j[l.id]=new Ext.Panel(l.attr)}}.bind(this));return j},showWindow:function(k){var j=$H(h).values();if(typeof k=="string"||k instanceof Array){k=[].concat(k);j=j.findAll(function(q){return k.include(q.id)}).compact()}var p=this.createTabPanel(j),n=$H(p.getTabs()).values();var m=this.createWindow(j);if(n.size()>1){m.add(p)}else{m.add(n.first())}m.getTabPanel=function(){return p};var l=this;j.each(function(q){if(l.hasContents(q.id)){l["create"+q.id.capitalize()+"Store"](m)}});m.show();m.body.mask(Signavio.I18N.Repository.Configuration.loading)},doSave:function(n){var p={};var m=false;if(this.hasContents(h.CONTROLRIGHTS.id)&&n.getTabPanel().getTabs().controlrights&&n.getTabPanel().getTabs().controlrights.rendered){n.getTabPanel().getTabs().controlrights.getFields().each(function(q){if(q.configuration){if(!p[q.configuration.category]){p[q.configuration.category]={}}if(q.getValue() instanceof Array){q.setValue(q.getValue().collect(function(r){return r.replace(Signavio.I18N.Repository.ControlRights.ownIp,"")}))}p[q.configuration.category][q.configuration.id]=q.getValue();if((q.getValue() instanceof Array||"object"===typeof q.getValue())&&(q.initialConfig.value||[]).sort().toJSON()!==(q.getValue()||[]).sort().toJSON()&&!m){m=true}else{if(!(q.getValue() instanceof Array||"object"===typeof q.getValue())&&(q.configuration.value||q.initialConfig.value)!==q.getValue()&&!m){m=true}}}}.bind(this));if(m){Signavio.Core.Stores.RequestManager.doPut("controlrights",[null,function(q){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.save,msg:Signavio.I18N.Repository.ControlRights.saveFailed,buttons:Ext.Msg.OK,icon:Ext.MessageBox.Warning})}],p)}}var l=[];$H(n.getTabPanel().getTabs()).each(function(q){if(q.key!==h.CONTROLRIGHTS.id){l.push(q.value)}});if(n.getConfigurationStore&&n.getConfigurationStore()){var k=n.getConfigurationStore();var j=l.map(function(q){return q.getFields()}).flatten();j.each(function(x){var y=x.getValue(),s=x.configuration,u=this.getConfigurationObject(s),q=this.getConfigurationName(s),r=this.getConfigurationCategory(s),v=k.getConfiguration(u,r,q),z=("undefined"!=typeof s.value&&y!=s.value&&y!=="")||("undefined"==typeof s.value&&y);if(v){if(z){var w=Object.clone(v.get("rep"));w.value=y;v.set("rep",w)}else{k.remove(v)}}else{if(z){var t=Signavio.Core.RecordCreator.create("config","",{name:q,object:u,category:r,value:y,type:this.getConfigurationType(s)});k.add(t)}}}.bind(this));if(k.getModifiedRecords().length>0||(k.addedRecords&&k.addedRecords.length>0)||(k.removedRecords&&k.removedRecords.length>0)){k.commitChanges()}}},doCancel:function(j){if(j.getConfigurationStore&&j.getConfigurationStore()){j.getConfigurationStore().rejectChanges()}},getConfigurationName:function(j){return j.id},getConfigurationObject:function(l){var k=l.object;switch(k.toLowerCase()){case"controlrights":return null;case"department":var j=this.facade.getCurrentUser().getRecords("info")[0];if(j&&j.get("rep").department){return j.get("rep").department}return this.facade.getConfig().tenant.split("/").last();case"tenant":return this.facade.getConfig().tenant.split("/").last();case"user":return this.facade.getCurrentUser().getIdentifier().split("/").last();default:throw new Error("Category does not exist.");break}},getConfigurationCategory:function(j){return j.category},getConfigurationType:function(j){return["boolean","integer","decimal","string","blob"].include(j.type)?j.type:"string"},generatePanel:function(n,p,l){if(!n||!(p instanceof Array)||p.length<=0){return}var k=p.map(this.generateItem.bind(this,l));var j=new Ext.Panel({title:n.title,items:k,anchor:"100%",dirty:false,cls:"df-conf-topicpanel",bodyStyle:"padding:6px 5px 5px 5px;",style:"margin-bottom:10px;",collapsible:false,layout:"form",labelWidth:250,listeners:{resize:function(r,q){q-=270;this.items.each(function(s){if(s instanceof Ext.form.TextField||s instanceof Ext.Panel){s.setWidth(q)}});this.doLayout()}},defaults:{}});var m=k.select(function(q){return q.getValue instanceof Function});j.getFields=function(){return m};j.validate=function(){var q=true;k.each(function(r){if(r.validate&&!r.validate()){q=false;throw $break}});return q};return j},generatePanels:function(l,j){var k=[];$H(l).each(function(n){var m=this.generatePanel(this.getCategory(n.key),n.value,j);k.push(m)}.bind(this));return k.compact()},getField:function(j,k){return j.findParentByType("panel").items.find(function(l){if(l.configuration){return l.configuration.id===k}return false})},validateFields:function(k,j,n,l,p,m){if(k.configuration.id===j){n.getField().maxText=n.getField().maxText.replace(n.getField().maxValue,m);n.getField().maxValue=m;n.validate()}else{p.getField().minText=p.getField().minText.replace(p.getField().minValue,l);p.getField().minValue=l;p.validate()}},validatePasswordLengthOrAge:function(j,k,l){var m,n;if(j.configuration.id==="passwordminage"||j.configuration.id==="passwordmaxage"){m=this.getField(j,"passwordminage");n=this.getField(j,"passwordmaxage");this.validateFields(j,"passwordmaxage",m,k.minAge,n,k.maxAge)}else{if(j.configuration.id==="passwordminlength"||j.configuration.id==="passwordmaxlength"){m=this.getField(j,"passwordminlength");n=this.getField(j,"passwordmaxlength");this.validateFields(j,"passwordmaxlength",m,k.minLength,n,k.maxLength)}}},updateField:function(n,j,m,k,l){if(k.value>-1){n[j]=n[j].replace(n[m],k.value);n[m]=k.value}else{n[j]=n[j].replace(n[m],l);n[m]=l}},updateFields:function(m,l,k,n,j){max="passwordmax"+k;min="passwordmin"+k;var p=this.getField(l,max);var q=this.getField(l,min);if(l.configuration.id===min){this.updateField(m,"maxText","maxValue",p,j.options.max)}if(l.configuration.id===max){this.updateField(m,"minText","minValue",q,j.options.min)}this.validateFields(l,max,q,n,p,n)},validatePasswordLengthOrAgeInput:function(l,k,m,j){if(k.configuration.id==="passwordminlength"||k.configuration.id==="passwordmaxlength"){this.updateFields(l,k,"length",m,j)}if(k.configuration.id==="passwordminage"||k.configuration.id==="passwordmaxage"){this.updateFields(l,k,"age",m,j)}},createBooleanInput:function(j){return new Ext.form.Checkbox(Ext.apply(j,{checked:j.value||false,value:j.value||false,style:"position:relative;top:2px;"}))},createDecimalInput:function(j){return new Ext.form.NumberField(Ext.apply(j,{decimalPrecision:10,width:250}))},createChoiceInput:function(k,j){return new Ext.form.ComboBox(Ext.apply(k,{width:250,displayField:"title",valueField:"value",editable:false,readOnly:true,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,store:new Ext.data.SimpleStore({fields:["value","title"],data:(j.items||[]).map(function(l){return[l.value,l.title]})})}))},createIPCheckBoxInput:function(j){return new Ext.form.Checkbox(Ext.apply(j,{cls:"ip-checkbox",checked:j.value||false,value:j.value||false,style:"position:relative;top:2px;margin-top:2px",listeners:{check:function(k,l){this.isIPRangeEnabled.value=l;if(l){if(this.ipAddressTree.isVisible()){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.ipCheckTitle,msg:Signavio.I18N.Repository.ControlRights.ipCheckInfo,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}this.listParentPanel.enable()}else{this.listParentPanel.disable()}}.bind(this)}}))},createMinMaxFieldLabel:function(j){return new Ext.Panel({width:250,html:j.fieldLabel,border:false,bodyStyle:"font-size:11px;padding:4px 0px 1px 0px;"})},createMinMaxCheckbox:function(j,l){var k=this;return new Ext.form.Checkbox({checked:j.value>=0,style:"position:relative;margin-left:5px;margin-top:2px;margin-right:10px;",listeners:{check:function(m,q){var n=this.findParentByType("panel");if(!q){k.validatePasswordLengthOrAge(n,{minAge:1,maxAge:365,minLength:6,maxLength:365});l.disable()}else{var p=l.getValue();k.validatePasswordLengthOrAge(n,{minAge:p,maxAge:p,minLength:p,maxLength:p});l.enable()}}}})},createMinMaxField:function(l,j){var k=this;return new Ext.form.NumberField({width:40,selectOnFocus:true,maskRe:/\d/,value:l.value>0?l.value:j.options.min,emptyText:this.value,minValue:j.options.min,maxValue:j.options.max,allowBlank:false,blankText:Signavio.I18N.Repository.ControlRights.fieldEmpty,minText:Signavio.I18N.Repository.ControlRights.lessThanMin.replace("{0}",j.options.min),maxText:Signavio.I18N.Repository.ControlRights.moreThanMax.replace("{0}",j.options.max),listeners:{change:function(p,n){var m=this.findParentByType("panel");k.validatePasswordLengthOrAgeInput(this,m,n,j);this.validate()}}})},createMinMaxInput:function(p,l){var k=this.createMinMaxFieldLabel(p);var q=this.createMinMaxField(p,l);var n=this.createMinMaxCheckbox(p,q);if(!n.checked){q.disable()}var m=p.value||l.value||l.options.min;if(m>0){q.setValue(m)}var j=new Ext.Panel(Ext.apply(p,{layout:"column",bodyStyle:"margin-bottom: 14px",configuration:l,setWidth:function(r){return Ext.Panel.prototype.setWidth.call(this,r+258)},validate:q.validate.bind(q),border:false,getValue:function(){if(!n.checked){return -1}return q.getValue()},items:[k,n,q,{xtype:"label",style:"margin: 4px 0 0 7px;",text:l.options.suffix}]}));j.getField=function(){return q};return j},createLanguageCombo:function(j){var k={};f.ALL.each(function(n){var l=n.split("_");var p=l.first();var m=l.last();if(!k[p]){k[p]=[]}k[p].push(m)});return new Ext.ux.form.ComboBox(Ext.apply(j,{store:new Ext.data.SimpleStore({fields:["value","title","group","country","position","rel"],data:f.ALL.map(function(p){var m=p.split("_");var q=m.first();var n=m.last();var l={rel:p,position:0};if(m.length===2&&k[q].length>1){return[p,Signavio.I18N.Languages[q],q,n,null,l]}return[p,Signavio.I18N.Languages[q],null,n,null,l]}),sortInfo:{field:"title",direction:"ASC"}}),mode:"local",tpl:'<tpl for="."><tpl if="group != null && (xindex === 1 || xindex &gt; 1 && parent[xindex-2].group != group)"><div style="padding:2px; color: silver; border:1px solid white; font-style: italic;">{[Signavio.I18N.Languages[values.group]]}</div></tpl><tpl if="group != null"><div class="x-combo-list-item" style="padding-left:15px"><img src="'+Signavio.Config.IMAGE_PATH+'/flags/{country}.png" style="width:16px;height:11px;"/> {[Signavio.I18N.Countries[values.country]]}</div></tpl><tpl if="group == null"><div class="x-combo-list-item">{title} (<img src="'+Signavio.Config.IMAGE_PATH+'/flags/{country}.png" style="width:16px;height:11px;"/>  {[Signavio.I18N.Countries[values.country]]})</div></tpl></div></tpl>'}))},createLanguageGrid:function(n,k){if("string"==typeof n.value){n.value=(n.value||"[]").evalJSON(true)}if(!(n.value instanceof Array)){n.value=[n.value||null].compact()}var j=new Ext.data.SimpleStore({fields:["value","title","group","country","position","rel","dateformat"],data:n.value.map(function(r){var p=r.rel.split("_");var s=p.first();var q=p.last();return[r.rel,Signavio.I18N.Languages[s],s,q,r.position,r,r.dateformat||"dd.mm.YYYY"]}),sortInfo:{field:"position",direction:"ASC"}});var l=new Ext.grid.GridPanel({header:false,hideHeaders:true,border:false,style:"margin-left:5px;margin-right:2px;padding:1px 0 5px;",columnWidth:1,store:j,height:100,cls:"y-language-selection-grid",autoExpandColumn:"x-manageconfiguration-language-language-column",viewConfig:{forceFit:true,emptyText:Signavio.I18N.LanguageConfiguration.emptyText},cm:new Ext.grid.ColumnModel([{dataIndex:"value",width:15,fixed:true,renderer:function(r,s,p,q){return(q+1)+"."}},{dataIndex:"title",id:"x-manageconfiguration-language-language-column",renderer:function(v,t,p,q){var r=p.get("value");var s=r.split("_");var w=s.first();var u=s.last();if(w!==u){r=u}else{r=w}if(q===0){v="<b>"+v+"</b>"}return v+" (<img src='"+Signavio.Config.IMAGE_PATH+"/flags/"+r+".png' style='position:relative;top:2px;'/> "+Signavio.I18N.Countries[u]+")"}},{dataIndex:"value",width:120,fixed:true,renderer:function(r,s,p,q){if(q!==0){return"<a href='' onclick='return false;' class='y-language-remove'>"+Signavio.I18N.LanguageConfiguration.remove+"</a>, <a href='' onclick='return false;' class='y-language-move'>"+Signavio.I18N.LanguageConfiguration.up+"</a>"}return""}}])});var m=function(){var p=this;$A(l.view.getRows()).invoke("removeAttribute","style");(l.view.getRow(1)||{setAttribute:function(){}}).setAttribute("style","border-top:1px solid silver;margin-top:5px;padding-top:5px;");l.getEl().select(".y-language-remove").each(function(r,s,q){r.removeAllListeners();r.on("click",function(){var t=j.getAt(q+1);j.remove(t);for(var u=q+2;u<j.getCount();u++){var v=j.getAt(u);v.set("position",v.get("position")-1)}l.getView().refresh()})});l.getEl().select(".y-language-move").each(function(r,s,q){r.removeAllListeners();r.on("click",function(){var v=j.getAt(q+1);var x=j.getAt(q);var w=function(){x.set("position",v.get("position"));v.set("position",v.get("position")-1);j.sort("position","ASC")};if(q==0){var z=Ext.Msg.confirm(Signavio.I18N.LanguageConfiguration.moveConfirmTitle,(Signavio.I18N.LanguageConfiguration.moveConfirmDescription).replace("#{lang}",v.get("title").toLowerCase()).replace("#{supportMailAdresse}",this.facade.getConfig().supportMailAddress),function(A){if(A=="yes"&&u()){w()}y.buttons[1].setDisabled(false)}),u=function(){var A=z.getDialog().body.child("input#x-language-change-default");return A&&A.dom.value==["Bw","f"].join("G")},y=z.getDialog(),t=function(A){A.buttons[1].setDisabled(!u());A.body.select("input#x-language-change-default").on("keyup",function(){A.buttons[1].setDisabled(!u())})};if(!y.rendered){y.on("show",t)}else{t(y)}z.setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{w()}}.bind(this))}.bind(this));if(j.getCount()>0){l.setHeight(l.getGridEl().child(".x-grid3-body",true).getHeight()+25)}else{l.setHeight(50)}l.view.applyEmptyText()}.bind(this);l.on("render",m);l.getView().on("refresh",m);l.getView().on("rowsinserted",m);l.getView().on("rowremoved",m);return l},createLanguageOverview:function(n,k,q){var l=this.createLanguageGrid(n,k);var j=l.getStore();q.on("select",function(t,s){if(j.find("value",s.get("value"))===-1){var u=function(){s.set("position",j.getCount());j.addSorted(s)};if(j.getCount()>=this.facade.getConfig().numAllowedLanguages){Ext.Msg.show({title:Signavio.I18N.LanguageConfiguration.tooManyLangsTitle,msg:Signavio.I18N.LanguageConfiguration.tooManyLangsDescription,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}else{if(j.getCount()<=0){Ext.Msg.show({title:Signavio.I18N.LanguageConfiguration.addNewTitle,msg:Signavio.I18N.LanguageConfiguration.addNewDescription,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.INFO,fn:function(v){if(v=="yes"){u()}}})}else{u()}}}}.bind(this));var r={fieldLabel:Signavio.I18N.LanguageConfiguration.activeLanguages+'<div class="x-description">'+Signavio.I18N.LanguageConfiguration.activeLangaugesDescription+"</div>"};var m=this.createFormElement(r,l);var p;return new Ext.Panel({items:[m,q,p].compact(),layout:"form",labelWidth:250,getValue:function(){var s=[];l.getStore().each(function(t){s.push({rel:t.get("value"),position:t.get("position"),dateformat:t.get("dateformat")||g.DEFAULT})});return s},border:false,configuration:k})},createLanguageSelector:function(l,k){var j=this.createLanguageCombo(l);j.setValue(f.DEFAULT);return this.createLanguageOverview(l,k,j)},createCurrencyComboBox:function(j){return new Ext.ux.form.ComboBox(Ext.apply(j,{width:250,displayField:"title",valueField:"value",editable:false,readOnly:true,triggerAction:"all",forceSelection:true,store:new Ext.data.SimpleStore({fields:["value","title"],data:e.ALL.map(function(k){return[k,k]}),sortInfo:{field:"value",direction:"ASC"}}),mode:"local",tpl:'<tpl for="."><div class="x-combo-list-item"><img src="'+Signavio.Config.IMAGE_PATH+'/flags/{[values.value.substring(0, 2).toLowerCase()]}.png" style="width:16px;height:11px;"/> {value}</div></tpl>'}))},createCurrencySelector:function(k,j){var l=this.createCurrencyComboBox(k);return new Ext.Panel({items:[l].compact(),layout:"form",labelWidth:250,getValue:function(){return l.getValue()},border:false,configuration:j})},getDefaultDateFormat:function(k){k=k.split("_").first();var j=g.DEFAULT;$H(g.ALL).each(function(l){if(l.value.languages.include(k)){j=l.key;throw $break}});return j},getCurrentDateFormat:function(l,k){var j=null;l.each(function(m){if(m.rel===k){j=m.dateformat;throw $break}});return j||g.DEFAULT},getDateFormatVariations:function(j){return g.ALL[j].variations},getHumanReadableFormat:function(j){j=j||g.DEFAULT;$H(a).each(function(k){j=j.replace(k.key,k.value)});return j},generateFormatData:function(j,l){var k=this;return[[j]].concat(l.map(function(m){return[m]})).map(function(m){var n=m.first();var p=k.getHumanReadableFormat(n);m.push(p);return m})},handleBeforeFormatEdit:function(q,p){var r=p.record.get("value");var k=p.grid.getColumnModel();var n=this.getDefaultDateFormat(r);var m=this.getCurrentDateFormat(q,r);var j=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:["format","title"],data:this.generateFormatData(n,this.getDateFormatVariations(n))}),mode:"local",editable:false,valueField:"format",displayField:"title",value:m||n});var l=new Ext.grid.GridEditor(j);k.setEditor(p.column,l);l.render(p.grid);l.setSize(k.getColumnWidth(p.column,l.height))},createDateOptions:function(l,j){if("string"==typeof l.value){l.value=(l.value||"[]").evalJSON(true)}if(!(l.value instanceof Array)){l.value=[l.value||null].compact()}var k=new Ext.grid.EditorGridPanel({store:j,header:false,hideHeaders:true,border:false,clicksToEdit:1,disableSelection:true,cm:new Ext.grid.ColumnModel([{dataIndex:"value",width:30,renderer:function(p){var q=p.split("_");var s=q.first();var r=q.last();if(s!==r){p=r}else{p=s}return"<img src='"+Signavio.Config.IMAGE_PATH+"/flags/"+p+".png' style='width:16px;height:11px;'/>"}},{dataIndex:"dateformat",width:240,renderer:this.getHumanReadableFormat,editor:new Ext.form.TextField()}])});var n={fieldLabel:Signavio.I18N.DateFormat.title+'<div class="x-description">'+Signavio.I18N.DateFormat.description+"</div>"};var m=function(){var p=k.getStore();if(p.getCount()>0){k.setHeight(k.getGridEl().child(".x-grid3-body",true).getHeight()+25)}};k.on("render",m);k.getView().on("refresh",m);k.on("beforeedit",this.handleBeforeFormatEdit.bind(this,l.value));k.on("afteredit",function(){k.getStore().commitChanges()});return this.createFormElement(n,k)},generateItem:function(k,m){var r={fieldLabel:m.title+':<div class="x-description">'+(m.description instanceof Function?m.description.call(this):m.description||"")+"</div>",labelSeparator:"",value:m.value,configuration:m};var p=this.getConfigurationObject(m),l=this.getConfigurationName(m),n=this.getConfigurationCategory(m),q;if(m.object==="controlrights"){q=k.getRange().find(function(s){return s.get("rel")==="config"}).get("rep")[m.category][l];r.value=q}else{q=k.data.items.find(function(s){return s.data.rep.name===l});if(q){r.value=q.data.rep.value.value}if(p){var j=k.getConfiguration(p,n,l)}}if(j){r.value=j.get("rep").value}switch(m.type.toLowerCase()){case"boolean":return this.createBooleanInput(r);case"integer":r.allowDecimals=false;break;case"decimal":return this.createDecimalInput(r);case"choice":return this.createChoiceInput(r,m);case"urllist":if(typeof r.value==="string"){r.value=(r.value||"{}").evalJSON()}return new Ext.ux.form.UrlLinkFieldList(Ext.apply(r,{width:250}));case"model":return this.generateModelItem(r,m);case"ipcheckbox":this.isIPRangeEnabled=this.createIPCheckBoxInput(r);return this.isIPRangeEnabled;case"iplist":return this.generateIPList(r,m,k);case"description":return new Ext.Panel({cls:"df-controlrightsdescription",items:new Ext.form.Label({text:m.value})});case"minmaxtextfield":return this.createMinMaxInput(r,m);case"languageselector":return this.createLanguageSelector(r,m);case"currencyselector":return this.createCurrencySelector(r,m);default:return new Ext.form.TextField(Ext.apply(r,{width:250,emptyText:m.value||""}))}},generateIPList:function(q,k,j){var n,p,r,m,l;n={iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/delete.png",text:Signavio.I18N.Repository.ControlRights.remove,handler:function(){r.getRootNode().eachChild(function(s){if(s&&s.isSelected()&&s.disabled){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,msg:Signavio.I18N.Repository.ControlRights.ipCannotBeRemoved,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING})}else{if(s&&s.isSelected()){if(s.previousSibling&&!s.previousSibling.disabled){s.previousSibling.select()}else{if(s.nextSibling&&!s.nextSibling.disabled){s.nextSibling.select()}}r.findParentByType("panel").findParentByType("panel").dirty=true;s.remove();return}}});r.updateValue(r.getIPs())}.bind(this)};m={};r=new Ext.tree.TreePanel({cls:"df-x-iplisttree",headerAsText:false,width:180,root:new Ext.tree.TreeNode({}),tbar:[{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/add.png",text:Signavio.I18N.Repository.ControlRights.add,handler:function(){var s=new Ext.form.TextField({style:"margin: 8px 0 5px 10px; width: 210px;",invalidText:Signavio.I18N.Repository.ControlRights.ipIsInvalid,blankText:Signavio.I18N.Repository.ControlRights.ipv4,anchor:"100%",allowBlank:false,regex:/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,validator:function(){var u=l.items.get(1).getValue();if(!this.validateIP(u)){return Signavio.I18N.Repository.ControlRights.ipInvalid}if(r.isAllready(u)){return Signavio.I18N.Repository.ControlRights.ipAlready}return true}.bind(this),listeners:{valid:function(){t.enable()},invalid:function(){t.disable()}}});var t=new Ext.Button({text:Signavio.I18N.Repository.ControlRights.add,width:100,disabled:true,cls:"df-ip-add-btn",style:"margin-to:10px",listeners:{click:function(){var u=l.items.get(1).getValue();if(!this.validateIP(u)){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,msg:Signavio.I18N.Repository.ControlRights.ipInvalid,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}else{if(r.updateIPs(new Ext.tree.TreeNode({text:u,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/computer.png"}))){l.close()}}}.bind(this)}});l=new Ext.Window({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,modal:true,cls:"df-ip-add-window",border:false,resizable:false,width:"250px",buttonAlign:"center",layout:"anchor",items:[{html:"<div style='background-color: #999999'>"+Signavio.I18N.Repository.ControlRights.ipv4+"</div>"},s],buttons:[new Ext.Button({text:Signavio.I18N.Repository.ControlRights.chancel,width:100,handler:function(){l.close()}.bind(this)}),t]});l.show()}.bind(this)},n],rootVisible:false,autoHeight:false,border:true,height:120,getValue:function(){return this.listParentPanel.value}.bind(this),getIPs:function(){var s=[];this.getRootNode().eachChild(function(t){s.push(t.text)});return s},setValue:function(s){this.updateValue(s)},updateValue:function(s){this.listParentPanel.value=s}.bind(this),clear:function(){if(!this.getRootNode){return}$A(this.getRootNode().childNodes||[]).each(function(s){if(s.remove instanceof Function){s.remove()}})},value:q.value||[],getDeleteBtn:function(){return n}.bind(this),isAllready:function(t){var s=false;this.getRootNode().eachChild(function(u){if(u.text==t){s=true}if(u.disabled&&u.text===(t+Signavio.I18N.Repository.ControlRights.ownIp)){s=true}});return s},updateIPs:function(s){if(s){this.findParentByType("panel").findParentByType("panel").dirty=true;var t=false;var u=s.text;this.getRootNode().eachChild(function(v){if(v.text==u){t=true}});if(t){Ext.Msg.show({title:Signavio.I18N.Repository.ControlRights.addAddressTitle,msg:Signavio.I18N.Repository.ControlRights.ipAlready,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}else{this.getRootNode().appendChild(s);this.updateValue(this.getIPs());return true}}else{if(!this.ipObj){this.ipObj=j.getRange()[0].get("rep").iprange.iplist;if(!this.ipObj){this.ipObj=[]}Signavio.Core.Stores.RequestManager.doGet("controlrights",function(v){this.clear();this.ipObj.adminip=v[0].rep;if(!this.ipObj.find(function(w){return w===this.ipObj.adminip}.bind(this))){this.ipObj.push(this.ipObj.adminip)}this.ipObj.each(function(w){this.getRootNode().appendChild(new Ext.tree.TreeNode({text:w+(w==this.ipObj.adminip?Signavio.I18N.Repository.ControlRights.ownIp:""),leaf:true,disabled:w==this.ipObj.adminip,listeners:{click:function(x,y){if(w==this.ipObj.adminip){x.unselect()}}.bind(this)},icon:Signavio.Config.IMAGE_PATH+"/famfamfam/computer.png"}))}.bind(this));this.updateValue(this.getIPs())}.bind(this),{curip:true})}}},listeners:{beforerender:function(s){s.getSelectionModel().on("beforeselect",function(t,u){return !u.disabled})},append:function(s,t){t.sort(function(x,v){var y=x.text.split(/\./);var w=v.text.split(/\./);var u;for(u=0;u<4;u++){if("string"==typeof y[u]&&y[u].length==1){y[u]="00"+y[u]}if("string"==typeof y[u]&&y[u].length==2){y[u]="0"+y[u]}if("string"==typeof w[u]&&w[u].length==1){w[u]="00"+w[u]}if("string"==typeof w[u]&&w[u].length==2){w[u]="0"+w[u]}}return y.inject("",function(A,z){return A+"."+z}).substring(1)<w.inject("",function(A,z){return A+"."+z}).substring(1)})}}});this.ipAddressTree=r;r.updateIPs();this.listParentPanel=new Ext.Panel(Ext.apply(q,{border:false,layout:"column",disable:function(){this.items.get(1).disable()},enable:function(){this.items.each(function(s){s.enable()})},listeners:{afterlayout:function(){if(!this.isIPRangeEnabled.getValue()){this.listParentPanel.disable()}}.bind(this)},setValue:function(s){this.items.items[1].setValue(s)},getValue:function(){return this.items.items[1].getValue()},items:[new Ext.Panel({width:250,html:q.fieldLabel,border:false,bodyStyle:"font-size:11px;padding:4px 0px 1px 0px;"}),r]}));return this.listParentPanel},generateModelItem:function(l,k){var j=new Signavio.Extensions.ModelDirectoryCheckTreePanel({style:"margin-left:5px;margin-right:2px;padding:1px 0 5px;",columnWidth:1,height:150,root:new Ext.tree.TreeNode({text:"",draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,singleClickExpand:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL],filterFn:function(m){if(this.isModel(m)){return true}else{if(this.isDirectory(m)&&this.isPublic(m)){return !this.isTrashFolder(m)}else{return false}}}.bind(this),isChildLeaf:function(m){return m.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(m){return m.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(m,true):"folder"}}),onRootLoaded:function(){if(l.value&&l.value.startsWith("/model/")){var m=Signavio.Core.StoreManager.getStore(l.value,true,function(){j.expandToAndCheckPreSelection([m],true)})}},getValue:function(){var m=this.getSelectedRecord();if(m){return m.get("href")}}},[]);j.getSelectionModel().on("beforeselect",function(n,m){return m.attributes.rel===Signavio.Const.REL.MODEL});j.getSelectionModel().onNodeClick=function(m,n){if(m==this.selNode){this.unselect(m)}else{this.select(m)}};return this.createFormElement(l,j,function(){var m=j.getSelectionModel().getSelectedNode();if(m){return m.attributes.identifier}return undefined})},createFormElement:function(k,j){return new Ext.Panel(Ext.apply(k,{border:false,layout:"column",setWidth:function(l){return Ext.Panel.prototype.setWidth.call(this,l+258)},getValue:j.getValue?j.getValue.bind(j):null,items:[new Ext.Panel({width:250,html:k.fieldLabel,border:false,bodyStyle:"font-size:11px;padding:4px 0px 14px 0px;"}),j]}))},getCategory:function(j){return b.find(function(k){return k.id===j})},getConfiguration:function(k){var j={};b.each(function(l){if(l.tab===k){j[l.id]=[]}});d.each(function(l){if(j[l.showsInCategory||l.category]){j[l.showsInCategory||l.category].push(l)}});return j},validateIP:function(n){var q=[{ip:"0.0.0.0",mask:8},{ip:"10.0.0.0",mask:8},{ip:"127.0.0.0",mask:8},{ip:"169.254.0.0",mask:16},{ip:"172.16.0.0",mask:12},{ip:"192.0.2.0",mask:24},{ip:"192.88.99.0",mask:24},{ip:"192.168.0.0",mask:16},{ip:"198.18.0.0",mask:15},{ip:"198.51.100.0",mask:24},{ip:"203.0.113.0",mask:24},{ip:"224.0.0.0",mask:4},{ip:"240.0.0.0",mask:4},{ip:"255.255.255.255",mask:32}];var k=function(r){return $R(0,7-r.length).inject("",function(t,s){return t+"0"})+r};var l=function(s){var r=s.split(".");return r.inject("",function(u,t){return u+k(parseInt(t).toString(2))})};var p=function(s,r){return $R(1,32).inject("",function(t,u){return t+(u>r?"0":s[u-1])})};var m=function(t,u){var r=l(t);var s={isvalid:true};u.each(function(v){if(p(r,v.mask)==p(l(v.ip),v.mask)){s.isvalid=false;s.subnet=v;return}});return s};var j=function(s){var r=s.split(".");return r.findAll(function(t){return t<256}).length===4};if(!j(n)){return false}return m(n,q).isvalid},isModel:function(j){return j.get("rel")==Signavio.Const.REL.MODEL},isPublic:function(j){return !j.get("rep").type||j.get("rep").type=="public"},isDirectory:function(j){return j.get("rel")==Signavio.Const.REL.DIRECTORY},isTrashFolder:function(j){return this.facade.getTrashRecord()&&j.get("href")==this.facade.getTrashRecord().get("href")}};Signavio.Plugins.ManageConfiguration=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageConfiguration)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Rename={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.initEvents();this.facade.offer({relGroup:"edit",index:8,name:Signavio.I18N.Repository.Offer.renameTitle,description:Signavio.I18N.Repository.Offer.renameDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/textfield_rename.png",functionality:this.showRenameBox.bind(this,true),isDisabled:function(){return this.getSelection().length!=1}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.WRITE]})},initEvents:function(){new Ext.KeyMap(document,{key:113,fn:this.showRenameBox,scope:this})},showRenameBox:function(){if(this.dialog){return}var e=this.getSelection();if(e.length===1){var b=Signavio.Core.StoreManager.getStore(e[0].get("href"));var f=b.getRecords("info")[0];var a=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Offer.renameLabelName,tabIndex:0,value:(f.get("rep").name||"").unescapeHTML()});var g=new Ext.form.TextArea({fieldLabel:Signavio.I18N.Repository.Offer.renameLabelDesc,value:(f.get("rep").description||"").unescapeHTML()});var d=new Ext.form.FormPanel({defaultType:"textfield",border:false,anchor:"100% 100%",items:[a,g]});d.getForm().errorReader={read:function(h){return{success:h.responseText.startsWith("["),records:[]}}};a.focus(true,500);var c=function(){if(!a.el||!g.el){return}var j=this.dialog.el.getWidth();var k=this.dialog.el.getHeight();a.el.setWidth(j-139);g.el.setWidth(j-139);g.el.setHeight(k-117)}.bind(this);this.dialog=new Ext.ux.Window({autoCreate:true,cls:"x-plugin-rename-window",modal:true,title:Signavio.I18N.Repository.Offer.renameTitle,resizable:true,width:500,minWidth:400,height:300,minHeight:300,layout:"anchor",items:[d],listeners:{resize:c,show:c,close:function(){delete this.dialog}.bind(this)},buttons:[{text:Signavio.I18N.Repository.Offer.renameTitle,handler:function(){var h=d.items.get(0).getValue();var j=d.items.get(1).getValue();if(h){if(f){var k=Object.clone(f.get("rep"));if(k.name!==h||k.description!==j){k.name=(h||"");k.description=(j||"");f.set("rep",k);f.commit()}}}this.dialog.close()}.bind(this)}]});this.dialog.show()}}};Signavio.Plugins.Rename=Signavio.Core.Plugin.extend(Signavio.Plugins.Rename)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.ManageInternalFolder={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",arrange:"right",seperated:true,index:50});this.facade.offer({relGroup:"configure",name:Signavio.I18N.Repository.Offer.manageInternalFolderTitle,description:Signavio.I18N.Repository.Offer.manageInternalFolderDesc,arrange:"right",icon:"/libs/ext-2.0.2/resources/images/default/s.gif",functionality:this.toogleInternalFolder.bind(this),index:55,isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this),onAdd:function(a){this.btn=a;this.toogleInternalFolder(true)}.bind(this)});Signavio.Core.StoreManager.getRootDirectoryStore().on("load",function(a){var b=a.getRange();if(!b.any(function(c){return c.get("rep").type=="internal"})){this.btn.destroy()}}.bind(this))},toogleInternalFolder:function(a){if(!this.cp){this.cp=new Ext.state.CookieProvider({path:Ext.isIE?"/":window.location.pathname,expires:null})}if(a!==true){if(this.cp.get("showinternalfolder")){this.cp.clear("showinternalfolder")}else{this.cp.set("showinternalfolder",true)}}this.btn.setIconClass(["x-checkbox-image",this.cp.get("showinternalfolder")?"x-checked":undefined].compact().join(" "));this.facade.raiseEvent("updatefolders")}};Signavio.Plugins.ManageInternalFolder=Signavio.Core.Plugin.extend(Signavio.Plugins.ManageInternalFolder)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.SharePointDownloadLinkDialog=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",name:Signavio.I18N.Repository.Offer.certificateDownloadSharePoint,description:Signavio.I18N.Repository.Offer.certificateDownloadSharePointInfo,arrange:"right",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_office.png",functionality:this.show.bind(this),index:25,isVisible:function(){return this.facade.isCurrentUserAdmin()&&this.facade.getConfig().numOfSPUsers&&this.facade.getConfig().numOfSPUsers>0}.bind(this)})},show:function(){var a=new Ext.Window({modal:true,title:Signavio.I18N.Repository.Offer.certificateDownloadSharePoint,bodyStyle:"background:white;padding:10px;",items:this.getDownloadPanel(),width:500,resizable:false,autoHeight:true,buttons:[{text:Signavio.I18N.Repository.SecurityCenter.Button.close,handler:function(){a.close()}.bind(this)}]});a.show()},getDownloadPanel:function(){var f,e,a,b,d,c;f=new Ext.Panel({border:false,cls:"x-sharepoint-download",bodyStyle:"padding:10px 0 10px 0;",html:"<div style='margin-bottom:10px;'>"+Signavio.I18N.Repository.Offer.certificateDownloadSharePointInfo+"</div>"});e=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:[["SharePoint 2007","SignavioViewer2007"],["SharePoint 2010","SignavioViewer2010"],["SharePoint 2013","SignavioViewer2013"],["SharePoint 365","SignavioViewer365"]]}),fieldLabel:Signavio.I18N.Repository.Offer.certificateSharepointVersion,valueField:"value",displayField:"title",value:"SignavioViewer2013",mode:"local",width:200,readOnly:true,forceSelection:true,listeners:{change:function(){c()}}});d=new Ext.XTemplate("<a href='/p/sharepoint?signavioviewerversion={sharepointversion}&signavio-id="+Ext.Ajax.getSecurityToken()+"' target='_blank'>",Signavio.I18N.Repository.Offer.certificateDownloadSharePoint,"</a>");a=new Ext.Panel({html:"",border:false,bodyStyle:"margin-top: 7px",listeners:{render:function(){c()}}});c=function(){d.overwrite(a.body,{sharepointversion:e.getValue()})};b=new Ext.Panel({border:false,bodyStyle:"padding:10px 0 10px 0;",items:[f,e,a]});return b}})})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.CurrencyInjector=Signavio.Core.Plugin.extend({enabled:true,construct:function(a){arguments.callee.$.construct.apply(this,arguments);this.facade=a;this.facade.registerOnEvent("attribute.mapper.stencilset.loaded",this.injectInAttributeMapper.bind(this))},injectInAttributeMapper:function(c,d){if(d&&d.arg&&typeof d.arg==="object"&&d.arg.namespace==="http://b3mn.org/stencilset/bpmn2.0#"){if(this.facade.getConfig().currency){var b=d.arg;var a=this.facade.getConfig().currency.sign;b.stencils.each(function(e){if(Signavio.Plugins.CurrencyInjector.STENCILS.include(e.id)){e.properties.each(function(f){if(f.id==="costs"){if(f.description){f.description=f.description.gsub("\\(.*?\\)","(in "+a+")")}if(f.description_de){f.description_de=f.description_de.gsub("\\(.*?\\)","(in "+a+")")}if(f.title){f.title=f.title.gsub("\\(.*?\\)","("+a+")")}if(f.title_de){f.title_de=f.title_de.gsub("\\(.*?\\)","("+a+")")}}})}})}}}});Signavio.Plugins.CurrencyInjector.STENCILS=["Task","CollapsedSubprocess","IntermediateMessageEventThrowing","IntermediateEscalationEventThrowing","IntermediateCompensationEventThrowing","IntermediateSignalEventThrowing","IntermediateMultipleEventThrowing","IntermediateEvent"]})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.OpenSimulation={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"edit",index:1,name:Signavio.I18N.Repository.Offer.openSimulation,description:Signavio.I18N.Repository.Offer.openSimulationDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/chart_curve.png",isVisible:function(){return !this.selectionInInternal()}.bind(this),isDisabled:function(){return !this.oneSelected()||!this.selectionIsBpmn20()}.bind(this),neededPrivileges:[Signavio.Config.RIGHTS.WRITE],functionality:function(){var a=Signavio.Config.SIMULATION_HANDLER_URI+"?id="+this.getSelection()[0].get("href").split("/")[2];window.open(a)}.bind(this)})}};Signavio.Plugins.OpenSimulation=Signavio.Core.Plugin.extend(Signavio.Plugins.OpenSimulation)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.AdonisImport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.Adonis.title,description:Signavio.I18N.Repository.Offer.Adonis.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.adonisImport.bind(this),index:14,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)});var b=Signavio.I18N.Language.split("_").first()},afterRender:function(){},adonisImport:function(){var c=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{text:Signavio.I18N.Repository.Offer.Adonis.restorelabel,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{name:"adonisFile",inputType:"file",style:"display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});c.getForm().errorReader={read:function(d){return{success:d.responseText.toLowerCase().endsWith("[true]\n</pre>"),records:[]}}};var b=this;var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.Adonis.restore,width:400,modal:true,resizable:false,items:[c],buttons:[{text:Signavio.I18N.Repository.Offer.Adonis.restoreBtn,handler:function(){if(c.items.items[1].el.dom.value){c.getForm().submit({url:Signavio.Config.BACKEND_PATH+"/adonis-import",waitMsg:Signavio.I18N.Repository.Offer.Adonis.wait,method:"POST",success:function(e,d){var h,g,f;a.close();h=d.response.responseText.replace(/<(\/){0,1}pre([^>]*)>/g,"");h=h.replace(/<(\/){0,1}pre([^>]*)>/g,"");h=h.replace("[true]\n","");if(h.startsWith("{")&&h.endsWith("}")){g=h.evalJSON();if(g.rep){f=b.buildValidationResultsWindow(g.rep.errors,g.rep.warnings,g.rep.infos);if(f){f.show()}}}else{if(h.startsWith("[")&&!h.endsWith("]")){Ext.Msg.alert(Signavio.I18N.Repository.Offer.Adonis.ReadingFileFailedTitle,Signavio.I18N.Repository.Offer.Adonis.ReadingFileFailedDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING)}}Signavio.Core.StoreManager.reloadChildEntitiesStore()}.bind(this),failure:function(e,d){a.close();if(text.startsWith("{")&&text.endsWith("}")){validationRes=text.evalJSON();if(validationRes.rep){b.showWarnings(validationRes.rep.errors)}}}})}}.bind(this)}]});a.show()},buildValidationResultsWindow:function(g,d,f){var e;var c=[],b,a;if(!(g instanceof Array)||!(d instanceof Array)||!(f instanceof Array)||(g.length==0&&d.length==0&&f.length==0)){return}b=new Ext.Panel({title:"test",anchor:"100%",height:60,hideCollapseTool:true,header:false,headerAsText:false,hideBorders:true,bodyBorder:false,border:false,frame:false,collapsible:false,html:(g.length>0?Signavio.I18N.Repository.Offer.Adonis.ErrorDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS):Signavio.I18N.Repository.Offer.Adonis.WarningDesc.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS))});if(g.length>0){c.push(this.setupValidationDetailsPanel(g,"Errors"))}if(d.length>0){c.push(this.setupValidationDetailsPanel(d,"Warnings"))}if(f.length>0){c.push(this.setupValidationDetailsPanel(f,"Infos"))}a=new Ext.Panel({hideBorders:true,layout:"accordion",anchor:"100%",height:350,items:c});e=new Ext.Window({width:600,height:500,resizable:true,minimizable:false,modal:true,autoScroll:false,title:Signavio.I18N.Repository.Offer.Adonis.title,bodyStyle:"background-color:#ffffff;padding:10px;",items:[b,a],buttons:[{text:Signavio.I18N.Repository.Offer.Adonis.OK,handler:function(){e.hide()}}]});return e},setupValidationDetailsPanel:function(f,d){var a,b,c,e;if(!(f instanceof Array)){return}b=new Ext.data.JsonStore({data:f,fields:["type","details"]});c=function(l,k,g,m,j,h){k.css="x-grid-cell-selectable-text";return l};e=function(l,k,g,m,j,h){if(typeof(Signavio.I18N.Repository.Offer.Adonis[l])!=="undefined"){return Signavio.I18N.Repository.Offer.Adonis[l]}else{return l}};a=new Ext.grid.GridPanel({title:Signavio.I18N.Repository.Offer.Adonis["Title"+d]+" ("+b.getTotalCount()+")",store:b,autoScroll:true,collapsed:true,disableSelection:true,columns:[{id:"type",header:Signavio.I18N.Repository.Offer.Adonis["HeaderType"+d],width:120,dataIndex:"type",menuDisabled:true,hidable:false},{id:"details",header:Signavio.I18N.Repository.Offer.Adonis["HeaderDetails"+d],editor:new Ext.form.TextField(),renderer:c,width:450,dataIndex:"details",menuDisabled:true,hidable:false}],autoExpandColumn:"details"});return a}};Signavio.Plugins.AdonisImport=Signavio.Core.Plugin.extend(Signavio.Plugins.AdonisImport)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.AMLExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:85,name:Signavio.I18N.Repository.Offer.exportAMLTitle,description:Signavio.I18N.Repository.Offer.exportAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",functionality:this.doExport.bind(this,"/aml",Signavio.I18N.Repository.Offer.exportAMLTitle),isDisabled:function(){return !this.oneSelected()||!this.selectionIsEpc()||this.selectionInTrash()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.AMLExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.AMLExport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.HrPlanning={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){var c=this.facade.getCurrentRootFolder();return c&&this.facade.getTrashRecord()===c}.bind(this);var a=function(){return !b()}.bind(this);this.facade.offer({relGroup:"reporting",index:10,name:Signavio.I18N.Repository.Offer.hrNeedTitle,description:Signavio.I18N.Repository.Offer.hrNeedDescription,icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/mimetypes/ooo_calc.png",functionality:this.triggerCalculation.bind(this),isVisible:a,isDisabled:function(){return !this.isAtLeastOneEpcSelected()}.bind(this)})},isAtLeastOneEpcSelected:function(){return this.getSelection().find(function(a){return this.isEpc(a)}.bind(this))!==undefined},triggerCalculation:function(){var a=[];var b=this.getSelection();if(b.size()==1&&this.isProcessMap(b[0])){this.showFirstDialogForProcessMap(b[0])}else{b.each(function(c){if(this.isModel(c)&&this.isEpc(c)){a.push(c)}else{if(this.isDirectory(c)){a.push(c)}}}.bind(this));this.showFirstDialog(a)}},showFirstDialogForProcessMap:function(e){var b=NaN;var d=NaN;Signavio.Core.Stores.RequestManager.doGet("/p/hrp",function(f){if(f.rep.personalAllowancePerCent){d=parseFloat(f.rep.personalAllowancePerCent)*100}if(f.rep.minutesPerManyear){b=parseInt(f.rep.minutesPerManyear)}}.bind(this),{});var a=new Signavio.Extensions.ProcessMapCheckTreePanel({visibleRootChild:new Ext.tree.TreeNode({text:e.get("rep").name,checked:false,draggable:false,leaf:false,visible:true,cls:"folder",dataField:"rep.name",identifier:e.get("href"),expanded:true,filterFn:function(f){if(this.isModel(f)){if(this.isEpc(f)||this.isProcessMap(f)){return !a.containsNodeWithIdentifier(f.get("href"))}}else{return false}}.bind(this),isChildLeaf:function(f){return this.isEpc(f)}.bind(this),hasChildCls:function(f){return this.isEpc(f)?"model":"folder"}.bind(this)}),sortingFn:function(h,g){var f=h.get("rep").namespace;var j=g.get("rep").namespace;if(f==j){tA=h.get("rep").name.toLowerCase();tB=g.get("rep").name.toLowerCase();return(tA<tB?-1:(tA>tB?1:0))}else{return(f>j?-1:1)}}});var c=new Ext.ux.Window({width:500,height:400,resizable:false,minimizable:false,modal:true,layout:"anchor",title:Signavio.I18N.Repository.HrNeed.title,description:Signavio.I18N.Repository.HrNeed.selectionDescripton,items:[a],buttons:[{text:Signavio.I18N.Repository.HrNeed.selectionButton,handler:function(){c.hide();var f=[];a.getChecked().each(function(g){if(g===a.root){return}var h=g.attributes.identifier;if(h&&h.indexOf("/model/")==0){f.push(h.replace(/\/model\//,""))}}.bind(this));this.showSecondDialog(b,d,f,[])}.bind(this)}]});c.show()},showFirstDialog:function(b){var c=NaN;var e=NaN;Signavio.Core.Stores.RequestManager.doGet("/p/hrp",function(f){if(f.rep.personalAllowancePerCent){e=parseFloat(f.rep.personalAllowancePerCent)*100}if(f.rep.minutesPerManyear){c=parseInt(f.rep.minutesPerManyear)}}.bind(this),{});var a=new Signavio.Extensions.ModelDirectoryCheckTreePanel({root:new Ext.tree.TreeNode({text:"",checked:false,draggable:false,leaf:false,cls:"folder",dataField:"rep.name",identifier:Signavio.Config.DIRECTORY_PATH,expanded:true,recordRel:[Signavio.Const.REL.DIRECTORY,Signavio.Const.REL.MODEL],filterFn:function(f){if(this.isModel(f)){return this.isEpc(f)}else{if(this.isDirectory(f)){return !this.isTrashFolder(f)&&!this.isInternalFolder(f)}else{return false}}}.bind(this),isChildLeaf:function(f){return f.get("rel")===Signavio.Const.REL.MODEL},hasChildCls:function(f){return f.get("rel")===Signavio.Const.REL.MODEL?"model model-"+Signavio.Utils.getIcon(f,true):"folder"}})},b);var d=new Ext.ux.Window({width:500,height:400,resizable:false,minimizable:false,modal:true,layout:"anchor",title:Signavio.I18N.Repository.HrNeed.title,description:Signavio.I18N.Repository.HrNeed.selectionDescripton,items:[a],buttons:[{text:Signavio.I18N.Repository.HrNeed.selectionButton,handler:function(){d.hide();var g=[];var f=[];a.getChecked().each(function(h){if(h===a.root){return}var j=h.attributes.identifier;if(j){if(j.indexOf("/model/")==0){g.push(j.replace(/\/model\//,""))}else{if(j.indexOf("/directory/")==0){f.push(j.replace(/\/directory\//,""))}}}}.bind(this));this.showSecondDialog(c,e,g,f)}.bind(this)}]});d.show()},showSecondDialog:function(e,f,d,c){var g=!isNaN(f);var a=!isNaN(e);var b=new Ext.ux.Window({width:500,height:400,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.HrNeed.title,layout:"form",layoutConfig:{labelSeparator:""},defaultType:"textfield",items:[{fieldLabel:Signavio.I18N.Repository.HrNeed.nameLabel,labelStyle:"width:180px;margin-top:12px;",name:"name",allowBlank:false,width:250,cls:"g-hr-planning-name-textbox",value:Signavio.I18N.Repository.HrNeed.nameDefault,style:"margin-top:12px;"},{fieldLabel:Signavio.I18N.Repository.HrNeed.paLabel,labelStyle:"width:180px;margin-top:24px;",name:"pa",allowBlank:false,width:100,cls:"g-hr-planning-countallowance-textbox",value:g?f:"11",style:"margin-top:24px;"},{boxLabel:Signavio.I18N.Repository.HrNeed.futureStoreLabel,labelStyle:"width:180px;",name:"store_pa",xtype:"checkbox",checked:false},{fieldLabel:Signavio.I18N.Repository.HrNeed.minuteLabel,labelStyle:"width:180px;margin-top:12px;",name:"min",allowBlank:false,width:100,cls:"g-hr-planning-minutes-per-manager-textbox",value:a?e:"92000",style:"margin-top:12px;"},{boxLabel:Signavio.I18N.Repository.HrNeed.futureStoreLabel,labelStyle:"width:180px;",name:"store_min",xtype:"checkbox",ctCls:"g-hr-planning-box-minutes-per-manager",checked:false}],buttons:[{text:Signavio.I18N.Repository.HrNeed.startCalculationLabel,handler:function(){var h=b.items.items[0].getValue();var k=parseFloat(b.items.items[1].getValue().replace(/,/,"."));var j=parseInt(b.items.items[3].getValue());if(h.length==0){this.showError(Signavio.I18N.Repository.HrNeed.nameError)}else{if(isNaN(j)){this.showError(Signavio.I18N.Repository.HrNeed.minutesError)}else{if(isNaN(k)){this.showError(Signavio.I18N.Repository.HrNeed.paError)}else{k=k/100;b.setDisabled(true);Signavio.Core.Stores.RequestManager.doPost("/p/hrp",[function(l){b.hide();this.showResult(l.rep)}.bind(this),function(l){b.hide();this.showError(l.message||Signavio.I18N.Repository.HrNeed.unknownError)}.bind(this)],{timeout:600000,models:d,directories:c,scenarioname:h,personalallowance:k,minutespermanyear:j,storepa:b.items.items[2].getValue(),storemin:b.items.items[4].getValue()})}}}}.bind(this)}]});b.show()},showResult:function(q){var m=q.errors;var n=q.downloadLink;var e=q.nrOfSuccessfulModelsUsingRegions;var h=q.nrOfSuccessfulModels;var p=q.nrOfModels;n+=(n.include("?")?"&":"?")+Object.toQueryString(Ext.Ajax.getSecurityParameter());if(p==0){this.showError(Signavio.I18N.Repository.HrNeed.noModelSelected);return}var k='<div style="font-size:11px;">';if(h>0){var g=(new Template(Signavio.I18N.Repository.HrNeed.summary)).evaluate({nr1:h,nr2:p});k+='<div style="margin:12px;">'+g+'</div><div style="margin:12px;"><a href="'+n+'" target="_blank">'+Signavio.I18N.Repository.HrNeed.link+"</a></div>";if(h<p){k+='<div style="margin:12px;margin-top:18px;">'+Signavio.I18N.Repository.HrNeed.errors+"</div>"}}else{var g=(new Template(Signavio.I18N.Repository.HrNeed.onlyErrors)).evaluate({nr:p});k+='<div style="margin:12px;">'+g+'</div><div style="margin:12px;">'+Signavio.I18N.Repository.HrNeed.onlyErrors2+"</div>"}if(h<p){k+='<div style="margin:12px;margin-left:24px;">';for(var d=0;d<m.length;d++){var b=m[d];var l=b.returnMessage;if(l==="HRNC_ERR_PLAUS"){l="";var a=b.returnDetails.array;for(var c=0;c<a.length;c++){if(l==""){l+=this.parseCodeToMsg(a[c])}else{l+=", "+this.parseCodeToMsg(a[c])}}}else{l=this.parseCodeToMsg(l)}k+=" - "+Signavio.I18N.Repository.HrNeed.model+" <i>"+b.modelName+": </i>"+l+' (<a href="'+Signavio.Config.EDITOR_HANDLER_URI+"?id="+b.modelId+'" target="_blank">'+Signavio.I18N.Repository.HrNeed.openModel+"</a>)<br />"}k+="</div>"}if(e>0&&e<h){k+='<div style="margin:12px;margin-top:18px;">';k+=Signavio.I18N.Repository.HrNeed.someRegionsWarning;k+="</div>"}k+="</div>";var f=new Ext.Window({width:500,height:400,resizable:false,minimizable:false,modal:true,autoScroll:true,title:Signavio.I18N.Repository.HrNeed.title,bodyStyle:"background-color:#ffffff;",html:k,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){f.hide()}}]});f.show()},showError:function(a){Ext.MessageBox.show({title:Signavio.I18N.Repository.HrNeed.error,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},parseCodeToMsg:function(a){return Signavio.I18N.Repository.ReturnCode[a]||a},isModel:function(a){return a.get("rel")==Signavio.Const.REL.MODEL},isDirectory:function(a){return a.get("rel")==Signavio.Const.REL.DIRECTORY},isEpc:function(a){return a.get("rep").namespace=="http://b3mn.org/stencilset/epc#"},isProcessMap:function(a){return a.get("rep").namespace=="http://www.signavio.com/stencilsets/processmap#"},isTrashFolder:function(a){return this.facade.getTrashRecord()&&a.get("href")==this.facade.getTrashRecord().get("href")},isInternalFolder:function(a){return a.get("rep").type=="internal"}};Signavio.Plugins.HrPlanning=Signavio.Core.Plugin.extend(Signavio.Plugins.HrPlanning)})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var b=Signavio.I18N.Repository.Offer.Astah;var d=Signavio.Core.Stores.RequestManager;var c=60000;var a=c+15000;Signavio.Plugins.AstahImport=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var e=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:b.importTitle,description:b.importDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.checkForImportedRootPackages.bind(this),index:13,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||e()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)});var f=Signavio.I18N.Language.split("_").first()},checkForImportedRootPackages:function(){if(!this.loading){this.loading=true;var e=this;d.doGet(Signavio.Config.BACKEND_PATH+Signavio.Config.ASTAH_IMPORT_PATH,[function(f){delete e.loading;if(typeof f==="object"&&f.rep&&f.rep.rootPackages&&f.rep.rootPackages.length>0){e.importAstah(f.rep.rootPackages)}else{e.importAstah([])}},function(g,f){delete e.loading;Ext.Msg.alert(b.importErrorTitle,b.importCommunicationError).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}],{})}},isInPublicDirectory:function(){return this.facade.getCurrentRootFolder().get("rep").type===Signavio.Config.FOLDER_TYPE.PUBLIC},importAstah:function(j){var e=new Ext.Panel({cls:"cw-astah-upload-form-extended",layout:"anchor",border:false,collapsed:true,listeners:{expand:function(k){k.ownerCt.ownerCt.syncSize()},collapse:function(k){k.ownerCt.ownerCt.syncSize()}},items:[{text:b.importExtendedFormInfoText,xtype:"label"},{name:"enableTracking",boxLabel:b.importEnableTracking,xtype:"checkbox",inputValue:"true",checked:this.isInPublicDirectory(),disabled:!this.isInPublicDirectory()},{name:"forceRemapping",boxLabel:b.importForceRemapping,xtype:"checkbox",inputValue:"true",checked:false,disabled:!this.isInPublicDirectory()}]});var h=new Ext.form.FormPanel({cls:"cw-astah-upload-form",defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{name:"timeout",inputType:"hidden",value:c},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(k){return{name:k.key,inputType:"hidden",value:k.value}}),{text:b.importFormInfoText,xtype:"label"},{name:"astahFile",inputType:"file",itemCls:"ext_specific_window_overflow"},new Ext.LinkButton({cls:"cw-astah-upload-content-trigger",text:b.importOptionsShow,click:function(l,k){l.setText(e.collapsed?b.importOptionsHide:b.importOptionsShow);e.toggleCollapse(false)}}),e].flatten()});var g=this;h.getForm().errorReader={read:function(l){var k=g.cleanResponse(l);return{success:typeof k!=="undefined"&&k.rep&&k.rep.success,records:[]}}};if((j||[]).length>0){e.add(this.getDeletePanel(j))}var f=new Ext.ux.Window({autoCreate:true,autoHeight:true,cls:"x-window-security-center",title:b.importTitle,width:600,modal:true,resizable:false,items:[new Ext.Panel({cls:"cw-astah-upload-info",layout:"anchor",border:false,html:b.importInfoText}),this.isInPublicDirectory()?undefined:new Ext.form.Label({cls:"cw-astah-upload-hint",text:Signavio.I18N.Repository.Offer.Astah.importHintPrivateDir}),h].compact(),buttons:[{text:b.importBtn,handler:function(){if(h.items.items[1].el.dom.value){var k=Signavio.Utils.timeOut([function(n,l){f.close();var p=g.cleanResponse(l.response);if(p&&p.rep){if(p.rep){var m=g.buildImportResultsWindow(p.rep);if(m){m.show()}}}Signavio.Core.StoreManager.reloadChildEntitiesStore()},function(n,l){f.close();var p=g.cleanResponse(l.response);if(p&&p.rep){var m=g.buildImportResultsWindow(p.rep);if(m){m.show()}}else{Ext.Msg.alert(b.importErrorTitle,b.importGeneralError.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}}],function(){f.close();Ext.Msg.alert(b.importTitle,b.importTakesTooLong).setIcon(Ext.MessageBox.INFO).getDialog().syncSize()},a);h.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.ASTAH_IMPORT_PATH,waitMsg:b.importWaitMsg,method:"POST",success:k[0],failure:k[1]})}}.bind(this)}]});f.show()},getDeletePanel:function(g){var e=new Ext.Panel({layout:"anchor",border:false,collapsed:true,listeners:{expand:function(h){h.ownerCt.ownerCt.ownerCt.ownerCt.syncSize()},collapse:function(h){h.ownerCt.ownerCt.ownerCt.ownerCt.syncSize()}},items:[new Ext.form.Label({text:b.importExistingInfo})]});var f=this;g.each(function(j){var h=Signavio.Core.StoreManager.getRelatedStore("/directory/"+j,undefined,undefined,{callback:function(l,m,k){l.each(function(p){if(p.get("rel")==="info"){var n=new Ext.Panel({cls:"cw-astah-dir-list-entry",layout:"anchor",border:false,items:[new Ext.form.Label({cls:"cw-astah-dir-list-entry-label",text:p.get("rep").name})]});n.add(new Ext.LinkButton({cls:"cw-astah-dir-list-entry-button",text:b.importExistingDelete,click:f.deleteMappings.bind(f,p.get("href").split("/")[2],p.get("rep").name,n)}));e.add(n);e.doLayout()}})}})});return new Ext.Panel({cls:"cw-astah-upload-existing",layout:"anchor",border:false,items:[new Ext.LinkButton({cls:"cw-astah-upload-content-trigger",text:b.importExistingShow,click:function(j,h){j.setText(e.collapsed?b.importExistingHide:b.importExistingShow);e.toggleCollapse(false)}}),e]})},deleteMappings:function(g,f,e){Ext.Msg.confirm(b.importExistingDelete,b.importExistingDeleteConfirm,function(h){if(h==="yes"){d.doDelete(Signavio.Config.BACKEND_PATH+Signavio.Config.ASTAH_IMPORT_PATH+"/"+g,[function(j){e.ownerCt.remove(e)},function(k,j){Ext.Msg.alert(b.importErrorTitle,b.importGeneralError.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.ERROR).getDialog().syncSize()}],{})}})},cleanResponse:function(e){if(e&&e.responseText){var g=e.responseText.gsub(/<\/?pre[^>]*>/,"");var f=g.evalJSON(true);return f}return undefined},buildImportResultsWindow:function(l){var k=l.success===false||(l.messages&&(l.messages.errors.length>0||l.messages.warnings.length>0||l.messages.infos.length>0));var h;if(l.success){if(l.initialImport){if(k){h=b.importMessageSuccessInitialWithInfo}else{h=b.importMessageSuccessInitialWithoutInfo}}else{if(k){h=b.importMessageSuccessFollowingWithInfo}else{h=b.importMessageSuccessFollowingWithoutInfo}}}else{h=b.importGeneralError.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)}var g=new Ext.Panel({anchor:"100%",height:60,border:false,html:h});var e;if(k){var f=[];if(l.success&&l.messages){var m=true;if(l.messages.errors.length>0){f.push(this.setupDetailsPanel(l.messages.errors,"Errors",m));m=false}if(l.messages.warnings.length>0){f.push(this.setupDetailsPanel(l.messages.warnings,"Warnings",m));m=false}if(l.messages.infos.length>0){f.push(this.setupDetailsPanel(l.messages.infos,"Infos",m))}}else{if(!l.success){f.push(this.setupDetailsPanel([{type:l.code,details:l.message?l.message:b.importDefaultErrorMessage}],"Errors",true))}}if(f.length>0){e=new Ext.Panel({border:false,layout:"accordion",anchor:"100%",height:350,items:f})}}var j=new Ext.ux.Window({cls:"x-window-security-center",width:600,height:k?500:150,resizable:true,minimizable:false,modal:true,autoScroll:false,title:l.success?b.importTitle:b.importErrorTitle,items:[g,k?e:undefined].compact(),buttons:[{text:b.importMessageBtnOk,handler:function(){j.hide()}}]});return j},setupDetailsPanel:function(j,h,k){if(!(j instanceof Array)){return}var f=new Ext.data.JsonStore({data:j,fields:["details"]});var g=function(q,p,l,r,n,m){p.css="x-grid-cell-selectable-text";return q};var e=new Ext.grid.GridPanel({title:b.importMessageHeader[h]+" ("+f.getTotalCount()+")",store:f,autoScroll:true,collapsed:!k,disableSelection:true,columns:[{id:"details",header:b.importMessageDetails,editor:new Ext.form.TextField(),renderer:g,width:450,dataIndex:"details",menuDisabled:true,hidable:false}],autoExpandColumn:"details"});return e}})})();if(!window.Signavio){window.Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.BPMN2ITSMExport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0#"}.bind(this);var a=function(){return !b.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.facade.offer({relGroup:"import",index:64,name:Signavio.I18N.Repository.Offer.ITSM_EXPORT.Title,description:Signavio.I18N.Repository.Offer.ITSM_EXPORT.Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/itsm_plausibility","/bpmn2_0_xml"),isDisabled:function(){return !a()},isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},doExport:function(b,a){var c=this.getSelection()[0].get("href").split("/").last();Signavio.Core.Stores.RequestManager.doGet(Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+b,function(d){if(d!=null){if(d.hasOwnProperty("errors")&&Object.keys(d.errors).length>0){this.showError(c,d.errors)}else{this.onSubmit(a)}}}.bind(this))},showError:function(b,a){if(Object.keys(a).length==1&&a[b]===Signavio.Const.ERRORS.WRONG_NAMESPACE){Ext.Msg.show({title:Signavio.I18N.Repository.Offer.ITSM_EXPORT.NoExportTitle,msg:Signavio.I18N.Repository.Offer.ITSM_EXPORT.NoITSMProcessInfo,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO}).getDialog().syncSize()}else{Ext.Msg.show({title:Signavio.I18N.Repository.Offer.ITSM_EXPORT.NoExportTitle,msg:Signavio.I18N.Repository.Offer.ITSM_EXPORT.ErrorsInProcessInfo+" "+(this.facade.isSupportedBrowserEditor()?"<a href='"+Signavio.Config.EDITOR_HANDLER_URI+"?id="+b+"' target='_blank'>"+Signavio.I18N.Repository.Offer.ITSM_EXPORT.OpenLink+"</a>":""),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}).getDialog().syncSize()}},onSubmit:function(b){if(Ext.isIE7||Ext.isIE8){var a=$("download_iframe");if(!a){a=document.createElement("iframe");a.id="download_iframe";document.body.appendChild(a)}a.setAttribute("src",Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+b+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter()||{}))}else{window.open(Signavio.Config.BACKEND_PATH+this.getSelection()[0].get("href")+b+"?"+Object.toQueryString(Ext.Ajax.getSecurityParameter()||{}))}}};Signavio.Plugins.BPMN2ITSMExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.BPMN2ITSMExport)}());if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.CommedDummyEntries={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.offer({relGroup:"configure",arrange:"right",name:Signavio.I18N.Repository.SecurityCenter.btnManage,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group.png",index:2});this.offer({relGroup:"configure",arrange:"right",index:9,name:Signavio.I18N.Repository.MetaData.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/table_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:15,name:Signavio.I18N.Repository.MetaData.titleGuidelines,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compass.png"});this.offer({relGroup:"configure",arrange:"right",index:10,name:Signavio.I18N.Repository.Configuration.offerLanguages,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:26,name:Signavio.I18N.Repository.Configuration.offerSecurity,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png"});this.offer({relGroup:"configure",arrange:"right",index:60,name:Signavio.I18N.Repository.Configuration.offerTitle,description:Signavio.I18N.Repository.Configuration.offerDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/monitor_edit.png"});this.offer({relGroup:"import",index:65,name:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3,description:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png"});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importXPDLTitle,description:Signavio.I18N.Repository.Offer.importXPDLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",index:15});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importAMLTitle,description:Signavio.I18N.Repository.Offer.importAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",index:25});this.offer({group:"reporting",name:Signavio.I18N.Repository.Reporting.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",isVisible:this.isVisible.bind(this),items:[{index:1,name:Signavio.I18N.Repository.Offer.processDocumentationTitle,description:Signavio.I18N.Repository.Offer.processDocumentationDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png"},{index:2,name:Signavio.I18N.Repository.Offer.processDocumentationWordTitle,description:Signavio.I18N.Repository.Offer.processDocumentationWordDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_word.png",seperated:true}]});this.offer({relGroup:"reporting",index:11,name:Signavio.I18N.Repository.Analysis.titleCost,description:Signavio.I18N.Repository.Analysis.descriptionCost,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:12,name:Signavio.I18N.Repository.Analysis.titleRes,description:Signavio.I18N.Repository.Analysis.descriptionRes,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",seperated:true});this.offer({relGroup:"reporting",index:25,name:Signavio.I18N.Repository.Analysis.activityListTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:26,name:Signavio.I18N.Repository.Analysis.attributesReportTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:22,name:Signavio.I18N.Repository.Analysis.docUseTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:23,name:Signavio.I18N.Repository.Analysis.itSystemByDiagramTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:24,name:Signavio.I18N.Repository.Analysis.itSystemByRolesTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:27,name:Signavio.I18N.Repository.Analysis.metricsTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:20,name:Signavio.I18N.Repository.Analysis.responsibilityAnalysisTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:21,name:Signavio.I18N.Repository.Analysis.responsibilityHandoverTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({arrange:"left",relGroup:"scenter",name:Signavio.I18N.Repository.Offer.doPublishTitle,description:Signavio.I18N.Repository.Offer.doPublishDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report_go.png",seperated:true,index:-9});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.processMap,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/processmap-22x22.png",index:2});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.epc,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/epc-22x22.png",index:3,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.organizationalChart,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/organigram-22x22.png",index:4,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}})},offer:function(a){var b=function(d){d.functionality=this.dummy.bind(this,d);d.isDisabled=this.isDisabled.bind(this,d);d.isVisible=this.isVisible.bind(this,d);var c="";if(d.activeClass==="x-menu-item-active item-large"){c+="line-height:22px;"}if(d.name){d.name=["<span ext:qtip='",Signavio.I18N.SAPERIONDummyEntries.premiumFeature,"'",(c?" style='"+c+"'":""),">",d.name,"<img src='"+Signavio.Config.IMAGE_PATH+"/signavio/logo_small.png' class='x-signavio-premium' onclick='window.open(\"http://www.signavio.com\")'/>","</span>"].join("")}}.bind(this);if(!a.items){b(a)}else{a.items.each(b)}this.facade.offer(a)},isDisabled:function(){return true},isVisible:function(a){if(a&&a.arrange=="right"){return true}else{return this.selectionNotInTrash()}},dummy:function(){}};Signavio.Plugins.CommedDummyEntries=Signavio.Core.Plugin.extend(Signavio.Plugins.CommedDummyEntries)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.CommedExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:200,name:"CareStation Package",description:"zip-Package including XPDL and Signavio specific representations.",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/xpdlexport","CareStation Package"),isDisabled:function(){return !this.oneSelected()||!this.selectionIsBpmn20()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.CommedExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.CommedExport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Deploy2Carestation={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0#"}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return b.call(this)||this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.Deploy2Carestation.title,arrange:"left",description:Signavio.I18N.Repository.Deploy2Carestation.description,icon:Signavio.Config.IMAGE_PATH+"/misc/commed.png",functionality:this.deploy.bind(this),isDisabled:a,isVisible:c})},deploy:function(){var a;this.getSelection().each(function(b){if(b.get("rel")==Signavio.Const.REL.MODEL){var c=b.get("href");a=c.replace(/\/model\//,"")}}.bind(this));this.performCheck(a)},performCheck:function(a){Signavio.Core.Stores.RequestManager.doPost("/p/deploy2Carestation",function(b){var c=b.rep["return"];if(c=="ok"){this.performDeploy(b.rep.revisionId)}else{var e;if(c=="plausibility"||c=="syntax"){e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Carestation[c]+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Carestation.checkFail2)).evaluate({link:Signavio.Config.EDITOR_HANDLER_URI+"?id="+a})+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Carestation.checkFail3)).evaluate({image:Signavio.Config.IMAGE_PATH+"/famfamfam/book_error.png"})+"</div></div>"}else{e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Carestation[c]+"</div></div>"}var d=new Ext.Window({width:400,height:300,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Carestation.title,bodyStyle:"background-color:#ffffff;",html:e,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){d.hide()}}]});d.show()}}.bind(this),{requestFor:"check",modelId:a})},performDeploy:function(b){var a=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login",layout:"form",modal:true,width:435,title:Signavio.I18N.Repository.Deploy2Carestation.title,items:[new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldUserName,width:400,tabIndex:1001,name:"Email"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:400,inputType:"password",tabIndex:1002,listeners:{specialkey:function(d,c){if(c.getKey()===c.ENTER){this.ownerCt.buttons[0].handler()}}},name:"Passwd"})],buttons:[{text:Signavio.I18N.Repository.Deploy2Carestation.deploy,tabIndex:1003,handler:function(){if(!(this.ownerCt.items.get(0).getValue()||"").trim()||!(this.ownerCt.items.get(1).getValue()||"").trim()){return}Signavio.Core.Stores.RequestManager.doPost("/p/deploy2Carestation",function(c){var d=c.rep["return"];if(d!="ok"){if(c.rep.details.include("authentication")){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Carestation.authentificationFailedTitle,msg:Signavio.I18N.Repository.Deploy2Carestation.authentificationFailedDescription,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}else{Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Carestation.title,msg:Signavio.I18N.Repository.Deploy2Carestation.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}else{Ext.MessageBox.alert(Signavio.I18N.Repository.Deploy2Carestation.title,Signavio.I18N.Repository.Deploy2Carestation.suc);Signavio.Core.StoreManager.reload()}}.bind(this),{requestFor:"deploy",revisionId:b,user:this.ownerCt.items.get(0).getValue(),pw:this.ownerCt.items.get(1).getValue()});this.ownerCt.close()}},{text:Signavio.I18N.Repository.Header.windowBtnCancel,tabIndex:1004,handler:function(){this.ownerCt.close()}}]});a.show()}};Signavio.Plugins.Deploy2Carestation=Signavio.Core.Plugin.extend(Signavio.Plugins.Deploy2Carestation)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Deploy2Effektif={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0#"}.bind(this);var c=function(){return(this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord())}.bind(this);var a=function(){return b.call(this)||this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.Deploy2Effektif.title,arrange:"left",description:Signavio.I18N.Repository.Deploy2Effektif.description,icon:Signavio.Config.IMAGE_PATH+"/effektif/effektif.png",functionality:this.deploy.bind(this),isDisabled:a,isVisible:c})},deploy:function(){var a;this.getSelection().each(function(b){if(b.get("rel")==Signavio.Const.REL.MODEL){var c=b.get("href");a=c.replace(/\/model\//,"")}}.bind(this));this.performCheck(a)},performCheck:function(a){Signavio.Core.Stores.RequestManager.doPost("/p/deploy2effektif",function(b){var c=b.rep["return"];if(c=="ok"){this.performDeploy(b.rep.revisionId,b.rep.hosts,a)}else{var e;if(c=="plausibility"||c=="syntax"){e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Effektif[c]+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Effektif.checkFail2)).evaluate({link:Signavio.Config.EDITOR_HANDLER_URI+"?id="+a})+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Effektif.checkFail3)).evaluate({image:Signavio.Config.IMAGE_PATH+"/famfamfam/book_error.png"})+"</div></div>"}else{e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Effektif[c]+"</div></div>"}var d=new Ext.Window({width:400,height:300,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Effektif.title,bodyStyle:"background-color:#ffffff;",html:e,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){d.hide()}}]});d.show()}}.bind(this),{requestFor:"check",modelId:a})},performDeploy:function(b,g,n){var e=[];for(var d=0;d<g.length;d++){e.push([g[d]])}var l=new Ext.data.SimpleStore({fields:["field"],data:e});var p=new Ext.data.SimpleStore({fields:["displayfield","valuefield"],data:this.typeArray});var f="font-size:11px;";var a,c,m,j,h;var k=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login x-window-effektif",labelAlign:"top",layout:"form",resizable:false,modal:true,width:535,height:285,title:Signavio.I18N.Repository.Deploy2Effektif.title,items:[a=new Ext.form.ComboBox({fieldLabel:Signavio.I18N.Repository.Deploy2Effektif.endPoint,width:500,tabIndex:1000,editable:this.facade.getConfig().isTestSystem,triggerAction:"all",displayField:"field",valueField:"field",store:l,mode:"local",value:(e[0]&&e[0][0])||"",labelStyle:f}),new Ext.Panel({border:false,width:500,layout:"column",items:[new Ext.Panel({border:false,columnWidth:1,layout:"form",style:"margin-right: 20px;",bodyStyle:"padding-top:10px;",labelAlign:"top",items:[h=new Ext.form.Radio({fieldLabel:Signavio.I18N.Repository.Deploy2Effektif.version,boxLabel:Signavio.I18N.Repository.Deploy2Effektif.versionCurTitle+"<br/><span style='font-size:11px;color:silver;display:block;line-height:12px;margin-left:18px;'>"+Signavio.I18N.Repository.Deploy2Effektif.versionCurDescription+"</span>",name:"x-saperion-deploy-to-version",checked:true,style:"position:relative;top:1px;"}),j=new Ext.form.Radio({hideLabel:true,boxLabel:Signavio.I18N.Repository.Deploy2Effektif.versionNewTitle+"<br/><span style='font-size:11px;color:silver;display:block;line-height:12px;margin-left:18px;'>"+Signavio.I18N.Repository.Deploy2Effektif.versionNewDescription+"</span>",name:"x-saperion-deploy-to-version",checked:false,labelStyle:f,style:"position:relative;top:1px;",listeners:{render:function(){this.wrap.parent(".x-form-item").setStyle("margin-top","-20px")}}})]}),new Ext.Panel({border:false,width:200,layout:"form",labelAlign:"top",bodyStyle:"padding-top:10px;",items:[c=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldUserName,width:200,tabIndex:1001,name:"Email",value:this.standardUser,labelStyle:f}),m=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:200,inputType:"password",tabIndex:1002,name:"Passwd",labelStyle:f})]})]})],buttons:[{text:Signavio.I18N.Repository.Deploy2Effektif.deploy,tabIndex:1005,handler:function(){if(!(a.getValue()||"").trim()||!(c.getValue()||"").trim()){return}Ext.MessageBox.wait(Signavio.I18N.Repository.Deploy2Effektif.progressDescription,Signavio.I18N.Repository.Deploy2Effektif.progressTitle);Signavio.Core.Stores.RequestManager.doPost("/p/deploy2effektif",function(q){Ext.MessageBox.hide();var s=q.rep["return"];if(s=="deploy"){if(q.rep.details.include("AUTHENTIFICATION_FAILED")){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Effektif.authentificationFailedTitle,msg:Signavio.I18N.Repository.Deploy2Effektif.authentificationFailedDescription,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}var r=q.rep.details.evalJSON();this.showDeploymentErrors(r,n)}else{if(s=="invalidHost"){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Effektif.title,msg:Signavio.I18N.Repository.Deploy2Effektif.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}else{if(s=="connect"){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Effektif.title,msg:Signavio.I18N.Repository.Deploy2Effektif.failConnect,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}else{var r=q.rep.details.evalJSON();this.showSuccessfulDeployment(r)}}}k.close()}.bind(this),{requestFor:"deploy",revisionId:b,host:a.getValue(),user:c.getValue(),pw:m.getValue(),newVersion:j.checked,timeout:60000})}.bind(this)},{text:Signavio.I18N.Repository.Header.windowBtnCancel,tabIndex:1004,handler:function(){this.ownerCt.close()}}]});k.show()},parseCodeToMsg:function(a){return Signavio.I18N.Repository.Deploy2Effektif.ReturnCode[a]||a},showDeploymentErrors:function(a,h){var g="div"+parseInt(Math.random()*100000000);var c="iframe"+parseInt(Math.random()*100000000);var d=(a.errors||[a.reason]).compact().filter(function(m){return typeof m==="string"});var l=(a.errors||[]).filter(function(m){return typeof m!=="string"});var b=0;var j=0;var f='<div style="font-size:12px;">';if(d.length>0){f+='<div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Effektif.deployFail1+"</div>";d.each(function(m){f+='<div style="margin:12px;margin-left:18px;"> - '+this.parseCodeToMsg(m)+"</div>"}.bind(this));b=450;j=400}else{if(l.length>0){f+='<div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Effektif.deployFail2+'</div><div id="'+g+'"></div>';b=650;j=500}else{Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Effektif.title,msg:Signavio.I18N.Repository.Deploy2Effektif.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}}f+="</div>";var e=new Ext.Window({width:b,height:j,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Effektif.fail,bodyStyle:"background-color:#ffffff;",html:f,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){e.hide()}}]});e.show();if(d.length==0&&l.length>0){$(g).update('<iframe id="'+c+'" width="634" height="340" scrolling="no" frameborder="0"></iframe>');var k;if($(c).contentDocument){k=$(c).contentDocument}else{k=$(c).contentWindow.document}k.write('<html><head><script type="text/javascript" src="'+Signavio.Config.MASHUP_URI+'/signavio.js"><\/script></head><body><div style="border:1px solid black;"><script type="text/javascript">function showErrors(facade){');l.each(function(m){var n=m.errorTranslation.find(function(p){return p.languageCode==Signavio.I18N.Language.substring(0,2)}).errorDescription;if(!n){n=m.errorTranslation.find(function(p){return p.languageCode=="en"}).errorDescription}m.errorElements.each(function(p){k.write('facade.focusOn({shapes:"'+p+'", color:"red", shadow: true});facade.showBubble({shape:"'+p+'", html:"'+n+'"});')})});k.write('}<\/script><script type="text/plain">{url: "'+Signavio.Config.BACKEND_PATH+Signavio.Config.MODEL_PATH+"/"+h+'",overflowX: "fit",overflowY: "fit",width: 616,height: 320,callback: showErrors,zoomSlider: true,linkSubProcesses: false}<\/script></div></body></html>');k.close()}},showSuccessfulDeployment:function(a){Ext.MessageBox.alert(Signavio.I18N.Repository.Deploy2Effektif.title,(new Template(Signavio.I18N.Repository.Deploy2Effektif.suc)).evaluate({time:new Date(parseInt(a.deployTime)).format("G:i"),buildNr:a.buildNr}));Signavio.Core.StoreManager.getChildEntitiesStore().reload()}};Signavio.Plugins.Deploy2Effektif=Signavio.Core.Plugin.extend(Signavio.Plugins.Deploy2Effektif)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.FeltenExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:75,name:Signavio.I18N.Repository.Offer.exportFeltenTitle,description:Signavio.I18N.Repository.Offer.exportFeltenDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/jpdl4zip",Signavio.I18N.Repository.Offer.exportFeltenTitle),isDisabled:function(){return !this.oneSelected()||!(this.selectionIsJbpm4()||this.selectionIsFelten())}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.FeltenExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.FeltenExport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Jpdl4Import={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",index:20,name:Signavio.I18N.Repository.Offer.jpdl4ImportTitle,description:Signavio.I18N.Repository.Offer.jpdl4ImportDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.showImportDialog.bind(this),isDisabled:function(){return a()||this.selectionInSearch()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},showImportDialog:function(){if(!this.facade.isSupportedBrowserEditor()){var c=Ext.Msg.alert("Signavio",Signavio.I18N.Repository.Offer.newFFOnly);c.setIcon("x-window-ffonly");return}var b=new Ext.form.FormPanel({defaultType:"textfield",layout:"anchor",border:false,fileUpload:true,items:[{name:"file",inputType:"file",style:"margin-top:10px;display:block;",itemCls:"ext_specific_window_overflow"},{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").lastOptions.id},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});b.getForm().errorReader={read:function(d){var f=d.responseText.replace("<pre>","").replace("</pre>","");return{success:f.length==32,records:[]}}};var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.jpdl4ImportTitle,description:Signavio.I18N.Repository.Offer.jpdl4ImportFileField,width:400,modal:true,resizable:false,items:[b],buttons:[{text:Signavio.I18N.Repository.Offer.archiveRestoreBtn,handler:function(){if(b.items.items[0].el.dom.value){b.getForm().submit({url:Signavio.Config.BACKEND_PATH+"/jpdl4import",waitMsg:Signavio.I18N.Repository.Offer.archiveRestoreWait,method:"POST",success:function(e,d){var f=d.response.responseText;f=f.replace("<pre>","").replace("</pre>","");if(f.length>0){window.open(Signavio.Config.BACKEND_PATH+"/editor?id="+f)}else{Ext.Msg.alert(Signavio.I18N.Repository.HrNeed.error,Signavio.I18N.Repository.Offer.jpdl4ImportErrorMsg).setIcon(Ext.MessageBox.ERROR)}a.close()},failure:function(){Ext.Msg.alert(Signavio.I18N.Repository.HrNeed.error,Signavio.I18N.Repository.Offer.jpdl4ImportErrorMsg).setIcon(Ext.MessageBox.ERROR);a.close()}})}}.bind(this)}]});a.show()}};Signavio.Plugins.Jpdl4Import=Signavio.Core.Plugin.extend(Signavio.Plugins.Jpdl4Import)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Jpdl4Export={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:80,name:Signavio.I18N.Repository.Offer.jpdl4ExportTitle,description:Signavio.I18N.Repository.Offer.jpdl4ExportDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/jpdl4",Signavio.I18N.Repository.Offer.jpdl4ExportTitle),isDisabled:function(){return !this.oneSelected()||!(this.selectionIsJbpm4()||this.selectionIsFelten())}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.Jpdl4Export=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.Jpdl4Export)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.SAPERIONDummyEntries={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.offer({relGroup:"configure",arrange:"right",name:Signavio.I18N.Repository.SecurityCenter.btnManage,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group.png",index:2});this.offer({relGroup:"configure",arrange:"right",index:9,name:Signavio.I18N.Repository.MetaData.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/table_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:15,name:Signavio.I18N.Repository.MetaData.titleGuidelines,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compass.png"});this.offer({relGroup:"configure",arrange:"right",index:10,name:Signavio.I18N.Repository.Configuration.offerLanguages,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:26,name:Signavio.I18N.Repository.Configuration.offerSecurity,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png"});this.offer({relGroup:"configure",arrange:"right",index:60,name:Signavio.I18N.Repository.Configuration.offerTitle,description:Signavio.I18N.Repository.Configuration.offerDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/monitor_edit.png"});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.BPMN2_0Import.title,description:Signavio.I18N.Repository.Offer.BPMN2_0Import.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",index:10});this.offer({relGroup:"import",index:65,name:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3,description:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png"});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importXPDLTitle,description:Signavio.I18N.Repository.Offer.importXPDLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",index:15});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importAMLTitle,description:Signavio.I18N.Repository.Offer.importAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",index:25});this.offer({group:"reporting",name:Signavio.I18N.Repository.Reporting.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",isVisible:this.isVisible.bind(this),items:[{index:1,name:Signavio.I18N.Repository.Offer.processDocumentationTitle,description:Signavio.I18N.Repository.Offer.processDocumentationDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png"},{index:2,name:Signavio.I18N.Repository.Offer.processDocumentationWordTitle,description:Signavio.I18N.Repository.Offer.processDocumentationWordDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_word.png",seperated:true}]});this.offer({relGroup:"reporting",index:11,name:Signavio.I18N.Repository.Analysis.titleCost,description:Signavio.I18N.Repository.Analysis.descriptionCost,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:12,name:Signavio.I18N.Repository.Analysis.titleRes,description:Signavio.I18N.Repository.Analysis.descriptionRes,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",seperated:true});this.offer({relGroup:"reporting",index:25,name:Signavio.I18N.Repository.Analysis.activityListTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:26,name:Signavio.I18N.Repository.Analysis.attributesReportTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:22,name:Signavio.I18N.Repository.Analysis.docUseTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:23,name:Signavio.I18N.Repository.Analysis.itSystemByDiagramTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:24,name:Signavio.I18N.Repository.Analysis.itSystemByRolesTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:27,name:Signavio.I18N.Repository.Analysis.metricsTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:20,name:Signavio.I18N.Repository.Analysis.responsibilityAnalysisTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:21,name:Signavio.I18N.Repository.Analysis.responsibilityHandoverTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({arrange:"left",name:Signavio.I18N.Repository.SecurityCenter.Offer.shareTitle,description:Signavio.I18N.Repository.SecurityCenter.Offer.shareDesc,group:"scenter",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png",index:1,isVisible:this.isVisible.bind(this),items:[{name:Signavio.I18N.Repository.SecurityCenter.Offer.readTitle,index:1,description:Signavio.I18N.Repository.SecurityCenter.Offer.readDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/picture_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)},{name:Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,index:2,description:Signavio.I18N.Repository.SecurityCenter.Offer.discussDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)},{name:Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle,index:3,description:Signavio.I18N.Repository.SecurityCenter.Offer.writeDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this),seperated:true},{name:Signavio.I18N.Repository.SecurityCenter.Offer.manageTitle,index:4,description:Signavio.I18N.Repository.SecurityCenter.Offer.manageDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/application_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)}]});this.offer({arrange:"left",relGroup:"scenter",name:Signavio.I18N.Repository.Offer.doPublishTitle,description:Signavio.I18N.Repository.Offer.doPublishDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report_go.png",seperated:true,index:-9});this.offer({relGroup:"edit",name:Signavio.I18N.Repository.TalkAbout.titleEdit,description:Signavio.I18N.Repository.TalkAbout.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments.png",index:2});this.offer({relGroup:"edit",name:Signavio.I18N.Repository.Offer.compareTitle,description:"",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report.png",index:2});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.processMap,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/processmap-22x22.png",index:2});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.epc,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/epc-22x22.png",index:3,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}});this.offer({relGroup:"new",name:Signavio.I18N.SAPERIONDummyEntries.organizationalChart,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/organigram-22x22.png",index:4,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}})},offer:function(a){var b=function(d){d.functionality=this.dummy.bind(this,d);d.isDisabled=this.isDisabled.bind(this,d);d.isVisible=this.isVisible.bind(this,d);var c="";if(d.activeClass==="x-menu-item-active item-large"){c+="line-height:22px;"}if(d.name){d.name=["<span ext:qtip='",Signavio.I18N.SAPERIONDummyEntries.premiumFeature,"'",(c?" style='"+c+"'":""),">",d.name,"<img src='"+Signavio.Config.IMAGE_PATH+"/signavio/logo_small.png' class='x-signavio-premium' onclick='window.open(\"http://www.signavio.com\")'/>","</span>"].join("")}}.bind(this);if(!a.items){b(a)}else{a.items.each(b)}this.facade.offer(a)},isDisabled:function(){return true},isVisible:function(a){if(a&&a.arrange=="right"){return true}else{return this.selectionNotInTrash()}},dummy:function(){}};Signavio.Plugins.SAPERIONDummyEntries=Signavio.Core.Plugin.extend(Signavio.Plugins.SAPERIONDummyEntries)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Deploy2Saperion={enabled:true,typeArray:[["Administrator",20],["Universal/Administrator",3]],standardClient:"",standardUser:"Administrator",construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0#"}.bind(this);var c=function(){return this.facade.isCurrentUserInGroup("SaperionDeployerUserGroup")&&(this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord())}.bind(this);var a=function(){return b.call(this)||this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.Deploy2Saperion.title,arrange:"left",description:Signavio.I18N.Repository.Deploy2Saperion.description,icon:Signavio.Config.IMAGE_PATH+"/misc/saperion.png",functionality:this.deploy.bind(this),isDisabled:a,isVisible:c})},deploy:function(){var a;this.getSelection().each(function(b){if(b.get("rel")==Signavio.Const.REL.MODEL){var c=b.get("href");a=c.replace(/\/model\//,"")}}.bind(this));this.performCheck(a)},performCheck:function(a){Signavio.Core.Stores.RequestManager.doPost("/p/deploy2saperion",function(b){var c=b.rep["return"];if(c=="ok"){this.performDeploy(b.rep.revisionId,b.rep.hosts,a)}else{var e;if(c=="plausibility"||c=="syntax"){e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Saperion[c]+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Saperion.checkFail2)).evaluate({link:Signavio.Config.EDITOR_HANDLER_URI+"?id="+a})+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Saperion.checkFail3)).evaluate({image:Signavio.Config.IMAGE_PATH+"/famfamfam/book_error.png"})+"</div></div>"}else{e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Saperion[c]+"</div></div>"}var d=new Ext.Window({width:400,height:300,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Saperion.title,bodyStyle:"background-color:#ffffff;",html:e,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){d.hide()}}]});d.show()}}.bind(this),{requestFor:"check",modelId:a})},performDeploy:function(b,g,p){var e=[];for(var d=0;d<g.length;d++){e.push([g[d]])}var l=new Ext.data.SimpleStore({fields:["field"],data:e});var q=new Ext.data.SimpleStore({fields:["displayfield","valuefield"],data:this.typeArray});var f="font-size:11px;";var a,c,n,m,j,h;var k=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login x-window-saperion",labelAlign:"top",layout:"form",resizable:false,modal:true,width:535,height:285,title:Signavio.I18N.Repository.Deploy2Saperion.title,items:[a=new Ext.form.ComboBox({fieldLabel:Signavio.I18N.Repository.Deploy2Saperion.endPoint,width:500,tabIndex:1000,editable:this.facade.getConfig().isTestSystem,triggerAction:"all",displayField:"field",valueField:"field",store:l,mode:"local",value:(e[0]&&e[0][0])||"",labelStyle:f}),new Ext.Panel({border:false,width:500,layout:"column",items:[new Ext.Panel({border:false,columnWidth:1,layout:"form",style:"margin-right: 20px;",bodyStyle:"padding-top:10px;",labelAlign:"top",items:[h=new Ext.form.Radio({fieldLabel:Signavio.I18N.Repository.Deploy2Saperion.version,boxLabel:Signavio.I18N.Repository.Deploy2Saperion.versionCurTitle+"<br/><span style='font-size:11px;color:silver;display:block;line-height:12px;margin-left:18px;'>"+Signavio.I18N.Repository.Deploy2Saperion.versionCurDescription+"</span>",name:"x-saperion-deploy-to-version",checked:true,style:"position:relative;top:1px;"}),j=new Ext.form.Radio({hideLabel:true,boxLabel:Signavio.I18N.Repository.Deploy2Saperion.versionNewTitle+"<br/><span style='font-size:11px;color:silver;display:block;line-height:12px;margin-left:18px;'>"+Signavio.I18N.Repository.Deploy2Saperion.versionNewDescription+"</span>",name:"x-saperion-deploy-to-version",checked:false,labelStyle:f,style:"position:relative;top:1px;",listeners:{render:function(){this.wrap.parent(".x-form-item").setStyle("margin-top","-20px")}}})]}),new Ext.Panel({border:false,width:200,layout:"form",labelAlign:"top",bodyStyle:"padding-top:10px;",items:[c=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldUserName,width:200,tabIndex:1001,name:"Email",value:this.standardUser,labelStyle:f}),n=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:200,inputType:"password",tabIndex:1002,name:"Passwd",labelStyle:f}),m=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Deploy2Saperion.client,width:200,tabIndex:1004,name:"Client",value:this.standardClient,labelStyle:f})]})]})],buttons:[{text:Signavio.I18N.Repository.Deploy2Saperion.deploy,tabIndex:1005,handler:function(){if(!(a.getValue()||"").trim()||!(c.getValue()||"").trim()){return}Ext.MessageBox.wait(Signavio.I18N.Repository.Deploy2Saperion.progressDescription,Signavio.I18N.Repository.Deploy2Saperion.progressTitle);Signavio.Core.Stores.RequestManager.doPost("/p/deploy2saperion",function(r){Ext.MessageBox.hide();var t=r.rep["return"];if(t=="deploy"){if(r.rep.details.include("AUTHENTIFICATION_FAILED")){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Saperion.authentificationFailedTitle,msg:Signavio.I18N.Repository.Deploy2Saperion.authentificationFailedDescription,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}var s=r.rep.details.evalJSON();this.showDeploymentErrors(s,p)}else{if(t=="invalidHost"){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Saperion.title,msg:Signavio.I18N.Repository.Deploy2Saperion.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}else{if(t=="connect"){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Saperion.title,msg:Signavio.I18N.Repository.Deploy2Saperion.failConnect,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});return}else{var s=r.rep.details.evalJSON();this.showSuccessfulDeployment(s)}}}k.close()}.bind(this),{requestFor:"deploy",revisionId:b,host:a.getValue(),user:c.getValue(),pw:n.getValue(),client:m.getValue(),newVersion:j.checked,timeout:60000})}.bind(this)},{text:Signavio.I18N.Repository.Header.windowBtnCancel,tabIndex:1004,handler:function(){this.ownerCt.close()}}]});k.show()},parseCodeToMsg:function(a){return Signavio.I18N.Repository.Deploy2Saperion.ReturnCode[a]||a},showDeploymentErrors:function(a,h){var g="div"+parseInt(Math.random()*100000000);var c="iframe"+parseInt(Math.random()*100000000);var d=(a.errors||[a.reason]).compact().filter(function(m){return typeof m==="string"});var l=(a.errors||[]).filter(function(m){return typeof m!=="string"});var b=0;var j=0;var f='<div style="font-size:12px;">';if(d.length>0){f+='<div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Saperion.deployFail1+"</div>";d.each(function(m){f+='<div style="margin:12px;margin-left:18px;"> - '+this.parseCodeToMsg(m)+"</div>"}.bind(this));b=450;j=400}else{if(l.length>0){f+='<div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Saperion.deployFail2+'</div><div id="'+g+'"></div>';b=650;j=500}else{Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Saperion.title,msg:Signavio.I18N.Repository.Deploy2Saperion.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}}f+="</div>";var e=new Ext.Window({width:b,height:j,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Saperion.fail,bodyStyle:"background-color:#ffffff;",html:f,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){e.hide()}}]});e.show();if(d.length==0&&l.length>0){$(g).update('<iframe id="'+c+'" width="634" height="340" scrolling="no" frameborder="0"></iframe>');var k;if($(c).contentDocument){k=$(c).contentDocument}else{k=$(c).contentWindow.document}k.write('<html><head><script type="text/javascript" src="'+Signavio.Config.MASHUP_URI+'/signavio.js"><\/script></head><body><div style="border:1px solid black;"><script type="text/javascript">function showErrors(facade){');l.each(function(m){var n=m.errorTranslation.find(function(p){return p.languageCode==Signavio.I18N.Language.substring(0,2)}).errorDescription;if(!n){n=m.errorTranslation.find(function(p){return p.languageCode=="en"}).errorDescription}m.errorElements.each(function(p){k.write('facade.focusOn({shapes:"'+p+'", color:"red", shadow: true});facade.showBubble({shape:"'+p+'", html:"'+n+'"});')})});k.write('}<\/script><script type="text/plain">{url: "'+Signavio.Config.BACKEND_PATH+Signavio.Config.MODEL_PATH+"/"+h+'",overflowX: "fit",overflowY: "fit",width: 616,height: 320,callback: showErrors,zoomSlider: true,linkSubProcesses: false}<\/script></div></body></html>');k.close()}},showSuccessfulDeployment:function(a){Ext.MessageBox.alert(Signavio.I18N.Repository.Deploy2Saperion.title,(new Template(Signavio.I18N.Repository.Deploy2Saperion.suc)).evaluate({time:new Date(parseInt(a.deployTime)).format("G:i"),buildNr:a.buildNr}));Signavio.Core.StoreManager.getChildEntitiesStore().reload()}};Signavio.Plugins.Deploy2Saperion=Signavio.Core.Plugin.extend(Signavio.Plugins.Deploy2Saperion)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.TIMDummyEntries={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.offer({relGroup:"configure",arrange:"right",name:Signavio.I18N.Repository.SecurityCenter.btnManage,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group.png",index:2});this.offer({relGroup:"configure",arrange:"right",index:9,name:Signavio.I18N.Repository.MetaData.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/table_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:15,name:Signavio.I18N.Repository.MetaData.titleGuidelines,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compass.png"});this.offer({relGroup:"configure",arrange:"right",index:10,name:Signavio.I18N.Repository.Configuration.offerLanguages,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_edit.png"});this.offer({relGroup:"configure",arrange:"right",index:26,name:Signavio.I18N.Repository.Configuration.offerSecurity,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png"});this.offer({relGroup:"configure",arrange:"right",index:60,name:Signavio.I18N.Repository.Configuration.offerTitle,description:Signavio.I18N.Repository.Configuration.offerDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/monitor_edit.png"});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.BPMN2_0Import.title,description:Signavio.I18N.Repository.Offer.BPMN2_0Import.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",index:10});this.offer({relGroup:"import",index:65,name:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3,description:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png"});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importXPDLTitle,description:Signavio.I18N.Repository.Offer.importXPDLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",index:15});this.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importAMLTitle,description:Signavio.I18N.Repository.Offer.importAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",index:25});this.offer({group:"reporting",name:Signavio.I18N.Repository.Reporting.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",isVisible:this.isVisible.bind(this),items:[{index:1,name:Signavio.I18N.Repository.Offer.processDocumentationTitle,description:Signavio.I18N.Repository.Offer.processDocumentationDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_acrobat.png"},{index:2,name:Signavio.I18N.Repository.Offer.processDocumentationWordTitle,description:Signavio.I18N.Repository.Offer.processDocumentationWordDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_word.png",seperated:true}]});this.offer({relGroup:"reporting",index:11,name:Signavio.I18N.Repository.Analysis.titleCost,description:Signavio.I18N.Repository.Analysis.descriptionCost,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:12,name:Signavio.I18N.Repository.Analysis.titleRes,description:Signavio.I18N.Repository.Analysis.descriptionRes,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png",seperated:true});this.offer({relGroup:"reporting",index:25,name:Signavio.I18N.Repository.Analysis.activityListTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:26,name:Signavio.I18N.Repository.Analysis.attributesReportTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:22,name:Signavio.I18N.Repository.Analysis.docUseTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:23,name:Signavio.I18N.Repository.Analysis.itSystemByDiagramTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:24,name:Signavio.I18N.Repository.Analysis.itSystemByRolesTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:27,name:Signavio.I18N.Repository.Analysis.metricsTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:20,name:Signavio.I18N.Repository.Analysis.responsibilityAnalysisTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({relGroup:"reporting",index:21,name:Signavio.I18N.Repository.Analysis.responsibilityHandoverTitle,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_gear.png"});this.offer({arrange:"left",name:Signavio.I18N.Repository.SecurityCenter.Offer.shareTitle,description:Signavio.I18N.Repository.SecurityCenter.Offer.shareDesc,group:"scenter",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/key.png",index:1,isVisible:this.isVisible.bind(this),items:[{name:Signavio.I18N.Repository.SecurityCenter.Offer.readTitle,index:1,description:Signavio.I18N.Repository.SecurityCenter.Offer.readDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/picture_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)},{name:Signavio.I18N.Repository.SecurityCenter.Offer.discussTitle,index:2,description:Signavio.I18N.Repository.SecurityCenter.Offer.discussDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)},{name:Signavio.I18N.Repository.SecurityCenter.Offer.writeTitle,index:3,description:Signavio.I18N.Repository.SecurityCenter.Offer.writeDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this),seperated:true},{name:Signavio.I18N.Repository.SecurityCenter.Offer.manageTitle,index:4,description:Signavio.I18N.Repository.SecurityCenter.Offer.manageDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/application_key.png",functionality:this.dummy.bind(this),isDisabled:this.isDisabled.bind(this),isVisible:this.isVisible.bind(this)}]});this.offer({arrange:"left",relGroup:"scenter",name:Signavio.I18N.Repository.Offer.doPublishTitle,description:Signavio.I18N.Repository.Offer.doPublishDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report_go.png",seperated:true,index:-9});this.offer({relGroup:"edit",name:Signavio.I18N.Repository.TalkAbout.titleEdit,description:Signavio.I18N.Repository.TalkAbout.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/comments.png",index:2});this.offer({relGroup:"edit",name:Signavio.I18N.Repository.Offer.compareTitle,description:"",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/report.png",index:2});this.offer({relGroup:"new",name:Signavio.I18N.TIMDummyEntries.processMap,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/processmap-22x22.png",index:2});this.offer({relGroup:"new",name:Signavio.I18N.TIMDummyEntries.conversation,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/bpmn.conversation-22x22.png",index:3,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}});this.offer({relGroup:"new",name:Signavio.I18N.TIMDummyEntries.choreography,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/bpmn.choreography-22x22.png",index:4,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}});this.offer({relGroup:"new",name:Signavio.I18N.TIMDummyEntries.epc,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/epc-22x22.png",index:5,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}});this.offer({relGroup:"new",name:Signavio.I18N.TIMDummyEntries.organizationalChart,description:"",activeClass:"x-menu-item-active item-large",iconCls:"x-menu-item-icon x-menu-item-icon-large",cls:"x-menu-list-item-large",icon:Signavio.Config.IMAGE_PATH+"/diagrams/organigram-22x22.png",index:6,onAdd:function(a,c){var b=function(){c.un("show",b);c.remove(a);c.addMenuItem(a.initialConfig).disable()};if(c){c.on("show",b)}}})},offer:function(a){var b=function(d){d.functionality=this.dummy.bind(this,d);d.isDisabled=this.isDisabled.bind(this,d);d.isVisible=this.isVisible.bind(this,d);var c="";if(d.activeClass==="x-menu-item-active item-large"){c+="line-height:22px;"}if(d.name){d.name=["<span ext:qtip='",Signavio.I18N.TIMDummyEntries.premiumFeature,"'",(c?" style='"+c+"'":""),">",d.name,"<img src='"+Signavio.Config.IMAGE_PATH+"/signavio/logo_small.png' class='x-signavio-premium' onclick='window.open(\"http://www.signavio.com\")'/>","</span>"].join("")}}.bind(this);if(!a.items){b(a)}else{a.items.each(b)}this.facade.offer(a)},isDisabled:function(){return true},isVisible:function(a){if(a&&a.arrange=="right"){return true}else{return this.selectionNotInTrash()}},dummy:function(){}};Signavio.Plugins.TIMDummyEntries=Signavio.Core.Plugin.extend(Signavio.Plugins.TIMDummyEntries)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Timjpdl3Export={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:90,name:Signavio.I18N.Repository.Offer.exportItemTIM,description:Signavio.I18N.Repository.Offer.exportItemTIMDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/timjpdl3",Signavio.I18N.Repository.Offer.exportItemTIM),isDisabled:function(){return !this.oneSelected()||!this.selectionIsTim()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.Timjpdl3Export=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.Timjpdl3Export)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Deploy2Tim={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||!this.selectionIsTim()}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return b.call(this)||this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);this.facade.offer({name:Signavio.I18N.Repository.Deploy2Tim.title,arrange:"left",description:Signavio.I18N.Repository.Deploy2Tim.description,icon:Signavio.Config.IMAGE_PATH+"/tim/tim_exclam_logo.png",functionality:this.deploy.bind(this),isDisabled:a,isVisible:c})},deploy:function(){var a;this.getSelection().each(function(b){if(b.get("rel")==Signavio.Const.REL.MODEL){var c=b.get("href");a=c.replace(/\/model\//,"")}}.bind(this));this.performCheck(a)},performCheck:function(a){Signavio.Core.Stores.RequestManager.doPost("/p/deploy2tim",function(b){var c=b.rep["return"];if(c=="ok"){this.performDeploy(b.rep.revisionId,b.rep.hosts)}else{var e;if(c=="plausibility"||c=="syntax"){e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Tim[c]+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Tim.checkFail2)).evaluate({link:Signavio.Config.EDITOR_HANDLER_URI+"?id="+a})+'</div><div style="margin:12px;">'+(new Template(Signavio.I18N.Repository.Deploy2Tim.checkFail3)).evaluate({image:Signavio.Config.IMAGE_PATH+"/famfamfam/book_error.png"})+"</div></div>"}else{e='<div style="font-size:13px;;"><div style="margin:12px;">'+Signavio.I18N.Repository.Deploy2Tim[c]+"</div></div>"}var d=new Ext.Window({width:400,height:300,resizable:false,minimizable:false,modal:true,title:Signavio.I18N.Repository.Deploy2Tim.title,bodyStyle:"background-color:#ffffff;",html:e,buttons:[{text:Signavio.I18N.Repository.Purchase.close,handler:function(){d.hide()}}]});d.show()}}.bind(this),{requestFor:"check",modelId:a})},performDeploy:function(e,b){var d=[];for(var c=0;c<b.length;c++){d.push([b[c]])}hostsStore=new Ext.data.SimpleStore({fields:["field"],data:d});var a=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login",layout:"form",modal:true,width:435,title:Signavio.I18N.Repository.Deploy2Tim.title,items:[new Ext.form.ComboBox({fieldLabel:Signavio.I18N.Repository.Deploy2Tim.endPoint,width:400,tabIndex:1000,editable:false,triggerAction:"all",displayField:"field",valueField:"field",store:hostsStore,mode:"local",value:d[0][0]}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldUserName,width:400,tabIndex:1001,name:"Email"}),new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:400,inputType:"password",tabIndex:1002,listeners:{specialkey:function(g,f){if(f.getKey()===f.ENTER){this.ownerCt.buttons[0].handler()}}},name:"Passwd"})],buttons:[{text:Signavio.I18N.Repository.Deploy2Tim.deploy,tabIndex:1003,handler:function(){if(!(this.ownerCt.items.get(0).getValue()||"").trim()||!(this.ownerCt.items.get(1).getValue()||"").trim()||!(this.ownerCt.items.get(2).getValue()||"").trim()){return}Signavio.Core.Stores.RequestManager.doPost("/p/deploy2tim",function(f){var g=f.rep["return"];if(g=="deploy"||g=="invalidHost"||g=="connect"){Ext.MessageBox.show({title:Signavio.I18N.Repository.Deploy2Tim.title,msg:Signavio.I18N.Repository.Deploy2Tim.fail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{Ext.MessageBox.alert(Signavio.I18N.Repository.Deploy2Tim.title,Signavio.I18N.Repository.Deploy2Tim.suc)}}.bind(this),{requestFor:"deploy",revisionId:e,host:this.ownerCt.items.get(0).getValue(),user:this.ownerCt.items.get(1).getValue(),pw:this.ownerCt.items.get(2).getValue()});this.ownerCt.close()}},{text:Signavio.I18N.Repository.Header.windowBtnCancel,tabIndex:1004,handler:function(){this.ownerCt.close()}}]});a.show()}};Signavio.Plugins.Deploy2Tim=Signavio.Core.Plugin.extend(Signavio.Plugins.Deploy2Tim)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.BPMN2XPDLExport={enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||(this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0conversation#"&&this.getSelection()[0].get("rep").namespace!=="http://b3mn.org/stencilset/bpmn2.0choreography#")}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return !b.call(this)&&this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);this.facade.offer({relGroup:"import",index:65,name:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3,description:Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3Description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.doExport.bind(this,"/bpmn2_0_xpdl",Signavio.I18N.Repository.Offer.exportItemBPMN2XPDL3),isDisabled:function(){return !a()},isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})}};Signavio.Plugins.BPMN2XPDLExport=Signavio.Core.ExportPlugin.extend(Signavio.Plugins.BPMN2XPDLExport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.VisioImport={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var a=function(){return !this.facade.getCurrentFolderStore()||!this.facade.getCurrentFolderStore().hasPrivileges(Signavio.Config.RIGHTS.WRITE)}.bind(this);this.facade.offer({relGroup:"import",name:Signavio.I18N.Repository.Offer.importVisioTitle,description:Signavio.I18N.Repository.Offer.importVisioDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_office.png",functionality:this.importVisio.bind(this),index:30,isDisabled:function(){return this.selectionInSearch()||this.selectionInTrash()||a()}.bind(this),isVisible:function(){return this.selectionNotInTrash()&&!this.selectionInInternal()}.bind(this)})},importVisio:function(){if(!this.facade.isSupportedBrowserEditor()){Ext.Msg.alert(SSignavio.I18N.Repository.Offer.importVisioNotSupportedTitle,Signavio.I18N.Repository.Offer.importVisioNotSupportedDescription).setIcon(Ext.MessageBox.INFO).getDialog().syncSize();return}var c=new Ext.form.FormPanel({defaultType:"textfield",layout:"form",border:false,fileUpload:true,hideLabels:true,items:[{text:Signavio.I18N.Repository.Offer.importVisioLabel,style:"font-size:12px;margin-bottom:10px;display:block;",xtype:"label"},{name:"visiofile",inputType:"file",style:"margin-bottom:10px;display:block;",itemCls:"ext_specific_window_overflow"},{text:Signavio.I18N.Repository.Offer.importVisioStencil,style:"font-size:12px;margin-bottom:5px;display:block;",xtype:"label"},new Ext.form.Radio({name:"stencilfield",boxLabel:"BPMN 2.0",value:"bpmn",checked:true}),new Ext.form.Radio({name:"stencilfield",boxLabel:"EPK",value:"epc"}),{name:"directory",inputType:"hidden",value:Signavio.Core.StoreManager.getStore("child").getIdentifier()},{name:"stencil",inputType:"hidden",value:"bpmn"},$H(Ext.Ajax.getSecurityParameter()).map(function(d){return{name:d.key,inputType:"hidden",value:d.value}})].flatten()});c.getForm().errorReader={read:function(d){return{success:d.responseText.toLowerCase().replace(/<.*?pre.*?>/g,"").length===32,records:[]}}};var b=this;var a=new Ext.ux.Window({autoCreate:true,cls:"x-window-security-center",title:Signavio.I18N.Repository.Offer.importVisioTitle,width:400,modal:true,resizable:false,items:[c],buttons:[{text:Signavio.I18N.Repository.Offer.amlImportRestoreBtn,handler:function(){if(c.items.items[1].el.dom.value){var e=[c.items.items[3],c.items.items[4]].find(function(f){return f.getValue()});if(e){c.items.items[6].el.dom.value=e.value}var d=window.open();c.getForm().submit({url:Signavio.Config.BACKEND_PATH+Signavio.Config.VISIO_IMPORT_PATH,waitMsg:Signavio.I18N.Repository.Offer.importXPDLWait,method:"POST",success:function(g,f){a.close();var h=Signavio.Config.EDITOR_HANDLER_URI+"?"+Object.toQueryString({id:f.response.responseText.toLowerCase().replace(/<.*?pre.*?>/g,"")});window.setTimeout(function(){d.location=window.location.protocol+"//"+window.location.host+""+h;d.focus();b.facade.askForRefresh()},100)}.bind(this),failure:function(g,f){a.close();d.close();if(f.response.responseText.indexOf("visioImport.InvalidRequestVisioFileMissing")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.importVisioFileMissingTitle,Signavio.I18N.Repository.Offer.importVisioFileMissingDescription.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.INFO).getDialog().syncSize()}else{if(f.response.responseText.indexOf("visioImport.VisioFileTooBig")>-1){Ext.Msg.alert(Signavio.I18N.Repository.Offer.importVisioTooBigTitle,Signavio.I18N.Repository.Offer.importVisioTooBigDescription.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.Offer.importVisioWarningTitle,Signavio.I18N.Repository.Offer.importVisioWarningDescription.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).setIcon(Ext.MessageBox.WARNING).getDialog().syncSize()}}}})}else{}}.bind(this)}]});a.show()}};Signavio.Plugins.VisioImport=Signavio.Core.Plugin.extend(Signavio.Plugins.VisioImport)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.SC_ManageInvitations={enabled:true,index:1,construct:function(){arguments.callee.$.construct.apply(this,arguments)},generateTab:function(){return(this.facade.isCurrentUserAdmin()?new a({facade:this.facade,height:400}):undefined)}};Signavio.Plugins.SC_ManageInvitations=Signavio.Core.AdministrationPlugins.extend(Signavio.Plugins.SC_ManageInvitations);var a=function(b){b=b||{};this.facade=b.facade;this.radioButtons={};b.listeners={activate:function(){this.updateLabels()}};b.items=[this.getPanel()];a.superclass.constructor.call(this,b)};Ext.extend(a,Ext.Panel,{title:Signavio.I18N.Repository.SecurityCenter.tabInvitation,layout:"anchor",getPanel:function(){var c,d,b;d=function(e){e.body.query("a.x-tab-change").each(function(f){$(f).observe("click",function(g){this.showTab(Number(f.getAttribute("href").split("#").last()));Event.stop(g);return false}.bind(this))}.bind(this));updateLabels()}.bind(this);c=this;b=new Signavio.Extensions.AdminPanel({treeTitle:Signavio.I18N.Repository.SecurityCenter.titleInvitationTree,hideButtons:true,split:false,treeRootIdentifier:Signavio.Config.INVITATION_PATH,anchor:"100% 100%",autoWidth:true,treeChildLeaf:true,treeCls:"x-tree-admin-user",treeChildCls:"user",recordRel:Signavio.Const.REL.INVITATION,dataField:"rep.mail",generateFormPanel:function(e){return new Ext.Panel({region:"center",layout:"form",autoScroll:true,cls:"configuration_window_form",margins:"3 3 3 0",items:e})},onSelectionChange:function(e){b.tree.getTopToolbar().items.items[0][e&&c.facade.isCurrentUserAdmin()?"enable":"disable"]()},items:this.generateInvitationPanelItems(),tbar:[{iconCls:"class_bugfixing",disabled:true,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/user_delete.png",enableToggle:false,handler:function(){var e=b.tree.getSelectionModel().getSelectedNode();if(!e){return}Ext.Msg.confirm(Signavio.I18N.Repository.SecurityCenter.removeInvitationTitle,Signavio.I18N.Repository.SecurityCenter.removeInvitationDesc,function(g,h){if(g==="yes"){var f=Signavio.Core.StoreManager.getStore(e.parentNode.attributes.identifier);this.removeInvitationRecord(f,e)}}.bind(this))}.bind(this)},{iconCls:"class_bugfixing",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/arrow_refresh_small.png",handler:function(){b.tree.loader.cachedStores.each(function(e){Signavio.Core.StoreManager.reload(e)});if(b.tree){b.tree.getSelectionModel().clearSelections()}}.bind(this)}]});this.panel=b;this.plugin=c;return b},getLicenseLabel:function(b){return new Ext.XTemplate(Signavio.I18N.Repository.Administration[b]).apply({count:this.facade.getUnusedLicenses(b).length})},generateInvitationPanelItems:function(){var c=[],e,f,b,d;d=this.facade.getConfig().isAcademic;e=(!this.facade.getConfig().trialGoodThru||this.facade.getConfig().trialGoodThru<=0);f=!d&&e&&Signavio.Config.MAIN_LICENSES.all(function(g){return this.facade.getUnusedLicenses(g).length<=0}.bind(this));b=d?"display:none;":"";if(!d){c=c.concat(this._generateNoneAcademicItems(b,e)).compact()}c=c.concat(this._generateStaticInvitationPanelItems(d,f)).compact();if(d){c=c.concat(this._generateAcademicItems()).compact()}return c},_generateNoneAcademicItems:function(b,g){var c=[],f=this,e;[].concat(Signavio.Config.MAIN_LICENSES).compact().each(function(h){if((![].concat(Signavio.Config.DEPRECATED_LICENSES).include(h)||f.facade.getUnusedLicenses(h).length>0)&&f.getLicenseLabel(h)){e=new Ext.form.Radio({itemCls:"x-admin-check",hideParent:true,labelStyle:b,id:h,width:300,fieldLabel:Signavio.I18N.Repository.Administration.fieldLicenses,boxLabel:f.getLicenseLabel(h),name:"licenses",checked:f.facade.getUnusedLicenses(h).length>0,disabled:f.facade.getUnusedLicenses(h).length===0});f.radioButtons[h]=e;c.push(e)}});if(!g){var d=new Ext.form.Radio({itemCls:"x-admin-check x-admin-trial",hideParent:true,labelStyle:b,width:300,id:Signavio.Config.TRIAL_LICENSE,fieldLabel:Signavio.I18N.Repository.Administration.fieldLicenses,boxLabel:Signavio.I18N.Repository.Administration.trial,name:"licenses",checked:Signavio.Config.MAIN_LICENSES.all(function(h){return this.facade.getUnusedLicenses(h).length<=0}.bind(this))});c.push(d)}return c},_generateStaticInvitationPanelItems:function(d,e){var b=[],c=this;b.push(new Ext.Panel({border:false,autoWidth:true,html:d?Signavio.I18N.Repository.Administration.inviteAcademicDesc:(e?Signavio.I18N.Repository.Administration.pleasePurchaseNow:Signavio.I18N.Repository.Administration.pleasePurchase),cls:"x-admin-btn x-admin-purchaseHint",render:function(){Ext.Panel.prototype.render.apply(this,arguments);this.body.select("a.x-purchase").on("click",function(f){Event.stop(f);c.facade.raiseEvent("open_purchase");c.panel.ownerCt.ownerCt.ownerCt.close()}.bind(this)).removeClass("x-purchase")}}));b.push(new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldPrincipal,width:200,disabled:e,listeners:{specialkey:function(g,h){if(h.getKey()===Ext.EventObject.ENTER){if(this.inviteUser(g.getValue())!==false){g.setValue("")}}}.bind(this)},validator:function(f){return !f||!!f.match(Signavio.Const.MAIL_VALIDATOR)}}));b.push(new Ext.Panel({border:false,autoWidth:true,cls:"x-admin-btn",bodyStyle:"padding-top:5px;",items:[new Ext.Button({text:Signavio.I18N.Repository.Administration.add,handler:function(){var f=this.panel.form.items.items.find(function(g){return g.fieldLabel==Signavio.I18N.Repository.Administration.fieldPrincipal});if(f&&this.inviteUser(f.getValue())!==false){f.setValue("")}}.bind(this)})]}));return b},_generateAcademicItems:function(){var b=[];b.push(new Ext.Panel({border:false,autoWidth:true,style:"padding-top:30px;",html:Signavio.I18N.Repository.Administration.inviteLinkAcademicDesc,cls:"x-admin-btn x-admin-purchaseHint"}));b.push(new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Administration.fieldInvitationLink,width:200,selectOnFocus:true,labelStyle:"",readOnly:true,value:this.facade.getConfig().invitationLink}));return b},updateLabels:function(){[].concat(Signavio.Config.MAIN_LICENSES).compact().each(function(c){if(this.radioButtons[c]){this.radioButtons[c].wrap.query("label")[0].innerHTML=this.getLicenseLabel(c);var b=this.facade.getUnusedLicenses(c).length===0;this.radioButtons[c].setDisabled(b)}}.bind(this))},inviteUser:function(b){var d=this.facade.getConfig().isAcademic||false;var e=b;if(!e){return}var c=Signavio.Config.INVITATION_PATH;var f=Signavio.Core.StoreManager.getStore(c,true,function(){if(f.findByRepValue("mail",e)){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.tabInvitation,Signavio.I18N.Repository.SecurityCenter.invitationAlertInvitationExists).setIcon(Ext.Msg.WARNING).getDialog().syncSize();return}if(Signavio.Core.StoreManager.getAllUserStore().findByRepValue("mail",e)){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.tabInvitation,Signavio.I18N.Repository.SecurityCenter.invitationAlertUserExists).setIcon(Ext.Msg.WARNING).getDialog().syncSize();return}var k;if(d){k=Signavio.Config.PREMIUM_LICENSE}else{var j=this.panel.form.items.items.find(function(l){return l instanceof Ext.form.Checkbox&&!l.hidden&&l.el.dom.checked});if(!j||j.el.dom.disabled){Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.tabInvitation,Signavio.I18N.Repository.SecurityCenter.invitationAlertNoLicense).setIcon(Ext.Msg.WARNING).getDialog().syncSize();return}k=j.getId()}var h=Signavio.Core.RecordCreator.create("invitation",c,{mail:e,type:k});var g=function(l,m){f.un("submitted",g);if(m&&m.get("rel")=="user"){f.remove(m,false);Signavio.Core.StoreManager.getAllUserStore().add(m,false);Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.tabInvitation,Signavio.I18N.Repository.SecurityCenter.invitationAlertSuccessUser).setIcon(Ext.Msg.INFO).getDialog().syncSize()}else{Ext.Msg.alert(Signavio.I18N.Repository.SecurityCenter.tabInvitation,Signavio.I18N.Repository.SecurityCenter.invitationAlertSuccessInvitation).setIcon(Ext.Msg.INFO).getDialog().syncSize()}}.bind(this);f.on("submitted",g);f.add(h,true);this.facade.setUnusedLicenses((this.facade.getConfig().licenses||[]).without((this.facade.getConfig().licenses||[]).find(function(l){return l.type==k})));this.updateLabels()}.bind(this))},removeInvitationRecord:function(b,e){var g=b.findByIdentifier(e.attributes.identifier);if(g){if(this.panel&&this.panel.tree){this.panel.tree.getTopToolbar().el.mask()}var f,d=this;var c=function(){if(d.panel&&d.panel.tree){d.panel.tree.getTopToolbar().el.unmask()}b.un("submitted",f);b.un("submitfailed",c)};f=function(j,l){c();var h=[Signavio.Core.StoreManager.getAllUserGroupStore(),Signavio.Core.StoreManager.getAllGroupStore()];var k=(g.get("rep").licenses||[]).find(function(m){return Signavio.Config.MAIN_LICENSES.include(m)});if(k){d.facade.setUnusedLicenses(d.facade.getConfig().licenses.concat({type:k,id:""}));d.updateLabels()}};b.on("submitted",f);b.on("submitfailed",c);b.remove(g,true)}}})})();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){var a={team:{monthly:34.95,quarterly:29.95},premium:{monthly:79.95,quarterly:74.95},professional:{quarterly:86.95,annually:81.95},corporate:{quarterly:134.95,annually:129.95},ultimate:{quarterly:209.95,annually:199.95}};Signavio.Plugins.Purchase={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.facade.isOwnerUser()}.bind(this);this.facade.offer({relGroup:"configure",arrange:"right",name:Signavio.I18N.Repository.Purchase.title,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/cart.png",functionality:this.checkPreconditions.bind(this),index:4,isVisible:b});this.facade.registerOnEvent("open_purchase",function(){this.checkPreconditions()}.bind(this))},finialize:function(){var b=this.hasMoreThanTrialLicense(this.facade.getCurrentUser().getRecords("info")[0]);if(b){return}var d=this.facade.getConfig().trialGoodThru||0;var c=document.createElement("a");$("signavio_repository_header").parentNode.appendChild(c);c.innerHTML=new Ext.XTemplate(Signavio.I18N.Repository.Purchase.purchaseLink).apply({count:d});c.className="x-purchase-link";c.href="#";c.title=Signavio.I18N.Repository.Purchase.linkTitle;$(c).observe("click",function(g){if(this.facade.isOwnerUser()){this.checkPreconditions()}else{var f={admin:this.facade.getOwnerUser().get("rep").name};var h=Ext.Msg.alert("Signavio",new Ext.Template(Signavio.I18N.Repository.Purchase.notSupported.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).apply(f));h.setIcon("x-window-ffonly");h.getDialog().syncSize()}Event.stop(g);return false}.bind(this));this.link=c;if(this.facade.isExpired()){this.checkPreconditions()}},hasMoreThanTrialLicense:function(b){return b&&(b.get("rep").licenses||[]).any(function(c){return Signavio.Config.MAIN_LICENSES.include(c.toLowerCase())})},generateTab:function(){this.record=Signavio.Core.RecordCreator.create(Signavio.Const.REL.ORDER,Signavio.Config.ORDER_PATH,{});var b=[];if(!this.facade.isExpired()){b=[new Ext.Button({text:Signavio.I18N.Repository.Purchase.cancel,template:new Ext.Template("<a href='#' class='x-button-plain'>{0}</a>"),handler:this.close.bind(this),onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.el.on("click",function(f,d){this.handler.apply(this,arguments);f.stopEvent();return false}.bind(this))}})]}else{b=[new Ext.Button({text:"Logout",template:new Ext.Template("<form action='"+Signavio.Config.LOGOUT_HANDLER+"' method='post'><a href='#' class='x-button-plain' style='display:inline;'>{0}</a></form>"),handler:function(){this.el.dom.submit()},onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.container.setStyle("width","100%");this.container.findParent("table").setStyle("width","100%");this.el.select("a").on("click",function(f,d){this.handler.apply(this,arguments);f.stopEvent();return false}.bind(this))}})]}var c=new Ext.ux.view.Wizard({buttons:b,items:[this.getPage0(),this.getPage1(),this.getPage2(),this.getPage3(),this.getPage4(),this.getWarningPage()].compact()});return new Ext.Panel({layout:"fit",height:500,cls:"x-plugin-purchase",title:Signavio.I18N.Repository.Purchase.title,items:[c]})},checkPreconditions:function(){if(!this.facade.isOwnerUser()){return}Signavio.Core.Stores.RequestManager.doGet(Signavio.Config.VALIDATE_ORDER_PATH,[function(b){if(b&&b.rel==="order.validate"&&b.rep){this.ordered=b.rep.hasPurchasedActiveLicenses;this.invoicingPeriod=b.rep.invoicingPeriod}this.showWindow()}.bind(this),function(){this.showContactInformation()}.bind(this)])},showContactInformation:function(){var c=[],b=true;c=[new Ext.Button({hidden:true}),new Ext.Button({text:Signavio.I18N.Repository.Purchase.cancel,template:new Ext.Template("<a href='#' class='x-button-plain'>{0}</a>"),handler:this.close.bind(this),onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.el.on("click",function(g,f){this.handler.apply(this,arguments);g.stopEvent();return false}.bind(this))}})];var d=new Ext.ux.view.Wizard({buttons:c,closable:b,items:[this.getWarningPage()].compact()});this.window=new Ext.ux.Window({layout:"fit",closable:b,modal:true,height:250,width:600,cls:"x-plugin-purchase",title:Signavio.I18N.Repository.Purchase.title,items:[this.getWarningPage()]});this.window.show();return this.window},showWindow:function(){this.record=Signavio.Core.RecordCreator.create(Signavio.Const.REL.ORDER,Signavio.Config.ORDER_PATH,{});var c=[],b=true;if(!this.facade.isExpired()){c=[new Ext.Button({hidden:true}),new Ext.Button({text:Signavio.I18N.Repository.Purchase.cancel,template:new Ext.Template("<a href='#' class='x-button-plain'>{0}</a>"),handler:this.close.bind(this),onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));this.el.on("click",function(g,f){this.handler.apply(this,arguments);g.stopEvent();return false}.bind(this))}})]}else{c=[new Ext.Button({hidden:true,text:Signavio.I18N.Repository.Purchase.logout,template:new Ext.Template("<form action='"+Signavio.Config.LOGOUT_HANDLER+"' method='post' class='x-form-button'><a href='#' class='x-button-plain'>{0}</a></form>"),handler:function(){this.el.dom.submit()},onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]));if(!Ext.isIE){this.container.setStyle("width","100%");this.container.findParent("table").setStyle("width","100%")}else{this.container.dom.style.cssText="width: 100%;";this.container.findParent("table").style.cssText="width: 100%;"}this.el.select("a").on("click",function(g,f){this.handler.apply(this,arguments);g.stopEvent();return false}.bind(this))}}),new Ext.Button({hidden:true,text:Signavio.I18N.Repository.Purchase.refresh,template:new Ext.Template("<a href='/p/explorer' class='x-button-plain'>{0}</a>"),onRender:function(){this.el=Ext.get(this.template.overwrite(this.container.dom,[this.text]))}})];b=false}var d=new Ext.ux.view.Wizard({buttons:c,closable:b,items:[this.getPage0(),this.getPage1(),this.getPage2(),this.getPage3(),this.getPage4(),this.getWarningPage()].compact()});this.window=new Ext.Window({layout:"fit",closable:b,modal:true,height:550,width:600,cls:"x-plugin-purchase",title:Signavio.I18N.Repository.Purchase.title,items:[d]});this.window.show();return this.window},close:function(){Ext.Msg.confirm(Signavio.I18N.Repository.Purchase.title,Signavio.I18N.Repository.Purchase.closeDescription,function(b){if(b=="yes"){if(this.window){this.window.close()}}}.bind(this))},purchaseSubmitted:function(b){if(this.link&&this.link.parentNode){this.link.parentNode.removeChild(this.link)}this.ordered=true;var e=(Number(b.get("rep").additionalLicenses)||0);var g=[];for(var d=0;d<e;d++){g.push({type:b.get("rep").licenseType,id:""})}this.facade.setUnusedLicenses(this.facade.getConfig().licenses.concat(g));var c=Signavio.Core.StoreManager.getAllUserStore();var h=c.getRecords("user");var f=b.get("rep").licenseType;([b.get("rep").users].flatten()||[]).each(function(l){var j=h.find(function(p){return p.get("href")===l});if(j){j.get("rep").licenses=(j.get("rep").licenses||[]).concat(f).uniq();c.commitChanges(true)}var k=Signavio.Core.StoreManager.getStore(l);if(k){var n=k.getRecords("info")[0];n.get("rep").licenses=(n.get("rep").licenses||[]).concat(f).uniq();k.commitChanges(true)}var m=Signavio.Core.StoreManager.getCurrentUser();if(m.getIdentifier()===l){var n=m.getRecords("info")[0];n.get("rep").licenses=(n.get("rep").licenses||[]).concat(f).uniq();m.commitChanges(true)}})},isFollowedPurchase:function(){return this.ordered},calcFirstPaymentInterval:function(d,c){c=c=="annually"?"annually":"quarterly";var f=d.getFirstDateOfMonth();if(c==="annually"){var g=Date.parseDate("31.12."+(new Date().getYear()+1900),"d.m.o");var e=new Date(g.getElapsed(d));if(0===e.getMonth()&&70===e.getYear()&&15>=e.getDate()){f=g.add(Date.YEAR,1)}else{f=g}}else{if(c==="quarterly"){var b=Date.parseDate("01."+(((Math.floor(d.getMonth()/3)+1)*3)+1),"d.n");b=b.add(Date.MONTH,-1).getLastDateOfMonth();var e=new Date(b.getElapsed(d));if(0===e.getMonth()&&15>=e.getDate()){f=b.getFirstDateOfMonth().add(Date.MONTH,3).getLastDateOfMonth()}else{f=b}}else{throw new Error("calcFirstPaymentInterval needs 'quarterly' or 'annually' as argument")}}return f.getLastDateOfMonth()},createLicenseRequestParam:function(b,e,d){var c=[{licenseType:b,numOfUnassignedUsers:d,assignedUsers:e}];return c},createQuotaPackageRequestParam:function(){return[{}]},getPage0:function(){if(!this.facade.isExpired()){return undefined}var d=new Ext.XTemplate('<tpl for=".">',Signavio.I18N.Repository.Purchase.expiredMessage.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS),"</tpl>");var c=this.facade.getCurrentUser().getRecords("info")[0];var b=new Ext.Panel({html:d.apply({name:c.get("rep").name.trim()})});var e=function(f){f.ownerCt.buttons[0].show()};return wizardPage=new Ext.ux.view.WizardPage({items:[b],listeners:{activate:e}})},getPage1:function(){var f=new Ext.XTemplate('<tpl for=".">','<div class="x-purchase-intro">','<tpl if="values.licenses">',Signavio.I18N.Repository.Purchase.introPrefix,"</tpl>",'<tpl if="!values.licenses">',Signavio.I18N.Repository.Purchase.introNone,"</tpl>",(this.facade.getConfig().trialGoodThru!==undefined&&this.facade.getConfig().trialGoodThru>=0?"<br/>"+Signavio.I18N.Repository.Purchase.introTrial:""),"</div>","</tpl>");var A=this.invoicingPeriod;A=(A&&A==="QUARTERLY");var n=(A)?'selected="true"':"";var G=this.facade.getConfig().purchaseOfferedLicenses||[];var v=(G.size()===0||G.member(Signavio.Config.TEAM_LICENSE));var q=(G.size()===0||G.member(Signavio.Config.PREMIUM_LICENSE));var D=(G.size()===0||G.member(Signavio.Config.PROFESSIONAL_LICENSE));var H=(G.size()===0||G.member(Signavio.Config.CORPORATE_LICENSE));var F=(G.size()===0||G.member(Signavio.Config.ULTIMATE_LICENSE));var C=this.isFollowedPurchase()?this.facade.getCurrentUser().getRecords("info")[0].get("rep").licenses:[];C=Signavio.Config.MAIN_LICENSES.find(function(K){return C.include(K)})||false;if((v||q)&&!Signavio.Config.DEPRECATED_LICENSES.member(C)){v=q=false}var t=new Ext.XTemplate('<tpl for=".">','<div class="x-purchase-box x-purchase-licenses">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.edition+"</span>",'<span class="x-label-hint">'+Signavio.I18N.Repository.Purchase.editionHint+"</span>",(F)?'<input type="radio" name="licence" '+(C&&C!==Signavio.Config.ULTIMATE_LICENSE?"":'checked="true"')+' id="'+Signavio.Config.ULTIMATE_LICENSE+'" class="x-purchase-license-type" '+(C&&C!==Signavio.Config.ULTIMATE_LICENSE?'disabled="true" ':"")+"/>":"",(F)?'<label for="'+Signavio.Config.ULTIMATE_LICENSE+'" '+(C&&C!==Signavio.Config.ULTIMATE_LICENSE?'class="x-disabled" ':"")+">"+Signavio.I18N.Repository.Purchase.licenseTitleUltimate+"</label><br/>":"",(H)?'<input type="radio" name="licence" '+(C===Signavio.Config.CORPORATE_LICENSE?'checked="true"':"")+' id="'+Signavio.Config.CORPORATE_LICENSE+'" class="x-purchase-license-type" '+(C&&C!==Signavio.Config.CORPORATE_LICENSE?'disabled="true" ':"")+"/>":"",(H)?'<label for="'+Signavio.Config.CORPORATE_LICENSE+'" '+(C&&C!==Signavio.Config.CORPORATE_LICENSE?'class="x-disabled" ':"")+">"+Signavio.I18N.Repository.Purchase.licenseTitleCorporate+"</label><br/>":"",(D)?'<input type="radio" name="licence" '+(C===Signavio.Config.PROFESSIONAL_LICENSE?'checked="true"':"")+' id="'+Signavio.Config.PROFESSIONAL_LICENSE+'" class="x-purchase-license-type" '+(C&&C!==Signavio.Config.PROFESSIONAL_LICENSE?'disabled="true" ':"")+"/>":"",(D)?'<label for="'+Signavio.Config.PROFESSIONAL_LICENSE+'" '+(C&&C!==Signavio.Config.PROFESSIONAL_LICENSE?'class="x-disabled" ':"")+">"+Signavio.I18N.Repository.Purchase.licenseTitleProfessional+"</label><br/>":"",(q)?'<input type="radio" name="licence" '+(C===Signavio.Config.PREMIUM_LICENSE?'checked="true"':"")+' id="'+Signavio.Config.PREMIUM_LICENSE+'" class="x-purchase-license-type '+(C&&C!==Signavio.Config.PREMIUM_LICENSE?'disabled="true" ':"")+'"/>':"",(q)?'<label for="'+Signavio.Config.PREMIUM_LICENSE+'" '+(C&&C!==Signavio.Config.PREMIUM_LICENSE?'class="x-disabled" ':"")+">"+Signavio.I18N.Repository.Purchase.licenseTitlePremium+"</label><br/>":"",(v)?('<input type="radio" name="licence" '+(C===Signavio.Config.TEAM_LICENSE?'checked="true"':"")+' id="'+Signavio.Config.TEAM_LICENSE+'" class="x-purchase-license-type" '+(C&&C!==Signavio.Config.TEAM_LICENSE?'disabled="true" ':"")+"/>"):"",(v)?'<label for="'+Signavio.Config.TEAM_LICENSE+'" '+(C&&C!==Signavio.Config.TEAM_LICENSE?'class="x-disabled" ':"")+">"+Signavio.I18N.Repository.Purchase.licenseTitleTeam+"</label>":"","</div>",'<span class="x-label-title x-purchase-license">'+Signavio.I18N.Repository.Purchase.license+"</span>",'<div class="x-purchase-box x-purchase-license">','<span class="x-label-hint">'+Signavio.I18N.Repository.Purchase.licenseHint+"</span>",'<tpl for="users">','<input type="checkbox" {[this.hasLicense(values) || values.get("href") == parent.current.get("href")?"disabled=\'true\'":""]} {[this.hasLicense(values)?"":"checked=\'true\'"]}" id="{[values.get("href")]}" class="x-user-licences"/>','<label for="{[values.get("href")]}">','{[values.get("rep").name]}  ','<tpl if="this.hasLicense(values)">','<span class="x-purchase-has-license">({[this.getLicense(values)]})</span>',"</tpl>","</label><br/>","</tpl>",'<input type="checkbox" class="x-more-licences"/>','<label for="more"><input class="x-purchase-license-count" id="more" class="x-purchase-more" maxlength="3"/>'+Signavio.I18N.Repository.Purchase.moreLicenses+' <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Purchase.moreHint+'"/></label><br/>',"</div>",'<div class="x-purchase-line x-purchase-interval"><span class="x-purchase-label">'+Signavio.I18N.Repository.Purchase.intervalDesc+':</span><select name="paymentInterval" class="x-purchase-dates"><option value="annually">'+Signavio.I18N.Repository.Purchase.annually+'</option><option value="quarterly" '+n+">"+Signavio.I18N.Repository.Purchase.quarterly+"</option></select></div>","</tpl>",{hasLicense:function(K){return K&&this.hasMoreThanTrialLicense(K)}.bind(this),getLicense:function(K){var L=(K.get("rep").licenses||[]).find(function(M){return Signavio.Config.MAIN_LICENSES.include(M)});return(L&&Signavio.I18N.Repository.Purchase[L])||L||"-"}});var y=new Ext.XTemplate('<tpl for=".">','<div class="x-purchase-line"><span class="x-purchase-label">'+Signavio.I18N.Repository.Purchase.firstRate+':</span><div class="x-purchase-dates"><b>{d1}</b> - <b>{d2}</b>  <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Purchase.intervalDescHint+'"/></div></div>','<div class="x-purchase-line x-purchase-line-calc"><span class="x-purchase-label">'+Signavio.I18N.Repository.Purchase.rate+':</span><div class="x-calc"><b>{users}</b> {[Signavio.I18N.Repository.Purchase["user"+(values.users>1?"s":"")]]} x <b>{[(values.rate.toFixed(2)+"").gsub("\\\\.", ",")]}</b> {currency} <br/><span class="x-sum">{[(values.sum.toFixed(2)+"").gsub("\\\\.", ",")]} {currency}</span></div></div>',"</tpl>");var z=(new Date()).add(Date.DAY,("undefined"!=typeof this.facade.getConfig().trialGoodThru?this.facade.getConfig().trialGoodThru+1:0));var c=z.add(Date.DAY,0).format("d.m.Y");var w=z.format("d.m.Y");var u=new Ext.Panel({html:t.apply({users:[],current:[]})});var E=new Ext.Panel({html:f.apply({licenses:"",date:w})});var l=new Ext.Panel({html:Signavio.I18N.Repository.Purchase.validating});var j;var h,e,k,b,s;var B;var p=function(L,O){if(!j||!j.body){return}var N=j.body.query.bind(j.body);if(!h){h=N("input.x-user-licences")}if(!e){e=N("input.x-purchase-license-count")[0]}if(!k){k=N("input.x-more-licences")[0]}if(!b){b=N("select.x-purchase-dates")[0]}if(!s){s=N("input.x-purchase-license-type")}if((h||e||k||false)===false){throw new Error("Purchase initialization went wrong.")}if(O&&O===e){k.checked=!isNaN(parseInt(O.value));O.value=isNaN(Number(O.value))||Number(O.value)<=0?"":Number(O.value)}var M=b?b.options[b.selectedIndex].value:"quarter";var K=s.find(function(Q){return Q.checked}).id;B=this.calcFirstPaymentInterval(z,M).format("d.m.Y");var P={d1:c,d2:B,users:h.findAll(function(Q){return Q.checked}).length+(k.checked?(parseInt(e.value)||0):0),rate:a[K][M],currency:Signavio.I18N.Repository.Purchase.currency};P.sum=P.users*P.rate;y.overwrite(l.body,P);j.ownerCt.next.setDisabled(P.users===0)}.bind(this);var x=null;var I=false;var d;var r;var g=function(L){L.ownerCt.buttons[0].hide();if(!d){d=Signavio.Core.StoreManager.getAllUserStore();d.on("load",r);d.on("update",r);d.on("add",r);d.on("remove",r)}if(x==null||I){return}p();var K=L.body.query("input");$A(K).each(function(M){Ext.get(M).on("click",p);Ext.get(M).on("keyup",p)}.bind(this));Ext.get(L.body.query("input.x-purchase-license-count")[0]).on("keyup",p);Ext.get(L.body.query("select.x-purchase-dates")[0]).on("change",p);Signavio.Core.StoreManager.getStore(Signavio.Config.INVITATION_PATH,true,function(N){if(x==null){throw new Error("Users is not defined. Check ordering of calling this method and updateUsers (purchase.js:getPage1)")}var M=[];Signavio.Config.MAIN_LICENSES.each(function(R){var Q=x.findAll(function(V){return V.get("rep").licenses.include(R)}).length;Q+=this.facade.getUnusedLicenses(R).length;Q+=N.findAll(function(V){return(V.get("rep").licenses||[]).include(R)}).length;if(Q){var T=Signavio.I18N.Repository.Purchase.introAccount,S=Signavio.I18N.Repository.Purchase.introAccounts,P=Signavio.I18N.Repository.Purchase.introSubsequence,U=Signavio.I18N.Repository.Purchase[R];M.push("<b>"+Q+"</b> "+(Q==1?T:S)+" "+P+" "+U)}}.bind(this));M=M.join(", ").replace(/(,)([^,]+)$/," "+Signavio.I18N.Repository.Purchase.introConcat+"$2");f.overwrite(E.body,{licenses:M||"",date:w});if(this.isFollowedPurchase()){try{b.disabled=true;b.disable()}catch(O){}}}.bind(this));I=true}.bind(this);r=function(K){if(!(K instanceof Ext.data.Store)){return}x=K.getRecords(Signavio.Const.REL.USER);x=x.sort(function(N,M){return N.get("rep").name.trim().toLowerCase()>M.get("rep").name.trim().toLowerCase()?1:-1});var L=this.facade.getCurrentUser();L=x.find(function(M){return M.get("href")===L.getIdentifier()});if(!L){L=this.facade.getCurrentUser().getRecords("info")[0]}x=x.without(L);x.unshift(L);t.overwrite(u.body,{users:x,current:L});g(j)}.bind(this);var m=function(){if((h||e||k||c||B||false)===false){throw new Error("Variables are not initialized.")}var K=s.find(function(M){return M.checked}).id;var L=this.record.get("rep");L.users=h.map(function(M){return M.checked?M.getAttribute("id"):undefined}).compact();L.additionalLicenses=(k.checked?(parseInt(e.value)||0):0);L.licenseType=K;L.licenseOrder=this.createLicenseRequestParam(K,L.users,L.additionalLicenses);L.quotaPackageOrder=this.createQuotaPackageRequestParam();L.paymentInterval=b.options[b.selectedIndex].value;L.startDate=c;L.firstIntervalEnd=B;L.currency=Signavio.I18N.Repository.Purchase.currency;L.sum=(L.users.length+(L.additionalLicenses||0))*a[L.licenseType][L.paymentInterval];this.record.set("rep",L)}.bind(this);var J=function(){j.ownerCt.next.setDisabled(false)};j=new Ext.ux.view.WizardPage({items:[E,u,l],pageId:"WizardPageProducts",onNext:m,onPrevious:J,listeners:{activate:g}});return j},getPage2:function(){var c=this.facade.getCurrentUser().getRecords("info")[0];var f=new Ext.XTemplate('<tpl for=".">','<div class="x-purchase-box x-purchase-method">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.paymentMethod+"</span>",'<input type="radio" {[!["payment_paypal","payment_creditcard"].include(values.paymentmethod) ? "checked=\\"true\\"" : ""]} name="paymentmethod" id="payment_invoice" value="payment_invoice"/>','<label for="payment_invoice">'+Signavio.I18N.Repository.Purchase.billingDesc+' <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Purchase.billingDescMore+'"/></label><br/>','<input type="radio" {[values.paymentmethod == "payment_paypal" ? "checked=\\"true\\"" : ""]} name="paymentmethod" value="payment_paypal" id="payment_paypal"/>','<label for="payment_paypal">'+Signavio.I18N.Repository.Purchase.billingPaypal+' <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Purchase.billingPaypalMore+'"/></label><br/>','<input type="radio" {[values.paymentmethod == "payment_creditcard" ? "checked=\\"true\\"" : ""]} name="paymentmethod" value="payment_creditcard" id="payment_creditcard"/>','<label for="payment_creditcard">'+Signavio.I18N.Repository.Purchase.billingCreditcard+' <img src="'+Signavio.Config.IMAGE_PATH+'/famfamfam/information.png" ext:qtip="'+Signavio.I18N.Repository.Purchase.billingCreditcardMore+'"/></label><br/>',"</div>",'<div class="x-purchase-box">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.billingAddress+"</span>",'<input type="text" name="companyName" value="{company}" blank="'+Signavio.I18N.Repository.Purchase.company+'" class="x-mandatory" maxlength="255"/>','<label for"companyName">*</label>',"<br/>",'<input type="text" name="street" blank="'+Signavio.I18N.Repository.Purchase.street+'" class="x-mandatory" maxlength="255"/>','<label for"street">*</label>',"<br/>",'<input type="text" name="street2" blank="'+Signavio.I18N.Repository.Purchase.street2+'" maxlength="255"/>',"<br/>",'<input type="text" name="zipcode" blank="'+Signavio.I18N.Repository.Purchase.zip+'" class="x-purchase-zip x-mandatory" maxlength="5" maxlength="255"/>','<label for"zipcode">*</label>','<input type="text" name="city" blank="'+Signavio.I18N.Repository.Purchase.city+'" class="x-purchase-city x-mandatory" maxlength="255"/>','<label for"city">*</label>',"<br/>",'<select name="country" class="x-purchase-country">',Signavio.Helper.GetAllCountries().map(function(h){if(h.name==(c.get("rep").country||"Deutschland")){return'<option name="'+h.name+'" selected>'+h.name+"</option>"}else{return'<option name="'+h.name+'">'+h.name+"</option>"}}).join(""),"</select>",'<label for"country">*</label>',"</div>",'<div class="x-purchase-box">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.contactInformation+"</span>",'<input type="text" name="firstName" value="{firstName}" blank="'+Signavio.I18N.Repository.Purchase.firstName+'" class="x-mandatory x-purchase-phone" maxlength="255"/>','<label for"firstName">*</label>','<input type="text" name="lastName" value="{lastName}" blank="'+Signavio.I18N.Repository.Purchase.lastName+'" class="x-mandatory x-purchase-fax" maxlength="255"/>','<label for"lastName">*</label>',"<br/>",'<input type="text" name="mail" value="{mail}" blank="'+Signavio.I18N.Repository.Purchase.mail+'" class="x-mandatory" maxlength="255"/>','<label for"mail">*</label>',"<br/>",'<input type="text" name="phone" value="{phone}" blank="'+Signavio.I18N.Repository.Purchase.phone+'" class="x-mandatory" maxlength="255"/>','<label for"phone">*</label>','<input type="text" name="fax" blank="'+Signavio.I18N.Repository.Purchase.fax+'" class="" maxlength="255">',"</div>","</tpl>");var b=new Ext.Panel({cls:"x-purchase-billing",html:f.apply({firstName:c.get("rep").firstName||"",lastName:c.get("rep").lastName||"",country:c.get("rep").country||"",mail:c.get("rep").mail||"",company:c.get("rep").company||"",phone:c.get("rep").phone||"",paymentmethod:"payment_invoice"})});var g=function(j){var h=j.body.query("input");h.each(function(k){Ext.get(k).on("focus",function(){$(k).removeClassName("x-default");$(k).removeClassName("x-invalid");if(k.nextSibling){$(k.nextSibling).removeClassName("x-invalid")}k.value==k.getAttribute("blank")?k.value="":""});var l=function(){k.value===""?$(k).addClassName("x-default"):"";k.value===""?k.value=k.getAttribute("blank"):""};Ext.get(k).on("blur",l);l()})};var e;var d=function(){var m=e.body.query("input.x-purchase-zip")[0];var h=e.body.query(".x-purchase-country")[0];if(m.value!==""&&m.value!==m.getAttribute("blank")){var k=Ext.isIE?h.options[h.selectedIndex].text:h.value;if((k==="Deutschland"&&!m.value.match(/\d{5}/))||!m.value.match(/^\w+$/)){$(m).addClassName("x-default");m.value=m.getAttribute("blank")}}var j=e.body.query("input.x-mandatory");var n=j.findAll(function(r){return r.value.strip()===""||r.value===r.getAttribute("blank")}).each(function(r){$(r).addClassName("x-invalid");if(r.nextSibling){$(r.nextSibling).addClassName("x-invalid")}var s=Ext.get(r);if(!s.hasActiveFx()){s.highlight("#AD0F5B",{attr:"color",duration:3})}}).length===0;if(n){var p=this.record.get("rep");e.body.query("input").each(function(r){p[r.getAttribute("name")||r.getAttribute("id")]=r.value!==r.getAttribute("blank")?r.value:""});var q=e.body.query("select")[0];q=q.options[q.selectedIndex];p.country_name=q.value;p.country=q.getAttribute("name").toLowerCase();var l=e.body.child("input[name=paymentmethod]:checked");p.paymentmethod=l?l.id:"payment_invoice";if(!p.licenseType&&p.licenseOrder){p.licenseType=(p.licenseOrder[0]||{}).licenseType}p.licenseOrder=this.createLicenseRequestParam(p.licenseType,p.users,p.additionalLicenses);p.quotaPackageOrder=this.createQuotaPackageRequestParam();this.record.set("rep",p);e.ownerCt.next.disable()}return n}.bind(this);e=new Ext.ux.view.WizardPage({items:[b],isNotActive:this.isFollowedPurchase.bind(this),listeners:{activate:g},onNext:d});return e},getPage3:function(){var f=new Ext.XTemplate('<tpl for=".">','<div class="x-purchase-box">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.customer+"</span>",Signavio.I18N.Repository.Purchase.customerTemplate,"</div>",'<div class="x-purchase-box">','<span class="x-label-title">'+Signavio.I18N.Repository.Purchase.purchase+"</span>",'<tpl if="!values.followed">','<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchaseLicenses+"</div>","</tpl>",'<tpl if="values.followed">','<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchaseLicensesAdditional+"</div>","</tpl>",'<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchaseInterval+"</div>",'<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchaseFirstPayment+"</div>",'<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchaseFollowedPayment+"</div>",'<div class="x-purchase-line">'+Signavio.I18N.Repository.Purchase.purchasePaymentMethodPayment+"</div>",'<div class="x-purchase-line x-purchase-hints">'+Signavio.I18N.Repository.Purchase.purchaseHint+"</div>","</div>",'<div class="agb">','<input type="checkbox" name="agb"/>','<label for="agb">'+Signavio.I18N.Repository.Purchase.agb+"<br/>","</div>","</tpl>");var e;var c=new Ext.Panel({cls:"x-purchase-summary",html:""});var g=function(){e.body.mask(Signavio.I18N.Repository.Purchase.validating);Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.VALIDATE_ORDER_PATH,[function(j){e.body.unmask();this.record.set("rep",j);j.start=Signavio.Helper.ParseDate(j.startDate);j.end=Signavio.Helper.ParseDate(j.firstIntervalEnd);j.monthLeft=j.end.getMonth()-j.start.getMonth();j.monthLeft=(j.monthLeft+12)%12;j.daysLeft=(j.start.getDaysInMonth()-j.start.getDate())+1;j.yearsLeft=(j.end.getYear()-j.start.getYear());j.startDate=j.start.format("d.m.Y");j.firstIntervalEnd=j.end.format("d.m.Y");j.sumFirst=(Number((j.sumFirst+"").gsub(",",".")).toFixed(2)+"").gsub("\\.",",");j.sum=(Number((j.sum+"").gsub(",",".")).toFixed(2)+"").gsub("\\.",",");j.paymentmethod=j.paymentmethod||"payment_invoice";j.licenseType=((j.licenseOrder||[])[0]||{}).licenseType;j.licenseCount=((j.licenseOrder||[])[0]||{}).numOfUnassignedUsers||0;j.licenseCount+=(((j.licenseOrder||[])[0]||{}).assignedUsers||[]).length;if(!j.country_name){j.country_name=(Signavio.Helper.GetAllCountries().find(function(k){return k.name.toLowerCase()==j.country.toLowerCase()})||{}).name||"Deutschland"}j.followed=this.isFollowedPurchase();f.overwrite(c.body,j);var h=c.body.query("input")[0];$(h).observe("click",function(){e.ownerCt.next.setDisabled(!h.checked)});$(h).observe("keyup",function(){e.ownerCt.next.setDisabled(!h.checked)});e.ownerCt.next.disable();h.checked=false}.bind(this),function(){e.body.unmask();e.body.mask(Signavio.I18N.Repository.Purchase.errorValidating)}],this.record.get("rep"))}.bind(this);var b=function(){e.ownerCt.next.enable()};var d=function(){e.body.mask(Signavio.I18N.Repository.Purchase.sending).fadeIn({endOpacity:0.5});var j=this.record.get("rep");if(!j.licenseType){j.licenseType=(j.licenseOrder[0]||{}).licenseType}j.licenseOrder=this.createLicenseRequestParam(j.licenseType,j.users,j.additionalLicenses);j.quotaPackageOrder=this.createQuotaPackageRequestParam();for(var h in j){if(h&&"string"==typeof j[h]){j[h]=Signavio.Utils.unescapeHTML(j[h])}}Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.ORDER_PATH,[function(k){this.purchaseSubmitted(this.record);e.ownerCt.next.enable();e.ownerCt.nextPage(true)}.bind(this),function(){e.body.unmask();e.body.mask(Signavio.I18N.Repository.Purchase.errorPurchase).fadeIn({endOpacity:0.5})}],j);e.ownerCt.next.disable();return false}.bind(this);e=new Ext.ux.view.WizardPage({items:[c],nextLabel:Signavio.I18N.Repository.Purchase.submit,onNext:d,onPrevious:b,listeners:{activate:g}});return e},getPage4:function(){var b=this.record.get("rep").mail;var e=new Ext.Panel({html:this.facade.isExpired()?"<div>"+new Ext.XTemplate(Signavio.I18N.Repository.Purchase.completeExpired.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).apply({mail:b})+"</div>":"<div>"+new Ext.XTemplate(Signavio.I18N.Repository.Purchase.complete.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS)).apply({mail:b})+"</div>"});var c;var d=function(){e.body.query("a.x-tab-change").each(function(g){$(g).observe("click",function(h){this.showTab(Number(g.getAttribute("href").split("#").last()));Event.stop(h);return false}.bind(this))}.bind(this));var f=function(){this.window.close()}.bind(this);if(this.facade.isExpired()){c.ownerCt.buttons[1].handler=f;c.ownerCt.buttons[1].show()}else{c.ownerCt.buttons[1].handler=f;c.ownerCt.buttons[1].el.dom.innerHTML=Signavio.I18N.Repository.Purchase.close}}.bind(this);c=new Ext.ux.view.WizardPage({items:[e],hideButtons:true,listeners:{activate:d}});return c},getWarningPage:function(){var d=new Ext.Panel({html:Signavio.I18N.Repository.Purchase.salesMessage,border:false});var b;var c=function(){if(b.ownerCt.buttons[1].text==Signavio.I18N.Repository.Purchase.cancel){b.ownerCt.buttons[1].show()}b.ownerCt.buttons[2].show()}.bind(this);b=new Ext.ux.view.WizardPage({items:[d],hideButtons:true,onPrevious:function(){var f=b.ownerCt;var e=f.items.items.find(function(g){return g.pageId==="WizardPageProducts"});if(e){f.setTab(e)}return false},listeners:{activate:c}});return b}};Signavio.Plugins.Purchase=Signavio.Core.Plugin.extend(Signavio.Plugins.Purchase)})();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.AMLImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:25,name:Signavio.I18N.Repository.Offer.importAMLTitle,description:Signavio.I18N.Repository.Offer.importAMLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_star.png",functionality:this.showDummyDialogue.bind(this,"aml"),isDisabled:function(){return false}.bind(this)})}})}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.XPDLImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:15,name:Signavio.I18N.Repository.Offer.importXPDLTitle,description:Signavio.I18N.Repository.Offer.importXPDLDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.showDummyDialogue.bind(this,"xpdl"),isDisabled:function(){return false}.bind(this)})}})}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.BPMN2ImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:10,name:Signavio.I18N.Repository.Offer.BPMN2_0Import.title,description:Signavio.I18N.Repository.Offer.BPMN2_0Import.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.showDummyDialogue.bind(this,"bpmn2"),isDisabled:function(){return false}.bind(this)})}})}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.ArchiveImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:5,name:Signavio.I18N.Repository.Offer.archiveRestore,description:Signavio.I18N.Repository.Offer.archiveRestoreDesc,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/compress_down.png",functionality:this.showDummyDialogue.bind(this,"sgx"),isDisabled:function(){return false}.bind(this)})}})}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.VisioImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:30,name:Signavio.I18N.Repository.Offer.importVisioTitle,description:Signavio.I18N.Repository.Offer.importVisioDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_office.png",functionality:this.showDummyDialogue.bind(this,"visio"),isDisabled:function(){return false}.bind(this)})}})}();if("undefined"===typeof Signavio){var Signavio={}}if("undefined"===typeof Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Jpdl4ImportDummy=Signavio.Core.ImportPlugin.extend({enabled:true,relTypes:["views"],construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"import",index:20,name:Signavio.I18N.Repository.Offer.jpdl4ImportTitle,description:Signavio.I18N.Repository.Offer.jpdl4ImportDescription,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/page_white_code.png",functionality:this.showDummyDialogue.bind(this,"jpdl4"),isDisabled:function(){return false}.bind(this)})}})}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}new function(){Signavio.Plugins.Socialize={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);var b=function(){return this.getSelection().length!==1||this.getSelection()[0].get("rel")!="mod"||(this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0#"&&this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0conversation#"&&this.getSelection()[0].get("rep").namespace!="http://b3mn.org/stencilset/bpmn2.0choreography#")}.bind(this);var c=function(){return this.facade.getCurrentRootFolder()===undefined||this.facade.getCurrentRootFolder()!==this.facade.getTrashRecord()}.bind(this);var a=function(){return b.call(this)||this.facade.getCurrentRootFolder()===this.facade.getTrashRecord()}.bind(this);this.facade.offer({seperated:true,relGroup:"scenter",index:8});this.facade.offer({name:Signavio.I18N.Repository.Socialize.title,index:9,relGroup:"scenter",description:Signavio.I18N.Repository.Socialize.description,icon:Signavio.Config.IMAGE_PATH+"/famfamfam/world_edit.png",functionality:this.deploy.bind(this),isDisabled:a,isVisible:c})},deploy:function(){var a;this.getSelection().each(function(b){if(b.get("rel")==Signavio.Const.REL.MODEL){var c=b.get("href");a=c.replace(/\/model\//,"")}}.bind(this));this.performDeploy(a)},performDeploy:function(f){var e=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldUserName,width:250,tabIndex:1001,autoCreate:{tag:"input",type:"text",size:"20"},name:"username"});var c=new Ext.form.TextField({fieldLabel:Signavio.I18N.Repository.Header.windowFieldPassword,width:250,autoCreate:{tag:"input",type:"password",size:"20"},inputType:"password",tabIndex:1002,listeners:{specialkey:function(h,g){if(g.getKey()===g.ENTER){b.buttons[1].handler()}}},name:"password"});var a=new Ext.form.Checkbox({hideLabel:true,boxLabel:Signavio.I18N.Repository.Socialize.anonymize,checked:false});var d=Signavio.I18N.Language.toLowerCase().startsWith("de");var b=new Ext.Window({bodyStyle:"background:white;padding:10px;",cls:"x-window-login x-window-socialize",layout:"column",modal:true,width:d?720:550,minWidth:d?600:500,height:d?400:350,minHeight:d?400:350,title:Signavio.I18N.Repository.Socialize.title,listeners:{afterlayout:function(){var g=this.body.getHeight()-this.body.getPadding("tb");this.items.get(1).setHeight(g)}},items:[new Ext.Panel({width:d?350:250,layout:"anchor",border:false,items:[new Ext.Panel({html:Signavio.I18N.Repository.Socialize.infoMessage,anchor:"100%",style:"margin-bottom:5px;",border:false}),new Ext.Panel({html:'<img src="'+Signavio.Config.IMAGE_PATH+'/nuvola/32x32/actions/messagebox_warning_yellow.png" style="float:left;margin:4px 10px 0px 4px;"/> '+Signavio.I18N.Repository.Socialize.warningMessage,anchor:"100%",style:"margin-bottom:10px;",border:false}),new Ext.Panel({html:Signavio.I18N.Repository.Socialize.registrationMessage,anchor:"100%",style:"margin-bottom:5px;",border:false}),new Ext.Panel({border:false,layout:"form",anchor:"100%",items:[e,c,a]})]}),new Ext.Panel({columnWidth:1,style:"margin-left:10px;",bodyStyle:"overflow:auto;",html:'<img src="/p/model/'+f+'/png" />'})],buttons:[new Ext.SimpleButton({text:Signavio.I18N.Repository.Header.windowBtnCancel,tabIndex:1004,handler:function(){b.close()}}),{text:Signavio.I18N.Repository.Socialize.deploy,tabIndex:1003,handler:function(){if(!(e.getValue()||"").trim()||!(c.getValue()||"").trim()){return}var g=window.open();Signavio.Core.Stores.RequestManager.doPost(Signavio.Config.BACKEND_PATH+Signavio.Config.MODEL_PATH+"/"+f+Signavio.Config.BPMN_INFO_PATH,[function(h){var j=h.responseText;g.location=j;g.focus();b.close()}.bind(this),function(h){g.close();Ext.Msg.alert(Signavio.I18N.Repository.Socialize.title,Signavio.I18N.Repository.Socialize.fail).setIcon(Ext.Msg.INFO).getDialog().syncSize()}.bind(this)],{username:e.getValue(),password:c.getValue(),anonymize:a.getValue()})}}]});b.show()}};Signavio.Plugins.Socialize=Signavio.Core.Plugin.extend(Signavio.Plugins.Socialize)}();if(!Signavio){var Signavio={}}if(!Signavio.Plugins){Signavio.Plugins={}}(function(){Signavio.Plugins.Certificates={enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({relGroup:"configure",name:Signavio.I18N.Repository.Offer.certificateTitle,description:Signavio.I18N.Repository.Offer.certificateDescription,arrange:"right",icon:Signavio.Config.IMAGE_PATH+"/famfamfam/group_key.png",functionality:this.show.bind(this),index:20,isVisible:function(){return this.facade.isCurrentUserAdmin()}.bind(this)})},show:function(){var a=new Ext.Window({modal:true,title:Signavio.I18N.Repository.Offer.certificateTitle,bodyStyle:"background:white;padding:10px;",items:[this.getNoPortalUserQuotaHintPanel(this),new Ext.Panel({border:false,html:Signavio.I18N.Repository.Offer.certificateLabel}),this.getCertificate()],width:500,resizable:false,autoHeight:true,listeners:{close:function(){this.onClose.call(this);a.destroy()}.bind(this)},buttons:[{text:Signavio.I18N.Repository.SecurityCenter.Button.close,handler:function(){a.close()}.bind(this)}]});a.show()},getNoPortalUserQuotaHintPanel:function(b){var a=function(){var c=Signavio.I18N.Repository.Offer.certificateNoQuotaHint;c=c.gsub("\\[supportMailAdresse\\]",Signavio.Config.SUPPORTMAILADDRESS);c=c.gsub("\\[supportPhoneNumber\\]",Signavio.Config.SUPPORTPHONENUMBER);return c};if(!b.noPortalUserQuotaPanel){b.noPortalUserQuotaPanel=new Ext.Panel({border:false,html:a(),cls:"y-certificate-dialog-no-quota-hint",hidden:true})}return b.noPortalUserQuotaPanel},updateNoPortalUserQuotaHint:function(b,a){b.getNoPortalUserQuotaHintPanel(b).hide();if((((a||{}).data||{}).rep||{}).userpkgactivequota===0){b.getNoPortalUserQuotaHintPanel(b).show()}},onClose:function(b){var a=Signavio.Core.StoreManager.getStore(Signavio.Config.CERTIFICATE_PATH);if(a){a.purgeListeners()}},getCertificate:function(){var d=Signavio.Core.StoreManager.getRelatedStore(Signavio.Config.CERTIFICATE_PATH);var b=this.facade.getCurrentUser().getRecords(Signavio.Const.REL.INFO)[0],e=this;var h="<img style='background:url("+Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/loading.gif) no-repeat center center transparent;width:16px;height16px;' src='"+Signavio.Config.LIBS_PATH+"/ext-2.0.2/resources/images/default/tree/s.gif'/>";var c=new Ext.XTemplate('<tpl if="values">','<tpl for=".">','<tpl for="data">','<tpl for="rep">','<a href="/p/certificateDownload/{id}?signavio-id={[Ext.Ajax.getSecurityToken()]}" target="_blank" style="{[!values.active?"color:gray;":""]}">',Signavio.I18N.Repository.Offer.certificateDownload,"</a>"," (",'<tpl if="values.active">',"<a href='#' class='x-deactivate-certificate'>",Signavio.I18N.Repository.Offer.certificateDeactivate,"</a>","</tpl>",'<tpl if="!values.active">',"<a href='#' class='x-activate-certificate'>",Signavio.I18N.Repository.Offer.certificateActivate,"</a>","</tpl>",", <a href='#' class='x-remove-certificate'>",Signavio.I18N.Repository.Offer.certificateRemove,"</a>",")","<br/>","<br/>","<span style='color:gray;line-height:17px;margin-right: 5px;'>",Signavio.I18N.Repository.Offer.certificatePassword,"</span> {pw}","<br/>","<span style='color:gray;margin-right: 5px;'>",Signavio.I18N.Repository.Offer.certificateExpires,"</span> {[Signavio.Helper.ParseDate(values.expires).format(Signavio.Const.DATE_FORMAT)]}","<br/>","</tpl>","</tpl>","</tpl>","</tpl>",'<tpl if="!values">',"<a href='#' class='x-create-certificate'>",Signavio.I18N.Repository.Offer.certificateCreate,"</a>","</tpl>");var a=new Ext.Panel({border:false,bodyStyle:"padding:15px 0 10px 0;",autoHeight:true,html:h});var f=new Ext.Panel({border:false,autoHeight:true,items:[a]});var g=function(){var j=d.getAt(0);e.updateNoPortalUserQuotaHint(e,j);e.getSharepointSolutionDownloadPanel(j,f);a.body.update(c.apply(j||""));f.ownerCt.buttons[0].enable();f.ownerCt.syncSize();f.ownerCt.center();a.body.select("a").on("click",function(k,l){if(!l.className){return}Event.stop(k);f.ownerCt.buttons[0].disable();a.body.update(h);a.ownerCt.syncSize();switch(l.className){case"x-create-certificate":d.add(Signavio.Core.RecordCreator.create("certificate","",{}),true);break;case"x-activate-certificate":case"x-deactivate-certificate":if(j){var m=Object.clone(j.get("rep"));m.active=l.className=="x-activate-certificate";j.set("rep",m);j.commit()}break;case"x-remove-certificate":if(j){Ext.Msg.confirm(Signavio.I18N.Repository.Offer.certificateDeleteTitle,Signavio.I18N.Repository.Offer.certificateDeleteDescription,function(n){if(n=="yes"){d.remove(j,true)}else{g()}}).getDialog().setWidth(400)}break}});f.doLayout()};d.on("add",g);d.on("remove",g);d.on("load",g);d.on("update",g);return f},getSharepointSolutionDownloadPanel:function(H,l){var z=(((H||{}).data||{}).rep||{}).sharepointactive;if(!z||l.items.length>1){return}var G=this,v,c,I,k,h,D,m,A;var t="<tpl for=\".\"><tpl if=\"active\"><div class='x-combo-list-item'>{title}</div></tpl><tpl if=\"!active\"><div class='x-combo-list-item item-inactive' style='display:none'>{title}</div></tpl></tpl>";v=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:[{name:"active"},{name:"title"},{name:"value"}],data:[[true,"SharePoint 2007","SignavioViewer2007"],[true,"SharePoint 2010","SignavioViewer2010"],[true,"SharePoint 2013","SignavioViewer2013"],[true,"SharePoint 365","SignavioViewer365"]]}),fieldLabel:Signavio.I18N.Repository.Offer.certificateSharepointVersion,valueField:"value",displayField:"title",value:"SignavioViewer2013",mode:"local",width:290,readOnly:false,forceSelection:true,editable:false,selectOnFocus:true,tpl:new Ext.XTemplate(t),listeners:{select:function(){j();D()}}});c=new Ext.ux.form.ComboBox({store:new Ext.data.SimpleStore({fields:[{name:"title"},{name:"value"}],data:[[Signavio.I18N.Repository.Offer.certificateSharepointCertBased,"Certificate"],[Signavio.I18N.Repository.Offer.certificateSharepointLDAPBased,"LDAP"],[Signavio.I18N.Repository.Offer.certificateSharepointAzureAD,"AzureAD"]]}),fieldLabel:Signavio.I18N.Repository.Offer.certificateSharepointVersionAuthMode,valueField:"value",displayField:"title",mode:"local",readOnly:false,width:290,forceSelection:true,editable:false,selectOnFocus:true,listeners:{select:function(){D();j()}}});I=new Ext.XTemplate("<a href='/p/sharepoint?signavioviewerversion={sharepointversion}&sharepointmode={authmode}&signavio-id="+Ext.Ajax.getSecurityToken()+"' target='_blank'>",Signavio.I18N.Repository.Offer.certificateDownloadSharePoint,"</a>");k=new Ext.Panel({html:"",border:false,bodyStyle:"margin-top: 7px",listeners:{render:function(){D()}}});h=new Ext.Panel({border:false,html:Signavio.I18N.Repository.Offer.certificateDownloadSharePointInfo,style:"padding-top:5px; padding-bottom:7px"});var g=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointUrlDescription});var a=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointUrl});var F=new Ext.form.TextField({width:290,tabIndex:1000,value:"",autoCreate:{tag:"input",type:"text",size:"20"},listeners:{focus:function(){var p=E.body&&n.body.child("img");if(p){p.fadeOut()}},specialkey:function(J,p){if(p.getKey()==p.ENTER){q.focus()}}}});var u=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointUrlToken});var q=new Ext.form.TextField({width:290,tabIndex:1000,value:"",listeners:{focus:function(){var p=E.body&&n.body.child("img");if(p){p.fadeOut()}},specialkey:function(J,p){if(p.getKey()==p.ENTER){E.handler()}}}});var e=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointAzureTenantid});var x=new Ext.form.TextField({width:290,tabIndex:1000,value:"",autoCreate:{tag:"input",type:"text",size:"20"},listeners:{focus:function(){var p=E.body&&n.body.child("img");if(p){p.fadeOut()}},specialkey:function(J,p){if(p.getKey()==p.ENTER){y.focus()}}}});var w=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointPrincipalId});var y=new Ext.form.TextField({width:290,tabIndex:1000,value:"",listeners:{focus:function(){var p=E.body&&n.body.child("img");if(p){p.fadeOut()}},specialkey:function(J,p){if(p.getKey()==p.ENTER){b.focus()}}}});var d=new Ext.form.Label({text:Signavio.I18N.Repository.Configuration.sharepointAzureSymKey});var b=new Ext.form.TextField({width:290,tabIndex:1000,value:"",listeners:{focus:function(){var p=E.body&&n.body.child("img");if(p){p.fadeOut()}},specialkey:function(J,p){if(p.getKey()==p.ENTER){E.handler()}}}});var C=new Ext.Panel({border:false,html:"<img src='"+Ext.BLANK_IMAGE_URL+"' class='x-success' style='display: none;'/>"});var E=new Ext.Button({text:Signavio.I18N.Repository.Configuration.sharepointUrlBtnTitle,style:"display: inline; margin-left: 5px; float:left;",handler:function(){var p=(F.getValue()||"").trim(),J=C.body.child("img");if(!p.endsWith("/")){p+="/"}if(!p.startsWith("http")){p="http://"+p}G.doSaveSharePointConnector(p,q.getValue(),c.getValue(),x.getValue(),y.getValue(),b.getValue(),function(K){if(K){if(c.getValue()==="LDAP"&&p&&J){F.setValue(p);window.clearTimeout(G.submitTimer);G.submitTimer=window.setTimeout(G.testURL.bind(G,p,J),100)}else{if(c.getValue()==="AzureAD"&&J){window.clearTimeout(G.submitTimer);G.submitTimer=window.setTimeout(G.testAzureAD.bind(G,J,x.getValue(),y.getValue(),b.getValue(),J),100)}}}else{G.setImageTooltip(J,Signavio.I18N.Repository.Configuration.sharepointUrlFailed,"x-failed");j()}D()})}});var n=new Ext.Panel({border:false,style:"padding: 5px 0px",items:[E,C]});var r=function(J){var p=[e,x,w,y,d,b];p.each(function(K){K.setVisible(J)})};var f=function(J){var p=[a,F,u,q];p.each(function(K){K.setVisible(J)})};A=new Ext.Panel({border:false,cls:"x-sharepoint-connector",items:[g,a,F,u,q,e,x,w,y,d,b,n],listeners:{render:function(){j()}}});var j=function(){var K=G.facade.getConfig("department","sharepointurl","explorer");var N=G.facade.getConfig("department","sharepointtoken","explorer");var p=G.facade.getConfig("department","sharepointmode","explorer");var M=G.facade.getConfig("department","sharepointazuretenantid","explorer");var J=G.facade.getConfig("department","sharepointazureprincipalid","explorer");var L=G.facade.getConfig("department","sharepointazuresymkey","explorer");if(!c.getValue()){c.setValue(p||c.getValue())}p=c.getValue();f(p==="LDAP");r(p==="AzureAD");F.setValue(K||"");q.setValue(N||"");x.setValue(M||"");y.setValue(J||"");b.setValue(L||"")},D=function(){var M=(F.getValue()&&q.getValue())||(x.getValue()&&y.getValue()&&b.getValue());A.setVisible(c.getValue()==="LDAP"||c.getValue()==="AzureAD");var p=c.getValue()==="Certificate"||M;h.setVisible(p);k.setVisible(p);B.setVisible(p);var K=v.store;var L=function(N){K.suspendEvents();K.each(function(O){O.set("active",false)});N.each(function(O){K.each(function(P){if(P.get("value")===O){P.set("active",true)}})});K.resumeEvents();K.fireEvent("datachanged")};if(c.getValue()==="AzureAD"){L(["SignavioViewer365"]);v.setValue("SignavioViewer365")}else{if(c.getValue()==="LDAP"){var J=[];K.each(function(N){if(N.get("value")!=="SignavioViewer365"){J.push(N.get("value"))}});L(J);if(v.getValue()==="SignavioViewer365"){v.setValue("SignavioViewer2013")}}else{var J=[];K.each(function(N){J.push(N.get("value"))});L(J)}}if(k.body){I.overwrite(k.body,{sharepointversion:v.getValue(),authmode:c.getValue()})}l.ownerCt.syncSize()};var B=new Ext.form.Label({text:Signavio.I18N.Repository.Offer.certificateSharepointVersion});var s=new Ext.Panel({border:false,cls:"x-sharepoint-download",bodyStyle:"padding-top:7px",items:[new Ext.Panel({border:false,html:Signavio.I18N.Repository.Configuration.sharepointDownloadDesc,style:"padding-bottom:7px"}),new Ext.form.Label({text:Signavio.I18N.Repository.Offer.certificateSharepointVersionAuthMode,style:"padding-top: 5px"}),c,A,h,B,v,k],listeners:{render:function(){j();D()}}});l.add(s);l.doLayout()},doJSONPRequest:function(b,g){var f="loadResources"+(Math.round(Math.random()*1000)),e=30*1000,a,d={method:f};var c=window.setTimeout(function(){g.apply(g,[false])}.bind(this),e);window[f]=function(h){delete window[f];window.clearTimeout(c);if(a&&a.parentNode){a.parentNode.removeChild(a)}g.apply(g,[true,h])};a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",b+"?"+Object.toQueryString(d));document.getElementsByTagName("head")[0].appendChild(a)},testURL:function(a,b){delete this.submitTimer;this.setImageTooltip(b,Signavio.I18N.Repository.Configuration.sharepointUrlWaiting,"x-loading");a=String(a||"");a+=!a.endsWith("/")?"/":"";a+=!a.include(Signavio.Const.SHAREPOINT_CONNECTOR_TEST_PATH)?Signavio.Const.SHAREPOINT_CONNECTOR_TEST_PATH+"":"";a=!a.startsWith("http")?"http://"+a:a;this.doJSONPRequest(a,function(d,c){if(d&&(!c||(c instanceof Array&&c[0]&&c[0].status===200))){this.setImageTooltip(b,Signavio.I18N.Repository.Configuration.sharepointUrlServiceAvailable)}else{this.setImageTooltip(b,Signavio.I18N.Repository.Configuration.sharepointUrlServiceNotAvailable,"x-warning")}}.bind(this))},testAzureAD:function(e,a,c,b){delete this.submitTimer;var d=this;Signavio.Core.Stores.RequestManager.doGet(Signavio.Config.BACKEND_PATH+"/azureadproxy",[function(){d.setImageTooltip(e,Signavio.I18N.Repository.Configuration.sharepointUrlServiceAvailable)},function(){d.setImageTooltip(e,Signavio.I18N.Repository.Configuration.sharepointUrlServiceNotAvailable,"x-warning")}],{sharepointazuretenantid:a,sharepointazureprincipalid:c,sharepointazuresymkey:b,method:"testazuread"})},setImageTooltip:function(b,c,a){if(!b){return}b.dom.setAttribute("ext:qtip",c||"");b.removeClass("x-failed").removeClass("x-loading").removeClass("x-warning").addClass(a||"").fadeIn({block:true})},getDepatmentId:function(){var a=this.facade.getCurrentUser().getRecords("info")[0];if(a&&a.get("rep").department){return a.get("rep").department}return this.facade.getConfig().tenant.split("/").last()},doSaveSharePointConnector:function(c,d,e,f,g,a,h){var b=Signavio.Core.StoreManager.getStore(Signavio.Config.CONFIGURATION_PATH,true,function(){var m=this.getDepatmentId(),k,l;k=function(){b.un("submitted",k);b.un("submitfailed",l);h.apply(h,[].concat(true,arguments))};l=function(){b.un("submitted",k);b.un("submitfailed",l);h.apply(h,[].concat(false,arguments))};b.on("submitted",k);b.on("submitfailed",l);var j=[{name:"sharepointmode",value:e}];if(e==="LDAP"){j.push({name:"sharepointtoken",value:d});j.push({name:"sharepointurl",value:c})}else{if(e==="AzureAD"){j.push({name:"sharepointazureprincipalid",value:g});j.push({name:"sharepointazuresymkey",value:a});j.push({name:"sharepointazuretenantid",value:f})}}j.each(function(p){var n=b.getConfiguration(m,"explorer",p.name),r=p.value||"";if(n){var q=Object.clone(n.get("rep"));q.value=r||"";n.set("rep",q)}else{var s=Signavio.Core.RecordCreator.create("config","",{name:p.name,object:m,category:"explorer",value:r||"",type:"string"});b.add(s)}});if(b.getModifiedRecords().length>0||(b.addedRecords&&b.addedRecords.length>0)||(b.removedRecords&&b.removedRecords.length>0)){b.commitChanges()}}.bind(this))}};Signavio.Plugins.Certificates=Signavio.Core.Plugin.extend(Signavio.Plugins.Certificates)}());if(!Signavio.Plugins){Signavio.Plugins={}}Signavio.Plugins.TeachingPackage=Signavio.Core.Plugin.extend({enabled:true,construct:function(){arguments.callee.$.construct.apply(this,arguments);this.facade.offer({name:Signavio.I18N.Repository.Offer.teachingTitle,description:Signavio.I18N.Repository.Offer.teachingDesc,arrange:"right",index:1,relGroup:"help",icon:Signavio.Config.IMAGE_PATH+"/nuvola/16x16/apps/bookcase.png",functionality:this.showTeachingPackage.bind(this)})},showTeachingPackage:function(){var a=Signavio.Config.TEACHING_PACKAGE;var b=Signavio.I18N.Repository.Offer.teachingTitle;this.showIFramePanel(a,b)},showIFramePanel:function(b,e){if(Ext.isIPad){window.open(b);return}var c="<iframe src='"+b+"' class='x-help-iframe'></iframe>";c+='<br/><a class="x-help-a" target="_blank" href="'+b+'">'+Signavio.I18N.Repository.Offer.teachingOpenInNewWindow+"</a>";var a=new Ext.Panel({height:"100%",width:"100%",html:c});var d=new Ext.Window({cls:"x-help",modal:true,title:e,items:[a],resizable:false,header:true,shadow:false,draggable:false});d.show()}});